OpenAI Codex v0.104.0 (research preview)
--------
workdir: /Users/emmanuel/Documents/Theory/Redefining_racism
model: gpt-5.2-codex
provider: openai
approval: never
sandbox: workspace-write [workdir, /tmp, $TMPDIR]
reasoning effort: high
reasoning summaries: auto
session id: 019c88d5-4078-7582-8785-a43aa9c4cbaf
--------
user
You are a Swift/SwiftUI developer. A previous attempt to complete a task failed.

TESTING & DEBUGGING REFERENCE:
For building, testing, and debugging iOS/macOS apps, reference this workflow guide:
/Users/emmanuel/Dev/Tools/Eocon-Foundation-V1/.Foundation/Docs/swiftDocs/Testing/XCODEBUILD_MCP_WORKFLOW.md

This guide covers:
- XcodeBuild MCP server tools for programmatic Xcode interaction
- Building for simulator, booting simulators, installing/launching apps
- UI automation: screenshots, accessibility hierarchy, tap simulation
- Debugging UI issues (button taps, gestures, navigation)

=== ORIGINAL TASK ===
I have created the following plan after thorough exploration and analysis of the codebase. Follow the below plan verbatim. Trust the files and references. Do not re-verify what's written in the plan. Explore only when absolutely necessary. First implement all the proposed file changes and then I'll review all the changes together at the end.

## Observations

T1–T6 are complete. The full backend is in place: \`AnalysisPipeline\`, \`TierResolver\`, \`DefaultPolicyScorer\`, \`ModelDownloadManager\`, \`HistoricalPolicies\`, and all SwiftData models. \`ContentView.swift\` is a placeholder. No UI views, ViewModels, Style structs, or \`ReportExporter\` exist yet. One data-model gap must be closed first: \`AnalyzedClause\` does not persist \`architectureScores\`, \`proxyDetection\`, or \`wasSafetyFallback\`, which are required by the drill-down chart views and export tier-usage stats.

## Approach

Build the UI layer in dependency order: close the data-model gap → navigation shell → screens in flow order → chart views → export → accessibility layer → macOS sidebar. Every view follows the MVVM-S pattern (\`@Observable\` ViewModel + pure-value Style struct). iOS uses \`NavigationStack\`; macOS uses \`NavigationSplitView\` gated with \`#if os(macOS)\`.

---

## Step 1 — Extend \`AnalyzedClause\` to Persist Chart Data

In \`file:app/decodingOppression/decodingOppression/Models/AnalyzedClause.swift\`, add three new stored properties:

- \`architectureScoresData: Data\` — \`@Attribute(.externalStorage)\`, JSON-encoded \`ArchitectureScores\`; expose a computed \`architectureScores: ArchitectureScores\` getter/setter (same pattern as \`PolicyAnalysis.scoreResult\`)
- \`proxyTerms: [String]\` — stored directly (small array)
- \`expandsOutgroup: Bool\`
- \`wasSafetyFallback: Bool\` — \`true\` when \`TierResolver\` routed the clause to Tier 2 after a Tier 3 safety guardrail rejection

Update the \`init\` to accept these new parameters with sensible defaults so existing call sites compile without changes.

---

## Step 2 — Navigation Shell (\`ContentView.swift\`)

Replace the placeholder \`ContentView\` entirely.

- Add \`@AppStorage(\"hasCompletedOnboarding\") private var hasCompletedOnboarding: Bool = false\`
- **iOS path** (\`#if os(iOS)\`): \`NavigationStack\` — show \`WelcomeView\` when \`!hasCompletedOnboarding\`, otherwise \`PolicyHistoryView\` as the root
- **macOS path** (\`#if os(macOS)\`): \`NavigationSplitView\` with a sidebar (\`List\` of \`SidebarItem\` enum: \`.analyze\`, \`.training\`, \`.validation\`, \`.data\`) and a detail column that switches on the selected item; the Analyze item renders \`PolicyHistoryView\` in the sidebar column and a detail panel for \`ScoreCardView\`/charts
- Pass \`hasCompletedOnboarding\` binding into \`WelcomeView\`

---

## Step 3 — \`WelcomeView\` + \`WelcomeViewModel\` + \`WelcomeViewStyle\`

**Files:** \`Views/WelcomeView.swift\`, \`ViewModels/WelcomeViewModel.swift\`, \`Views/Style/WelcomeViewStyle.swift\`

**\`WelcomeViewModel: @Observable @MainActor\`**
- \`isDownloadStarted: Bool\`
- \`func getStarted(deps: AppDependencies, hasCompletedOnboarding: inout Bool)\` — calls \`deps.startTier2Download()\`, sets \`hasCompletedOnboarding = true\`

**\`WelcomeView\`**
- App icon, one-sentence description, \"Get Started\" button
- Inline download progress section (observe \`modelDownloadManager.state\`): \`ProgressView(value:)\` + percentage label + \"Pause\" button calling \`modelDownloadManager.cancelDownload()\`
- Retry button when \`modelDownloadManager.downloadError != nil\`
- Accessibility: \`.accessibilityHint\` on \"Get Started\" button; \`@AccessibilityFocusState\` to move focus to progress bar after tap

**\`WelcomeViewStyle\`**
- \`reduceMotion\`, \`dynamicTypeSize\` environment values
- \`static func progressAnimation(reduceMotion: Bool) -> Animation?\`

---

## Step 4 — \`PolicyHistoryView\` + \`PolicyHistoryViewModel\` + \`PolicyHistoryViewStyle\`

**Files:** \`Views/PolicyHistoryView.swift\`, \`ViewModels/PolicyHistoryViewModel.swift\`, \`Views/Style/PolicyHistoryViewStyle.swift\`

**\`PolicyHistoryViewModel: @Observable @MainActor\`**
- \`isShowingFilePicker: Bool\`
- \`selectedAnalysis: PolicyAnalysis?\`
- \`func delete(_ analysis: PolicyAnalysis, context: ModelContext)\` — calls \`context.delete(analysis)\`

**\`PolicyHistoryView\`**
- \`@Query(sort: \\PolicyAnalysis.dateAnalyzed, order: .reverse) var analyses: [PolicyAnalysis]\`
- \`@Environment(\\.modelContext) private var modelContext\`
- Navigation bar: title \"Analyses\", trailing \"+\" button sets \`viewModel.isShowingFilePicker = true\`
- MLX downloading banner: shown when \`modelDownloadManager.state\` is \`.downloading\` or \`.unavailable\` (and \`hasCompletedOnboarding\`); disappears when \`.available\`
- List rows: policy name, formatted date + clause count, COI badge
- \`.swipeActions\` (iOS) / \`.contextMenu { Button(\"Delete\", role: .destructive) }\` (macOS) calling \`viewModel.delete\`
- Empty state: \`ContentUnavailableView(\"No Analyses\", systemImage: \"doc.text.magnifyingglass\", description: Text(\"Analyze your first policy\"))\`
- \`.fileImporter(isPresented: \$viewModel.isShowingFilePicker, allowedContentTypes: [.pdf])\` → on success navigate to \`AnalysisView(pdfURL:)\`
- Tapping a row navigates to \`ScoreCardView(analysis:)\`

**\`PolicyHistoryViewStyle\`**
- \`static func coiBadgeColor(_ coi: Double, differentiateWithoutColor: Bool) -> (Color, String)\` — returns color + icon name
- COI severity thresholds: \`coi ≥ 0.6\` → red/\"exclamationmark.triangle\", \`0.3..<0.6\` → orange/\"minus.circle\", \`< 0.3\` → green/\"checkmark.shield\"

---

## Step 5 — \`AnalysisViewModel\` + \`AnalysisView\` + \`AnalysisViewStyle\`

**Files:** \`ViewModels/AnalysisViewModel.swift\`, \`Views/AnalysisView.swift\`, \`Views/Style/AnalysisViewStyle.swift\`

**\`AnalysisViewModel: @Observable @MainActor\`**
- Properties: \`stage: String\`, \`coiValue: Double\`, \`partialScores: ScoreResult\`, \`clauseIndex: Int\`, \`totalClauses: Int\`, \`isComplete: Bool\`, \`error: Error?\`, \`finalAnalysis: PolicyAnalysis?\`, \`classifiedClauses: [TierClassification]\`
- \`func startAnalysis(pdfURL: URL, deps: AppDependencies, context: ModelContext)\` — calls \`deps.makeAnalysisPipeline()\`, iterates \`AsyncStream<AnalysisProgress>\`:
  - \`.extracting\` → \`stage = \"Extracting text…\"\`
  - \`.classifying(clauseIndex:total:partialScores:)\` → update \`stage\`, \`clauseIndex\`, \`totalClauses\`, \`coiValue\`, \`partialScores\`; append to \`classifiedClauses\`
  - \`.complete(scoreResult)\` → build \`PolicyAnalysis\` + \`[AnalyzedClause]\` (populating \`architectureScores\`, \`proxyTerms\`, \`expandsOutgroup\`, \`wasSafetyFallback\` from \`TierClassification\`), \`context.insert\`, set \`finalAnalysis\`, \`isComplete = true\`
  - \`.failed(error)\` → set \`error\`
- \`func cancel()\` — cancels the pipeline task

**\`AnalysisView\`**
- Receives \`pdfURL: URL\`
- Filename in nav bar title
- Tier availability banner (same as \`PolicyHistoryView\`)
- Stage label
- COI gauge: circular \`Canvas\` or \`ZStack\` with \`Circle\` stroke arcs; animates from 0 to \`viewModel.coiValue\`
- Clause counter + \`ProgressView(value: Double(clauseIndex) / Double(max(totalClauses, 1)))\`
- Sub-score rows (DIS, ADS, EIS, CIS, OES): show value if \`clauseIndex > 0\`, else \"—\"; label \"Preliminary\" until \`isComplete\`
- On \`isComplete\`: show \"View Full Results\" \`Button\` + auto-navigate after 1 second via \`Task { try await Task.sleep(for: .seconds(1)); navigate() }\`
- Error banner with \"Go Back\" button
- \`.onAppear { viewModel.startAnalysis(pdfURL:deps:context:) }\`
- \`@AccessibilityFocusState\` — move focus to COI gauge when \`isComplete\` becomes \`true\`

**\`AnalysisViewStyle\`**
- \`static func gaugeAnimation(reduceMotion: Bool) -> Animation?\` — \`nil\` when \`reduceMotion\`, else \`.spring(duration: 0.6)\`
- \`static func scoreColor(_ score: Double, differentiateWithoutColor: Bool) -> (Color, String)\`

---

## Step 6 — \`ScoreCardView\` + \`ScoreCardViewModel\` + \`ScoreCardViewStyle\`

**Files:** \`ViewModels/ScoreCardViewModel.swift\`, \`Views/ScoreCardView.swift\`, \`Views/Style/ScoreCardViewStyle.swift\`

**\`ScoreCardViewModel: @Observable @MainActor\`**
- \`analysis: PolicyAnalysis\`
- \`isShowingExport: Bool\`
- \`interpretation: String\` — computed from \`analysis.scoreResult.coi\` (e.g., \"Highly Oppressive\" ≥ 0.6, \"Moderately Oppressive\" 0.3–0.6, \"Low Oppression\" < 0.3, \"Liberatory\" < 0)

**\`ScoreCardView\`**
- Large COI gauge (same \`Canvas\`/\`ZStack\` arc as \`AnalysisView\` but static/final)
- Interpretation label below gauge
- 5 \`NavigationLink\` rows: DIS → \`BenefitHierarchyView\`, ADS → \`ArchitectureRadarView\`, EIS → \`EliteInterestDetailView\`, CIS → \`CompoundingTrajectoryView\`, OES → \`OutgroupExpansionView\`
- \"Historical Comparison\" \`NavigationLink\` → \`HistoricalComparisonView\`
- Toolbar: \"Export\" button → \`.sheet(isPresented: \$viewModel.isShowingExport) { ExportView(analysis:) }\`
- Accessibility: \`.accessibilityElement(children: .combine)\` on gauge block; \`.accessibilityLabel(\"Composite Oppression Index\")\`; \`.accessibilityValue(\"\\(coi, format: .number.precision(.fractionLength(2))), \\(interpretation)\")\`; \`.accessibilityCustomContent\` for each sub-score; \`speechAdjustedPitch\`; custom \"Scores\" rotor; \`.accessibilitySortPriority\` ordering

**\`ScoreCardViewStyle\`**
- \`static func scoreRevealAnimation(reduceMotion: Bool) -> Animation?\`
- \`static func scoreColor(_ score: Double, differentiateWithoutColor: Bool) -> (Color, String)\`
- \`static func backgroundMaterial(reduceTransparency: Bool) -> Material\`
- \`static func scoreFont(dynamicTypeSize: DynamicTypeSize, legibilityWeight: LegibilityWeight?) -> Font\`

---

## Step 7 — Chart Views

Each chart view has a corresponding ViewModel and Style struct. Create under \`Views/Charts/\` and \`ViewModels/Charts/\`.

### \`BenefitHierarchyView\`
- Swift Charts \`BarMark\` stacked by \`TargetGroup\` (Elite / InGroupNonElite / Outgroup)
- Data: aggregate benefit/burden counts from \`analysis.clauses\` grouped by \`targetGroup\` and \`effectDirection\`
- \`BenefitChartDescriptor: AXChartDescriptorRepresentable\` — \`AXCategoricalDataAxisDescriptor\` for groups, \`AXNumericDataAxisDescriptor\` for percentage
- Pattern fills (\`.foregroundStyle(by:)\` + custom \`ChartSymbolShape\`) when \`differentiateWithoutColor\`
- \`.accessibilityLabel(\"Benefit Hierarchy Chart\")\`; \`.accessibilityValue\` with plain-English summary

### \`ArchitectureRadarView\`
- \`Canvas\` spider chart with 4 axes: AAR, SE, IJ, RSC
- Data: mean of each component across \`analysis.clauses\` (using the new \`architectureScores\` property on \`AnalyzedClause\`)
- \`.accessibilityRepresentation { VStack { ForEach(components) { Text(\"\\(\$0.name): \\(\$0.score, format: .percent)\") } } }\`
- \`.accessibilityLabel(\"Architecture Detection Radar Chart\")\`; \`.accessibilityHeading(.h2)\`
- \`.accessibilityAdjustableAction\` to swipe through the 4 component scores
- Distinct line patterns (dashed/dotted/solid) per axis when \`differentiateWithoutColor\`

### \`CompoundingTrajectoryView\`
- Swift Charts \`LineMark\` — X axis: year, Y axis: out-group capacity (0–1)
- Data: \`HistoricalPolicies.chain\` mapped to \`(year, capacity)\` points where capacity = \`1 - cumulativeCompoundingEffect\`; append current policy as the final point
- \`CompoundingChartDescriptor: AXChartDescriptorRepresentable\` — implement \`makeChartDescriptor()\` per Phase 7 plan
- \`.accessibilityLabel(\"Compounding Impact Trajectory\")\`; \`.accessibilityHint\`

### \`HistoricalComparisonView\`
- Swift Charts \`BarMark\` or \`PointMark\` — X axis: policy name, Y axis: COI
- Data: \`HistoricalPolicies.chain\` + current \`analysis\` as the highlighted bar
- \`.accessibilityElement(children: .contain)\`; per-baseline \`.accessibilityLabel\` + \`.accessibilityValue\`; current policy \`.accessibilityAddTraits(.isSelected)\`
- Custom \"Historical Policies\" rotor

### \`OutgroupExpansionView\`
- Three metric rows: expansion rate, proxy usage rate, proxy density (computed from \`analysis.clauses\`)
- Proxy term list: aggregate unique \`proxyTerms\` from all \`AnalyzedClause\` instances
- \`.accessibilityLabel(\"Outgroup Expansion Score\")\`

---

## Step 8 — \`ReportExporter\`

**File:** \`Export/ReportExporter.swift\`

\`nonisolated struct ReportExporter\`

**\`exportJSON(analysis: PolicyAnalysis) throws -> Data\`**
- Define \`PolicyAnalysisExport: Codable\` with all \`PolicyAnalysis\` fields + \`tierUsageStats: TierUsageStats\` + \`safetyFallbackCount: Int\`
- \`TierUsageStats: Codable\` — \`tier1Count: Int\`, \`tier2Count: Int\`, \`tier3Count: Int\`
- Compute counts by iterating \`analysis.clauses\` on \`tierUsed\`; \`safetyFallbackCount\` = count of clauses where \`wasSafetyFallback == true\`
- Encode with \`JSONEncoder(outputFormatting: [.prettyPrinted, .sortedKeys])\`

**\`exportPDF(analysis: PolicyAnalysis) throws -> Data\`**
- On iOS (\`#if canImport(UIKit)\`): \`UIGraphicsPDFRenderer\` — render policy name, date, COI gauge summary, sub-score table, tier-usage stats, clause breakdown table
- On macOS (\`#if os(macOS)\`): \`NSGraphicsPDFContext\` equivalent
- Return \`Data\`

---

## Step 9 — \`ExportView\` + \`ExportViewModel\` + \`ExportViewStyle\`

**Files:** \`ViewModels/ExportViewModel.swift\`, \`Views/ExportView.swift\`, \`Views/Style/ExportViewStyle.swift\`

**\`ExportViewModel: @Observable @MainActor\`**
- \`isGenerating: Bool\`, \`error: Error?\`, \`exportedItem: ExportedItem?\` (wraps \`URL\` + \`UTType\`)
- \`func export(analysis: PolicyAnalysis, format: ExportFormat)\` — calls \`ReportExporter\`, writes to a temp file, sets \`exportedItem\`
- \`enum ExportFormat { case pdf, json }\`

**\`ExportView\`**
- Presented as \`.sheet\` (iOS) / \`.popover\` (macOS)
- Two format buttons: \"PDF Report\" and \"JSON Data\"
- \`ProgressView\` while \`isGenerating\`
- On success: \`ShareLink(item: exportedItem.url)\` or \`UIActivityViewController\` via \`UIViewControllerRepresentable\`
- Error banner with \"Try Again\" button
- Accessibility: \`.accessibilityLabel\` on format buttons; \`.accessibilityHint\` describing output format

---

## Step 10 — Accessibility Layer (applied across all views)

This is not a separate file but a pass over all views created above. Key items not yet covered in individual steps:

- **Heading hierarchy**: add \`.accessibilityHeading(.h1)\` to \"Policy Analysis Results\" in \`ScoreCardView\`; \`.accessibilityHeading(.h2)\` to each section title
- **\"Scores\" custom rotor** on \`ScoreCardView\`: \`AccessibilityRotorEntry\` for COI, DIS, ADS, EIS, CIS, OES
- **\"Clauses\" custom rotor** on a \`ClauseListView\` (optional detail view accessible from \`ScoreCardView\`): \"Oppressive Clauses\" and \"Liberatory Clauses\" rotors filtering by score threshold
- **\`accessibilitySortPriority\`**: \`ScoreCardView\` = 5, \`ArchitectureRadarView\` = 4, \`CompoundingTrajectoryView\` = 3, \`BenefitHierarchyView\` = 2, \`HistoricalComparisonView\` = 1
- **\`accessibilityLinkedGroup\`**: link each sub-score label in \`ScoreCardView\` to its corresponding chart view using a shared \`@Namespace\`
- **\`accessibilityShowsLargeContentViewer()\`** on the COI score number in \`ScoreCardView\`
- **\`speechSpellsOutCharacters(false)\`** + \`speechAdjustedPitch\` on score \`Text\` views

---

## Step 11 — macOS Sidebar Layout

In \`ContentView.swift\`, within the \`#if os(macOS)\` block:

- \`NavigationSplitView(sidebar:detail:)\` — sidebar renders a \`List\` bound to \`@State var selectedSidebarItem: SidebarItem?\`
- \`SidebarItem\` enum: \`.analyze\`, \`.training\` (placeholder), \`.validation\` (placeholder), \`.data\` (placeholder)
- Analyze detail: \`NavigationSplitView\` with \`PolicyHistoryView\` in the content column and \`ScoreCardView\`/chart views in the detail column (driven by \`viewModel.selectedAnalysis\`)
- Drill-down charts open in the detail column instead of pushing a new screen — \`ScoreCardView\` uses \`@State var selectedDrillDown: DrillDown?\` and renders the chart in a detail panel
- Training/Validation/Data items show \`ContentUnavailableView(\"Coming in T8\", ...)\` placeholders

---

## File Structure Summary

\`\`\`
app/decodingOppression/decodingOppression/
├── Models/
│   └── AnalyzedClause.swift          ← extend with architectureScores, proxyTerms, expandsOutgroup, wasSafetyFallback
├── Views/
│   ├── WelcomeView.swift
│   ├── PolicyHistoryView.swift
│   ├── AnalysisView.swift
│   ├── ScoreCardView.swift
│   ├── ExportView.swift
│   ├── Charts/
│   │   ├── BenefitHierarchyView.swift
│   │   ├── ArchitectureRadarView.swift
│   │   ├── CompoundingTrajectoryView.swift
│   │   ├── HistoricalComparisonView.swift
│   │   └── OutgroupExpansionView.swift
│   └── Style/
│       ├── WelcomeViewStyle.swift
│       ├── PolicyHistoryViewStyle.swift
│       ├── AnalysisViewStyle.swift
│       ├── ScoreCardViewStyle.swift
│       ├── ExportViewStyle.swift
│       └── Charts/
│           ├── BenefitHierarchyViewStyle.swift
│           ├── ArchitectureRadarViewStyle.swift
│           ├── CompoundingTrajectoryViewStyle.swift
│           ├── HistoricalComparisonViewStyle.swift
│           └── OutgroupExpansionViewStyle.swift
├── ViewModels/
│   ├── WelcomeViewModel.swift
│   ├── PolicyHistoryViewModel.swift
│   ├── AnalysisViewModel.swift
│   ├── ScoreCardViewModel.swift
│   ├── ExportViewModel.swift
│   └── Charts/
│       ├── BenefitHierarchyViewModel.swift
│       ├── ArchitectureRadarViewModel.swift
│       ├── CompoundingTrajectoryViewModel.swift
│       ├── HistoricalComparisonViewModel.swift
│       └── OutgroupExpansionViewModel.swift
├── Export/
│   └── ReportExporter.swift
└── ContentView.swift                  ← replace placeholder
\`\`\`

---

## Flow Coverage

\`\`\`mermaid
sequenceDiagram
    participant App as decodingOppressionApp
    participant CV as ContentView
    participant WV as WelcomeView
    participant PHV as PolicyHistoryView
    participant AV as AnalysisView
    participant SCV as ScoreCardView
    participant Charts as Chart Views
    participant EV as ExportView

    App->>CV: launch
    CV->>WV: !hasCompletedOnboarding
    WV->>CV: getStarted() → hasCompletedOnboarding=true
    CV->>PHV: root view
    PHV->>AV: fileImporter → pdfURL
    AV->>AV: AnalysisViewModel.startAnalysis()
    AV->>SCV: isComplete → navigate
    SCV->>Charts: tap sub-score row
    Charts-->>SCV: back
    SCV->>EV: tap Export
    EV-->>SCV: ShareLink / UIActivityViewController
\`\`\`
=== END ORIGINAL TASK ===

=== REFERENCE CONTEXT ===

=== SWIFT DOCUMENTATION ===

--- FILE: Navigation.md ---
# Navigation

**Enable people to move between different parts of your app’s view hierarchy within a scene.**


## Overview

Use navigation containers to provide structure to your app’s user interface, enabling people to easily move among the parts of your app.

![Image](navigation-hero)

For example, people can move forward and backward through a stack of views using a [doc://com.apple.SwiftUI/documentation/SwiftUI/NavigationStack](https://developer.apple.com/documentation/SwiftUI/NavigationStack), or choose which view to display from a tab bar using a [doc://com.apple.SwiftUI/documentation/SwiftUI/TabView](https://developer.apple.com/documentation/SwiftUI/TabView).

Configure navigation containers by adding view modifiers like [doc://com.apple.SwiftUI/documentation/SwiftUI/View/navigationSplitViewStyle(_:)](https://developer.apple.com/documentation/SwiftUI/View/navigationSplitViewStyle(_:)) to the container. Use other modifiers on the views inside the container to affect the container’s behavior when showing that view. For example, you can use [doc://com.apple.SwiftUI/documentation/SwiftUI/View/navigationTitle(_:)](https://developer.apple.com/documentation/SwiftUI/View/navigationTitle(_:)) on a view to provide a toolbar title to display when showing that view.

## Topics

### Essentials

- [Understanding the navigation stack](https://developer.apple.com/documentation/swiftui/understanding-the-composition-of-navigation-stack) — Learn about the navigation stack, links, and how to manage navigation types in your app’s structure.
### Presenting views in columns

- [Bringing robust navigation structure to your SwiftUI app](https://developer.apple.com/documentation/swiftui/bringing-robust-navigation-structure-to-your-swiftui-app) — Use navigation links, stacks, destinations, and paths to provide a streamlined experience for all platforms, as well as behaviors such as deep linking and state restoration.
- [Migrating to new navigation types](https://developer.apple.com/documentation/swiftui/migrating-to-new-navigation-types) — Improve navigation behavior in your app by replacing navigation views with navigation stacks and navigation split views.
- [NavigationSplitView](https://developer.apple.com/documentation/swiftui/navigationsplitview) — A view that presents views in two or three columns, where selections in leading columns control presentations in subsequent columns.
- [navigationSplitViewStyle(_:)](https://developer.apple.com/documentation/swiftui/view/navigationsplitviewstyle(_:)) — Sets the style for navigation split views within this view.
- [navigationSplitViewColumnWidth(_:)](https://developer.apple.com/documentation/swiftui/view/navigationsplitviewcolumnwidth(_:)) — Sets a fixed, preferred width for the column containing this view.
- [navigationSplitViewColumnWidth(min:ideal:max:)](https://developer.apple.com/documentation/swiftui/view/navigationsplitviewcolumnwidth(min:ideal:max:)) — Sets a flexible, preferred width for the column containing this view.
- [NavigationSplitViewVisibility](https://developer.apple.com/documentation/swiftui/navigationsplitviewvisibility) — The visibility of the leading columns in a navigation split view.
- [NavigationLink](https://developer.apple.com/documentation/swiftui/navigationlink) — A view that controls a navigation presentation.
### Stacking views in one column

- [NavigationStack](https://developer.apple.com/documentation/swiftui/navigationstack) — A view that displays a root view and enables you to present additional views over the root view.
- [NavigationPath](https://developer.apple.com/documentation/swiftui/navigationpath) — A type-erased list of data representing the content of a navigation stack.
- [navigationDestination(for:destination:)](https://developer.apple.com/documentation/swiftui/view/navigationdestination(for:destination:)) — Associates a destination view with a presented data type for use within a navigation stack.
- [navigationDestination(isPresented:destination:)](https://developer.apple.com/documentation/swiftui/view/navigationdestination(ispresented:destination:)) — Associates a destination view with a binding that can be used to push the view onto a [doc://com.apple.SwiftUI/documentation/SwiftUI/NavigationStack](https://developer.apple.com/documentation/SwiftUI/NavigationStack).
- [navigationDestination(item:destination:)](https://developer.apple.com/documentation/swiftui/view/navigationdestination(item:destination:)) — Associates a destination view with a bound value for use within a navigation stack or navigation split view
### Managing column collapse

- [NavigationSplitViewColumn](https://developer.apple.com/documentation/swiftui/navigationsplitviewcolumn) — A view that represents a column in a navigation split view.
### Setting titles for navigation content

- [navigationTitle(_:)](https://developer.apple.com/documentation/swiftui/view/navigationtitle(_:)) — Configures the view’s title for purposes of navigation, using a string binding.
- [navigationSubtitle(_:)](https://developer.apple.com/documentation/swiftui/view/navigationsubtitle(_:)) — Configures the view’s subtitle for purposes of navigation.
- [navigationDocument(_:)](https://developer.apple.com/documentation/swiftui/view/navigationdocument(_:)) — Configures the view’s document for purposes of navigation.
- [navigationDocument(_:preview:)](https://developer.apple.com/documentation/swiftui/view/navigationdocument(_:preview:)) — Configures the view’s document for purposes of navigation.
### Configuring the navigation bar

- [navigationBarBackButtonHidden(_:)](https://developer.apple.com/documentation/swiftui/view/navigationbarbackbuttonhidden(_:)) — Hides the navigation bar back button for the view.
- [navigationBarTitleDisplayMode(_:)](https://developer.apple.com/documentation/swiftui/view/navigationbartitledisplaymode(_:)) — Configures the title display mode for this view.
- [NavigationBarItem](https://developer.apple.com/documentation/swiftui/navigationbaritem) — A configuration for a navigation bar that represents a view at the top of a navigation stack.
### Configuring the sidebar

- [sidebarRowSize](https://developer.apple.com/documentation/swiftui/environmentvalues/sidebarrowsize) — The current size of sidebar rows.
- [SidebarRowSize](https://developer.apple.com/documentation/swiftui/sidebarrowsize) — The standard sizes of sidebar rows.
### Presenting views in tabs

- [Enhancing your app’s content with tab navigation](https://developer.apple.com/documentation/swiftui/enhancing-your-app-content-with-tab-navigation) — Keep your app content front and center while providing quick access to navigation using the tab bar.
- [TabView](https://developer.apple.com/documentation/swiftui/tabview) — A view that switches between multiple child views using interactive user interface elements.
- [Tab](https://developer.apple.com/documentation/swiftui/tab) — The content for a tab and the tab’s associated tab item in a tab view.
- [TabRole](https://developer.apple.com/documentation/swiftui/tabrole) — A value that defines the purpose of the tab.
- [TabSection](https://developer.apple.com/documentation/swiftui/tabsection) — A container that you can use to add hierarchy within a tab view.
- [tabViewStyle(_:)](https://developer.apple.com/documentation/swiftui/view/tabviewstyle(_:)) — Sets the style for the tab view within the current environment.
### Configuring a tab bar

- [tabViewSidebarHeader(content:)](https://developer.apple.com/documentation/swiftui/view/tabviewsidebarheader(content:)) — Adds a custom header to the sidebar of a tab view.
- [tabViewSidebarFooter(content:)](https://developer.apple.com/documentation/swiftui/view/tabviewsidebarfooter(content:)) — Adds a custom footer to the sidebar of a tab view.
- [tabViewSidebarBottomBar(content:)](https://developer.apple.com/documentation/swiftui/view/tabviewsidebarbottombar(content:)) — Adds a custom bottom bar to the sidebar of a tab view.
- [AdaptableTabBarPlacement](https://developer.apple.com/documentation/swiftui/adaptabletabbarplacement) — A placement for tabs in a tab view using the adaptable sidebar style.
- [tabBarPlacement](https://developer.apple.com/documentation/swiftui/environmentvalues/tabbarplacement) — The current placement of the tab bar.
- [TabBarPlacement](https://developer.apple.com/documentation/swiftui/tabbarplacement) — A placement for tabs in a tab view.
- [isTabBarShowingSections](https://developer.apple.com/documentation/swiftui/environmentvalues/istabbarshowingsections) — A Boolean value that determines whether a tab view shows the expanded contents of a tab section.
- [TabBarMinimizeBehavior](https://developer.apple.com/documentation/swiftui/tabbarminimizebehavior)
- [TabViewBottomAccessoryPlacement](https://developer.apple.com/documentation/swiftui/tabviewbottomaccessoryplacement) — A placement of the bottom accessory in a tab view. You can use this to adjust the content of the accessory view based on the placement.
### Configuring a tab

- [sectionActions(content:)](https://developer.apple.com/documentation/swiftui/view/sectionactions(content:)) — Adds custom actions to a section.
- [TabPlacement](https://developer.apple.com/documentation/swiftui/tabplacement) — A place that a tab can appear.
- [TabContentBuilder](https://developer.apple.com/documentation/swiftui/tabcontentbuilder) — A result builder that constructs tabs for a tab view that supports programmatic selection. This builder requires that all tabs in the tab view have the same selection type.
- [TabContent](https://developer.apple.com/documentation/swiftui/tabcontent) — A type that provides content for programmatically selectable tabs in a tab view.
- [AnyTabContent](https://developer.apple.com/documentation/swiftui/anytabcontent) — Type erased tab content.
### Enabling tab customization

- [tabViewCustomization(_:)](https://developer.apple.com/documentation/swiftui/view/tabviewcustomization(_:)) — Specifies the customizations to apply to the sidebar representation of the tab view.
- [TabViewCustomization](https://developer.apple.com/documentation/swiftui/tabviewcustomization) — The customizations a person makes to an adaptable sidebar tab view.
- [TabCustomizationBehavior](https://developer.apple.com/documentation/swiftui/tabcustomizationbehavior) — The customization behavior of customizable tab view content.
### Displaying views in multiple panes

- [HSplitView](https://developer.apple.com/documentation/swiftui/hsplitview) — A layout container that arranges its children in a horizontal line and allows the user to resize them using dividers placed between them.
- [VSplitView](https://developer.apple.com/documentation/swiftui/vsplitview) — A layout container that arranges its children in a vertical line and allows the user to resize them using dividers placed between them.
### Deprecated Types

- [NavigationView](https://developer.apple.com/documentation/swiftui/navigationview) — A view for presenting a stack of views that represents a visible path in a navigation hierarchy.
- [tabItem(_:)](https://developer.apple.com/documentation/swiftui/view/tabitem(_:)) — Sets the tab bar item associated with this view.

---

*Source: [https://developer.apple.com/documentation/com.apple.SwiftUI/documentation/SwiftUI/Navigation](https://developer.apple.com/documentation/com.apple.SwiftUI/documentation/SwiftUI/Navigation)*
--- END FILE ---

--- FILE: Navigation.md ---
# Navigation

**Enable people to move between different parts of your app’s view hierarchy within a scene.**


## Overview

Use navigation containers to provide structure to your app’s user interface, enabling people to easily move among the parts of your app.

![Image](navigation-hero)

For example, people can move forward and backward through a stack of views using a [doc://com.apple.SwiftUI/documentation/SwiftUI/NavigationStack](https://developer.apple.com/documentation/SwiftUI/NavigationStack), or choose which view to display from a tab bar using a [doc://com.apple.SwiftUI/documentation/SwiftUI/TabView](https://developer.apple.com/documentation/SwiftUI/TabView).

Configure navigation containers by adding view modifiers like [doc://com.apple.SwiftUI/documentation/SwiftUI/View/navigationSplitViewStyle(_:)](https://developer.apple.com/documentation/SwiftUI/View/navigationSplitViewStyle(_:)) to the container. Use other modifiers on the views inside the container to affect the container’s behavior when showing that view. For example, you can use [doc://com.apple.SwiftUI/documentation/SwiftUI/View/navigationTitle(_:)](https://developer.apple.com/documentation/SwiftUI/View/navigationTitle(_:)) on a view to provide a toolbar title to display when showing that view.

## Topics

### Essentials

- [Understanding the navigation stack](https://developer.apple.com/documentation/swiftui/understanding-the-composition-of-navigation-stack) — Learn about the navigation stack, links, and how to manage navigation types in your app’s structure.
### Presenting views in columns

- [Bringing robust navigation structure to your SwiftUI app](https://developer.apple.com/documentation/swiftui/bringing-robust-navigation-structure-to-your-swiftui-app) — Use navigation links, stacks, destinations, and paths to provide a streamlined experience for all platforms, as well as behaviors such as deep linking and state restoration.
- [Migrating to new navigation types](https://developer.apple.com/documentation/swiftui/migrating-to-new-navigation-types) — Improve navigation behavior in your app by replacing navigation views with navigation stacks and navigation split views.
- [NavigationSplitView](https://developer.apple.com/documentation/swiftui/navigationsplitview) — A view that presents views in two or three columns, where selections in leading columns control presentations in subsequent columns.
- [navigationSplitViewStyle(_:)](https://developer.apple.com/documentation/swiftui/view/navigationsplitviewstyle(_:)) — Sets the style for navigation split views within this view.
- [navigationSplitViewColumnWidth(_:)](https://developer.apple.com/documentation/swiftui/view/navigationsplitviewcolumnwidth(_:)) — Sets a fixed, preferred width for the column containing this view.
- [navigationSplitViewColumnWidth(min:ideal:max:)](https://developer.apple.com/documentation/swiftui/view/navigationsplitviewcolumnwidth(min:ideal:max:)) — Sets a flexible, preferred width for the column containing this view.
- [NavigationSplitViewVisibility](https://developer.apple.com/documentation/swiftui/navigationsplitviewvisibility) — The visibility of the leading columns in a navigation split view.
- [NavigationLink](https://developer.apple.com/documentation/swiftui/navigationlink) — A view that controls a navigation presentation.
### Stacking views in one column

- [NavigationStack](https://developer.apple.com/documentation/swiftui/navigationstack) — A view that displays a root view and enables you to present additional views over the root view.
- [NavigationPath](https://developer.apple.com/documentation/swiftui/navigationpath) — A type-erased list of data representing the content of a navigation stack.
- [navigationDestination(for:destination:)](https://developer.apple.com/documentation/swiftui/view/navigationdestination(for:destination:)) — Associates a destination view with a presented data type for use within a navigation stack.
- [navigationDestination(isPresented:destination:)](https://developer.apple.com/documentation/swiftui/view/navigationdestination(ispresented:destination:)) — Associates a destination view with a binding that can be used to push the view onto a [doc://com.apple.SwiftUI/documentation/SwiftUI/NavigationStack](https://developer.apple.com/documentation/SwiftUI/NavigationStack).
- [navigationDestination(item:destination:)](https://developer.apple.com/documentation/swiftui/view/navigationdestination(item:destination:)) — Associates a destination view with a bound value for use within a navigation stack or navigation split view
### Managing column collapse

- [NavigationSplitViewColumn](https://developer.apple.com/documentation/swiftui/navigationsplitviewcolumn) — A view that represents a column in a navigation split view.
### Setting titles for navigation content

- [navigationTitle(_:)](https://developer.apple.com/documentation/swiftui/view/navigationtitle(_:)) — Configures the view’s title for purposes of navigation, using a string binding.
- [navigationSubtitle(_:)](https://developer.apple.com/documentation/swiftui/view/navigationsubtitle(_:)) — Configures the view’s subtitle for purposes of navigation.
- [navigationDocument(_:)](https://developer.apple.com/documentation/swiftui/view/navigationdocument(_:)) — Configures the view’s document for purposes of navigation.
- [navigationDocument(_:preview:)](https://developer.apple.com/documentation/swiftui/view/navigationdocument(_:preview:)) — Configures the view’s document for purposes of navigation.
### Configuring the navigation bar

- [navigationBarBackButtonHidden(_:)](https://developer.apple.com/documentation/swiftui/view/navigationbarbackbuttonhidden(_:)) — Hides the navigation bar back button for the view.
- [navigationBarTitleDisplayMode(_:)](https://developer.apple.com/documentation/swiftui/view/navigationbartitledisplaymode(_:)) — Configures the title display mode for this view.
- [NavigationBarItem](https://developer.apple.com/documentation/swiftui/navigationbaritem) — A configuration for a navigation bar that represents a view at the top of a navigation stack.
### Configuring the sidebar

- [sidebarRowSize](https://developer.apple.com/documentation/swiftui/environmentvalues/sidebarrowsize) — The current size of sidebar rows.
- [SidebarRowSize](https://developer.apple.com/documentation/swiftui/sidebarrowsize) — The standard sizes of sidebar rows.
### Presenting views in tabs

- [Enhancing your app’s content with tab navigation](https://developer.apple.com/documentation/swiftui/enhancing-your-app-content-with-tab-navigation) — Keep your app content front and center while providing quick access to navigation using the tab bar.
- [TabView](https://developer.apple.com/documentation/swiftui/tabview) — A view that switches between multiple child views using interactive user interface elements.
- [Tab](https://developer.apple.com/documentation/swiftui/tab) — The content for a tab and the tab’s associated tab item in a tab view.
- [TabRole](https://developer.apple.com/documentation/swiftui/tabrole) — A value that defines the purpose of the tab.
- [TabSection](https://developer.apple.com/documentation/swiftui/tabsection) — A container that you can use to add hierarchy within a tab view.
- [tabViewStyle(_:)](https://developer.apple.com/documentation/swiftui/view/tabviewstyle(_:)) — Sets the style for the tab view within the current environment.
### Configuring a tab bar

- [tabViewSidebarHeader(content:)](https://developer.apple.com/documentation/swiftui/view/tabviewsidebarheader(content:)) — Adds a custom header to the sidebar of a tab view.
- [tabViewSidebarFooter(content:)](https://developer.apple.com/documentation/swiftui/view/tabviewsidebarfooter(content:)) — Adds a custom footer to the sidebar of a tab view.
- [tabViewSidebarBottomBar(content:)](https://developer.apple.com/documentation/swiftui/view/tabviewsidebarbottombar(content:)) — Adds a custom bottom bar to the sidebar of a tab view.
- [AdaptableTabBarPlacement](https://developer.apple.com/documentation/swiftui/adaptabletabbarplacement) — A placement for tabs in a tab view using the adaptable sidebar style.
- [tabBarPlacement](https://developer.apple.com/documentation/swiftui/environmentvalues/tabbarplacement) — The current placement of the tab bar.
- [TabBarPlacement](https://developer.apple.com/documentation/swiftui/tabbarplacement) — A placement for tabs in a tab view.
- [isTabBarShowingSections](https://developer.apple.com/documentation/swiftui/environmentvalues/istabbarshowingsections) — A Boolean value that determines whether a tab view shows the expanded contents of a tab section.
- [TabBarMinimizeBehavior](https://developer.apple.com/documentation/swiftui/tabbarminimizebehavior)
- [TabViewBottomAccessoryPlacement](https://developer.apple.com/documentation/swiftui/tabviewbottomaccessoryplacement) — A placement of the bottom accessory in a tab view. You can use this to adjust the content of the accessory view based on the placement.
### Configuring a tab

- [sectionActions(content:)](https://developer.apple.com/documentation/swiftui/view/sectionactions(content:)) — Adds custom actions to a section.
- [TabPlacement](https://developer.apple.com/documentation/swiftui/tabplacement) — A place that a tab can appear.
- [TabContentBuilder](https://developer.apple.com/documentation/swiftui/tabcontentbuilder) — A result builder that constructs tabs for a tab view that supports programmatic selection. This builder requires that all tabs in the tab view have the same selection type.
- [TabContent](https://developer.apple.com/documentation/swiftui/tabcontent) — A type that provides content for programmatically selectable tabs in a tab view.
- [AnyTabContent](https://developer.apple.com/documentation/swiftui/anytabcontent) — Type erased tab content.
### Enabling tab customization

- [tabViewCustomization(_:)](https://developer.apple.com/documentation/swiftui/view/tabviewcustomization(_:)) — Specifies the customizations to apply to the sidebar representation of the tab view.
- [TabViewCustomization](https://developer.apple.com/documentation/swiftui/tabviewcustomization) — The customizations a person makes to an adaptable sidebar tab view.
- [TabCustomizationBehavior](https://developer.apple.com/documentation/swiftui/tabcustomizationbehavior) — The customization behavior of customizable tab view content.
### Displaying views in multiple panes

- [HSplitView](https://developer.apple.com/documentation/swiftui/hsplitview) — A layout container that arranges its children in a horizontal line and allows the user to resize them using dividers placed between them.
- [VSplitView](https://developer.apple.com/documentation/swiftui/vsplitview) — A layout container that arranges its children in a vertical line and allows the user to resize them using dividers placed between them.
### Deprecated Types

- [NavigationView](https://developer.apple.com/documentation/swiftui/navigationview) — A view for presenting a stack of views that represents a visible path in a navigation hierarchy.
- [tabItem(_:)](https://developer.apple.com/documentation/swiftui/view/tabitem(_:)) — Sets the tab bar item associated with this view.

---

*Source: [https://developer.apple.com/documentation/com.apple.SwiftUI/documentation/SwiftUI/Navigation](https://developer.apple.com/documentation/com.apple.SwiftUI/documentation/SwiftUI/Navigation)*
--- END FILE ---

--- FILE: Adopting-SwiftData-for-a-Core-Data-app.md ---
# Adopting SwiftData for a Core Data app

**Persist data in your app intuitively with the Swift native persistence framework.**

## Availability

- **iOS** 26.0+
- **iPadOS** 26.0+
- **macOS** 26.0+
- **Xcode** 26.0+


## Overview

This sample project is designed to help you understand how to adopt SwiftData in an existing Core Data app. The SampleTrips app fetches and displays all upcoming trips from the store, and allows people to create or remove trips, and to add, update, or remove information from the itinerary for each trip. There are three versions of this app:

- A Core Data version that demonstrates Core Data best practices.

- A SwiftData version that shows the complete app conversion from Core Data to SwiftData.

- A coexistence version, where the sample app uses Core Data, and adds a widget extension that uses SwiftData. This version covers a scenario where you might want to adopt SwiftData incrementally, or for certain portions of your app.


### Configure the sample code project

Open the sample code project in Xcode. Before building it, do the following:

1. Set the developer team for all targets to your team so Xcode automatically manages the provisioning profile. For more information, see [https://help.apple.com/xcode/mac/current/#/dev23aab79b4](https://help.apple.com/xcode/mac/current/#/dev23aab79b4).

2. Replace the App Group container identifier — `group.com.example.apple-samplecode.SampleTrips` — with one specific to your team for the entire project. The identifier points to an App Group container that the app and widget use to share data. You can search for `group.com.example.apple-samplecode.SampleTrips` using the Find navigator in Xcode, and then change all of the occurrences. For more information, see [doc://com.apple.documentation/documentation/Xcode/configuring-app-groups](https://developer.apple.com/documentation/Xcode/configuring-app-groups).


### Adopt SwiftData

The SwiftData sample sets up the schema with Swift types that conform to the [doc://com.apple.documentation/documentation/SwiftData/PersistentModel](https://developer.apple.com/documentation/SwiftData/PersistentModel) protocol, which captures information about the app’s types, including properties and relationships. Each model file corresponds to an individual entity, with identical entity names, properties, and relationships as its Core Data counterpart.

Each model file in this sample uses the [doc://com.apple.documentation/documentation/SwiftData/Model()](https://developer.apple.com/documentation/SwiftData/Model()) macro to add necessary conformances for the `PersistentModel` and [doc://com.apple.documentation/documentation/Observation/Observable](https://developer.apple.com/documentation/Observation/Observable) protocols:

```swift
@Model class Trip {
    #Index<Trip>([\.name], [\.startDate], [\.endDate], [\.name, \.startDate, \.endDate])
    #Unique<Trip>([\.name, \.startDate, \.endDate])
    
    @Attribute(.preserveValueOnDeletion)
    var name: String
    var destination: String
    
    @Attribute(.preserveValueOnDeletion)
    var startDate: Date
    
    @Attribute(.preserveValueOnDeletion)
    var endDate: Date

    @Relationship(deleteRule: .cascade, inverse: \BucketListItem.trip)
    var bucketList: [BucketListItem] = [BucketListItem]()
    
    @Relationship(deleteRule: .cascade, inverse: \LivingAccommodation.trip)
    var livingAccommodation: LivingAccommodation?
    ...
```

Additionally, the app sets up the container using [doc://com.apple.documentation/documentation/SwiftData/ModelContainer](https://developer.apple.com/documentation/SwiftData/ModelContainer) to ensure that all views access the same `ModelContainer`.

```swift
.modelContainer(modelContainer)
```

Setting up the `ModelContainer` also creates and sets a default [doc://com.apple.documentation/documentation/SwiftData/ModelContext](https://developer.apple.com/documentation/SwiftData/ModelContext) in the environment. The app can access the `ModelContext` from any scene or view using an environment property.

```swift
@Environment(\.modelContext) private var modelContext
```


### Create a persisted data object

This app creates a new instance of a trip and inserts it into the [doc://com.apple.documentation/documentation/SwiftData/ModelContext](https://developer.apple.com/documentation/SwiftData/ModelContext) for persistence:

```swift
if newTripSegment == .personal {
    newTrip = PersonalTrip(name: name, destination: destination, startDate: startDate, endDate: endDate, reason: reason)
} else if newTripSegment == .business {
    newTrip = BusinessTrip(name: name, destination: destination, startDate: startDate, endDate: endDate, perdiem: perdiem)
} else {
    newTrip = Trip(name: name, destination: destination, startDate: startDate, endDate: endDate)
}
modelContext.insert(newTrip)
```


### Persist data

The app uses the SwiftData implicit save feature to persist data. This implicit save occurs on UI life cycle events and on a timer after the context changes. For more information about enabling autosave, see the [doc://com.apple.documentation/documentation/SwiftData/ModelContext/autosaveEnabled](https://developer.apple.com/documentation/SwiftData/ModelContext/autosaveEnabled) property.

The app calls [doc://com.apple.documentation/documentation/SwiftData/ModelContext/delete(_:)](https://developer.apple.com/documentation/SwiftData/ModelContext/delete(_:)) on the [doc://com.apple.documentation/documentation/SwiftData/ModelContext](https://developer.apple.com/documentation/SwiftData/ModelContext) with the instance to delete.

```swift
modelContext.delete(trip)
```


### Fetch persisted data

This sample app fetches the complete list of upcoming trips by wrapping an array of trips in a [doc://com.apple.documentation/documentation/SwiftData/Query](https://developer.apple.com/documentation/SwiftData/Query) macro, which fetches `Trip` objects from the container.

```swift
@Query(sort: \Trip.startDate, order: .forward)
var trips: [Trip]
```

This sample also fetches data by calling [doc://com.apple.documentation/documentation/SwiftData/ModelContext/fetch(_:)](https://developer.apple.com/documentation/SwiftData/ModelContext/fetch(_:)) on the [doc://com.apple.documentation/documentation/SwiftData/ModelContext](https://developer.apple.com/documentation/SwiftData/ModelContext) and passing in a [doc://com.apple.documentation/documentation/SwiftData/FetchDescriptor](https://developer.apple.com/documentation/SwiftData/FetchDescriptor) that specifies both the entity to retrieve data from as well as a corresponding [doc://com.apple.documentation/documentation/Foundation/Predicate](https://developer.apple.com/documentation/Foundation/Predicate) that specifies the conditions for the object to fetch.

```swift
var descriptor = FetchDescriptor<BucketListItem>()
let tripName = trip.name
descriptor.predicate = #Predicate { item in
    item.title.contains(searchText) && tripName == item.trip?.name
}
let filteredList = try? modelContext.fetch(descriptor)
```


### Inheritance

The SwiftData-Inheritance version of the app extends the `Trip` class into two distinct kinds of Trips, `PersonalTrip` and `BusinessTrip`, building on the basic `Trip` model to include more specialized properties for different kinds of Trips.

```swift
class PersonalTrip: Trip {...}
```

Both `PersonalTrip` and `BusinessTrip` inherit basic properties from their superclass, `Trip`, while defining their own specialized properties, as shown in the following code. For instance, `PersonalTrip`, has an additional property that describes the reason for the trip.

```swift
init(name: String, destination: String, startDate: Date = .now, endDate: Date = .distantFuture, reason: Reason) {
    self.reason = reason
    super.init(name: name, destination: destination, startDate: startDate, endDate: endDate)
}
```


### Coexistence between Core Data and SwiftData

The coexistence version of the app has two persistence stacks: a Core Data persistence stack for the host app, and a SwiftData persistence stack for the widget extension. Both stacks write to the same store file.


### Namespace models

The namespaces in the coexistence sample use the pre-existing [doc://com.apple.documentation/documentation/CoreData/NSManagedObject](https://developer.apple.com/documentation/CoreData/NSManagedObject)-based entity subclasses so that they don’t conflict with the SwiftData classes. Note that this refers to the class name, not the entity name.

```swift
class CDTrip: NSManagedObject {...}
```

The sample then refers to the entity as `CDTrip` when accessing it in the Core Data host app. For instance, when adding a new `Trip`:

```swift
let newTrip = CDTrip(context: viewContext)
```


### Share the same store file

This sample ensures that both the Core Data and SwiftData persistent stacks write to the same store file by setting the persistent store URL for the container description:

```swift
if let description = container.persistentStoreDescriptions.first {
    description.url = url
    ...
}
```

Additionally, the coexistence sample must set the [doc://com.apple.documentation/documentation/CoreData/NSPersistentHistoryTrackingKey](https://developer.apple.com/documentation/CoreData/NSPersistentHistoryTrackingKey). Although SwiftData enables persistent history tracking automatically, Core Data does not, so the app enables persistent history manually.

```swift
description.setOption(true as NSNumber, forKey: NSPersistentHistoryTrackingKey)
```

By default, SwiftData behaves in the following way when determining where it persists data:

- It persists data store to the app’s Application Support directory.

- This sample app uses App Groups to access shared containers and share data between the SwiftData widget extension and the Core Data host app. For an app that has the [doc://com.apple.documentation/documentation/BundleResources/Entitlements/com.apple.security.application-groups](https://developer.apple.com/documentation/BundleResources/Entitlements/com.apple.security.application-groups), it persists the data store to the root directory of the app group container. For apps that evolve from a version that doesn’t have any app group container to a version that has one, SwiftData copies the existing store to the app group container.

In this sample, the main app and widget share the same store via an app group container, and the store is located in the default location in the app group container. To ensure SwiftData accesses the same store, the main app and widget both share the [doc://com.apple.documentation/documentation/SwiftData/ModelContainer](https://developer.apple.com/documentation/SwiftData/ModelContainer).


### Detect relevant changes by consuming the SwiftData history

In the SwiftData version, people can confirm the living accommodation for the current trip by tapping the Accommodation button in the widget. The widget then updates `LivingAccommodation.isConfirmed` in SwiftData, and the main app, when entering the foreground, detects the changes and annotates the trip with a blue dot to indicate that it has unread changes.

There are multiple options for the main app to detect the changes from the widget:

1. Adding a key value pair to the shared `UserDefaults` ([doc://com.apple.documentation/documentation/Foundation/UserDefaults/init(suiteName:)](https://developer.apple.com/documentation/Foundation/UserDefaults/init(suiteName:)) for the widget and the main app to share the changes.

2. Adding a new attribute in `Trip` so the widget can mark the trip as “unread” when changing the living accommodation status.

3. Consuming the history of the store, which SwiftData generates by default, and picking up the relevant changes from there.

The first option introduces a new storage, and hence needs to maintain the consistency between SwiftData and the shared `UserDefaults`. The second option is easier to implement, but introduces and maintains a new attribute, which is redundant and consumes extra storage space; for real-world apps that manage more complicated changes and have larger data set, that may not be the favorite approach.

This sample chooses to detect the changes with the third option. To do so, it sets up a `HistoryDescriptor<DefaultHistoryTransaction>` with a history token (`DefaultHistoryToken`) and calls `fetchHistory(_:)` to retrieve the history transactions (`DefaultHistoryTransaction`) after the token, as shown in the following code:

```swift
private func findTransactions(after historyToken: DefaultHistoryToken?, author: String) -> [DefaultHistoryTransaction] {...}
```

After getting the transactions, it uses the following code to find the trips that have living accommodation changes:

```swift
private func findTrips(in transactions: [DefaultHistoryTransaction]) -> (Set<Trip>, DefaultHistoryToken?) {...}
```

---

*Source: [https://developer.apple.com/documentation/com.apple.coredata/documentation/CoreData/adopting-swiftdata-for-a-core-data-app](https://developer.apple.com/documentation/com.apple.coredata/documentation/CoreData/adopting-swiftdata-for-a-core-data-app)*
--- END FILE ---

--- FILE: SwiftData-Class-Inheritance.md ---
# Adopting Class Inheritance in Swift Data

## Overview

Swift Data supports class inheritance, allowing you to create hierarchical relationships between your model classes. This powerful feature enables you to build more flexible and specialized data models by creating subclasses that inherit properties and capabilities from a base class. Class inheritance in Swift Data follows the same principles as standard Swift inheritance but with additional considerations for persistence and querying.

Key concepts include:
- Base classes that define common properties and behaviors
- Specialized subclasses that extend functionality for specific use cases
- Type-based querying that can filter by specific model types
- Polymorphic relationships that work with different model types

## When to Use Inheritance in Swift Data

### Good Use Cases

- When you have a clear "IS-A" relationship between models (e.g., a `BusinessTrip` IS-A `Trip`)
- When models share fundamental properties but diverge as use cases become more specialized
- When your app needs to perform both deep searches (across all properties) and shallow searches (specific to subclass properties)
- When your data model naturally forms a hierarchical structure

```swift
// Example of a good inheritance relationship
@Model class Vehicle {
    var manufacturer: String
    var model: String
    var year: Int
}

@Model class Car: Vehicle {
    var numberOfDoors: Int
    var fuelType: FuelType
}

@Model class Motorcycle: Vehicle {
    var engineDisplacement: Int
    var hasABS: Bool
}
```

### When to Avoid Inheritance

- When specialized subclasses would only share a few common properties
- When your query strategy only focuses on specialized properties (shallow queries)
- When a Boolean flag or enumeration could represent the type distinction more efficiently
- When protocol conformance would be more appropriate for shared behavior

```swift
// Alternative to inheritance using an enum approach
@Model class Vehicle {
    var manufacturer: String
    var model: String
    var year: Int
    
    enum VehicleType: String, Codable {
        case car(numberOfDoors: Int, fuelType: FuelType)
        case motorcycle(engineDisplacement: Int, hasABS: Bool)
    }
    
    var type: VehicleType
}
```

## Designing Class Hierarchies

### Base Class Design

1. Identify common properties that all subclasses will share
2. Define relationships that apply to all subclasses
3. Use the `@Model` macro on the base class
4. Ensure the base class is declared as a `class` (not a struct)

```swift
import SwiftData

@Model class Trip {
    @Attribute(.preserveValueOnDeletion)
    var name: String
    var destination: String
    
    @Attribute(.preserveValueOnDeletion)
    var startDate: Date
    
    @Attribute(.preserveValueOnDeletion)
    var endDate: Date

    @Relationship(deleteRule: .cascade, inverse: \Accommodation.trip)
    var accommodation: Accommodation?
    
    init(name: String, destination: String, startDate: Date, endDate: Date) {
        self.name = name
        self.destination = destination
        self.startDate = startDate
        self.endDate = endDate
    }
}
```

### Subclass Design

1. Inherit from the base class using standard Swift inheritance syntax
2. Add the `@Model` macro to the subclass
3. Add specialized properties and relationships specific to the subclass
4. Override methods as needed
5. Consider availability annotations if needed

```swift
@Model class BusinessTrip: Trip {
    var purpose: String
    var expenseCode: String
    var perDiemRate: Double
    
    @Relationship(deleteRule: .cascade, inverse: \BusinessMeal.trip)
    var businessMeals: [BusinessMeal] = []
    
    @Relationship(deleteRule: .cascade, inverse: \MileageRecord.trip)
    var mileageRecords: [MileageRecord] = []
    
    init(name: String, destination: String, startDate: Date, endDate: Date,
         purpose: String, expenseCode: String, perDiemRate: Double) {
        self.purpose = purpose
        self.expenseCode = expenseCode
        self.perDiemRate = perDiemRate
        super.init(name: name, destination: destination, startDate: startDate, endDate: endDate)
    }
}
```

```swift
@Model class PersonalTrip: Trip {
    enum Reason: String, CaseIterable, Codable, Identifiable {
        case family, vacation, wellness, other
        var id: Self { self }
    }
    
    var reason: Reason
    var notes: String?
    
    @Relationship(deleteRule: .cascade, inverse: \Attraction.trip)
    var attractions: [Attraction] = []
    
    init(name: String, destination: String, startDate: Date, endDate: Date,
         reason: Reason, notes: String? = nil) {
        self.reason = reason
        self.notes = notes
        super.init(name: name, destination: destination, startDate: startDate, endDate: endDate)
    }
}
```

## Querying with Inheritance

### Basic Queries

You can query for all instances of a base class, which will include all subclass instances:

```swift
// Query for all trips (including BusinessTrip and PersonalTrip)
@Query(sort: \Trip.startDate)
var allTrips: [Trip]
```

### Type-Based Filtering

Filter by specific subclass types using the `is` operator in predicates:

```swift
// Query for only BusinessTrip instances
let businessTripPredicate = #Predicate<Trip> { $0 is BusinessTrip }
@Query(filter: businessTripPredicate)
var businessTrips: [Trip]
```

### Combined Filtering

Combine type filtering with property filtering:

```swift
// Query for PersonalTrip instances with a specific reason
let personalVacationPredicate = #Predicate<Trip> {
    if let personalTrip = $0 as? PersonalTrip {
        return personalTrip.reason == .vacation
    }
    return false
}

@Query(filter: personalVacationPredicate)
var vacationTrips: [Trip]
```

### Using Enums for Filtering

Create an enum to simplify filtering by type:

```swift
enum TripKind: String, CaseIterable {
    case all = "All"
    case personal = "Personal"
    case business = "Business"
}

struct TripListView: View {
    @Query var trips: [Trip]
    
    init(tripKind: TripKind, searchText: String = "") {
        // Create type predicate based on selected kind
        let typePredicate: Predicate<Trip>? = {
            switch tripKind {
            case .all:
                return nil
            case .personal:
                return #Predicate { $0 is PersonalTrip }
            case .business:
                return #Predicate { $0 is BusinessTrip }
            }
        }()
        
        // Create search predicate if needed
        let searchPredicate = searchText.isEmpty ? nil : #Predicate<Trip> {
            $0.name.localizedStandardContains(searchText) || 
            $0.destination.localizedStandardContains(searchText)
        }
        
        // Combine predicates if both exist
        let finalPredicate: Predicate<Trip>?
        if let typePredicate, let searchPredicate {
            finalPredicate = #Predicate { typePredicate.evaluate($0) && searchPredicate.evaluate($0) }
        } else {
            finalPredicate = typePredicate ?? searchPredicate
        }
        
        _trips = Query(filter: finalPredicate, sort: \.startDate)
    }
}
```

## Working with Subclass Properties

### Type Casting

When working with a collection of base class instances, you'll need to cast to access subclass-specific properties:

```swift
func calculateTotalExpenses(for trips: [Trip]) -> Double {
    var total = 0.0
    
    for trip in trips {
        if let businessTrip = trip as? BusinessTrip {
            // Access BusinessTrip-specific properties
            let perDiemTotal = businessTrip.perDiemRate * Double(Calendar.current.dateComponents([.day], from: businessTrip.startDate, to: businessTrip.endDate).day ?? 0)
            
            // Add meal expenses
            let mealExpenses = businessTrip.businessMeals.reduce(0.0) { $0 + $1.cost }
            
            total += perDiemTotal + mealExpenses
        }
    }
    
    return total
}
```

### Polymorphic Relationships

You can create relationships that work with the base class but contain instances of different subclasses:

```swift
@Model class TravelPlanner {
    var name: String
    
    @Relationship(deleteRule: .cascade)
    var upcomingTrips: [Trip] = []  // Can contain both BusinessTrip and PersonalTrip instances
    
    func addTrip(_ trip: Trip) {
        upcomingTrips.append(trip)
    }
}
```

## Best Practices

1. **Keep inheritance hierarchies shallow**: Avoid deep inheritance chains that can become difficult to maintain.

2. **Use meaningful IS-A relationships**: Only use inheritance when there's a true "is-a" relationship between models.

3. **Consider alternatives**: For simpler cases, enums or Boolean flags might be more appropriate than inheritance.

4. **Design for query patterns**: Consider how you'll query your data when designing your class hierarchy.

5. **Be mindful of schema migrations**: Changes to your inheritance hierarchy may require more complex migrations.

6. **Document the inheritance structure**: Make sure other developers understand the relationships between your models.

7. **Test with real data**: Verify that your inheritance structure works well with realistic data and query patterns.

## References

- [Adopting inheritance in SwiftData](https://developer.apple.com/documentation/SwiftData/Adopting-inheritance-in-SwiftData)
- [Design for specialization](https://developer.apple.com/documentation/SwiftData/Adopting-inheritance-in-SwiftData#Design-for-specialization)
- [Determine whether inheritance is right for your use case](https://developer.apple.com/documentation/SwiftData/Adopting-inheritance-in-SwiftData#Determine-whether-inheritance-is-right-for-your-use-case)
- [Fetch and Query Data](https://developer.apple.com/documentation/SwiftData/Adopting-inheritance-in-SwiftData#Fetch-and-Query-Data)
--- END FILE ---

--- FILE: charting-data.md ---
---
title: Charting data | Apple Developer Documentation
source_url: https://developer.apple.com/design/human-interface-guidelines/charting-data
scraped_date: '2025-10-25T18:04:03.312840Z'
extraction_method: Chrome DevTools MCP Server
content_length: 6930
filename: charting-data.md
---

# Charting data | Apple Developer Documentation

Charting data
Presenting data in a chart can help you communicate information with clarity and appeal.

Charts provide efficient ways to communicate complex information without requiring people to read and interpret a lot of text. The graphical nature of charts also gives you additional opportunities to express the personality of your experience and add visual interest to your interface. To learn about the components you use to create a chart, see Charts.

A chart can range from a simple graphic that provides glanceable information to a rich, interactive experience that can form the centerpiece of your app and encourage people to explore the data from various perspectives. Whether simple or complex, you can use charts to help people perform data-driven tasks that are important to them, such as:

Analyzing trends based on historical or predicted values

Visualizing the current state of a process, system, or quantity that changes over time

Evaluating different items — or the same item at different times — by comparing data across multiple categories

Not every collection of data needs to be displayed in a chart. If you simply need to provide data — and you don't need to convey information about it or help people analyze it — consider offering the data in other ways, such as in a list or table that people can scroll, search, and sort.

Best practices

Use a chart when you want to highlight important information about a dataset. Charts are visually prominent, so they tend to draw people's attention. Take advantage of this prominence by clearly communicating what people can learn from the data they care about.

Keep a chart simple, letting people choose when they want additional details. Resist the temptation to pack as much data as possible into a chart. Too much data can make a chart visually overwhelming and difficult to use, obscuring the relationships and other information you want to convey. If you have a lot of data to present — or a lot of functionality to provide — consider giving people a way to reveal it gradually. For example, you might let people choose to view different levels of detail or subsets of data to match their interest. To help people learn how to use an interactive chart, you might offer several versions of the chart, each with more functionality than the last.

Make every chart in your app accessible. A chart communicates visually through graphical representations of data and visual descriptions. In addition to the visual descriptions you display, it's crucial to provide both accessibility labels that describe chart values and components, and accessibility elements that help people interact with the chart. For guidance, see Enhancing the accessibility of a chart.

Designing effective charts

In general, prefer using common chart types. People tend to be familiar with common chart types — such as bar charts and line charts — so using one of these types in your app can make it more likely that people will already know how to read your chart. For guidance, see Charts.

If you need to create a chart that presents data in a novel way, help people learn how to interpret the chart. For example, when a Watch pairs with iPhone, Activity introduces the Activity rings by animating them individually, showing people how each ring maps to the move, exercise, and stand metrics.

Examine the data from multiple levels or perspectives to find details you can display to enhance the chart. For example, viewing the data from a macro level can help you determine high-level summaries that people might be interested in, like totals or averages. From a mid-level perspective, you might find ways to help people identify useful subsets of the data, whereas examining individual data points might help you find ways to draw people's attention to specific values or items. Displaying information that helps people view the chart from various perspectives can encourage them to engage with it.

Aid comprehension by adding descriptive text to the chart. Descriptive text titles, subtitles, and annotations help emphasize the most important information in a chart and can highlight actionable takeaways. You can also display brief descriptive text that serves as a headline or summary for a chart, helping people grasp essential information at a glance. For example, Weather displays text that summarizes the information people need right now — such as "Chance of light rain in the next hour" — above the scrolling list of hourly forecasts for the next 24 hours. Although a descriptive headline or summary can make a chart more accessible, it doesn't take the place of accessibility labels.

Match the size of a chart to its functionality, topic, and level of detail. In general, a chart needs to be large enough to comfortably display the details you need to include and expansive enough for the interactivity you want to support. For example, you always want to make it easy for people to read a chart's details and descriptive text — like labels and annotations — but you might also want to give people enough room to change the scope of a chart or investigate the data from different perspectives. On the other hand, you might want to use a small chart to offer glanceable information about an individual item or to provide a snapshot or preview of a larger version of the chart that people can reveal in a different view.

Prefer consistency across multiple charts, deviating only when you need to highlight differences. If multiple charts in your app serve a similar purpose, you generally don't want to imply that the charts are unrelated by using a different type or style for each one. Also, using a consistent visual approach for the charts in your app lets people use what they learn about one chart to help them understand another. Consider using different chart types and styles when you need to highlight meaningful differences between charts.

Maintain continuity among multiple charts that use the same data. When you use multiple charts to help people explore one dataset from different perspectives, it's important to use one chart type and consistent colors, annotations, layouts, and descriptive text to signal that the dataset remains the same. For example, the Health Trends screen shows small charts that each use a specific visual style to depict a recent trend in an area like steps or resting heart rate. When people choose a chart to reveal all their data in that area, the expanded version uses the same style, colors, marks, and annotations to strengthen the relationship between the versions.

Platform considerations

No additional considerations for iOS, iPadOS, macOS, tvOS, visionOS, or watchOS.

Resources
Related

Charts

Developer documentation

Swift Charts

Videos
Bring Swift Charts to the third dimension
Design app experiences with charts
Design an effective chart
Change log

Date

	

Changes




September 23, 2022

	

New page.
--- END FILE ---

--- FILE: Swift-Charts-3D-Visualization.md ---
# Using 3D Charts with Swift Charts

## Overview

Swift Charts provides powerful 3D visualization capabilities through the `Chart3D` component, allowing developers to create immersive three-dimensional data visualizations. This guide covers how to create, customize, and interact with 3D charts in SwiftUI applications using the Swift Charts framework.

Key components for 3D charts include:
- `Chart3D`: The main container view for 3D chart content
- `SurfacePlot`: For visualizing 3D surface data
- `Chart3DPose`: For controlling the viewing angle and perspective
- `Chart3DSurfaceStyle`: For styling the appearance of 3D surfaces

## Basic Setup

### Importing Required Frameworks

```swift
import SwiftUI
import Charts
```

### Creating a Simple 3D Chart

The most basic 3D chart can be created using a mathematical function that maps x,y coordinates to z values:

```swift
struct Basic3DChartView: View {
    var body: some View {
        Chart3D {
            SurfacePlot(
                x: "X Axis",
                y: "Y Axis",
                z: "Z Axis",
                function: { x, y in
                    // Simple mathematical function: z = sin(x) * cos(y)
                    sin(x) * cos(y)
                }
            )
        }
    }
}
```

### Creating a 3D Chart from Data

You can also create 3D charts from collections of data:

```swift
struct DataPoint3D: Identifiable {
    var x: Double
    var y: Double
    var z: Double
    var id = UUID()
}

struct Data3DChartView: View {
    let dataPoints: [DataPoint3D] = [
        // Your 3D data points
    ]
    
    var body: some View {
        Chart3D(dataPoints) { point in
            // Create appropriate 3D visualization for each point
        }
    }
}
```

## Customizing 3D Charts

### Setting the Chart Pose (Viewing Angle)

Control the viewing angle of your 3D chart using `Chart3DPose`:

```swift
struct CustomPose3DChartView: View {
    // Create a state variable to store the pose
    @State private var chartPose: Chart3DPose = .default
    
    var body: some View {
        Chart3D {
            SurfacePlot(
                x: "X Axis",
                y: "Y Axis",
                z: "Z Axis",
                function: { x, y in
                    sin(x) * cos(y)
                }
            )
        }
        // Apply the pose to the chart
        .chart3DPose(chartPose)
    }
}
```

You can use predefined poses:
- `.default`: The default viewing angle
- `.front`: View from the front
- `.back`: View from the back
- `.top`: View from the top
- `.bottom`: View from the bottom
- `.right`: View from the right side
- `.left`: View from the left side

Or create a custom pose with specific azimuth and inclination angles:

```swift
Chart3DPose(azimuth: .degrees(45), inclination: .degrees(30))
```

### Interactive Pose Control

Allow users to interact with the chart by binding the pose to a state variable:

```swift
struct Interactive3DChartView: View {
    @State private var chartPose: Chart3DPose = .default
    
    var body: some View {
        Chart3D {
            SurfacePlot(
                x: "X Axis",
                y: "Y Axis",
                z: "Z Axis",
                function: { x, y in
                    sin(x) * cos(y)
                }
            )
        }
        // Bind the pose to enable interactive rotation
        .chart3DPose($chartPose)
    }
}
```

### Setting the Camera Projection

Control the camera projection of the points in a 3D chart using `Chart3DCameraProjection`:

```swift
struct CustomProjection3DChartView: View {
    // Create a state variable to store the pose
    @State private var cameraProjection: Chart3DCameraProjection = .perspective
    
    var body: some View {
        Chart3D {
            SurfacePlot(
                x: "X Axis",
                y: "Y Axis",
                z: "Z Axis",
                function: { x, y in
                    sin(x) * cos(y)
                }
            )
        }
        // Apply the camera projection to the chart
        .chart3DCameraProjection(cameraProjection)
    }
}
```

You can use the following camera projection styles:
- `.automatic`: Automatically determines the camera projection
- `.orthographic`: Objects maintain size regardless of depth
- `.perspective`: Objects appear smaller with distance

## Working with Surface Plots

### Basic Surface Plot

```swift
SurfacePlot(
    x: "X Axis",
    y: "Y Axis",
    z: "Z Axis",
    function: { x, y in
        // Mathematical function defining the surface
        sin(sqrt(x*x + y*y))
    }
)
```

### Styling Surface Plots

Apply different styles to your surface plots:

```swift
SurfacePlot(
    x: "X Axis",
    y: "Y Axis",
    z: "Z Axis",
    function: { x, y in
        sin(x) * cos(y)
    }
)
.foregroundStyle(Color.blue)
```

Available surface styles:
- `.heightBased`: Colors the surface based on the height (y-value)
- `.normalBased`: Colors the surface based on the surface normal direction

### Custom Gradient Surface Style

Create a custom gradient for your surface:

```swift
let customGradient = Gradient(colors: [.blue, .purple, .red])

SurfacePlot(
    x: "X Axis",
    y: "Y Axis",
    z: "Z Axis",
    function: { x, y in
        sin(x) * cos(y)
    }
)
.foregroundStyle(LinearGradient(gradient: customGradient, startPoint: .topLeading, endPoint: .bottomTrailing))
```

### Controlling Surface Roughness

Adjust the roughness of the surface:

```swift
SurfacePlot(
    x: "X Axis",
    y: "Y Axis",
    z: "Z Axis",
    function: { x, y in
        sin(x) * cos(y)
    }
)
.roughness(0.3) // 0 is smooth, 1 is completely rough
```

## Advanced Techniques

### Combining Multiple Surface Plots

```swift
Chart3D {
    // First surface plot
    SurfacePlot(
        x: "X",
        y: "Y",
        z: "Z",
        function: { x, y in
            sin(x) * cos(y)
        }
    )
    
    // Second surface plot
    SurfacePlot(
        x: "X",
        y: "Y",
        z: "Z",
        function: { x, y in
            cos(x) * sin(y) + 2 // Offset to avoid overlap
        }
    )
}
```

### Specifying Y-Range for Height-Based Styling

Control the color mapping by specifying the y-range:

```swift
SurfacePlot(
    x: "X Axis",
    y: "Y Axis",
    z: "Z Axis",
    function: { x, y in
        sin(x) * cos(y)
    }
)
.foregroundStyle(Chart3DSurfaceStyle.heightBased(yRange: -1.0...1.0))
```

### Custom Gradient with Y-Range

```swift
let customGradient = Gradient(colors: [.blue, .green, .yellow, .red])

SurfacePlot(
    x: "X Axis",
    y: "Y Axis",
    z: "Z Axis",
    function: { x, y in
        sin(x) * cos(y)
    }
)
.foregroundStyle(Chart3DSurfaceStyle.heightBased(customGradient, yRange: -1.0...1.0))
```

## Complete Example: Interactive 3D Visualization

Here's a complete example that demonstrates an interactive 3D chart with customized styling:

```swift
import SwiftUI
import Charts

struct Interactive3DSurfaceView: View {
    // State for interactive rotation
    @State private var chartPose: Chart3DPose = .default
    
    // Custom gradient for surface coloring
    let surfaceGradient = Gradient(colors: [
        .blue,
        .cyan,
        .green,
        .yellow,
        .orange,
        .red
    ])
    
    var body: some View {
        VStack {
            Text("Interactive 3D Surface Visualization")
                .font(.headline)
            
            Chart3D {
                SurfacePlot(
                    x: "X Value",
                    y: "Y Value",
                    z: "Result",
                    function: { x, y in
                        // Interesting mathematical function
                        sin(sqrt(x*x + y*y)) / sqrt(x*x + y*y + 0.1)
                    }
                )
                .roughness(0.2)
            }
            .chart3DPose($chartPose)
            .frame(height: 400)
            
            Text("Drag to rotate the visualization")
                .font(.caption)
                .foregroundColor(.secondary)
            
            HStack {
                Button("Front View") {
                    withAnimation {
                        chartPose = .front
                    }
                }
                
                Button("Top View") {
                    withAnimation {
                        chartPose = .top
                    }
                }
                
                Button("Default View") {
                    withAnimation {
                        chartPose = .default
                    }
                }
            }
            .buttonStyle(.bordered)
        }
        .padding()
    }
}
```

## References

- [Apple Developer Documentation: Chart3D](https://developer.apple.com/documentation/Charts/Chart3D)
- [Apple Developer Documentation: SurfacePlot](https://developer.apple.com/documentation/Charts/SurfacePlot)
- [Apple Developer Documentation: Chart3DPose](https://developer.apple.com/documentation/Charts/Chart3DPose)
- [Apple Developer Documentation: Chart3DSurfaceStyle](https://developer.apple.com/documentation/Charts/Chart3DSurfaceStyle)
- [Apple Developer Documentation: Creating a chart using Swift Charts](https://developer.apple.com/documentation/Charts/Creating-a-chart-using-Swift-Charts)
--- END FILE ---

--- FILE: Accessibility-fundamentals.md ---
# Accessibility fundamentals

**Make your SwiftUI apps accessible to everyone, including people with disabilities.**


## Overview

Like all Apple UI frameworks, SwiftUI comes with built-in accessibility support. The framework introspects common elements like navigation views, lists, text fields, sliders, buttons, and so on, and provides basic accessibility labels and values by default. You don’t have to do any extra work to enable these standard accessibility features.

![Image](accessibility-fundamentals-hero)

SwiftUI also provides tools to help you enhance the accessibility of your app. To find out what enhancements you need, try using your app with accessibility features like VoiceOver, Voice Control, and Switch Control, or get feedback from users of your app that regularly use these features. Then use the accessibility view modifiers that SwiftUI provides to improve the experience. For example, you can explicitly add accessibility labels to elements in your UI using the [doc://com.apple.SwiftUI/documentation/SwiftUI/View/accessibilityLabel(_:)](https://developer.apple.com/documentation/SwiftUI/View/accessibilityLabel(_:)) or the [doc://com.apple.SwiftUI/documentation/SwiftUI/View/accessibilityValue(_:)](https://developer.apple.com/documentation/SwiftUI/View/accessibilityValue(_:)) view modifier.

Customize your use of accessibility modifiers for all the platforms that your app runs on. For example, you may need to adjust the accessibility elements for a companion Apple Watch app that shares a common code base with an iOS app. If you integrate AppKit or UIKit controls in SwiftUI, expose any accessibility labels and make them accessible from your [doc://com.apple.SwiftUI/documentation/SwiftUI/NSViewRepresentable](https://developer.apple.com/documentation/SwiftUI/NSViewRepresentable) or [doc://com.apple.SwiftUI/documentation/SwiftUI/UIViewRepresentable](https://developer.apple.com/documentation/SwiftUI/UIViewRepresentable) views, or provide custom accessibility information if the underlying accessibility labels aren’t available.

For design guidance, see doc://com.apple.documentation/design/Human-Interface-Guidelines/accessibility in the Human Interface Guidelines.

## Topics

### Essentials

- [Creating accessible views](https://developer.apple.com/documentation/swiftui/creating-accessible-views) — Make your app accessible to everyone by applying accessibility modifiers to your SwiftUI views.
### Creating accessible elements

- [accessibilityElement(children:)](https://developer.apple.com/documentation/swiftui/view/accessibilityelement(children:)) — Creates a new accessibility element, or modifies the [doc://com.apple.SwiftUI/documentation/SwiftUI/AccessibilityChildBehavior](https://developer.apple.com/documentation/SwiftUI/AccessibilityChildBehavior) of the existing accessibility element.
- [accessibilityChildren(children:)](https://developer.apple.com/documentation/swiftui/view/accessibilitychildren(children:)) — Replaces the existing accessibility element’s children with one or more new synthetic accessibility elements.
- [accessibilityRepresentation(representation:)](https://developer.apple.com/documentation/swiftui/view/accessibilityrepresentation(representation:)) — Replaces one or more accessibility elements for this view with new accessibility elements.
- [AccessibilityChildBehavior](https://developer.apple.com/documentation/swiftui/accessibilitychildbehavior) — Defines the behavior for the child elements of the new parent element.
### Identifying elements

- [accessibilityIdentifier(_:)](https://developer.apple.com/documentation/swiftui/view/accessibilityidentifier(_:)) — Uses the string you specify to identify the view.
- [accessibilityIdentifier(_:isEnabled:)](https://developer.apple.com/documentation/swiftui/view/accessibilityidentifier(_:isenabled:)) — Uses the string you specify to identify the view.
### Hiding elements

- [accessibilityHidden(_:)](https://developer.apple.com/documentation/swiftui/view/accessibilityhidden(_:)) — Specifies whether to hide this view from system accessibility features.
- [accessibilityHidden(_:isEnabled:)](https://developer.apple.com/documentation/swiftui/view/accessibilityhidden(_:isenabled:)) — Specifies whether to hide this view from system accessibility features.
### Supporting types

- [AccessibilityTechnologies](https://developer.apple.com/documentation/swiftui/accessibilitytechnologies) — Accessibility technologies available to the system.
- [AccessibilityAttachmentModifier](https://developer.apple.com/documentation/swiftui/accessibilityattachmentmodifier) — A view modifier that adds accessibility properties to the view

---

*Source: [https://developer.apple.com/documentation/com.apple.SwiftUI/documentation/SwiftUI/Accessibility-fundamentals](https://developer.apple.com/documentation/com.apple.SwiftUI/documentation/SwiftUI/Accessibility-fundamentals)*
--- END FILE ---

--- FILE: Accessible-descriptions.md ---
# Accessible descriptions

**Describe interface elements to help people understand what they represent.**


## Overview

SwiftUI can often infer some information about your user interface elements, but you can use accessibility modifiers to provide even more information for users that need it.

![Image](accessible-descriptions-hero)

For design guidance, see doc://com.apple.documentation/design/Human-Interface-Guidelines/accessibility#Content-descriptions in the Accessibility section of the Human Interface Guidelines.

## Topics

### Applying labels

- [accessibilityLabel(_:)](https://developer.apple.com/documentation/swiftui/view/accessibilitylabel(_:)) — Adds a label to the view that describes its contents.
- [accessibilityLabel(_:isEnabled:)](https://developer.apple.com/documentation/swiftui/view/accessibilitylabel(_:isenabled:)) — Adds a label to the view that describes its contents.
- [accessibilityLabel(content:)](https://developer.apple.com/documentation/swiftui/view/accessibilitylabel(content:)) — Adds a label to the view that describes its contents.
- [accessibilityInputLabels(_:)](https://developer.apple.com/documentation/swiftui/view/accessibilityinputlabels(_:)) — Sets alternate input labels with which users identify a view.
- [accessibilityInputLabels(_:isEnabled:)](https://developer.apple.com/documentation/swiftui/view/accessibilityinputlabels(_:isenabled:)) — Sets alternate input labels with which users identify a view.
- [accessibilityLabeledPair(role:id:in:)](https://developer.apple.com/documentation/swiftui/view/accessibilitylabeledpair(role:id:in:)) — Pairs an accessibility element representing a label with the element for the matching content.
- [AccessibilityLabeledPairRole](https://developer.apple.com/documentation/swiftui/accessibilitylabeledpairrole) — The role of an accessibility element in a label / content pair.
### Describing values

- [accessibilityValue(_:)](https://developer.apple.com/documentation/swiftui/view/accessibilityvalue(_:)) — Adds a textual description of the value that the view contains.
- [accessibilityValue(_:isEnabled:)](https://developer.apple.com/documentation/swiftui/view/accessibilityvalue(_:isenabled:)) — Adds a textual description of the value that the view contains.
### Describing content

- [accessibilityTextContentType(_:)](https://developer.apple.com/documentation/swiftui/view/accessibilitytextcontenttype(_:)) — Sets an accessibility text content type.
- [accessibilityHeading(_:)](https://developer.apple.com/documentation/swiftui/view/accessibilityheading(_:)) — Sets the accessibility level of this heading.
- [AccessibilityHeadingLevel](https://developer.apple.com/documentation/swiftui/accessibilityheadinglevel) — The hierarchy of a heading in relation other headings.
- [AccessibilityTextContentType](https://developer.apple.com/documentation/swiftui/accessibilitytextcontenttype) — Textual context that assistive technologies can use to improve the presentation of spoken text.
### Describing charts

- [accessibilityChartDescriptor(_:)](https://developer.apple.com/documentation/swiftui/view/accessibilitychartdescriptor(_:)) — Adds a descriptor to a View that represents a chart to make the chart’s contents accessible to all users.
- [AXChartDescriptorRepresentable](https://developer.apple.com/documentation/swiftui/axchartdescriptorrepresentable) — A type to generate an `AXChartDescriptor` object that you use to provide information about a chart and its data for an accessible experience in VoiceOver or other assistive technologies.
### Adding custom descriptions

- [accessibilityCustomContent(_:_:importance:)](https://developer.apple.com/documentation/swiftui/view/accessibilitycustomcontent(_:_:importance:)) — Add additional accessibility information to the view.
- [AccessibilityCustomContentKey](https://developer.apple.com/documentation/swiftui/accessibilitycustomcontentkey) — Key used to specify the identifier and label associated with an entry of additional accessibility information.
### Assigning traits to content

- [accessibilityAddTraits(_:)](https://developer.apple.com/documentation/swiftui/view/accessibilityaddtraits(_:)) — Adds the given traits to the view.
- [accessibilityRemoveTraits(_:)](https://developer.apple.com/documentation/swiftui/view/accessibilityremovetraits(_:)) — Removes the given traits from this view.
- [AccessibilityTraits](https://developer.apple.com/documentation/swiftui/accessibilitytraits) — A set of accessibility traits that describe how an element behaves.
### Offering hints

- [accessibilityHint(_:)](https://developer.apple.com/documentation/swiftui/view/accessibilityhint(_:)) — Communicates to the user what happens after performing the view’s action.
- [accessibilityHint(_:isEnabled:)](https://developer.apple.com/documentation/swiftui/view/accessibilityhint(_:isenabled:)) — Communicates to the user what happens after performing the view’s action.
### Configuring VoiceOver

- [speechAdjustedPitch(_:)](https://developer.apple.com/documentation/swiftui/view/speechadjustedpitch(_:)) — Raises or lowers the pitch of spoken text.
- [speechAlwaysIncludesPunctuation(_:)](https://developer.apple.com/documentation/swiftui/view/speechalwaysincludespunctuation(_:)) — Sets whether VoiceOver should always speak all punctuation in the text view.
- [speechAnnouncementsQueued(_:)](https://developer.apple.com/documentation/swiftui/view/speechannouncementsqueued(_:)) — Controls whether to queue pending announcements behind existing speech rather than interrupting speech in progress.
- [speechSpellsOutCharacters(_:)](https://developer.apple.com/documentation/swiftui/view/speechspellsoutcharacters(_:)) — Sets whether VoiceOver should speak the contents of the text view character by character.

---

*Source: [https://developer.apple.com/documentation/com.apple.SwiftUI/documentation/SwiftUI/Accessible-descriptions](https://developer.apple.com/documentation/com.apple.SwiftUI/documentation/SwiftUI/Accessible-descriptions)*
--- END FILE ---

--- FILE: Accessible-navigation.md ---
# Accessible navigation

**Enable users to navigate to specific user interface elements using rotors.**


## Overview

An accessibility rotor is a shortcut that enables users to quickly navigate to specific elements of the user interface, and, optionally, to specific ranges of text within those elements.

![Image](accessible-navigation-hero)

The system automatically provides rotors for many navigable elements, but you can supply additional rotors for specific purposes, or replace system rotors when they don’t automatically pick up off-screen elements, like those far down in a [doc://com.apple.SwiftUI/documentation/SwiftUI/LazyVStack](https://developer.apple.com/documentation/SwiftUI/LazyVStack) or a [doc://com.apple.SwiftUI/documentation/SwiftUI/List](https://developer.apple.com/documentation/SwiftUI/List).

For design guidance, see doc://com.apple.documentation/design/Human-Interface-Guidelines/accessibility#Navigation in the Accessibility section of the Human Interface Guidelines.

## Topics

### Working with rotors

- [accessibilityRotor(_:entries:)](https://developer.apple.com/documentation/swiftui/view/accessibilityrotor(_:entries:)) — Create an Accessibility Rotor with the specified user-visible label, and entries generated from the content closure.
- [accessibilityRotor(_:entries:entryID:entryLabel:)](https://developer.apple.com/documentation/swiftui/view/accessibilityrotor(_:entries:entryid:entrylabel:)) — Create an Accessibility Rotor with the specified user-visible label and entries.
- [accessibilityRotor(_:entries:entryLabel:)](https://developer.apple.com/documentation/swiftui/view/accessibilityrotor(_:entries:entrylabel:)) — Create an Accessibility Rotor with the specified user-visible label and entries.
- [accessibilityRotor(_:textRanges:)](https://developer.apple.com/documentation/swiftui/view/accessibilityrotor(_:textranges:)) — Create an Accessibility Rotor with the specified user-visible label and entries for each of the specified ranges. The Rotor will be attached to the current Accessibility element, and each entry will go the specified range of that element.
### Creating rotors

- [AccessibilityRotorContent](https://developer.apple.com/documentation/swiftui/accessibilityrotorcontent) — Content within an accessibility rotor.
- [AccessibilityRotorContentBuilder](https://developer.apple.com/documentation/swiftui/accessibilityrotorcontentbuilder) — Result builder you use to generate rotor entry content.
- [AccessibilityRotorEntry](https://developer.apple.com/documentation/swiftui/accessibilityrotorentry) — A struct representing an entry in an Accessibility Rotor.
### Replacing system rotors

- [AccessibilitySystemRotor](https://developer.apple.com/documentation/swiftui/accessibilitysystemrotor) — Designates a Rotor that replaces one of the automatic, system-provided Rotors with a developer-provided Rotor.
### Configuring rotors

- [accessibilityRotorEntry(id:in:)](https://developer.apple.com/documentation/swiftui/view/accessibilityrotorentry(id:in:)) — Defines an explicit identifier tying an Accessibility element for this view to an entry in an Accessibility Rotor.
- [accessibilityLinkedGroup(id:in:)](https://developer.apple.com/documentation/swiftui/view/accessibilitylinkedgroup(id:in:)) — Links multiple accessibility elements so that the user can quickly navigate from one element to another, even when the elements are not near each other in the accessibility hierarchy.
- [accessibilitySortPriority(_:)](https://developer.apple.com/documentation/swiftui/view/accessibilitysortpriority(_:)) — Sets the sort priority order for this view’s accessibility element, relative to other elements at the same level.

---

*Source: [https://developer.apple.com/documentation/com.apple.SwiftUI/documentation/SwiftUI/Accessible-navigation](https://developer.apple.com/documentation/com.apple.SwiftUI/documentation/SwiftUI/Accessible-navigation)*
--- END FILE ---

--- FILE: Accessible-controls.md ---
# Accessible controls

**Improve access to actions that your app can undertake.**


## Overview

Help people using assistive technologies to gain access to controls in your app.

![Image](accessible-controls-hero)

For design guidance, see doc://com.apple.documentation/design/Human-Interface-Guidelines/accessibility#Buttons-and-controls in the Accessibility section of the Human Interface Guidelines.

## Topics

### Adding actions to views

- [accessibilityAction(_:_:)](https://developer.apple.com/documentation/swiftui/view/accessibilityaction(_:_:)) — Adds an accessibility action to the view. Actions allow assistive technologies, such as the VoiceOver, to interact with the view by invoking the action.
- [accessibilityActions(_:)](https://developer.apple.com/documentation/swiftui/view/accessibilityactions(_:)) — Adds multiple accessibility actions to the view.
- [accessibilityAction(named:_:)](https://developer.apple.com/documentation/swiftui/view/accessibilityaction(named:_:)) — Adds an accessibility action to the view. Actions allow assistive technologies, such as the VoiceOver, to interact with the view by invoking the action.
- [accessibilityAction(action:label:)](https://developer.apple.com/documentation/swiftui/view/accessibilityaction(action:label:)) — Adds an accessibility action to the view. Actions allow assistive technologies, such as the VoiceOver, to interact with the view by invoking the action.
- [accessibilityAction(intent:label:)](https://developer.apple.com/documentation/swiftui/view/accessibilityaction(intent:label:)) — Adds an accessibility action labeled by the contents of `label` to the view. Actions allow assistive technologies, such as the VoiceOver, to interact with the view by invoking the action. When the action is performed, the `intent` will be invoked.
- [accessibilityAction(_:intent:)](https://developer.apple.com/documentation/swiftui/view/accessibilityaction(_:intent:)) — Adds an accessibility action representing `actionKind` to the view. Actions allow assistive technologies, such as the VoiceOver, to interact with the view by invoking the action. When the action is performed, the `intent` will be invoked.
- [accessibilityAction(named:intent:)](https://developer.apple.com/documentation/swiftui/view/accessibilityaction(named:intent:)) — Adds an accessibility action labeled `name` to the view. Actions allow assistive technologies, such as the VoiceOver, to interact with the view by invoking the action. When the action is performed, the `intent` will be invoked.
- [accessibilityAdjustableAction(_:)](https://developer.apple.com/documentation/swiftui/view/accessibilityadjustableaction(_:)) — Adds an accessibility adjustable action to the view. Actions allow assistive technologies, such as the VoiceOver, to interact with the view by invoking the action.
- [accessibilityScrollAction(_:)](https://developer.apple.com/documentation/swiftui/view/accessibilityscrollaction(_:)) — Adds an accessibility scroll action to the view. Actions allow assistive technologies, such as the VoiceOver, to interact with the view by invoking the action.
- [accessibilityActions(category:_:)](https://developer.apple.com/documentation/swiftui/view/accessibilityactions(category:_:)) — Adds multiple accessibility actions to the view with a specific category. Actions allow assistive technologies, such as VoiceOver, to interact with the view by invoking the action and are grouped by their category. When multiple action modifiers with an equal category are applied to the view, the actions are combined together.
- [AccessibilityActionKind](https://developer.apple.com/documentation/swiftui/accessibilityactionkind) — The structure that defines the kinds of available accessibility actions.
- [AccessibilityAdjustmentDirection](https://developer.apple.com/documentation/swiftui/accessibilityadjustmentdirection) — A directional indicator you use when making an accessibility adjustment.
- [AccessibilityActionCategory](https://developer.apple.com/documentation/swiftui/accessibilityactioncategory) — Designates an accessibility action category that is provided and named by the system.
### Offering Quick Actions to people

- [accessibilityQuickAction(style:content:)](https://developer.apple.com/documentation/swiftui/view/accessibilityquickaction(style:content:)) — Adds a quick action to be shown by the system when active.
- [accessibilityQuickAction(style:isActive:content:)](https://developer.apple.com/documentation/swiftui/view/accessibilityquickaction(style:isactive:content:)) — Adds a quick action to be shown by the system when active.
- [AccessibilityQuickActionStyle](https://developer.apple.com/documentation/swiftui/accessibilityquickactionstyle) — A type that describes the presentation style of an accessibility quick action.
### Making gestures accessible

- [accessibilityActivationPoint(_:)](https://developer.apple.com/documentation/swiftui/view/accessibilityactivationpoint(_:)) — The activation point for an element is the location assistive technologies use to initiate gestures.
- [accessibilityActivationPoint(_:isEnabled:)](https://developer.apple.com/documentation/swiftui/view/accessibilityactivationpoint(_:isenabled:)) — The activation point for an element is the location assistive technologies use to initiate gestures.
- [accessibilityDragPoint(_:description:)](https://developer.apple.com/documentation/swiftui/view/accessibilitydragpoint(_:description:)) — The point an assistive technology should use to begin a drag interaction.
- [accessibilityDragPoint(_:description:isEnabled:)](https://developer.apple.com/documentation/swiftui/view/accessibilitydragpoint(_:description:isenabled:)) — The point an assistive technology should use to begin a drag interaction.
- [accessibilityDropPoint(_:description:)](https://developer.apple.com/documentation/swiftui/view/accessibilitydroppoint(_:description:)) — The point an assistive technology should use to end a drag interaction.
- [accessibilityDropPoint(_:description:isEnabled:)](https://developer.apple.com/documentation/swiftui/view/accessibilitydroppoint(_:description:isenabled:)) — The point an assistive technology should use to end a drag interaction.
- [accessibilityDirectTouch(_:options:)](https://developer.apple.com/documentation/swiftui/view/accessibilitydirecttouch(_:options:)) — Explicitly set whether this accessibility element is a direct touch area. Direct touch areas passthrough touch events to the app rather than being handled through an assistive technology, such as VoiceOver. The modifier accepts an optional `AccessibilityDirectTouchOptions` option set to customize the functionality of the direct touch area.
- [accessibilityZoomAction(_:)](https://developer.apple.com/documentation/swiftui/view/accessibilityzoomaction(_:)) — Adds an accessibility zoom action to the view. Actions allow assistive technologies, such as VoiceOver, to interact with the view by invoking the action.
- [AccessibilityDirectTouchOptions](https://developer.apple.com/documentation/swiftui/accessibilitydirecttouchoptions) — An option set that defines the functionality of a view’s direct touch area.
- [AccessibilityZoomGestureAction](https://developer.apple.com/documentation/swiftui/accessibilityzoomgestureaction) — Position and direction information of a zoom gesture that someone performs with an assistive technology like VoiceOver.
### Controlling focus

- [accessibilityFocused(_:)](https://developer.apple.com/documentation/swiftui/view/accessibilityfocused(_:)) — Modifies this view by binding its accessibility element’s focus state to the given boolean state value.
- [accessibilityFocused(_:equals:)](https://developer.apple.com/documentation/swiftui/view/accessibilityfocused(_:equals:)) — Modifies this view by binding its accessibility element’s focus state to the given state value.
- [AccessibilityFocusState](https://developer.apple.com/documentation/swiftui/accessibilityfocusstate) — A property wrapper type that can read and write a value that SwiftUI updates as the focus of any active accessibility technology, such as VoiceOver, changes.
### Managing interactivity

- [accessibilityRespondsToUserInteraction(_:)](https://developer.apple.com/documentation/swiftui/view/accessibilityrespondstouserinteraction(_:)) — Explicitly set whether this Accessibility element responds to user interaction and would thus be interacted with by technologies such as Switch Control, Voice Control or Full Keyboard Access.
- [accessibilityRespondsToUserInteraction(_:isEnabled:)](https://developer.apple.com/documentation/swiftui/view/accessibilityrespondstouserinteraction(_:isenabled:)) — Explicitly set whether this Accessibility element responds to user interaction and would thus be interacted with by technologies such as Switch Control, Voice Control or Full Keyboard Access.

---

*Source: [https://developer.apple.com/documentation/com.apple.SwiftUI/documentation/SwiftUI/Accessible-controls](https://developer.apple.com/documentation/com.apple.SwiftUI/documentation/SwiftUI/Accessible-controls)*
--- END FILE ---

--- FILE: View.md ---
# View

**A type that represents part of your app’s user interface and provides modifiers that you use to configure views.**

## Availability

- **iOS** 13.0+
- **iPadOS** 13.0+
- **Mac Catalyst** 13.0+
- **macOS** 10.15+
- **tvOS** 13.0+
- **visionOS** 1.0+
- **watchOS** 6.0+


## Overview

You create custom views by declaring types that conform to the `View` protocol. Implement the required [doc://com.apple.SwiftUI/documentation/SwiftUI/View/body-8kl5o](https://developer.apple.com/documentation/SwiftUI/View/body-8kl5o) computed property to provide the content for your custom view.

```swift
struct MyView: View {
    var body: some View {
        Text("Hello, World!")
    }
}
```

Assemble the view’s body by combining one or more of the built-in views provided by SwiftUI, like the [doc://com.apple.SwiftUI/documentation/SwiftUI/Text](https://developer.apple.com/documentation/SwiftUI/Text) instance in the example above, plus other custom views that you define, into a hierarchy of views. For more information about creating custom views, see [doc://com.apple.SwiftUI/documentation/SwiftUI/Declaring-a-Custom-View](https://developer.apple.com/documentation/SwiftUI/Declaring-a-Custom-View).

The `View` protocol provides a set of modifiers — protocol methods with default implementations — that you use to configure views in the layout of your app. Modifiers work by wrapping the view instance on which you call them in another view with the specified characteristics, as described in [doc://com.apple.SwiftUI/documentation/SwiftUI/Configuring-Views](https://developer.apple.com/documentation/SwiftUI/Configuring-Views). For example, adding the [doc://com.apple.SwiftUI/documentation/SwiftUI/View/opacity(_:)](https://developer.apple.com/documentation/SwiftUI/View/opacity(_:)) modifier to a text view returns a new view with some amount of transparency:

```swift
Text("Hello, World!")
    .opacity(0.5) // Display partially transparent text.
```

The complete list of default modifiers provides a large set of controls for managing views. For example, you can fine tune [doc://com.apple.SwiftUI/documentation/SwiftUI/View-Layout](https://developer.apple.com/documentation/SwiftUI/View-Layout), add [doc://com.apple.SwiftUI/documentation/SwiftUI/View-Accessibility](https://developer.apple.com/documentation/SwiftUI/View-Accessibility) information, and respond to [doc://com.apple.SwiftUI/documentation/SwiftUI/View-Input-and-Events](https://developer.apple.com/documentation/SwiftUI/View-Input-and-Events). You can also collect groups of default modifiers into new, custom view modifiers for easy reuse.

A type conforming to this protocol inherits `@preconcurrency @MainActor` isolation from the protocol if the conformance is declared in its original declaration. Isolation to the main actor is the default, but it’s not required. Declare the conformance in an extension to opt-out the isolation.

## Topics

### Implementing a custom view

- [body](https://developer.apple.com/documentation/swiftui/view/body-8kl5o) — The content and behavior of the view.
- [Body](https://developer.apple.com/documentation/swiftui/view/body-swift.associatedtype) — The type of view representing the body of this view.
- [modifier(_:)](https://developer.apple.com/documentation/swiftui/view/modifier(_:)) — Applies a modifier to a view and returns a new view.
- [Previews in Xcode](https://developer.apple.com/documentation/swiftui/previews-in-xcode) — Generate dynamic, interactive previews of your custom views.
### Configuring view elements

- [Accessibility modifiers](https://developer.apple.com/documentation/swiftui/view-accessibility) — Make your SwiftUI apps accessible to everyone, including people with disabilities.
- [Appearance modifiers](https://developer.apple.com/documentation/swiftui/view-appearance) — Configure a view’s foreground and background styles, controls, and visibility.
- [Text and symbol modifiers](https://developer.apple.com/documentation/swiftui/view-text-and-symbols) — Manage the rendering, selection, and entry of text in your view.
- [Auxiliary view modifiers](https://developer.apple.com/documentation/swiftui/view-auxiliary-views) — Add and configure supporting views, like toolbars and context menus.
- [Chart view modifiers](https://developer.apple.com/documentation/swiftui/view-chart-view) — Configure charts that you declare with Swift Charts.
### Drawing views

- [Style modifiers](https://developer.apple.com/documentation/swiftui/view-style-modifiers) — Apply built-in styles to different types of views.
- [Layout modifiers](https://developer.apple.com/documentation/swiftui/view-layout) — Tell a view how to arrange itself within a view hierarchy by adjusting its size, position, alignment, padding, and so on.
- [Graphics and rendering modifiers](https://developer.apple.com/documentation/swiftui/view-graphics-and-rendering) — Affect the way the system draws a view, for example by scaling or masking a view, or by applying graphical effects.
### Providing interactivity

- [Input and event modifiers](https://developer.apple.com/documentation/swiftui/view-input-and-events) — Supply actions for a view to perform in response to user input and system events.
- [Search modifiers](https://developer.apple.com/documentation/swiftui/view-search) — Enable people to search for content in your app.
- [Presentation modifiers](https://developer.apple.com/documentation/swiftui/view-presentation) — Define additional views for the view to present under specified conditions.
- [State modifiers](https://developer.apple.com/documentation/swiftui/view-state) — Access storage and provide child views with configuration data.
### Deprecated modifiers

- [Deprecated modifiers](https://developer.apple.com/documentation/swiftui/view-deprecated) — Review unsupported modifiers and their replacements.
### Instance Methods

- [accessibilityActions(category:_:)](https://developer.apple.com/documentation/swiftui/view/accessibilityactions(category:_:)) — Adds multiple accessibility actions to the view with a specific category. Actions allow assistive technologies, such as VoiceOver, to interact with the view by invoking the action and are grouped by their category. When multiple action modifiers with an equal category are applied to the view, the actions are combined together.
- [accessibilityDefaultFocus(_:_:)](https://developer.apple.com/documentation/swiftui/view/accessibilitydefaultfocus(_:_:)) — Defines a region in which default accessibility focus is evaluated by assigning a value to a given accessibility focus state binding.
- [accessibilityScrollStatus(_:isEnabled:)](https://developer.apple.com/documentation/swiftui/view/accessibilityscrollstatus(_:isenabled:)) — Changes the announcement provided by accessibility technologies when a user scrolls a scroll view within this view.
- [accessoryWidgetGroupStyle(_:)](https://developer.apple.com/documentation/swiftui/view/accessorywidgetgroupstyle(_:)) — The view modifier that can be applied to `AccessoryWidgetGroup` to specify the shape the three content views will be masked with. The value of `style` is set to `.automatic`, which is `.circular` by default.
- [addOrderToWalletButtonStyle(_:)](https://developer.apple.com/documentation/swiftui/view/addordertowalletbuttonstyle(_:)) — Sets the button’s style.
- [addPassToWalletButtonStyle(_:)](https://developer.apple.com/documentation/swiftui/view/addpasstowalletbuttonstyle(_:)) — Sets the style to be used by the button. (see `PKAddPassButtonStyle`).
- [allowsWindowActivationEvents()](https://developer.apple.com/documentation/swiftui/view/allowswindowactivationevents()) — Configures gestures in this view hierarchy to handle events that activate the containing window.
- [appStoreMerchandising(isPresented:kind:onDismiss:)](https://developer.apple.com/documentation/swiftui/view/appstoremerchandising(ispresented:kind:ondismiss:))
- [aspectRatio3D(_:contentMode:)](https://developer.apple.com/documentation/swiftui/view/aspectratio3d(_:contentmode:)) — Constrains this view’s dimensions to the specified 3D aspect ratio.
- [assistiveAccessNavigationIcon(_:)](https://developer.apple.com/documentation/swiftui/view/assistiveaccessnavigationicon(_:)) — Configures the view’s icon for purposes of navigation.
- [assistiveAccessNavigationIcon(systemImage:)](https://developer.apple.com/documentation/swiftui/view/assistiveaccessnavigationicon(systemimage:)) — Configures the view’s icon for purposes of navigation.
- [attributedTextFormattingDefinition(_:)](https://developer.apple.com/documentation/swiftui/view/attributedtextformattingdefinition(_:)) — Apply a text formatting definition to nested views.
- [automatedDeviceEnrollmentAddition(isPresented:)](https://developer.apple.com/documentation/swiftui/view/automateddeviceenrollmentaddition(ispresented:)) — Presents a modal view that enables users to add devices to their organization.
- [backgroundExtensionEffect()](https://developer.apple.com/documentation/swiftui/view/backgroundextensioneffect()) — Adds the background extension effect to the view. The view will be duplicated into mirrored copies which will be placed around the view on any edge with available safe area. Additionally, a blur effect will be applied on top to blur out the copies.
- [backgroundExtensionEffect(isEnabled:)](https://developer.apple.com/documentation/swiftui/view/backgroundextensioneffect(isenabled:)) — Adds the background extension effect to the view. The view will be duplicated into mirrored copies which will be placed around the view on any edge with available safe area. Additionally, a blur effect will be applied on top to blur out the copies.
- [breakthroughEffect(_:)](https://developer.apple.com/documentation/swiftui/view/breakthrougheffect(_:)) — Ensures that the view is always visible to the user, even when other content is occluding it, like 3D models.
- [buttonSizing(_:)](https://developer.apple.com/documentation/swiftui/view/buttonsizing(_:)) — The preferred sizing behavior of buttons in the view hierarchy.
- [certificateSheet(trust:title:message:help:)](https://developer.apple.com/documentation/swiftui/view/certificatesheet(trust:title:message:help:)) — Displays a certificate sheet using the provided certificate trust.
- [chart3DCameraProjection(_:)](https://developer.apple.com/documentation/swiftui/view/chart3dcameraprojection(_:))
- [chart3DPose(_:)](https://developer.apple.com/documentation/swiftui/view/chart3dpose(_:)) — Associates a binding to be updated when the 3D chart’s pose is changed by an interaction.
- [chart3DRenderingStyle(_:)](https://developer.apple.com/documentation/swiftui/view/chart3drenderingstyle(_:))
- [chartZAxis(_:)](https://developer.apple.com/documentation/swiftui/view/chartzaxis(_:)) — Sets the visibility of the z axis.
- [chartZAxis(content:)](https://developer.apple.com/documentation/swiftui/view/chartzaxis(content:)) — Configures the z-axis for 3D charts in the view.
- [chartZAxisLabel(_:position:alignment:spacing:)](https://developer.apple.com/documentation/swiftui/view/chartzaxislabel(_:position:alignment:spacing:)) — Adds z axis label for charts in the view. It effects 3D charts only.
- [chartZScale(domain:range:type:)](https://developer.apple.com/documentation/swiftui/view/chartzscale(domain:range:type:)) — Configures the z scale for 3D charts.
- [chartZScale(domain:type:)](https://developer.apple.com/documentation/swiftui/view/chartzscale(domain:type:)) — Configures the z scale for 3D charts.
- [chartZScale(range:type:)](https://developer.apple.com/documentation/swiftui/view/chartzscale(range:type:)) — Configures the z scale for 3D charts.
- [chartZSelection(range:)](https://developer.apple.com/documentation/swiftui/view/chartzselection(range:))
- [chartZSelection(value:)](https://developer.apple.com/documentation/swiftui/view/chartzselection(value:))
- [contactAccessButtonCaption(_:)](https://developer.apple.com/documentation/swiftui/view/contactaccessbuttoncaption(_:))
- [contactAccessButtonStyle(_:)](https://developer.apple.com/documentation/swiftui/view/contactaccessbuttonstyle(_:))
- [contactAccessPicker(isPresented:completionHandler:)](https://developer.apple.com/documentation/swiftui/view/contactaccesspicker(ispresented:completionhandler:)) — Modally present UI which allows the user to select which contacts your app has access to.
- [containerCornerOffset(_:sizeToFit:)](https://developer.apple.com/documentation/swiftui/view/containercorneroffset(_:sizetofit:)) — Adjusts the view’s layout to avoid the container view’s corner insets for the specified edges.
- [containerValue(_:_:)](https://developer.apple.com/documentation/swiftui/view/containervalue(_:_:)) — Sets a particular container value of a view.
- [contentCaptureProtected(_:)](https://developer.apple.com/documentation/swiftui/view/contentcaptureprotected(_:))
- [contentToolbar(for:content:)](https://developer.apple.com/documentation/swiftui/view/contenttoolbar(for:content:)) — Populates the toolbar of the specified content view type with the views you provide.
- [continuityDevicePicker(isPresented:onDidConnect:)](https://developer.apple.com/documentation/swiftui/view/continuitydevicepicker(ispresented:ondidconnect:)) — A `continuityDevicePicker` should be used to discover and connect nearby continuity device through a button interface or other form of activation. On tvOS, this presents a fullscreen continuity device picker experience when selected. The modal view covers as much the screen of `self` as possible when a given condition is true.
- [controlWidgetActionHint(_:)](https://developer.apple.com/documentation/swiftui/view/controlwidgetactionhint(_:)) — The action hint of the control described by the modified label.
- [controlWidgetStatus(_:)](https://developer.apple.com/documentation/swiftui/view/controlwidgetstatus(_:)) — The status of the control described by the modified label.
- [currentEntitlementTask(for:priority:action:)](https://developer.apple.com/documentation/swiftui/view/currententitlementtask(for:priority:action:)) — Declares the view as dependent on the entitlement of an In-App Purchase product, and returns a modified view.
- [dialogPreventsAppTermination(_:)](https://developer.apple.com/documentation/swiftui/view/dialogpreventsapptermination(_:)) — Whether the alert or confirmation dialog prevents the app from being quit/terminated by the system or app termination menu item.
- [documentBrowserContextMenu(_:)](https://developer.apple.com/documentation/swiftui/view/documentbrowsercontextmenu(_:)) — Adds to a `DocumentLaunchView` actions that accept a list of selected files as their parameter.
- [dragConfiguration(_:)](https://developer.apple.com/documentation/swiftui/view/dragconfiguration(_:)) — Configures a drag session.
- [dragContainer(for:in:_:)](https://developer.apple.com/documentation/swiftui/view/dragcontainer(for:in:_:)) — A container with draggable views where the drag payload is based on multiple identifiers of dragged items.
- [dragContainer(for:itemID:in:_:)](https://developer.apple.com/documentation/swiftui/view/dragcontainer(for:itemid:in:_:)) — A container with draggable views.
- [dragContainerSelection(_:containerNamespace:)](https://developer.apple.com/documentation/swiftui/view/dragcontainerselection(_:containernamespace:)) — Provides multiple item selection support for drag containers.
- [dragPreviewsFormation(_:)](https://developer.apple.com/documentation/swiftui/view/dragpreviewsformation(_:)) — Describes the way dragged previews are visually composed.
- [draggable(_:containerNamespace:_:)](https://developer.apple.com/documentation/swiftui/view/draggable(_:containernamespace:_:)) — Activates this view as the source of a drag and drop operation, allowing to provide optional identifiable payload and specify the namespace of the drag container this view belongs to.
- [draggable(_:id:containerNamespace:_:)](https://developer.apple.com/documentation/swiftui/view/draggable(_:id:containernamespace:_:)) — Activates this view as the source of a drag and drop operation, allowing to provide optional payload and specify the namespace of the drag container this view belongs to.
- [draggable(_:id:item:containerNamespace:)](https://developer.apple.com/documentation/swiftui/view/draggable(_:id:item:containernamespace:)) — Activates this view as the source of a drag and drop operation, allowing to provide optional payload and specify the namespace of the drag container this view belongs to.
- [draggable(_:item:containerNamespace:)](https://developer.apple.com/documentation/swiftui/view/draggable(_:item:containernamespace:)) — Activates this view as the source of a drag and drop operation, allowing to provide optional identifiable payload and specify the namespace of the drag container this view belongs to.
- [draggable(containerItemID:containerNamespace:)](https://developer.apple.com/documentation/swiftui/view/draggable(containeritemid:containernamespace:)) — Inside a drag container, activates this view as the source of a drag and drop operation. Supports lazy drag containers.
- [dropConfiguration(_:)](https://developer.apple.com/documentation/swiftui/view/dropconfiguration(_:)) — Configures a drop session.
- [dropDestination(for:isEnabled:action:)](https://developer.apple.com/documentation/swiftui/view/dropdestination(for:isenabled:action:)) — Defines the destination of a drag and drop operation that provides a drop operation proposal and handles the dropped content with a closure that you specify.
- [dropPreviewsFormation(_:)](https://developer.apple.com/documentation/swiftui/view/droppreviewsformation(_:)) — Describes the way previews for a drop are composed.
- [formStyle(_:)](https://developer.apple.com/documentation/swiftui/view/formstyle(_:)) — Sets the style for forms in a view hierarchy.
- [gameSaveSyncingAlert(directory:finishedLoading:)](https://developer.apple.com/documentation/swiftui/view/gamesavesyncingalert(directory:finishedloading:)) — Presents a modal view while the game synced directory loads.
- [glassBackgroundEffect(_:displayMode:)](https://developer.apple.com/documentation/swiftui/view/glassbackgroundeffect(_:displaymode:)) — Fills the view’s background with a custom glass background effect and container-relative rounded rectangle shape.
- [glassBackgroundEffect(_:in:displayMode:)](https://developer.apple.com/documentation/swiftui/view/glassbackgroundeffect(_:in:displaymode:)) — Fills the view’s background with a custom glass background effect and a shape that you specify.
- [glassEffect(_:in:)](https://developer.apple.com/documentation/swiftui/view/glasseffect(_:in:)) — Applies the Liquid Glass effect to a view.
- [glassEffectID(_:in:)](https://developer.apple.com/documentation/swiftui/view/glasseffectid(_:in:)) — Associates an identity value to Liquid Glass effects defined within this view.
- [glassEffectTransition(_:)](https://developer.apple.com/documentation/swiftui/view/glasseffecttransition(_:)) — Associates a glass effect transition with any glass effects defined within this view.
- [glassEffectUnion(id:namespace:)](https://developer.apple.com/documentation/swiftui/view/glasseffectunion(id:namespace:)) — Associates any Liquid Glass effects defined within this view to a union with the provided identifier.
- [groupActivityAssociation(_:)](https://developer.apple.com/documentation/swiftui/view/groupactivityassociation(_:)) — Specifies how a view should be associated with the current SharePlay group activity.
- [handGestureShortcut(_:isEnabled:)](https://developer.apple.com/documentation/swiftui/view/handgestureshortcut(_:isenabled:)) — Assigns a hand gesture shortcut to the modified control.
- [handPointerBehavior(_:)](https://developer.apple.com/documentation/swiftui/view/handpointerbehavior(_:)) — Sets the behavior of the hand pointer while the user is interacting with the view.
- [handlesGameControllerEvents(matching:)](https://developer.apple.com/documentation/swiftui/view/handlesgamecontrollerevents(matching:)) — Specifies the game controllers events which should be delivered through the GameController framework when the view, or one of its descendants has focus.
- [handlesGameControllerEvents(matching:withOptions:)](https://developer.apple.com/documentation/swiftui/view/handlesgamecontrollerevents(matching:withoptions:)) — Specifies the game controllers events which should be delivered through the GameController framework when the view or one of its descendants has focus.
- [healthDataAccessRequest(store:objectType:predicate:trigger:completion:)](https://developer.apple.com/documentation/swiftui/view/healthdataaccessrequest(store:objecttype:predicate:trigger:completion:)) — Asynchronously requests permission to read a data type that requires per-object authorization (such as vision prescriptions).
- [healthDataAccessRequest(store:readTypes:trigger:completion:)](https://developer.apple.com/documentation/swiftui/view/healthdataaccessrequest(store:readtypes:trigger:completion:)) — Requests permission to read the specified HealthKit data types.
- [healthDataAccessRequest(store:shareTypes:readTypes:trigger:completion:)](https://developer.apple.com/documentation/swiftui/view/healthdataaccessrequest(store:sharetypes:readtypes:trigger:completion:)) — Requests permission to save and read the specified HealthKit data types.
- [imagePlaygroundGenerationStyle(_:in:)](https://developer.apple.com/documentation/swiftui/view/imageplaygroundgenerationstyle(_:in:)) — Sets the generation style for an image playground.
- [imagePlaygroundPersonalizationPolicy(_:)](https://developer.apple.com/documentation/swiftui/view/imageplaygroundpersonalizationpolicy(_:)) — Policy determining whether to support the usage of people in the playground or not.
- [imagePlaygroundSheet(isPresented:concept:sourceImage:onCompletion:onCancellation:)](https://developer.apple.com/documentation/swiftui/view/imageplaygroundsheet(ispresented:concept:sourceimage:oncompletion:oncancellation:)) — Presents the system sheet to create images from the specified input.
- [imagePlaygroundSheet(isPresented:concept:sourceImageURL:onCompletion:onCancellation:)](https://developer.apple.com/documentation/swiftui/view/imageplaygroundsheet(ispresented:concept:sourceimageurl:oncompletion:oncancellation:)) — Presents the system sheet to create images from the specified input.
- [imagePlaygroundSheet(isPresented:concepts:sourceImage:onCompletion:onCancellation:)](https://developer.apple.com/documentation/swiftui/view/imageplaygroundsheet(ispresented:concepts:sourceimage:oncompletion:oncancellation:)) — Presents the system sheet to create images from the specified input.
- [imagePlaygroundSheet(isPresented:concepts:sourceImageURL:onCompletion:onCancellation:)](https://developer.apple.com/documentation/swiftui/view/imageplaygroundsheet(ispresented:concepts:sourceimageurl:oncompletion:oncancellation:)) — Presents the system sheet to create images from the specified input.
- [immersiveEnvironmentPicker(content:)](https://developer.apple.com/documentation/swiftui/view/immersiveenvironmentpicker(content:)) — Add menu items to open immersive spaces from a media player’s environment picker.
- [inAppPurchaseOptions(_:)](https://developer.apple.com/documentation/swiftui/view/inapppurchaseoptions(_:)) — Add a function to call before initiating a purchase from StoreKit view within this view, providing a set of options for the purchase.
- [journalingSuggestionsPicker(isPresented:journalingSuggestionToken:onCompletion:)](https://developer.apple.com/documentation/swiftui/view/journalingsuggestionspicker(ispresented:journalingsuggestiontoken:oncompletion:)) — Presents a visual picker interface that contains events and images that a person can select to retrieve more information.
- [journalingSuggestionsPicker(isPresented:onCompletion:)](https://developer.apple.com/documentation/swiftui/view/journalingsuggestionspicker(ispresented:oncompletion:)) — Presents a visual picker interface that contains events and images that a person can select to retrieve more information.
- [labelIconToTitleSpacing(_:)](https://developer.apple.com/documentation/swiftui/view/labelicontotitlespacing(_:)) — Set the spacing between the icon and title in labels.
- [labelReservedIconWidth(_:)](https://developer.apple.com/documentation/swiftui/view/labelreservediconwidth(_:)) — Set the width reserved for icons in labels.
- [labeledContentStyle(_:)](https://developer.apple.com/documentation/swiftui/view/labeledcontentstyle(_:)) — Sets a style for labeled content.
- [labelsVisibility(_:)](https://developer.apple.com/documentation/swiftui/view/labelsvisibility(_:)) — Controls the visibility of labels of any controls contained within this view.
- [lineHeight(_:)](https://developer.apple.com/documentation/swiftui/view/lineheight(_:)) — A modifier for the default line height in the view hierarchy.
- [listRowInsets(_:_:)](https://developer.apple.com/documentation/swiftui/view/listrowinsets(_:_:)) — Sets the insets of rows in a list on the specified edges.
- [listSectionIndexVisibility(_:)](https://developer.apple.com/documentation/swiftui/view/listsectionindexvisibility(_:)) — Changes the visibility of the list section index.
- [listSectionMargins(_:_:)](https://developer.apple.com/documentation/swiftui/view/listsectionmargins(_:_:)) — Set the section margins for the specific edges.
- [lookAroundViewer(isPresented:initialScene:allowsNavigation:showsRoadLabels:pointsOfInterest:onDismiss:)](https://developer.apple.com/documentation/swiftui/view/lookaroundviewer(ispresented:initialscene:allowsnavigation:showsroadlabels:pointsofinterest:ondismiss:))
- [lookAroundViewer(isPresented:scene:allowsNavigation:showsRoadLabels:pointsOfInterest:onDismiss:)](https://developer.apple.com/documentation/swiftui/view/lookaroundviewer(ispresented:scene:allowsnavigation:showsroadlabels:pointsofinterest:ondismiss:))
- [manageSubscriptionsSheet(isPresented:subscriptionGroupID:)](https://developer.apple.com/documentation/swiftui/view/managesubscriptionssheet(ispresented:subscriptiongroupid:))
- [managedContentStyle(_:)](https://developer.apple.com/documentation/swiftui/view/managedcontentstyle(_:)) — Applies a managed content style to the view.
- [manipulable(coordinateSpace:operations:inertia:isEnabled:onChanged:)](https://developer.apple.com/documentation/swiftui/view/manipulable(coordinatespace:operations:inertia:isenabled:onchanged:)) — Allows this view to be manipulated using common hand gestures.
- [manipulable(transform:coordinateSpace:operations:inertia:isEnabled:onChanged:)](https://developer.apple.com/documentation/swiftui/view/manipulable(transform:coordinatespace:operations:inertia:isenabled:onchanged:)) — Applies the given 3D affine transform to the view and allows it to be manipulated using common hand gestures.
- [manipulable(using:)](https://developer.apple.com/documentation/swiftui/view/manipulable(using:)) — Allows the view to be manipulated using a manipulation gesture attached to a different view.
- [manipulationGesture(updating:coordinateSpace:operations:inertia:isEnabled:onChanged:)](https://developer.apple.com/documentation/swiftui/view/manipulationgesture(updating:coordinatespace:operations:inertia:isenabled:onchanged:)) — Adds a manipulation gesture to this view without allowing this view to be manipulable itself.
- [mapCameraKeyframeAnimator(trigger:keyframes:)](https://developer.apple.com/documentation/swiftui/view/mapcamerakeyframeanimator(trigger:keyframes:)) — Uses the given keyframes to animate the camera of a `Map` when the given trigger value changes.
- [mapControlVisibility(_:)](https://developer.apple.com/documentation/swiftui/view/mapcontrolvisibility(_:)) — Configures all Map controls in the environment to have the specified visibility
- [mapControls(_:)](https://developer.apple.com/documentation/swiftui/view/mapcontrols(_:)) — Configures all `Map` views in the associated environment to have standard size and position controls
- [mapFeatureSelectionAccessory(_:)](https://developer.apple.com/documentation/swiftui/view/mapfeatureselectionaccessory(_:)) — Specifies the selection accessory to display for a `MapFeature`
- [mapFeatureSelectionContent(content:)](https://developer.apple.com/documentation/swiftui/view/mapfeatureselectioncontent(content:)) — Specifies a custom presentation for the currently selected feature.
- [mapFeatureSelectionDisabled(_:)](https://developer.apple.com/documentation/swiftui/view/mapfeatureselectiondisabled(_:)) — Specifies which map features should have selection disabled.
- [mapItemDetailPopover(isPresented:item:displaysMap:attachmentAnchor:)](https://developer.apple.com/documentation/swiftui/view/mapitemdetailpopover(ispresented:item:displaysmap:attachmentanchor:)) — Presents a map item detail popover.
- [mapItemDetailPopover(isPresented:item:displaysMap:attachmentAnchor:arrowEdge:)](https://developer.apple.com/documentation/swiftui/view/mapitemdetailpopover(ispresented:item:displaysmap:attachmentanchor:arrowedge:)) — Presents a map item detail popover.
- [mapItemDetailPopover(item:displaysMap:attachmentAnchor:)](https://developer.apple.com/documentation/swiftui/view/mapitemdetailpopover(item:displaysmap:attachmentanchor:)) — Presents a map item detail popover.
- [mapItemDetailPopover(item:displaysMap:attachmentAnchor:arrowEdge:)](https://developer.apple.com/documentation/swiftui/view/mapitemdetailpopover(item:displaysmap:attachmentanchor:arrowedge:)) — Presents a map item detail popover.
- [mapItemDetailSheet(isPresented:item:displaysMap:)](https://developer.apple.com/documentation/swiftui/view/mapitemdetailsheet(ispresented:item:displaysmap:)) — Presents a map item detail sheet.
- [mapItemDetailSheet(item:displaysMap:)](https://developer.apple.com/documentation/swiftui/view/mapitemdetailsheet(item:displaysmap:)) — Presents a map item detail sheet.
- [mapScope(_:)](https://developer.apple.com/documentation/swiftui/view/mapscope(_:)) — Creates a mapScope that SwiftUI uses to connect map controls to an associated map.
- [mapStyle(_:)](https://developer.apple.com/documentation/swiftui/view/mapstyle(_:)) — Specifies the map style to be used.
- [matchedTransitionSource(id:in:)](https://developer.apple.com/documentation/swiftui/view/matchedtransitionsource(id:in:)) — Identifies this view as the source of a navigation transition, such as a zoom transition.
- [matchedTransitionSource(id:in:configuration:)](https://developer.apple.com/documentation/swiftui/view/matchedtransitionsource(id:in:configuration:)) — Identifies this view as the source of a navigation transition, such as a zoom transition.
- [materialActiveAppearance(_:)](https://developer.apple.com/documentation/swiftui/view/materialactiveappearance(_:)) — Sets an explicit active appearance for materials in this view.
- [multilineTextAlignment(strategy:)](https://developer.apple.com/documentation/swiftui/view/multilinetextalignment(strategy:)) — A modifier for the default text alignment strategy in the view hierarchy.
- [navigationLinkIndicatorVisibility(_:)](https://developer.apple.com/documentation/swiftui/view/navigationlinkindicatorvisibility(_:)) — Configures whether navigation links show a disclosure indicator.
- [navigationTransition(_:)](https://developer.apple.com/documentation/swiftui/view/navigationtransition(_:)) — Sets the navigation transition style for this view.
- [onAppIntentExecution(_:perform:)](https://developer.apple.com/documentation/swiftui/view/onappintentexecution(_:perform:)) — Registers a handler to invoke in response to the specified app intent that your app receives.
- [onApplePayCouponCodeChange(perform:)](https://developer.apple.com/documentation/swiftui/view/onapplepaycouponcodechange(perform:)) — Called when a user has entered or updated a coupon code. This is required if the user is being asked to provide a coupon code.
- [onApplePayPaymentMethodChange(perform:)](https://developer.apple.com/documentation/swiftui/view/onapplepaypaymentmethodchange(perform:)) — Called when a payment method has changed and asks for an update payment request. If this modifier isn’t provided Wallet will assume the payment method is valid.
- [onApplePayShippingContactChange(perform:)](https://developer.apple.com/documentation/swiftui/view/onapplepayshippingcontactchange(perform:)) — Called when a user selected a shipping address. This is required if the user is being asked to provide a shipping contact.
- [onApplePayShippingMethodChange(perform:)](https://developer.apple.com/documentation/swiftui/view/onapplepayshippingmethodchange(perform:)) — Called when a user selected a shipping method. This is required if the user is being asked to provide a shipping method.
- [onCameraCaptureEvent(isEnabled:defaultSoundDisabled:action:)](https://developer.apple.com/documentation/swiftui/view/oncameracaptureevent(isenabled:defaultsounddisabled:action:)) — Used to register an action triggered by system capture events.
- [onCameraCaptureEvent(isEnabled:defaultSoundDisabled:primaryAction:secondaryAction:)](https://developer.apple.com/documentation/swiftui/view/oncameracaptureevent(isenabled:defaultsounddisabled:primaryaction:secondaryaction:)) — Used to register actions triggered by system capture events.
- [onDragSessionUpdated(_:)](https://developer.apple.com/documentation/swiftui/view/ondragsessionupdated(_:)) — Specifies an action to perform on each update of an ongoing dragging operation activated by `draggable(_:)` or anther drag modifiers.
- [onDropSessionUpdated(_:)](https://developer.apple.com/documentation/swiftui/view/ondropsessionupdated(_:)) — Specifies an action to perform on each update of an ongoing drop operation activated by `dropDestination(_:)` or other drop modifiers.
- [onGeometryChange3D(for:of:action:)](https://developer.apple.com/documentation/swiftui/view/ongeometrychange3d(for:of:action:)) — Returns a new view that arranges to call `action(value)` whenever the value computed by `transform(proxy)` changes, where `proxy` provides access to the view’s 3D geometry properties.
- [onInAppPurchaseCompletion(perform:)](https://developer.apple.com/documentation/swiftui/view/oninapppurchasecompletion(perform:)) — Add an action to perform when a purchase initiated from a StoreKit view within this view completes.
- [onInAppPurchaseStart(perform:)](https://developer.apple.com/documentation/swiftui/view/oninapppurchasestart(perform:)) — Add an action to perform when a user triggers the purchase button on a StoreKit view within this view.
- [onInteractiveResizeChange(_:)](https://developer.apple.com/documentation/swiftui/view/oninteractiveresizechange(_:)) — Adds an action to perform when the enclosing window is being interactively resized.
- [onMapCameraChange(frequency:_:)](https://developer.apple.com/documentation/swiftui/view/onmapcamerachange(frequency:_:)) — Performs an action when Map camera framing changes
- [onOpenURL(prefersInApp:)](https://developer.apple.com/documentation/swiftui/view/onopenurl(prefersinapp:)) — Sets an `OpenURLAction` that prefers opening URL with an in-app browser. It’s equivalent to calling `.onOpenURL(_:)`
- [onWorldRecenter(action:)](https://developer.apple.com/documentation/swiftui/view/onworldrecenter(action:)) — Adds an action to perform when recentering the view with the digital crown.
- [payLaterViewAction(_:)](https://developer.apple.com/documentation/swiftui/view/paylaterviewaction(_:)) — Sets the action on the PayLaterView. See `PKPayLaterAction`.
- [payLaterViewDisplayStyle(_:)](https://developer.apple.com/documentation/swiftui/view/paylaterviewdisplaystyle(_:)) — Sets the display style on the PayLaterView. See `PKPayLaterDisplayStyle`.
- [payWithApplePayButtonDisableCardArt()](https://developer.apple.com/documentation/swiftui/view/paywithapplepaybuttondisablecardart()) — Sets the features that should be allowed to show on the payment buttons.
- [payWithApplePayButtonStyle(_:)](https://developer.apple.com/documentation/swiftui/view/paywithapplepaybuttonstyle(_:)) — Sets the style to be used by the button. (see `PayWithApplePayButtonStyle`).
- [popoverTip(_:arrowEdge:action:)](https://developer.apple.com/documentation/swiftui/view/popovertip(_:arrowedge:action:)) — Presents a popover tip on the modified view.
- [popoverTip(_:isPresented:attachmentAnchor:arrowEdge:action:)](https://developer.apple.com/documentation/swiftui/view/popovertip(_:ispresented:attachmentanchor:arrowedge:action:)) — Presents a popover tip on the modified view.
- [popoverTip(_:isPresented:attachmentAnchor:arrowEdges:action:)](https://developer.apple.com/documentation/swiftui/view/popovertip(_:ispresented:attachmentanchor:arrowedges:action:)) — Presents a popover tip on the modified view.
- [postToPhotosSharedAlbumSheet(isPresented:items:photoLibrary:defaultAlbumIdentifier:completion:)](https://developer.apple.com/documentation/swiftui/view/posttophotossharedalbumsheet(ispresented:items:photolibrary:defaultalbumidentifier:completion:)) — Presents an “Add to Shared Album” sheet that allows the user to post the given items to a shared album.
- [preferredSubscriptionOffer(_:)](https://developer.apple.com/documentation/swiftui/view/preferredsubscriptionoffer(_:)) — Selects a subscription offer to apply to a purchase that a customer makes from a subscription store view, a store view, or a product view.
- [preferredWindowClippingMargins(_:_:)](https://developer.apple.com/documentation/swiftui/view/preferredwindowclippingmargins(_:_:)) — Requests additional margins for drawing beyond the bounds of the window.
- [presentationBreakthroughEffect(_:)](https://developer.apple.com/documentation/swiftui/view/presentationbreakthrougheffect(_:)) — Changes the way the enclosing presentation breaks through content occluding it.
- [presentationPreventsAppTermination(_:)](https://developer.apple.com/documentation/swiftui/view/presentationpreventsapptermination(_:)) — Whether a presentation prevents the app from being terminated/quit by the system or app termination menu item.
- [productDescription(_:)](https://developer.apple.com/documentation/swiftui/view/productdescription(_:)) — Configure the visibility of labels displaying an in-app purchase product description within the view.
- [productIconBorder()](https://developer.apple.com/documentation/swiftui/view/producticonborder()) — Adds a standard border to an in-app purchase product’s icon .
- [productViewStyle(_:)](https://developer.apple.com/documentation/swiftui/view/productviewstyle(_:)) — Sets the style for In-App Purchase product views within a view.
- [realityViewCameraControls(_:)](https://developer.apple.com/documentation/swiftui/view/realityviewcameracontrols(_:)) — Adds gestures that control the position and direction of a virtual camera.
- [realityViewLayoutBehavior(_:)](https://developer.apple.com/documentation/swiftui/view/realityviewlayoutbehavior(_:)) — A view modifier that controls the frame sizing and content alignment behavior for `RealityView`
- [rotation3DLayout(_:)](https://developer.apple.com/documentation/swiftui/view/rotation3dlayout(_:)) — Rotates a view with impacts to its frame in a containing layout
- [rotation3DLayout(_:axis:)](https://developer.apple.com/documentation/swiftui/view/rotation3dlayout(_:axis:)) — Rotates a view with impacts to its frame in a containing layout
- [safeAreaBar(edge:alignment:spacing:content:)](https://developer.apple.com/documentation/swiftui/view/safeareabar(edge:alignment:spacing:content:)) — Shows the specified content as a custom bar beside the modified view.
- [scaledToFill3D()](https://developer.apple.com/documentation/swiftui/view/scaledtofill3d()) — Scales this view to fill its parent.
- [scaledToFit3D()](https://developer.apple.com/documentation/swiftui/view/scaledtofit3d()) — Scales this view to fit its parent.
- [scrollEdgeEffectHidden(_:for:)](https://developer.apple.com/documentation/swiftui/view/scrolledgeeffecthidden(_:for:)) — Hides any scroll edge effects for scroll views within this hierarchy.
- [scrollEdgeEffectStyle(_:for:)](https://developer.apple.com/documentation/swiftui/view/scrolledgeeffectstyle(_:for:)) — Configures the scroll edge effect style for scroll views within this hierarchy.
- [scrollInputBehavior(_:for:)](https://developer.apple.com/documentation/swiftui/view/scrollinputbehavior(_:for:)) — Enables or disables scrolling in scrollable views when using particular inputs.
- [searchSelection(_:)](https://developer.apple.com/documentation/swiftui/view/searchselection(_:)) — Binds the selection of the search field associated with the nearest searchable modifier to the given [doc://com.apple.SwiftUI/documentation/SwiftUI/TextSelection](https://developer.apple.com/documentation/SwiftUI/TextSelection) value.
- [searchToolbarBehavior(_:)](https://developer.apple.com/documentation/swiftui/view/searchtoolbarbehavior(_:)) — Configures the behavior for search in the toolbar.
- [sectionIndexLabel(_:)](https://developer.apple.com/documentation/swiftui/view/sectionindexlabel(_:)) — Sets the label that is used in a section index to point to this section, typically only a single character long.
- [signInWithAppleButtonStyle(_:)](https://developer.apple.com/documentation/swiftui/view/signinwithapplebuttonstyle(_:)) — Sets the style used for displaying the control (see `SignInWithAppleButton.Style`).
- [sliderThumbVisibility(_:)](https://developer.apple.com/documentation/swiftui/view/sliderthumbvisibility(_:)) — Sets the thumb visibility for `Slider`s within this view.
- [spatialOverlay(alignment:content:)](https://developer.apple.com/documentation/swiftui/view/spatialoverlay(alignment:content:)) — Adds secondary views within the 3D bounds of this view.
- [spatialOverlayPreferenceValue(_:alignment:_:)](https://developer.apple.com/documentation/swiftui/view/spatialoverlaypreferencevalue(_:alignment:_:)) — Uses the specified preference value from the view to produce another view occupying the same 3D space of the first view.
- [storeButton(_:for:)](https://developer.apple.com/documentation/swiftui/view/storebutton(_:for:)) — Specifies the visibility of auxiliary buttons that store view and subscription store view instances may use.
- [storeProductTask(for:priority:action:)](https://developer.apple.com/documentation/swiftui/view/storeproducttask(for:priority:action:)) — Declares the view as dependent on an In-App Purchase product and returns a modified view.
- [storeProductsTask(for:priority:action:)](https://developer.apple.com/documentation/swiftui/view/storeproductstask(for:priority:action:)) — Declares the view as dependent on a collection of In-App Purchase products and returns a modified view.
- [subscriptionIntroductoryOffer(applyOffer:compactJWS:)](https://developer.apple.com/documentation/swiftui/view/subscriptionintroductoryoffer(applyoffer:compactjws:)) — Selects the introductory offer eligibility preference to apply to a purchase a customer makes from a subscription store view.
- [subscriptionOfferViewButtonVisibility(_:for:)](https://developer.apple.com/documentation/swiftui/view/subscriptionofferviewbuttonvisibility(_:for:))
- [subscriptionOfferViewDetailAction(_:)](https://developer.apple.com/documentation/swiftui/view/subscriptionofferviewdetailaction(_:))
- [subscriptionOfferViewStyle(_:)](https://developer.apple.com/documentation/swiftui/view/subscriptionofferviewstyle(_:))
- [subscriptionPromotionalOffer(offer:compactJWS:)](https://developer.apple.com/documentation/swiftui/view/subscriptionpromotionaloffer(offer:compactjws:)) — Selects a promotional offer to apply to a purchase a customer makes from a subscription store view.
- [subscriptionPromotionalOffer(offer:signature:)](https://developer.apple.com/documentation/swiftui/view/subscriptionpromotionaloffer(offer:signature:)) — Selects a promotional offer to apply to a purchase a customer makes from a subscription store view.
- [subscriptionStatusTask(for:priority:action:)](https://developer.apple.com/documentation/swiftui/view/subscriptionstatustask(for:priority:action:)) — Declares the view as dependent on the status of an auto-renewable subscription group, and returns a modified view.
- [subscriptionStoreButtonLabel(_:)](https://developer.apple.com/documentation/swiftui/view/subscriptionstorebuttonlabel(_:)) — Configures subscription store view instances within a view to use the provided button label.
- [subscriptionStoreControlBackground(_:)](https://developer.apple.com/documentation/swiftui/view/subscriptionstorecontrolbackground(_:)) — Set a standard effect to use for the background of subscription store view controls within the view.
- [subscriptionStoreControlIcon(icon:)](https://developer.apple.com/documentation/swiftui/view/subscriptionstorecontrolicon(icon:)) — Sets a view to use to decorate individual subscription options within a subscription store view.
- [subscriptionStoreControlStyle(_:)](https://developer.apple.com/documentation/swiftui/view/subscriptionstorecontrolstyle(_:)) — Sets the control style for subscription store views within a view.
- [subscriptionStoreControlStyle(_:placement:)](https://developer.apple.com/documentation/swiftui/view/subscriptionstorecontrolstyle(_:placement:)) — Sets the control style and control placement for subscription store views within a view.
- [subscriptionStoreOptionGroupStyle(_:)](https://developer.apple.com/documentation/swiftui/view/subscriptionstoreoptiongroupstyle(_:)) — Sets the style subscription store views within this view use to display groups of subscription options.
- [subscriptionStorePickerItemBackground(_:)](https://developer.apple.com/documentation/swiftui/view/subscriptionstorepickeritembackground(_:)) — Sets the background style for picker items of the subscription store view instances within a view.
- [subscriptionStorePickerItemBackground(_:in:)](https://developer.apple.com/documentation/swiftui/view/subscriptionstorepickeritembackground(_:in:)) — Sets the background shape and style for subscription store view picker items within a view.
- [subscriptionStorePolicyDestination(for:destination:)](https://developer.apple.com/documentation/swiftui/view/subscriptionstorepolicydestination(for:destination:)) — Configures a view as the destination for a policy button action in subscription store views.
- [subscriptionStorePolicyDestination(url:for:)](https://developer.apple.com/documentation/swiftui/view/subscriptionstorepolicydestination(url:for:)) — Configures a URL as the destination for a policy button action in subscription store views.
- [subscriptionStorePolicyForegroundStyle(_:)](https://developer.apple.com/documentation/swiftui/view/subscriptionstorepolicyforegroundstyle(_:)) — Sets the style for the terms of service and privacy policy buttons within a subscription store view.
- [subscriptionStorePolicyForegroundStyle(_:_:)](https://developer.apple.com/documentation/swiftui/view/subscriptionstorepolicyforegroundstyle(_:_:)) — Sets the primary and secondary style for the terms of service and privacy policy buttons within a subscription store view.
- [subscriptionStoreSignInAction(_:)](https://developer.apple.com/documentation/swiftui/view/subscriptionstoresigninaction(_:)) — Adds an action to perform when a person uses the sign-in button on a subscription store view within a view.
- [symbolColorRenderingMode(_:)](https://developer.apple.com/documentation/swiftui/view/symbolcolorrenderingmode(_:)) — Sets the color rendering mode for symbol images.
- [symbolVariableValueMode(_:)](https://developer.apple.com/documentation/swiftui/view/symbolvariablevaluemode(_:)) — Sets the variable value mode mode for symbol images within this view.
- [tabBarMinimizeBehavior(_:)](https://developer.apple.com/documentation/swiftui/view/tabbarminimizebehavior(_:)) — Sets the behavior for tab bar minimization.
- [tabViewBottomAccessory(content:)](https://developer.apple.com/documentation/swiftui/view/tabviewbottomaccessory(content:))
- [tabViewSearchActivation(_:)](https://developer.apple.com/documentation/swiftui/view/tabviewsearchactivation(_:)) — Configures the activation and deactivation behavior of search in the search tab.
- [tabletopGame(_:parent:automaticUpdate:)](https://developer.apple.com/documentation/swiftui/view/tabletopgame(_:parent:automaticupdate:)) — Adds a tabletop game to a view.
- [tabletopGame(_:parent:automaticUpdate:interaction:)](https://developer.apple.com/documentation/swiftui/view/tabletopgame(_:parent:automaticupdate:interaction:)) — Supplies a closure which returns a new interaction whenever needed.
- [task(id:name:executorPreference:priority:file:line:_:)](https://developer.apple.com/documentation/swiftui/view/task(id:name:executorpreference:priority:file:line:_:)) — Adds a task to perform before this view appears or when a specified value changes.
- [textContentType(_:)](https://developer.apple.com/documentation/swiftui/view/textcontenttype(_:)) — Sets the text content type for this view, which the system uses to offer suggestions while the user enters text on macOS.
- [textInputFormattingControlVisibility(_:for:)](https://developer.apple.com/documentation/swiftui/view/textinputformattingcontrolvisibility(_:for:)) — Define which system text formatting controls are available.
- [textRenderer(_:)](https://developer.apple.com/documentation/swiftui/view/textrenderer(_:)) — Returns a new view such that any text views within it will use `renderer` to draw themselves.
- [textSelectionAffinity(_:)](https://developer.apple.com/documentation/swiftui/view/textselectionaffinity(_:)) — Sets the direction of a selection or cursor relative to a text character.
- [tipAnchor(_:)](https://developer.apple.com/documentation/swiftui/view/tipanchor(_:)) — Sets a value for the specified tip anchor to be used to anchor a tip view to the `.bounds` of the view.
- [tipBackground(_:)](https://developer.apple.com/documentation/swiftui/view/tipbackground(_:)) — Sets the tip’s view background to a style. Currently this only applies to inline tips, not popover tips.
- [tipBackgroundInteraction(_:)](https://developer.apple.com/documentation/swiftui/view/tipbackgroundinteraction(_:)) — Controls whether people can interact with the view behind a presented tip.
- [tipCornerRadius(_:antialiased:)](https://developer.apple.com/documentation/swiftui/view/tipcornerradius(_:antialiased:)) — Sets the corner radius for an inline tip view.
- [tipImageSize(_:)](https://developer.apple.com/documentation/swiftui/view/tipimagesize(_:)) — Sets the size for a tip’s image.
- [tipImageStyle(_:)](https://developer.apple.com/documentation/swiftui/view/tipimagestyle(_:)) — Sets the style for a tip’s image.
- [tipImageStyle(_:_:)](https://developer.apple.com/documentation/swiftui/view/tipimagestyle(_:_:)) — Sets the style for a tip’s image.
- [tipImageStyle(_:_:_:)](https://developer.apple.com/documentation/swiftui/view/tipimagestyle(_:_:_:)) — Sets the style for a tip’s image.
- [tipViewStyle(_:)](https://developer.apple.com/documentation/swiftui/view/tipviewstyle(_:)) — Sets the given style for TipView within the view hierarchy.
- [toolbarItemHidden(_:)](https://developer.apple.com/documentation/swiftui/view/toolbaritemhidden(_:)) — Hides an individual view within a control group toolbar item.
- [transactionPicker(isPresented:selection:)](https://developer.apple.com/documentation/swiftui/view/transactionpicker(ispresented:selection:)) — Presents a picker that selects a collection of transactions.
- [transactionTask(_:action:)](https://developer.apple.com/documentation/swiftui/view/transactiontask(_:action:)) — Provides a task to perform before this view appears
- [translationPresentation(isPresented:text:attachmentAnchor:arrowEdge:replacementAction:)](https://developer.apple.com/documentation/swiftui/view/translationpresentation(ispresented:text:attachmentanchor:arrowedge:replacementaction:)) — Presents a translation popover when a given condition is true.
- [translationTask(_:action:)](https://developer.apple.com/documentation/swiftui/view/translationtask(_:action:)) — Adds a task to perform before this view appears or when the translation configuration changes.
- [translationTask(source:target:action:)](https://developer.apple.com/documentation/swiftui/view/translationtask(source:target:action:)) — Adds a task to perform before this view appears or when the specified source or target languages change.
- [verifyIdentityWithWalletButtonStyle(_:)](https://developer.apple.com/documentation/swiftui/view/verifyidentitywithwalletbuttonstyle(_:)) — Sets the style to be used by the button. (see `PKIdentityButtonStyle`).
- [webViewBackForwardNavigationGestures(_:)](https://developer.apple.com/documentation/swiftui/view/webviewbackforwardnavigationgestures(_:)) — Determines whether horizontal swipe gestures trigger backward and forward page navigation.
- [webViewContentBackground(_:)](https://developer.apple.com/documentation/swiftui/view/webviewcontentbackground(_:)) — Specifies the visibility of the webpage’s natural background color within this view.
- [webViewContextMenu(menu:)](https://developer.apple.com/documentation/swiftui/view/webviewcontextmenu(menu:)) — Adds an item-based context menu to a WebView, replacing the default set of context menu items.
- [webViewElementFullscreenBehavior(_:)](https://developer.apple.com/documentation/swiftui/view/webviewelementfullscreenbehavior(_:)) — Determines whether a web view can display content full screen.
- [webViewLinkPreviews(_:)](https://developer.apple.com/documentation/swiftui/view/webviewlinkpreviews(_:)) — Determines whether pressing a link displays a preview of the destination for the link.
- [webViewMagnificationGestures(_:)](https://developer.apple.com/documentation/swiftui/view/webviewmagnificationgestures(_:)) — Determines whether magnify gestures change the view’s magnification.
- [webViewOnScrollGeometryChange(for:of:action:)](https://developer.apple.com/documentation/swiftui/view/webviewonscrollgeometrychange(for:of:action:)) — Adds an action to be performed when a value, created from a scroll geometry, changes.
- [webViewScrollInputBehavior(_:for:)](https://developer.apple.com/documentation/swiftui/view/webviewscrollinputbehavior(_:for:)) — Enables or disables scrolling in web views when using particular inputs.
- [webViewScrollPosition(_:)](https://developer.apple.com/documentation/swiftui/view/webviewscrollposition(_:)) — Associates a binding to a scroll position with the web view.
- [webViewTextSelection(_:)](https://developer.apple.com/documentation/swiftui/view/webviewtextselection(_:)) — Determines whether to allow people to select or otherwise interact with text.
- [windowResizeAnchor(_:)](https://developer.apple.com/documentation/swiftui/view/windowresizeanchor(_:)) — Sets the window anchor point used when the size of the view changes such that the window must resize.
- [windowToolbarFullScreenVisibility(_:)](https://developer.apple.com/documentation/swiftui/view/windowtoolbarfullscreenvisibility(_:)) — Configures the visibility of the window toolbar when the window enters full screen mode.
- [workoutPreview(_:isPresented:)](https://developer.apple.com/documentation/swiftui/view/workoutpreview(_:ispresented:)) — Presents a preview of the workout contents as a modal sheet
- [writingDirection(strategy:)](https://developer.apple.com/documentation/swiftui/view/writingdirection(strategy:)) — A modifier for the default text writing direction strategy in the view hierarchy.
- [writingToolsAffordanceVisibility(_:)](https://developer.apple.com/documentation/swiftui/view/writingtoolsaffordancevisibility(_:)) — Specifies whether the system should show the Writing Tools affordance for text input views affected by the environment.
- [writingToolsBehavior(_:)](https://developer.apple.com/documentation/swiftui/view/writingtoolsbehavior(_:)) — Specifies the Writing Tools behavior for text and text input in the environment.

---

*Source: [https://developer.apple.com/documentation/com.apple.SwiftUI/documentation/SwiftUI/View](https://developer.apple.com/documentation/com.apple.SwiftUI/documentation/SwiftUI/View)*
--- END FILE ---

--- FILE: Technology-specific-views.md ---
# Technology-specific views

**Use SwiftUI views that other Apple frameworks provide.**


## Overview

To access SwiftUI views that another framework defines, import both SwiftUI and the other framework into the file where you use the view. You can find the framework to import by looking at the availability information on the view’s documentation page.

![Image](technology-specific-views-hero)

For example, to use the [doc://com.apple.documentation/documentation/MapKit/Map](https://developer.apple.com/documentation/MapKit/Map) view in your app, import both SwiftUI and MapKit.

```swift
import SwiftUI
import MapKit

struct MyMapView: View {
    // Center the map on Joshua Tree National Park.
    var region = MKCoordinateRegion(
            center: CLLocationCoordinate2D(latitude: 34.011_286, longitude: -116.166_868),
            span: MKCoordinateSpan(latitudeDelta: 0.2, longitudeDelta: 0.2)
        )

    var body: some View {
        Map(initialPosition: .region(region))
    }
}
```

For design guidance, see doc://com.apple.documentation/design/Human-Interface-Guidelines/technologies in the Human Interface Guidelines.

## Topics

### Displaying web content

- [WebView](https://developer.apple.com/documentation/WebKit/WebView-swift.struct) — A view that displays some web content.
- [WebPage](https://developer.apple.com/documentation/WebKit/WebPage) — An object that controls and manages the behavior of interactive web content.
- [webViewBackForwardNavigationGestures(_:)](https://developer.apple.com/documentation/swiftui/view/webviewbackforwardnavigationgestures(_:)) — Determines whether horizontal swipe gestures trigger backward and forward page navigation.
- [webViewContentBackground(_:)](https://developer.apple.com/documentation/swiftui/view/webviewcontentbackground(_:)) — Specifies the visibility of the webpage’s natural background color within this view.
- [webViewContextMenu(menu:)](https://developer.apple.com/documentation/swiftui/view/webviewcontextmenu(menu:)) — Adds an item-based context menu to a WebView, replacing the default set of context menu items.
- [webViewElementFullscreenBehavior(_:)](https://developer.apple.com/documentation/swiftui/view/webviewelementfullscreenbehavior(_:)) — Determines whether a web view can display content full screen.
- [webViewLinkPreviews(_:)](https://developer.apple.com/documentation/swiftui/view/webviewlinkpreviews(_:)) — Determines whether pressing a link displays a preview of the destination for the link.
- [webViewMagnificationGestures(_:)](https://developer.apple.com/documentation/swiftui/view/webviewmagnificationgestures(_:)) — Determines whether magnify gestures change the view’s magnification.
- [webViewOnScrollGeometryChange(for:of:action:)](https://developer.apple.com/documentation/swiftui/view/webviewonscrollgeometrychange(for:of:action:)) — Adds an action to be performed when a value, created from a scroll geometry, changes.
- [webViewScrollInputBehavior(_:for:)](https://developer.apple.com/documentation/swiftui/view/webviewscrollinputbehavior(_:for:)) — Enables or disables scrolling in web views when using particular inputs.
- [webViewScrollPosition(_:)](https://developer.apple.com/documentation/swiftui/view/webviewscrollposition(_:)) — Associates a binding to a scroll position with the web view.
- [webViewTextSelection(_:)](https://developer.apple.com/documentation/swiftui/view/webviewtextselection(_:)) — Determines whether to allow people to select or otherwise interact with text.
### Accessing Apple Pay and Wallet

- [PayWithApplePayButton](https://developer.apple.com/documentation/PassKit/PayWithApplePayButton) — A type that provides a button to pay with Apple pay.
- [AddPassToWalletButton](https://developer.apple.com/documentation/PassKit/AddPassToWalletButton) — A type that provides a button that enables people to add a new or existing pass to Apple Wallet.
- [VerifyIdentityWithWalletButton](https://developer.apple.com/documentation/PassKit/VerifyIdentityWithWalletButton) — A type that displays a button to present the identity verification flow.
- [addOrderToWalletButtonStyle(_:)](https://developer.apple.com/documentation/swiftui/view/addordertowalletbuttonstyle(_:)) — Sets the button’s style.
- [addPassToWalletButtonStyle(_:)](https://developer.apple.com/documentation/swiftui/view/addpasstowalletbuttonstyle(_:)) — Sets the style to be used by the button. (see `PKAddPassButtonStyle`).
- [onApplePayCouponCodeChange(perform:)](https://developer.apple.com/documentation/swiftui/view/onapplepaycouponcodechange(perform:)) — Called when a user has entered or updated a coupon code. This is required if the user is being asked to provide a coupon code.
- [onApplePayPaymentMethodChange(perform:)](https://developer.apple.com/documentation/swiftui/view/onapplepaypaymentmethodchange(perform:)) — Called when a payment method has changed and asks for an update payment request. If this modifier isn’t provided Wallet will assume the payment method is valid.
- [onApplePayShippingContactChange(perform:)](https://developer.apple.com/documentation/swiftui/view/onapplepayshippingcontactchange(perform:)) — Called when a user selected a shipping address. This is required if the user is being asked to provide a shipping contact.
- [onApplePayShippingMethodChange(perform:)](https://developer.apple.com/documentation/swiftui/view/onapplepayshippingmethodchange(perform:)) — Called when a user selected a shipping method. This is required if the user is being asked to provide a shipping method.
- [payLaterViewAction(_:)](https://developer.apple.com/documentation/swiftui/view/paylaterviewaction(_:)) — Sets the action on the PayLaterView. See `PKPayLaterAction`.
- [payLaterViewDisplayStyle(_:)](https://developer.apple.com/documentation/swiftui/view/paylaterviewdisplaystyle(_:)) — Sets the display style on the PayLaterView. See `PKPayLaterDisplayStyle`.
- [payWithApplePayButtonStyle(_:)](https://developer.apple.com/documentation/swiftui/view/paywithapplepaybuttonstyle(_:)) — Sets the style to be used by the button. (see `PayWithApplePayButtonStyle`).
- [verifyIdentityWithWalletButtonStyle(_:)](https://developer.apple.com/documentation/swiftui/view/verifyidentitywithwalletbuttonstyle(_:)) — Sets the style to be used by the button. (see `PKIdentityButtonStyle`).
- [AsyncShareablePassConfiguration](https://developer.apple.com/documentation/PassKit/AsyncShareablePassConfiguration)
- [transactionTask(_:action:)](https://developer.apple.com/documentation/swiftui/view/transactiontask(_:action:)) — Provides a task to perform before this view appears
### Authorizing and authenticating

- [LocalAuthenticationView](https://developer.apple.com/documentation/LocalAuthentication/LocalAuthenticationView) — A SwiftUI view that displays an authentication interface.
- [SignInWithAppleButton](https://developer.apple.com/documentation/AuthenticationServices/SignInWithAppleButton) — A SwiftUI view that creates the Sign in with Apple button for display.
- [signInWithAppleButtonStyle(_:)](https://developer.apple.com/documentation/swiftui/view/signinwithapplebuttonstyle(_:)) — Sets the style used for displaying the control (see `SignInWithAppleButton.Style`).
- [authorizationController](https://developer.apple.com/documentation/swiftui/environmentvalues/authorizationcontroller) — A value provided in the SwiftUI environment that views can use to perform authorization requests.
- [webAuthenticationSession](https://developer.apple.com/documentation/swiftui/environmentvalues/webauthenticationsession) — A value provided in the SwiftUI environment that views can use to authenticate a user through a web service.
### Configuring Family Sharing

- [FamilyActivityPicker](https://developer.apple.com/documentation/FamilyControls/FamilyActivityPicker) — A view in which users specify applications, web domains, and categories without revealing their choices to the app.
- [familyActivityPicker(isPresented:selection:)](https://developer.apple.com/documentation/swiftui/view/familyactivitypicker(ispresented:selection:)) — Presents an activity picker view as a sheet.
- [familyActivityPicker(headerText:footerText:isPresented:selection:)](https://developer.apple.com/documentation/swiftui/view/familyactivitypicker(headertext:footertext:ispresented:selection:)) — Presents an activity picker view as a sheet.
### Reporting on device activity

- [DeviceActivityReport](https://developer.apple.com/documentation/DeviceActivity/DeviceActivityReport) — A view that reports the user’s application, category, and web domain activity in a privacy-preserving way.
### Working with managed devices

- [managedContentStyle(_:)](https://developer.apple.com/documentation/swiftui/view/managedcontentstyle(_:)) — Applies a managed content style to the view.
- [automatedDeviceEnrollmentAddition(isPresented:)](https://developer.apple.com/documentation/swiftui/view/automateddeviceenrollmentaddition(ispresented:)) — Presents a modal view that enables users to add devices to their organization.
### Creating graphics

- [Chart](https://developer.apple.com/documentation/Charts/Chart) — A SwiftUI view that displays a chart.
- [SceneView](https://developer.apple.com/documentation/SceneKit/SceneView) — A SwiftUI view for displaying 3D SceneKit content.
- [SpriteView](https://developer.apple.com/documentation/SpriteKit/SpriteView) — A SwiftUI view that renders a SpriteKit scene.
### Getting location information

- [LocationButton](https://developer.apple.com/documentation/CoreLocationUI/LocationButton) — A SwiftUI button that grants one-time location authorization.
- [Map](https://developer.apple.com/documentation/MapKit/Map) — A view that displays an embedded map interface.
- [mapStyle(_:)](https://developer.apple.com/documentation/swiftui/view/mapstyle(_:)) — Specifies the map style to be used.
- [mapScope(_:)](https://developer.apple.com/documentation/swiftui/view/mapscope(_:)) — Creates a mapScope that SwiftUI uses to connect map controls to an associated map.
- [mapFeatureSelectionDisabled(_:)](https://developer.apple.com/documentation/swiftui/view/mapfeatureselectiondisabled(_:)) — Specifies which map features should have selection disabled.
- [mapFeatureSelectionAccessory(_:)](https://developer.apple.com/documentation/swiftui/view/mapfeatureselectionaccessory(_:)) — Specifies the selection accessory to display for a `MapFeature`
- [mapFeatureSelectionContent(content:)](https://developer.apple.com/documentation/swiftui/view/mapfeatureselectioncontent(content:)) — Specifies a custom presentation for the currently selected feature.
- [mapControls(_:)](https://developer.apple.com/documentation/swiftui/view/mapcontrols(_:)) — Configures all `Map` views in the associated environment to have standard size and position controls
- [mapControlVisibility(_:)](https://developer.apple.com/documentation/swiftui/view/mapcontrolvisibility(_:)) — Configures all Map controls in the environment to have the specified visibility
- [mapCameraKeyframeAnimator(trigger:keyframes:)](https://developer.apple.com/documentation/swiftui/view/mapcamerakeyframeanimator(trigger:keyframes:)) — Uses the given keyframes to animate the camera of a `Map` when the given trigger value changes.
- [lookAroundViewer(isPresented:scene:allowsNavigation:showsRoadLabels:pointsOfInterest:onDismiss:)](https://developer.apple.com/documentation/swiftui/view/lookaroundviewer(ispresented:scene:allowsnavigation:showsroadlabels:pointsofinterest:ondismiss:))
- [lookAroundViewer(isPresented:initialScene:allowsNavigation:showsRoadLabels:pointsOfInterest:onDismiss:)](https://developer.apple.com/documentation/swiftui/view/lookaroundviewer(ispresented:initialscene:allowsnavigation:showsroadlabels:pointsofinterest:ondismiss:))
- [onMapCameraChange(frequency:_:)](https://developer.apple.com/documentation/swiftui/view/onmapcamerachange(frequency:_:)) — Performs an action when Map camera framing changes
- [mapItemDetailPopover(isPresented:item:displaysMap:attachmentAnchor:)](https://developer.apple.com/documentation/swiftui/view/mapitemdetailpopover(ispresented:item:displaysmap:attachmentanchor:)) — Presents a map item detail popover.
- [mapItemDetailPopover(isPresented:item:displaysMap:attachmentAnchor:arrowEdge:)](https://developer.apple.com/documentation/swiftui/view/mapitemdetailpopover(ispresented:item:displaysmap:attachmentanchor:arrowedge:)) — Presents a map item detail popover.
- [mapItemDetailPopover(item:displaysMap:attachmentAnchor:)](https://developer.apple.com/documentation/swiftui/view/mapitemdetailpopover(item:displaysmap:attachmentanchor:)) — Presents a map item detail popover.
- [mapItemDetailPopover(item:displaysMap:attachmentAnchor:arrowEdge:)](https://developer.apple.com/documentation/swiftui/view/mapitemdetailpopover(item:displaysmap:attachmentanchor:arrowedge:)) — Presents a map item detail popover.
- [mapItemDetailSheet(isPresented:item:displaysMap:)](https://developer.apple.com/documentation/swiftui/view/mapitemdetailsheet(ispresented:item:displaysmap:)) — Presents a map item detail sheet.
- [mapItemDetailSheet(item:displaysMap:)](https://developer.apple.com/documentation/swiftui/view/mapitemdetailsheet(item:displaysmap:)) — Presents a map item detail sheet.
### Displaying media

- [CameraView](https://developer.apple.com/documentation/HomeKit/CameraView) — A SwiftUI view into which a video stream or an image snapshot is rendered.
- [NowPlayingView](https://developer.apple.com/documentation/WatchKit/NowPlayingView) — A view that displays the system’s Now Playing interface so that the user can control audio.
- [VideoPlayer](https://developer.apple.com/documentation/AVKit/VideoPlayer) — A view that displays content from a player and a native user interface to control playback.
- [continuityDevicePicker(isPresented:onDidConnect:)](https://developer.apple.com/documentation/swiftui/view/continuitydevicepicker(ispresented:ondidconnect:)) — A `continuityDevicePicker` should be used to discover and connect nearby continuity device through a button interface or other form of activation. On tvOS, this presents a fullscreen continuity device picker experience when selected. The modal view covers as much the screen of `self` as possible when a given condition is true.
- [cameraAnchor(isActive:)](https://developer.apple.com/documentation/swiftui/view/cameraanchor(isactive:)) — Specifies the view that should act as the virtual camera for Apple Vision Pro 2D Persona stream.
### Selecting photos

- [PhotosPicker](https://developer.apple.com/documentation/PhotosUI/PhotosPicker) — A view that displays a Photos picker for choosing assets from the photo library.
- [photosPicker(isPresented:selection:matching:preferredItemEncoding:)](https://developer.apple.com/documentation/swiftui/view/photospicker(ispresented:selection:matching:preferreditemencoding:)) — Presents a Photos picker that selects a `PhotosPickerItem`.
- [photosPicker(isPresented:selection:matching:preferredItemEncoding:photoLibrary:)](https://developer.apple.com/documentation/swiftui/view/photospicker(ispresented:selection:matching:preferreditemencoding:photolibrary:)) — Presents a Photos picker that selects a `PhotosPickerItem` from a given photo library.
- [photosPicker(isPresented:selection:maxSelectionCount:selectionBehavior:matching:preferredItemEncoding:)](https://developer.apple.com/documentation/swiftui/view/photospicker(ispresented:selection:maxselectioncount:selectionbehavior:matching:preferreditemencoding:)) — Presents a Photos picker that selects a collection of `PhotosPickerItem`.
- [photosPicker(isPresented:selection:maxSelectionCount:selectionBehavior:matching:preferredItemEncoding:photoLibrary:)](https://developer.apple.com/documentation/swiftui/view/photospicker(ispresented:selection:maxselectioncount:selectionbehavior:matching:preferreditemencoding:photolibrary:)) — Presents a Photos picker that selects a collection of `PhotosPickerItem` from a given photo library.
- [photosPickerAccessoryVisibility(_:edges:)](https://developer.apple.com/documentation/swiftui/view/photospickeraccessoryvisibility(_:edges:)) — Sets the accessory visibility of the Photos picker. Accessories include anything between the content and the edge, like the navigation bar or the sidebar.
- [photosPickerDisabledCapabilities(_:)](https://developer.apple.com/documentation/swiftui/view/photospickerdisabledcapabilities(_:)) — Disables capabilities of the Photos picker.
- [photosPickerStyle(_:)](https://developer.apple.com/documentation/swiftui/view/photospickerstyle(_:)) — Sets the mode of the Photos picker.
### Previewing content

- [quickLookPreview(_:)](https://developer.apple.com/documentation/swiftui/view/quicklookpreview(_:)) — Presents a Quick Look preview of the contents of a single URL.
- [quickLookPreview(_:in:)](https://developer.apple.com/documentation/swiftui/view/quicklookpreview(_:in:)) — Presents a Quick Look preview of the URLs you provide.
### Interacting with networked devices

- [DevicePicker](https://developer.apple.com/documentation/DeviceDiscoveryUI/DevicePicker) — A SwiftUI view that displays other devices on the network, and creates an encrypted connection to a copy of your app running on that device.
- [devicePickerSupports](https://developer.apple.com/documentation/swiftui/environmentvalues/devicepickersupports) — Checks for support to present a DevicePicker.
### Configuring a Live Activity

- [activitySystemActionForegroundColor(_:)](https://developer.apple.com/documentation/swiftui/view/activitysystemactionforegroundcolor(_:)) — The text color for the auxiliary action button that the system shows next to a Live Activity on the Lock Screen.
- [activityBackgroundTint(_:)](https://developer.apple.com/documentation/swiftui/view/activitybackgroundtint(_:)) — Sets the tint color for the background of a Live Activity that appears on the Lock Screen.
- [isActivityFullscreen](https://developer.apple.com/documentation/swiftui/environmentvalues/isactivityfullscreen) — A Boolean value that indicates whether the Live Activity appears in a full-screen presentation.
- [activityFamily](https://developer.apple.com/documentation/swiftui/environmentvalues/activityfamily) — The size family of the current Live Activity.
### Interacting with the App Store and Apple Music

- [appStoreOverlay(isPresented:configuration:)](https://developer.apple.com/documentation/swiftui/view/appstoreoverlay(ispresented:configuration:)) — Presents a StoreKit overlay when a given condition is true.
- [manageSubscriptionsSheet(isPresented:)](https://developer.apple.com/documentation/swiftui/view/managesubscriptionssheet(ispresented:))
- [refundRequestSheet(for:isPresented:onDismiss:)](https://developer.apple.com/documentation/swiftui/view/refundrequestsheet(for:ispresented:ondismiss:)) — Display the refund request sheet for the given transaction.
- [offerCodeRedemption(isPresented:onCompletion:)](https://developer.apple.com/documentation/swiftui/view/offercoderedemption(ispresented:oncompletion:)) — Presents a sheet that enables users to redeem subscription offer codes that you configure in App Store Connect.
- [musicSubscriptionOffer(isPresented:options:onLoadCompletion:)](https://developer.apple.com/documentation/swiftui/view/musicsubscriptionoffer(ispresented:options:onloadcompletion:)) — Initiates the process of presenting a sheet with subscription offers for Apple Music when the `isPresented` binding is `true`.
- [currentEntitlementTask(for:priority:action:)](https://developer.apple.com/documentation/swiftui/view/currententitlementtask(for:priority:action:)) — Declares the view as dependent on the entitlement of an In-App Purchase product, and returns a modified view.
- [inAppPurchaseOptions(_:)](https://developer.apple.com/documentation/swiftui/view/inapppurchaseoptions(_:)) — Add a function to call before initiating a purchase from StoreKit view within this view, providing a set of options for the purchase.
- [manageSubscriptionsSheet(isPresented:subscriptionGroupID:)](https://developer.apple.com/documentation/swiftui/view/managesubscriptionssheet(ispresented:subscriptiongroupid:))
- [onInAppPurchaseCompletion(perform:)](https://developer.apple.com/documentation/swiftui/view/oninapppurchasecompletion(perform:)) — Add an action to perform when a purchase initiated from a StoreKit view within this view completes.
- [onInAppPurchaseStart(perform:)](https://developer.apple.com/documentation/swiftui/view/oninapppurchasestart(perform:)) — Add an action to perform when a user triggers the purchase button on a StoreKit view within this view.
- [productIconBorder()](https://developer.apple.com/documentation/swiftui/view/producticonborder()) — Adds a standard border to an in-app purchase product’s icon .
- [productViewStyle(_:)](https://developer.apple.com/documentation/swiftui/view/productviewstyle(_:)) — Sets the style for In-App Purchase product views within a view.
- [productDescription(_:)](https://developer.apple.com/documentation/swiftui/view/productdescription(_:)) — Configure the visibility of labels displaying an in-app purchase product description within the view.
- [storeButton(_:for:)](https://developer.apple.com/documentation/swiftui/view/storebutton(_:for:)) — Specifies the visibility of auxiliary buttons that store view and subscription store view instances may use.
- [storeProductTask(for:priority:action:)](https://developer.apple.com/documentation/swiftui/view/storeproducttask(for:priority:action:)) — Declares the view as dependent on an In-App Purchase product and returns a modified view.
- [storeProductsTask(for:priority:action:)](https://developer.apple.com/documentation/swiftui/view/storeproductstask(for:priority:action:)) — Declares the view as dependent on a collection of In-App Purchase products and returns a modified view.
- [subscriptionStatusTask(for:priority:action:)](https://developer.apple.com/documentation/swiftui/view/subscriptionstatustask(for:priority:action:)) — Declares the view as dependent on the status of an auto-renewable subscription group, and returns a modified view.
- [subscriptionStoreButtonLabel(_:)](https://developer.apple.com/documentation/swiftui/view/subscriptionstorebuttonlabel(_:)) — Configures subscription store view instances within a view to use the provided button label.
- [subscriptionStoreControlIcon(icon:)](https://developer.apple.com/documentation/swiftui/view/subscriptionstorecontrolicon(icon:)) — Sets a view to use to decorate individual subscription options within a subscription store view.
- [subscriptionStoreControlStyle(_:)](https://developer.apple.com/documentation/swiftui/view/subscriptionstorecontrolstyle(_:)) — Sets the control style for subscription store views within a view.
- [subscriptionStoreControlStyle(_:placement:)](https://developer.apple.com/documentation/swiftui/view/subscriptionstorecontrolstyle(_:placement:)) — Sets the control style and control placement for subscription store views within a view.
- [subscriptionStoreOptionGroupStyle(_:)](https://developer.apple.com/documentation/swiftui/view/subscriptionstoreoptiongroupstyle(_:)) — Sets the style subscription store views within this view use to display groups of subscription options.
- [subscriptionStorePickerItemBackground(_:)](https://developer.apple.com/documentation/swiftui/view/subscriptionstorepickeritembackground(_:)) — Sets the background style for picker items of the subscription store view instances within a view.
- [subscriptionStorePickerItemBackground(_:in:)](https://developer.apple.com/documentation/swiftui/view/subscriptionstorepickeritembackground(_:in:)) — Sets the background shape and style for subscription store view picker items within a view.
- [subscriptionStorePolicyDestination(for:destination:)](https://developer.apple.com/documentation/swiftui/view/subscriptionstorepolicydestination(for:destination:)) — Configures a view as the destination for a policy button action in subscription store views.
- [subscriptionStorePolicyDestination(url:for:)](https://developer.apple.com/documentation/swiftui/view/subscriptionstorepolicydestination(url:for:)) — Configures a URL as the destination for a policy button action in subscription store views.
- [subscriptionStorePolicyForegroundStyle(_:)](https://developer.apple.com/documentation/swiftui/view/subscriptionstorepolicyforegroundstyle(_:)) — Sets the style for the terms of service and privacy policy buttons within a subscription store view.
- [subscriptionStorePolicyForegroundStyle(_:_:)](https://developer.apple.com/documentation/swiftui/view/subscriptionstorepolicyforegroundstyle(_:_:)) — Sets the primary and secondary style for the terms of service and privacy policy buttons within a subscription store view.
- [subscriptionStoreSignInAction(_:)](https://developer.apple.com/documentation/swiftui/view/subscriptionstoresigninaction(_:)) — Adds an action to perform when a person uses the sign-in button on a subscription store view within a view.
- [subscriptionStoreControlBackground(_:)](https://developer.apple.com/documentation/swiftui/view/subscriptionstorecontrolbackground(_:)) — Set a standard effect to use for the background of subscription store view controls within the view.
- [subscriptionPromotionalOffer(offer:signature:)](https://developer.apple.com/documentation/swiftui/view/subscriptionpromotionaloffer(offer:signature:)) — Selects a promotional offer to apply to a purchase a customer makes from a subscription store view.
- [preferredSubscriptionOffer(_:)](https://developer.apple.com/documentation/swiftui/view/preferredsubscriptionoffer(_:)) — Selects a subscription offer to apply to a purchase that a customer makes from a subscription store view, a store view, or a product view.
### Accessing health data

- [healthDataAccessRequest(store:objectType:predicate:trigger:completion:)](https://developer.apple.com/documentation/swiftui/view/healthdataaccessrequest(store:objecttype:predicate:trigger:completion:)) — Asynchronously requests permission to read a data type that requires per-object authorization (such as vision prescriptions).
- [healthDataAccessRequest(store:readTypes:trigger:completion:)](https://developer.apple.com/documentation/swiftui/view/healthdataaccessrequest(store:readtypes:trigger:completion:)) — Requests permission to read the specified HealthKit data types.
- [healthDataAccessRequest(store:shareTypes:readTypes:trigger:completion:)](https://developer.apple.com/documentation/swiftui/view/healthdataaccessrequest(store:sharetypes:readtypes:trigger:completion:)) — Requests permission to save and read the specified HealthKit data types.
- [workoutPreview(_:isPresented:)](https://developer.apple.com/documentation/swiftui/view/workoutpreview(_:ispresented:)) — Presents a preview of the workout contents as a modal sheet
### Providing tips

- [popoverTip(_:arrowEdge:action:)](https://developer.apple.com/documentation/swiftui/view/popovertip(_:arrowedge:action:)) — Presents a popover tip on the modified view.
- [tipBackground(_:)](https://developer.apple.com/documentation/swiftui/view/tipbackground(_:)) — Sets the tip’s view background to a style. Currently this only applies to inline tips, not popover tips.
- [tipCornerRadius(_:antialiased:)](https://developer.apple.com/documentation/swiftui/view/tipcornerradius(_:antialiased:)) — Sets the corner radius for an inline tip view.
- [tipImageSize(_:)](https://developer.apple.com/documentation/swiftui/view/tipimagesize(_:)) — Sets the size for a tip’s image.
- [tipViewStyle(_:)](https://developer.apple.com/documentation/swiftui/view/tipviewstyle(_:)) — Sets the given style for TipView within the view hierarchy.
- [tipImageStyle(_:)](https://developer.apple.com/documentation/swiftui/view/tipimagestyle(_:)) — Sets the style for a tip’s image.
- [tipImageStyle(_:_:)](https://developer.apple.com/documentation/swiftui/view/tipimagestyle(_:_:)) — Sets the style for a tip’s image.
- [tipImageStyle(_:_:_:)](https://developer.apple.com/documentation/swiftui/view/tipimagestyle(_:_:_:)) — Sets the style for a tip’s image.
### Showing a translation

- [translationPresentation(isPresented:text:attachmentAnchor:arrowEdge:replacementAction:)](https://developer.apple.com/documentation/swiftui/view/translationpresentation(ispresented:text:attachmentanchor:arrowedge:replacementaction:)) — Presents a translation popover when a given condition is true.
- [translationTask(_:action:)](https://developer.apple.com/documentation/swiftui/view/translationtask(_:action:)) — Adds a task to perform before this view appears or when the translation configuration changes.
- [translationTask(source:target:action:)](https://developer.apple.com/documentation/swiftui/view/translationtask(source:target:action:)) — Adds a task to perform before this view appears or when the specified source or target languages change.
### Presenting journaling suggestions

- [journalingSuggestionsPicker(isPresented:onCompletion:)](https://developer.apple.com/documentation/swiftui/view/journalingsuggestionspicker(ispresented:oncompletion:)) — Presents a visual picker interface that contains events and images that a person can select to retrieve more information.
### Managing contact access

- [contactAccessButtonCaption(_:)](https://developer.apple.com/documentation/swiftui/view/contactaccessbuttoncaption(_:))
- [contactAccessButtonStyle(_:)](https://developer.apple.com/documentation/swiftui/view/contactaccessbuttonstyle(_:))
- [contactAccessPicker(isPresented:completionHandler:)](https://developer.apple.com/documentation/swiftui/view/contactaccesspicker(ispresented:completionhandler:)) — Modally present UI which allows the user to select which contacts your app has access to.
### Handling game controller events

- [handlesGameControllerEvents(matching:)](https://developer.apple.com/documentation/swiftui/view/handlesgamecontrollerevents(matching:)) — Specifies the game controllers events which should be delivered through the GameController framework when the view, or one of its descendants has focus.
### Creating a tabletop game

- [tabletopGame(_:parent:automaticUpdate:)](https://developer.apple.com/documentation/swiftui/view/tabletopgame(_:parent:automaticupdate:)) — Adds a tabletop game to a view.
- [tabletopGame(_:parent:automaticUpdate:interaction:)](https://developer.apple.com/documentation/swiftui/view/tabletopgame(_:parent:automaticupdate:interaction:)) — Supplies a closure which returns a new interaction whenever needed.
### Configuring camera controls

- [realityViewCameraControls](https://developer.apple.com/documentation/swiftui/environmentvalues/realityviewcameracontrols) — The camera controls for the reality view.
- [realityViewCameraControls(_:)](https://developer.apple.com/documentation/swiftui/view/realityviewcameracontrols(_:)) — Adds gestures that control the position and direction of a virtual camera.
### Interacting with transactions

- [transactionPicker(isPresented:selection:)](https://developer.apple.com/documentation/swiftui/view/transactionpicker(ispresented:selection:)) — Presents a picker that selects a collection of transactions.

---

*Source: [https://developer.apple.com/documentation/com.apple.SwiftUI/documentation/SwiftUI/Technology-specific-views](https://developer.apple.com/documentation/com.apple.SwiftUI/documentation/SwiftUI/Technology-specific-views)*
--- END FILE ---

--- FILE: Core-Data.md ---
# Core Data

**Persist or cache data on a single device, or sync data to multiple devices with CloudKit.**

## Availability

- **iOS** 3.0+
- **iPadOS** 3.0+
- **Mac Catalyst** 13.0+
- **macOS** 10.4+
- **tvOS** 9.0+
- **visionOS** 1.0+
- **watchOS** 2.0+


## Overview

Use Core Data to save your application’s permanent data for offline use, to cache temporary data, and to add undo functionality to your app on a single device. To sync data across multiple devices in a single iCloud account, Core Data automatically mirrors your schema to a CloudKit container.

Through Core Data’s Data Model editor, you define your data’s types and relationships, and generate respective class definitions. Core Data can then manage object instances at runtime to provide the following features.


### Persistence

Core Data abstracts the details of mapping your objects to a store, making it easy to save data from Swift and Objective-C without administering a database directly.

![Image](media-3119932)


### Undo and redo of individual and batched changes

Core Data’s undo manager tracks changes and can roll them back individually, in groups, or all at once, making it easy to add undo and redo support to your app.

![Image](media-3118362)


### Background data tasks

Perform potentially UI-blocking data tasks, like parsing JSON into objects, in the background. You can then cache or store the results to reduce server roundtrips.

![Image](media-3118359)


### View synchronization

Core Data also helps keep your views and data synchronized by providing data sources for table and collection views.


### Versioning and migration

Core Data includes mechanisms for versioning your data model and migrating user data as your app evolves.

## Topics

### Essentials

- [Creating a Core Data model](https://developer.apple.com/documentation/coredata/creating-a-core-data-model) — Define your app’s object structure with a data model file.
- [Setting up a Core Data stack](https://developer.apple.com/documentation/coredata/setting-up-a-core-data-stack) — Set up the classes that manage and persist your app’s objects.
- [Core Data stack](https://developer.apple.com/documentation/coredata/core-data-stack) — Manage and persist your app’s model layer.
- [Handling Different Data Types in Core Data](https://developer.apple.com/documentation/coredata/handling-different-data-types-in-core-data) — Create, store, and present records for a variety of data types.
- [Linking Data Between Two Core Data Stores](https://developer.apple.com/documentation/coredata/linking-data-between-two-core-data-stores) — Organize data in two different stores and implement a link between them.
### Data modeling

- [Modeling data](https://developer.apple.com/documentation/coredata/modeling-data) — Configure the data model file to contain your app’s object graph.
- [Core Data model](https://developer.apple.com/documentation/coredata/core-data-model) — Describe your app’s object structure.
### Fetch requests

- [NSFetchRequest](https://developer.apple.com/documentation/coredata/nsfetchrequest) — A description of search criteria used to retrieve data from a persistent store.
- [NSAsynchronousFetchRequest](https://developer.apple.com/documentation/coredata/nsasynchronousfetchrequest) — A fetch request that retrieves results asynchronously and supports progress notification.
- [NSAsynchronousFetchResult](https://developer.apple.com/documentation/coredata/nsasynchronousfetchresult) — A fetch result object that encompasses the response from an executed asynchronous fetch request.
- [NSFetchedResultsController](https://developer.apple.com/documentation/coredata/nsfetchedresultscontroller) — A controller that you use to manage the results of a Core Data fetch request and to display data to the user.
### SwiftData migration and coexistence

- [Adopting SwiftData for a Core Data app](https://developer.apple.com/documentation/coredata/adopting-swiftdata-for-a-core-data-app) — Persist data in your app intuitively with the Swift native persistence framework.
### CloudKit mirroring

- [Mirroring a Core Data store with CloudKit](https://developer.apple.com/documentation/coredata/mirroring-a-core-data-store-with-cloudkit) — Back user interfaces with a local replica of a CloudKit private database.
- [Synchronizing a local store to the cloud](https://developer.apple.com/documentation/coredata/synchronizing-a-local-store-to-the-cloud) — Share data between a user’s devices and other iCloud users.
- [NSPersistentCloudKitContainer](https://developer.apple.com/documentation/coredata/nspersistentcloudkitcontainer) — A container that encapsulates the Core Data stack in your app, and mirrors select persistent stores to a CloudKit private database.
- [NSPersistentCloudKitContainerOptions](https://developer.apple.com/documentation/coredata/nspersistentcloudkitcontaineroptions) — An object that customizes how a store description aligns with a CloudKit database.
- [Sharing Core Data objects between iCloud users](https://developer.apple.com/documentation/coredata/sharing-core-data-objects-between-icloud-users) — Use Core Data and CloudKit to synchronize data between devices of an iCloud user and share data between different iCloud users.
### Change processing

- [Accessing data when the store changes](https://developer.apple.com/documentation/coredata/accessing-data-when-the-store-changes) — Guarantee that a context won’t see store changes until you tell it to look.
- [Consuming relevant store changes](https://developer.apple.com/documentation/coredata/consuming-relevant-store-changes) — Filter store transactions for changes relevant to the current view.
- [Persistent history](https://developer.apple.com/documentation/coredata/persistent-history) — Use persistent history tracking to determine what changes have occurred in the store since the enabling of persistent history tracking.
### Background tasks

- [Using Core Data in the background](https://developer.apple.com/documentation/coredata/using-core-data-in-the-background) — Use Core Data in both a single-threaded and multithreaded app.
- [Loading and Displaying a Large Data Feed](https://developer.apple.com/documentation/swiftui/loading_and_displaying_a_large_data_feed) — Consume data in the background, and lower memory use by batching imports and preventing duplicate records.
- [Conflict resolution](https://developer.apple.com/documentation/coredata/conflict-resolution) — Detect and resolve conflicts that occur when data is changed on multiple threads.
- [Batch processing](https://developer.apple.com/documentation/coredata/batch-processing) — Use batch processes to manage large data changes.
### Data model migration

- [Migrating your data model automatically](https://developer.apple.com/documentation/coredata/migrating-your-data-model-automatically) — Enable lightweight migrations to keep your data model and the underlying data in a consistent state.
- [Staged migrations](https://developer.apple.com/documentation/coredata/staged-migrations) — Migrate complex data models containing changes that are incompatible with lightweight migrations.
- [Manual migrations](https://developer.apple.com/documentation/coredata/manual-migrations) — Migrate elaborate data models with changes that go beyond the capabilities of both lightweight and staged migrations.
### Related types

- [Core Data Constants](https://developer.apple.com/documentation/coredata/core-data-constants) — Keys to use with persistent stores and notifications from Core Data.

---

*Source: [https://developer.apple.com/documentation/com.apple.coredata/documentation/CoreData](https://developer.apple.com/documentation/com.apple.coredata/documentation/CoreData)*
--- END FILE ---

--- FILE: accessibility.md ---
---
title: Accessibility | Apple Developer Documentation
source_url: https://developer.apple.com/design/human-interface-guidelines/accessibility
scraped_date: '2025-10-25T18:04:03.284807Z'
extraction_method: Chrome DevTools MCP Server
content_length: 19147
filename: accessibility.md
---

# Accessibility | Apple Developer Documentation

Accessibility
Accessible user interfaces empower everyone to have a great experience with your app or game.

When you design for accessibility, you reach a larger audience and create a more inclusive experience. An accessible interface allows people to experience your app or game regardless of their capabilities or how they use their devices. Accessibility makes information and interactions available to everyone. An accessible interface is:

Intuitive. Your interface uses familiar and consistent interactions that make tasks straightforward to perform.

Perceivable. Your interface doesn't rely on any single method to convey information. People can access and interact with your content, whether they use sight, hearing, speech, or touch.

Adaptable. Your interface adapts to how people want to use their device, whether by supporting system accessibility features or letting people personalize settings.

As you design your app, audit the accessibility of your interface. Use Accessibility Inspector to highlight accessibility issues with your interface and to understand how your app represents itself to people using system accessibility features. You can also communicate how accessible your app is on the App Store using Accessibility Nutrition Labels. To learn more about how to evaluate and indicate accessibility feature support, see Accessibility Nutrition Labels in App Store Connect help.

Vision

The people who use your interface may be blind, color blind, or have low vision or light sensitivity. They may also be in situations where lighting conditions and screen brightness affect their ability to interact with your interface.

Support larger text sizes. Make sure people can adjust the size of your text or icons to make them more legible, visible, and comfortable to read. Ideally, give people the option to enlarge text by at least 200 percent (or 140 percent in watchOS apps). Your interface can support font size enlargement either through custom UI, or by adopting Dynamic Type. Dynamic Type is a systemwide setting that lets people adjust the size of text for comfort and legibility. For more guidance, see Supporting Dynamic Type.

Use recommended defaults for custom type sizes. Each platform has different default and minimum sizes for system-defined type styles to promote readability. If you're using custom type styles, follow the recommended defaults.

Platform

	

Default size

	

Minimum size




iOS, iPadOS

	

17 pt

	

11 pt




macOS

	

13 pt

	

10 pt




tvOS

	

29 pt

	

23 pt




visionOS

	

17 pt

	

12 pt




watchOS

	

16 pt

	

12 pt

Bear in mind that font weight can also impact how easy text is to read. If you're using a custom font with a thin weight, aim for larger than the recommended sizes to increase legibility. For more guidance, see Typography.

Thicker weights are easier to read for smaller font sizes.

Consider increasing the font size when using a thin weight.

Strive to meet color contrast minimum standards. To ensure all information in your app is legible, it's important that there's enough contrast between foreground text and icons and background colors. Two popular standards of measure for color contrast are the Web Content Accessibility Guidelines (WCAG) and the Accessible Perceptual Contrast Algorithm (APCA). Use standard contrast calculators to ensure your UI meets acceptable levels. Accessibility Inspector uses the following values from WCAG Level AA as guidance in determining whether your app's colors have an acceptable contrast.

Text size

	

Text weight

	

Minimum contrast ratio




Up to 17 pts

	

All

	

4.5:1




18 pts

	

All

	

3:1




All

	

Bold

	

3:1

If your app doesn't provide this minimum contrast by default, ensure it at least provides a higher contrast color scheme when the system setting Increase Contrast is turned on. If your app supports Dark Mode, make sure to check the minimum contrast in both light and dark appearances.

A button with insufficient color contrast

A button with sufficient color contrast

Prefer system-defined colors. These colors have their own accessible variants that automatically adapt when people adjust their color preferences, such as enabling Increase Contrast or toggling between the light and dark appearances. For guidance, see Color.

The systemRed default color in iOS

The systemRed accessible color in iOS

Convey information with more than color alone. Some people have trouble differentiating between certain colors and shades. For example, people who are color blind may have particular difficulty with pairings such as red-green and blue-orange. Offer visual indicators, like distinct shapes or icons, in addition to color to help people perceive differences in function and changes in state. Consider allowing people to customize color schemes such as chart colors or game characters so they can personalize your interface in a way that's comfortable for them.

For someone with red-green color blindness, these indicators might appear the same.

Both visual indicators and color help differentiate between indicators.

Describe your app's interface and content for VoiceOver. VoiceOver is a screen reader that lets people experience your app's interface without needing to see the screen. For more guidance, see VoiceOver.

Hearing

The people who use your interface may be deaf or hard of hearing. They may also be in noisy or public environments.

Support text-based ways to enjoy audio and video. It's important that dialogue and crucial information about your app or game isn't communicated through audio alone. Depending on the context, give people different text-based ways to experience their media, and allow people to customize the visual presentation of that text:

Captions give people the textual equivalent of audible information in video or audio-only content. Captions are great for scenarios like game cutscenes and video clips where text synchronizes live with the media.

Subtitles allow people to read live onscreen dialogue in their preferred language. Subtitles are great for TV shows and movies.

Audio descriptions are interspersed between natural pauses in the main audio of a video and supply spoken narration of important information that's presented only visually.

Transcripts provide a complete textual description of a video, covering both audible and visual information. Transcripts are great for longer-form media like podcasts and audiobooks where people may want to review content as a whole or highlight the transcript as media is playing.

For developer guidance, see Selecting Subtitles and Alternative Audio Tracks.

Use haptics in addition to audio cues. If your interface conveys information through audio cues — such as a success chime, error sound, or game feedback — consider pairing that sound with matching haptics for people who can't perceive the audio or have their audio turned off. In iOS and iPadOS, you can also use Music Haptics and Audio graphs to let people experience music and infographics through vibration and texture. For guidance, see Playing haptics.

Augment audio cues with visual cues. This is especially important for games and spatial apps where important content might be taking place off screen. When using audio to guide people towards a specific action, also add in visual indicators that point to where you want people to interact.

Mobility

Ensure your interface offers a comfortable experience for people with limited dexterity or mobility.

Offer sufficiently sized controls. Controls that are too small are hard for many people to interact with and select. Strive to meet the recommended minimum control size for each platform to ensure controls and menus are comfortable for all when tapping and clicking.

Platform

	

Default control size

	

Minimum control size




iOS, iPadOS

	

44x44 pt

	

28x28 pt




macOS

	

28x28 pt

	

20x20 pt




tvOS

	

66x66 pt

	

56x56 pt




visionOS

	

60x60 pt

	

28x28 pt




watchOS

	

44x44 pt

	

28x28 pt

Consider spacing between controls as important as size. Include enough padding between elements to reduce the chance that someone taps the wrong control. In general, it works well to add about 12 points of padding around elements that include a bezel. For elements without a bezel, about 24 points of padding works well around the element's visible edges.

Elements with insufficient padding

Elements with sufficient padding

Support simple gestures for common interactions. For many people, with or without disabilities, complex gestures can be challenging. For interactions people do frequently in your app or game, use the simplest gesture possible — avoid custom multifinger and multihand gestures — so repetitive actions are both comfortable and easy to remember.

Offer alternatives to gestures. Make sure your UI's core functionality is accessible through more than one type of physical interaction. Gestures can be less comfortable for people who have limited dexterity, so offer onscreen ways to achieve the same outcome. For example, if you use a swipe gesture to dismiss a view, also make a button available so people can tap or use an assistive device.

Edit and tap to delete

Swipe to delete

Let people use Voice Control to give guidance and enter information verbally. With Voice Control, people can interact with their devices entirely by speaking commands. They can perform gestures, interact with screen elements, dictate and edit text, and more. To ensure a smooth experience, label interface elements appropriately. For developer guidance, see Voice Control.

Integrate with Siri and Shortcuts to let people perform tasks using voice alone. When your app supports Siri and Shortcuts, people can automate the important and repetitive tasks they perform regularly. They can initiate these tasks from Siri, the Action button on their iPhone or Apple Watch, and shortcuts on their Home Screen or in Control Center. For guidance, see Siri.

Support mobility-related assistive technologies. Features like VoiceOver, AssistiveTouch, Full Keyboard Access, Pointer Control, and Switch Control offer alternative ways for people with low mobility to interact with their devices. Conduct testing and verify that your app or game supports these technologies, and that your interface elements are appropriately labeled to ensure a great experience. For more information, see Performing accessibility testing for your app.

Speech

Apple's accessibility features help people with speech disabilities and people who prefer text-based interactions to communicate effectively using their devices.

Let people use the keyboard alone to navigate and interact with your app. People can turn on Full Keyboard Access to navigate apps using their physical keyboard. The system also defines accessibility keyboard shortcuts and a wide range of other keyboard shortcuts that many people use all the time. Avoid overriding system-defined keyboard shortcuts and evaluate your app to ensure it works well with Full Keyboard Access. For additional guidance, see Keyboards. For developer guidance, see Support Full Keyboard Access in your iOS app.

Support Switch Control. Switch Control is an assistive technology that lets people control their devices through separate hardware, game controllers, or sounds such as a click or a pop. People can perform actions like selecting, tapping, typing, and drawing when your app or game supports the ability to navigate using Switch Control. For developer guidance, see Switch Control.

Cognitive

When you minimize complexity in your app or game, all people benefit.

Keep actions simple and intuitive. Ensure that people can navigate your interface using easy-to-remember and consistent interactions. Prefer system gestures and behaviors people are already familiar with over creating custom gestures people must learn and retain.

Minimize use of time-boxed interface elements. Views and controls that auto-dismiss on a timer can be problematic for people who need longer to process information, and for people who use assistive technologies that require more time to traverse the interface. Prefer dismissing views with an explicit action.

Consider offering difficulty accommodations in games. Everyone has their own way of playing and enjoying games. To support a variety of cognitive abilities, consider adding the ability to customize the difficulty level of your game, such as offering options for people to reduce the criteria for successfully completing a level, adjust reaction time, or enable control assistance.

Let people control audio and video playback. Avoid autoplaying audio and video content without also providing controls to start and stop it. Make sure these controls are discoverable and easy to act upon, and consider global settings that let people opt out of auto-playing all audio and video. For developer guidance, see Animated images and isVideoAutoplayEnabled.

Allow people to opt out of flashing lights in video playback. People might want to avoid bright, frequent flashes of light in the media they consume. A Dim Flashing Lights setting allows the system to calculate, mitigate, and inform people about flashing lights in a piece of media. If your app supports video playback, ensure that it responds appropriately to the Dim Flashing Lights setting. For developer guidance, see Flashing lights.

Be cautious with fast-moving and blinking animations. When you use these effects in excess, it can be distracting, cause dizziness, and in some cases even result in epileptic episodes. People who are prone to these effects can turn on the Reduce Motion accessibility setting. When this setting is active, ensure your app or game responds by reducing automatic and repetitive animations, including zooming, scaling, and peripheral motion. Other best practices for reducing motion include:

Tightening animation springs to reduce bounce effects

Tracking animations directly with people's gestures

Avoiding animating depth changes in z-axis layers

Replacing transitions in x-, y-, and z-axes with fades to avoid motion

Avoiding animating into and out of blurs

Optimize your app's UI for Assistive Access. Assistive Access is an accessibility feature in iOS and iPadOS that allows people with cognitive disabilities to use a streamlined version of your app. Assistive Access sets a default layout and control presentation for apps that reduces cognitive load, such as the following layout of the Camera app.

To optimize your app for this mode, use the following guidelines when Assistive Access is turned on:

Identify the core functionality of your app and consider removing noncritical workflows and UI elements.

Break up multistep workflows so people can focus on a single interaction per screen.

Always ask for confirmation twice whenever people perform an action that's difficult to recover from, such a deleting a file.

For developer guidance, see Assistive Access.

Platform considerations

No additional considerations for iOS, iPadOS, macOS, tvOS, or watchOS.

visionOS

visionOS offers a variety of accessibility features people can use to interact with their surroundings in ways that are comfortable and work best for them, including head and hand Pointer Control, and a Zoom feature.

Pointer Control (hand)

Pointer Control (head)

Zoom

Prioritize comfort. The immersive nature of visionOS means that interfaces, animations, and interactions have a greater chance of causing motion sickness, and visual and ergonomic discomfort for people. To ensure the most comfortable experience, consider these tips:

Keep interface elements within a person's field of view. Prefer horizontal layouts to vertical ones that might cause neck strain, and avoid demanding the viewer's attention in different locations in quick succession.

Reduce the speed and intensity of animated objects, particularly in someone's peripheral vision.

Be gentle with camera and video motion, and avoid situations where someone may feel like the world around them is moving without their control.

Avoid anchoring content to the wearer's head, which may make them feel stuck and confined, and also prevent them from using assistive technologies like Pointer Control.

Minimize the need for large and repetitive gestures, as these can become tiresome and may be difficult depending on a person's surroundings.

For additional guidance, see Create accessible spatial experiences and Design considerations for vision and motion.

Resources

Related

Inclusion

Typography

VoiceOver

Developer documentation

Building accessible apps

Accessibility framework

Overview of Accessibility Nutrition Labels

Videos

Principles of inclusive app design

Evaluate your app for Accessibility Nutrition Labels

Catch up on accessibility in SwiftUI

Change log

Date

	

Changes




June 9, 2025

	

Added guidance and links for Assistive Access, Switch Control, and Accessibility Nutrition Labels.




March 7, 2025

	

Expanded and refined all guidance. Moved Dynamic Type guidance to the Typography page, and moved VoiceOver guidance to a new VoiceOver page.




June 10, 2024

	

Added a link to Apple's Unity plug-ins for supporting Dynamic Type.




December 5, 2023

	

Updated visionOS Zoom lens artwork.




June 21, 2023

	

Updated to include guidance for visionOS.

Current page is Accessibility

## Detailed Sections

### Quick Links

DownloadsDocumentationSample CodeVideosForums
5 Quick Links


## Vision

The people who use your interface may be blind, color blind, or have low vision or light sensitivity. They may also be in situations where lighting conditions and screen brightness affect their ability to interact with your interface.
Support larger text sizes. Make sure people can adjust the size of your text or icons to make them more legible, visible, and comfortable to read. Ideally, give people the option to enlarge text by at least 200 percent (or 140 percent in watchOS apps). Your interface can support font size enlargement either through custom UI, or by adopting Dynamic Type. Dynamic Type is a systemwide setting that lets people adjust the size of text for comfort and legibility. For more guidance, see Supporting Dynamic Type.
Use recommended defaults for custom type sizes. Each platform has different default and minimum sizes for system-defined type styles to promote readability. If you're using custom type styles, follow the recommended defaults.
PlatformDefault sizeMinimum sizeiOS, iPadOS17 pt11 ptmacOS13 pt10 pttvOS29 pt23 ptvisionOS17 pt12 ptwatchOS16 pt12 pt
Bear in mind that font weight can also impact how easy text is to read. If you're using a custom font with a thin weight, aim for larger than the recommended sizes to increase legibility. For more guidance, see Typography.
Thicker weights are easier to read for smaller font sizes.Consider increasing the font size when using a thin weight.
Strive to meet color contrast minimum standards. To ensure all information in your app is legible, it's important that there's enough contrast between foreground text and icons and background colors. Two popular standards of measure for color contrast are the Web Content Accessibility Guidelines (WCAG) and the Accessible Perceptual Contrast Algorithm (APCA). Use standard contrast calculators to ensure your UI meets acceptable levels. Accessibility Inspector uses the following values from WCAG Level AA as guidance in determining whether your app's colors have an acceptable contrast.
Text sizeText weightMinimum contrast ratioUp to 17 ptsAll4.5:118 ptsAll3:1AllBold3:1
If your app doesn't provide this minimum contrast by default, ensure it at least provides a higher contrast color scheme when the system setting Increase Contrast is turned on. If your app supports Dark Mode, make sure to check the minimum contrast in both light and dark appearances.
A button with insufficient color contrastA button with sufficient color contrast
Prefer system-defined colors. These colors have their own accessible variants that automatically adapt when people adjust their color preferences, such as enabling Increase Contrast or toggling between the light and dark appearances. For guidance, see Color.
The systemRed default color in iOSThe systemRed accessible color in iOS
Convey information with more than color alone. Some people have trouble differentiating between certain colors and shades. For example, people who are color blind may have particular difficulty with pairings such as red-green and blue-orange. Offer visual indicators, like distinct shapes or icons, in addition to color to help people perceive differences in function and changes in state. Consider allowing people to customize color schemes such as chart colors or game characters so they can personalize your interface in a way that's comfortable for them.
For someone with red-green color blindness, these indicators might appear the same.Both visual indicators and color help differentiate between indicators.
Describe your app's interface and content for VoiceOver. VoiceOver is a screen reader that lets people experience your app's interface without needing to see the screen. For more guidance, see VoiceOver.


## Hearing

The people who use your interface may be deaf or hard of hearing. They may also be in noisy or public environments.
Support text-based ways to enjoy audio and video. It's important that dialogue and crucial information about your app or game isn't communicated through audio alone. Depending on the context, give people different text-based ways to experience their media, and allow people to customize the visual presentation of that text:
Captions give people the textual equivalent of audible information in video or audio-only content. Captions are great for scenarios like game cutscenes and video clips where text synchronizes live with the media.Subtitles allow people to read live onscreen dialogue in their preferred language. Subtitles are great for TV shows and movies.Audio descriptions are interspersed between natural pauses in the main audio of a video and supply spoken narration of important information that's presented only visually.Transcripts provide a complete textual description of a video, covering both audible and visual information. Transcripts are great for longer-form media like podcasts and audiobooks where people may want to review content as a whole or highlight the transcript as media is playing.
For developer guidance, see Selecting Subtitles and Alternative Audio Tracks.
Use haptics in addition to audio cues. If your interface conveys information through audio cues — such as a success chime, error sound, or game feedback — consider pairing that sound with matching haptics for people who can't perceive the audio or have their audio turned off. In iOS and iPadOS, you can also use Music Haptics and Audio graphs to let people experience music and infographics through vibration and texture. For guidance, see Playing haptics.
Augment audio cues with visual cues. This is especially important for games and spatial apps where important content might be taking place off screen. When using audio to guide people towards a specific action, also add in visual indicators that point to where you want people to interact.


## Mobility

Ensure your interface offers a comfortable experience for people with limited dexterity or mobility.
Offer sufficiently sized controls. Controls that are too small are hard for many people to interact with and select. Strive to meet the recommended minimum control size for each platform to ensure controls and menus are comfortable for all when tapping and clicking.
PlatformDefault control sizeMinimum control sizeiOS, iPadOS44x44 pt28x28 ptmacOS28x28 pt20x20 pttvOS66x66 pt56x56 ptvisionOS60x60 pt28x28 ptwatchOS44x44 pt28x28 pt
Consider spacing between controls as important as size. Include enough padding between elements to reduce the chance that someone taps the wrong control. In general, it works well to add about 12 points of padding around elements that include a bezel. For elements without a bezel, about 24 points of padding works well around the element's visible edges.
Elements with insufficient paddingElements with sufficient padding
Support simple gestures for common interactions. For many people, with or without disabilities, complex gestures can be challenging. For interactions people do frequently in your app or game, use the simplest gesture possible — avoid custom multifinger and multihand gestures — so repetitive actions are both comfortable and easy to remember.
Offer alternatives to gestures. Make sure your UI's core functionality is accessible through more than one type of physical interaction. Gestures can be less comfortable for people who have limited dexterity, so offer onscreen ways to achieve the same outcome. For example, if you use a swipe gesture to dismiss a view, also make a button available so people can tap or use an assistive device.
Edit and tap to deleteSwipe to delete
Let people use Voice Control to give guidance and enter information verbally. With Voice Control, people can interact with their devices entirely by speaking commands. They can perform gestures, interact with screen elements, dictate and edit text, and more. To ensure a smooth experience, label interface elements appropriately. For developer guidance, see Voice Control.
Integrate with Siri and Shortcuts to let people perform tasks using voice alone. When your app supports Siri and Shortcuts, people can automate the important and repetitive tasks they perform regularly. They can initiate these tasks from Siri, the Action button on their iPhone or Apple Watch, and shortcuts on their Home Screen or in Control Center. For guidance, see Siri.
Support mobility-related assistive technologies. Features like VoiceOver, AssistiveTouch, Full Keyboard Access, Pointer Control, and Switch Control offer alternative ways for people with low mobility to interact with their devices. Conduct testing and verify that your app or game supports these technologies, and that your interface elements are appropriately labeled to ensure a great experience. For more information, see Performing accessibility testing for your app.


## Speech

Apple's accessibility features help people with speech disabilities and people who prefer text-based interactions to communicate effectively using their devices.
Let people use the keyboard alone to navigate and interact with your app. People can turn on Full Keyboard Access to navigate apps using their physical keyboard. The system also defines accessibility keyboard shortcuts and a wide range of other keyboard shortcuts that many people use all the time. Avoid overriding system-defined keyboard shortcuts and evaluate your app to ensure it works well with Full Keyboard Access. For additional guidance, see Keyboards. For developer guidance, see Support Full Keyboard Access in your iOS app.
Support Switch Control. Switch Control is an assistive technology that lets people control their devices through separate hardware, game controllers, or sounds such as a click or a pop. People can perform actions like selecting, tapping, typing, and drawing when your app or game supports the ability to navigate using Switch Control. For developer guidance, see Switch Control.


## Cognitive

When you minimize complexity in your app or game, all people benefit.
Keep actions simple and intuitive. Ensure that people can navigate your interface using easy-to-remember and consistent interactions. Prefer system gestures and behaviors people are already familiar with over creating custom gestures people must learn and retain.
Minimize use of time-boxed interface elements. Views and controls that auto-dismiss on a timer can be problematic for people who need longer to process information, and for people who use assistive technologies that require more time to traverse the interface. Prefer dismissing views with an explicit action.
Consider offering difficulty accommodations in games. Everyone has their own way of playing and enjoying games. To support a variety of cognitive abilities, consider adding the ability to customize the difficulty level of your game, such as offering options for people to reduce the criteria for successfully completing a level, adjust reaction time, or enable control assistance.
Let people control audio and video playback. Avoid autoplaying audio and video content without also providing controls to start and stop it. Make sure these controls are discoverable and easy to act upon, and consider global settings that let people opt out of auto-playing all audio and video. For developer guidance, see Animated images and isVideoAutoplayEnabled.
Allow people to opt out of flashing lights in video playback. People might want to avoid bright, frequent flashes of light in the media they consume. A Dim Flashing Lights setting allows the system to calculate, mitigate, and inform people about flashing lights in a piece of media. If your app supports video playback, ensure that it responds appropriately to the Dim Flashing Lights setting. For developer guidance, see Flashing lights.
Be cautious with fast-moving and blinking animations. When you use these effects in excess, it can be distracting, cause dizziness, and in some cases even result in epileptic episodes. People who are prone to these effects can turn on the Reduce Motion accessibility setting. When this setting is active, ensure your app or game responds by reducing automatic and repetitive animations, including zooming, scaling, and peripheral motion. Other best practices for reducing motion include:
Tightening animation springs to reduce bounce effectsTracking animations directly with people's gesturesAvoiding animating depth changes in z-axis layersReplacing transitions in x-, y-, and z-axes with fades to avoid motionAvoiding animating into and out of blurs
Optimize your app's UI for Assistive Access. Assistive Access is an accessibility feature in iOS and iPadOS that allows people with cognitive disabilities to use a streamlined version of your app. Assistive Access sets a default layout and control presentation for apps that reduces cognitive load, such as the following layout of the Camera app.
To optimize your app for this mode, use the following guidelines when Assistive Access is turned on:
Identify the core functionality of your app and consider removing noncritical workflows and UI elements.Break up multistep workflows so people can focus on a single interaction per screen.Always ask for confirmation twice whenever people perform an action that's difficult to recover from, such a deleting a file.
For developer guidance, see Assistive Access.


## Platform considerations

No additional considerations for iOS, iPadOS, macOS, tvOS, or watchOS.


### visionOS

visionOS offers a variety of accessibility features people can use to interact with their surroundings in ways that are comfortable and work best for them, including head and hand Pointer Control, and a Zoom feature.
Pointer Control (hand)  Pointer Control (head)  Zoom  Video with custom controls.  Content description: A recording of a person's hand using Pointer Control to interact with content in an app's visionOS window. A line with a pointer at the end extends from the person's hand. It changes position within the field of view as the person moves their hand.  Play  Video with custom controls.  Content description: A recording of someone using Pointer Control to interact with content in an app's visionOS window. The person isn't visible in the recording. Only the pointer is visible. It's centered in the field of view, and the person uses their head movement to position content beneath the pointer.  Play
Prioritize comfort. The immersive nature of visionOS means that interfaces, animations, and interactions have a greater chance of causing motion sickness, and visual and ergonomic discomfort for people. To ensure the most comfortable experience, consider these tips:
Keep interface elements within a person's field of view. Prefer horizontal layouts to vertical ones that might cause neck strain, and avoid demanding the viewer's attention in different locations in quick succession.Reduce the speed and intensity of animated objects, particularly in someone's peripheral vision.Be gentle with camera and video motion, and avoid situations where someone may feel like the world around them is moving without their control.Avoid anchoring content to the wearer's head, which may make them feel stuck and confined, and also prevent them from using assistive technologies like Pointer Control.Minimize the need for large and repetitive gestures, as these can become tiresome and may be difficult depending on a person's surroundings.
For additional guidance, see Create accessible spatial experiences and Design considerations for vision and motion.


#### Related

Inclusion
Typography
VoiceOver


#### Developer documentation

Building accessible apps
Accessibility framework
Overview of Accessibility Nutrition Labels


#### Videos

Principles of inclusive app design  Evaluate your app for Accessibility Nutrition Labels  Catch up on accessibility in SwiftUI


## Change log

DateChangesJune 9, 2025Added guidance and links for Assistive Access, Switch Control, and Accessibility Nutrition Labels.March 7, 2025Expanded and refined all guidance. Moved Dynamic Type guidance to the Typography page, and moved VoiceOver guidance to a new VoiceOver page.June 10, 2024Added a link to Apple's Unity plug-ins for supporting Dynamic Type.December 5, 2023Updated visionOS Zoom lens artwork.June 21, 2023Updated to include guidance for visionOS.


### Platforms

Toggle Menu
iOSiPadOSmacOStvOSvisionOSwatchOS


### Tools

Toggle Menu
SwiftSwiftUISwift PlaygroundTestFlightXcodeXcode CloudSF Symbols


### Topics & Technologies

Toggle Menu
AccessibilityAccessoriesApp ExtensionApp StoreAudio & VideoAugmented RealityDesignDistributionEducationFontsGamesHealth & FitnessIn-App PurchaseLocalizationMaps & LocationMachine Learning & AIOpen SourceSecuritySafari & Web


### Resources

Toggle Menu
DocumentationTutorialsDownloadsForumsVideos


### Support

Toggle Menu
Support ArticlesContact UsBug ReportingSystem Status


### Account

Toggle Menu
Apple DeveloperApp Store ConnectCertificates, IDs, & ProfilesFeedback Assistant


### Programs

Toggle Menu
Apple Developer ProgramApple Developer Enterprise ProgramApp Store Small Business ProgramMFi ProgramNews Partner ProgramVideo Partner ProgramSecurity Bounty ProgramSecurity Research Device Program


### Events

Toggle Menu
Meet with AppleApple Developer CentersApp Store AwardsApple Design AwardsApple Developer AcademiesWWDC
--- END FILE ---

--- FILE: SwiftUI-Accessibility-beond-the-basics.md ---
Bass music playing ♪  ♪ Nathan Tannar: Hello, and welcome to WWDC! My name is Nathan, and I'm an engineer on the Accessibility team.

Today we'll be going beyond the basics to learn how to deliver exceptional and accessible SwiftUI apps.

This year marks a huge leap forward for accessibility in SwiftUI.

At Apple, accessibility is one of our core values.

Our assistive technologies across all our platforms make sure that anyone can use your app regardless of any physical, visual, audible, or motor impairment.

My team and I work to make sure most of your app is accessible by default, but there is always more you can do to enrich the experience.

Today I'll show you the new tools and APIs for SwiftUI that make enriching this experience easy.

Let's begin with the tooling improvements in Xcode.

SwiftUI Previews have changed how many of us develop apps.

It dramatically improves your ability to iterate upon your views across multiple environments, all without the need of running your app.

To make the most important accessibility modifiers just a click away, we've added a curated list of accessibility editors.

I hope this encourages everyone to always make their views accessible.

But there's more.

Since accessibility modifiers don't have visual changes in the previews, a new tool was developed that allows you to inspect the accessibility of your view without leaving Xcode.

Let's switch from the editor's panel to the new accessibility panel.

Shipping in Xcode 13, SwiftUI Previews will now also feature an Accessibility Preview.

With it, you can inspect the accessibility elements for a preview in real time.

And this is a game changer.

Accessibility Preview will help you make accessible apps even if you don't have a deep understanding of each assistive technology.

Let's take a closer look to see how changes are reflected in the Accessibility Preview.

This is a simplified version of the view we just saw.

After running the preview, I can select the VStack and the Accessibility Preview will update to display the elements in their sorted order.

Notice that each element will always display its basic properties -- such as a label and traits.

For example, the Text view will create an accessibility element with the string as its label.

It also gains the .isStaticText trait.

The preview will update for any accessibility changes we make, such as adding the .isHeader trait.

You will also be able to see some of the automatic accessibility that takes place behind the scenes, such as automatic SF Symbol labels.

For example, the checkmark.seal.fill symbol is labeled "Verified" by default.

If you're relying on a symbol's default label, it's important to check that it accurately describes your interface.

We'll continue to use the Accessibility Preview as we step through five importance areas that'll help you deliver an exceptional experience to all of your app's users.

We'll start by examining the best way to make custom controls accessible.

Next, we'll discuss how to make a view accessible with children.

I'll highlight how to audit your app for common navigation problems and how the Accessibility Preview can assist with this.

Then I'll show you how to supercharge your app's navigation with VoiceOver rotors.

And finally, we'll look at focus and how it relates to assistive technologies.

I've been working to prototype a new finance app I call Wallet Pal.

It's still in the early stages, but so far, I'm pretty happy with the initial design.

I was pleased to hear that early beta testers are also loving it.

Now that I've polished the UI, I should spend some time to polish the accessibility interface.

The accessibility interface compliments the visual experience to make sure that it’s usable by everyone.

I've asked some VoiceOver users to help test Wallet Pal and I've heard that the app is hard to navigate and not fully accessible.

If parts are not accessible to VoiceOver, then they are also not accessible to other assistive technologies.

It's important that anyone be able to use Wallet Pal, so let's investigate to see where we can improve the experience.

We'll begin with reports of users not being able to edit their budgets, a critical feature in Wallet Pal.

This is the Budget Planner view which allows users to edit their food, entertainment, and savings budgets.

To fit the design of Wallet Pal, I ended up needing to create custom sliders.

```swift
struct BudgetSlider: View {
    @Binding var value: Double
    var label: String

    var body: some View {
        VStack(alignment: .leading) {
            HStack {
                Text(label)
                Text(value.toDollars()).bold()
            }
            SliderShape(value: value)
                .gesture(DragGesture().onChanged(handle))
                .accessibilityRepresentation {
                    Slider(value: $value, in: 0...1) {
                        Text(label)
                    }
                    .accessibilityValue(value.toDollars())
                }
        }
    }
}

struct SliderShape: View {
    var value: Double

    private struct BackgroundTrack: View {
        var cornerRadius: CGFloat
        var body: some View {
            RoundedRectangle(
                cornerRadius: cornerRadius,
                style: .continuous
            )
            .foregroundColor(Color(white: 0.2))
        }
    }

    private struct OverlayTrack: View {
        var cornerRadius: CGFloat
        var body: some View {
            RoundedRectangle(
                cornerRadius: cornerRadius,
                style: .continuous
            )
            .foregroundColor(Color(white: 0.95))
        }
    }

    private struct Knob: View {
        var cornerRadius: CGFloat
        var body: some View {
            RoundedRectangle(
                cornerRadius: cornerRadius,
                style: .continuous
            )
            .strokeBorder(Color(white: 0.7), lineWidth: 1)
            .shadow(radius: 3)
        }
    }

    var body: some View {
        GeometryReader { geometry in
            ZStack(alignment: .leading) {
                BackgroundTrack(cornerRadius: geometry.size.height / 2)

                OverlayTrack(cornerRadius: geometry.size.height / 2)
                    .frame(
                        width: max(geometry.size.height, geometry.size.width * CGFloat(value) + geometry.size.height / 2),
                        height: geometry.size.height)

                Knob(cornerRadius: geometry.size.height / 2)
                    .frame(
                        width: geometry.size.height,
                        height: geometry.size.height)
                    .offset(x: max(0, geometry.size.width * CGFloat(value) - geometry.size.height / 2), y: 0)
            }
        }
    }
}

extension Double {
    func toDollars() -> String {
        return "$\(Int(self))"
    }
}
```

This must be why some users are not able to edit their budgets.

We can confirm it's not accessible by running a SwiftUI preview and selecting the SliderShape.

The Accessibility Preview shows that there are no elements, so this control is not accessible.

Ideally, we should have a single labeled accessibility element with a value that can be changed.

In contrast, standard controls are accessible by default, meaning little to no extra effort is required to provide a great experience.

SwiftUI uses the view type and its initialization parameters to automatically derive the accessibility element's label, value, traits, and actions.

So what's the best way to make our custom budget slider accessible? Since the standard slider is accessible by default, my team and I thought it would be great to have an API that allows the accessibility of one view to be represented by another.

This is what led us to us to create accessibilityRepresentation(representation:).

It's an API that allows the accessibility of one view to be defined by another.

Since I want this to be perceived by assistive technologies as a slider, that's what I'll use for the accessibility representation.

With accessibilityRepresentation(representation:), we're now well on the way to making this budget slider accessible.

The only change needed to improve the experience of the slider is to describe the value in dollars.

And great, just like that, now our budget slider is perfectly accessible.

On macOS, the type of control will also be spoken to VoiceOver users.

So by using the slider view in our budget slider's representation, it will be announced as a slider.

It's recommended to use accessibilityRepresentation(representation:) when possible, to make custom controls accessible.

This is just one way to use accessibilityRepresentation(representation:).

Its flexibility allows for many more creative uses.

Let's see if we can use it to fix other accessibility bugs in our app.

While we have now fixed the functional ability to edit budgets, some users reported that they couldn't discover how to navigate to the Budget Planner view.

When designing Wallet Pal, we decided to use SF Symbols for all of our buttons.

While SF Symbols may have great default accessibility labels, they may not always fit the intended use case.

Let's investigate if the problem is a poorly labeled button.

The NavigationBarView contains the Edit Budgets button.

Since we rely on SF Symbols for so many of our buttons, I created a custom buttonStyle called SymbolButtonStyle.

But it appears that despite initializing the button with the label "Edit Budgets", the label for the button is slider.vertical.3.

So the accessibility label is being derived from the SF Symbol.

Let's take a closer look at the SymbolButtonStyle.

The SymbolButtonStyle's makeBody(configuration:) method returns an Image view.

The Edit Budgets string we initialize the button with would create a Text view as the configuration's label.

But this style completely ignores the configuration's label.

This is why the button is not labeled "Edit Budgets".

While we want an SF Symbol to appear visually, we want the accessibility of the button to be represented by the configuration's label.

And so this seems like a great use case for accessibilityRepresentation(representation:).

Using accessibilityRepresentation(representation:), I can substitute the accessibility of the Image view with another view, in this case, the configuration's label.

This way, we can preserve the label we used to create the button.

accessibilityRepresentation(representation:) is not just the ideal and recommended way to make custom controls accessible, it also opens up new creative possibilities to make views accessible.

Next, let's discuss the relationship between children and accessibility containers.

As you may recall, accessibility elements can be wrapped together in a group as children of an accessibility container.

This is done with the accessibilityElement(children:) modifier and the contain child behavior.

In case you're unfamiliar, the contain child behavior can be used to create an accessibility container, which wraps existing accessibility elements as children.

But what if instead you have an accessibility element and you want to set its children? I'm running into this case when trying to make the Budget History graph accessible.

Users reported the graph is completely inaccessible.

And so this means when assistive technologies are focused on the Budget History header and try to navigate to the next element, they end up at the Alerts header.

VoiceOver users would not even know that this graph exists.

I built the graph using the new Canvas view.

Canvas makes it easier to draw a collection of shapes.

For more on Canvas, please check out Jacob's presentation on how it can be used to add rich graphics to your app.

Canvas draws a collection of shapes and just like we saw with BudgetSlider, shapes are not accessible by default.

All users need to be able to view their budget history, so let's make this accessible for everyone.

Starting with the basics, let's give our Canvas a label.

This will automatically create a new accessibility element for the Canvas and assign its label.

Now, I'd like each bar in the graph to be represented by their own accessibility element.

This is a use case where we have an accessibility element and want to provide its children.

To do this, I'll use the new accessibilityChildren(children:) modifier.

This will transform the accessibility element into an accessibility container, preserving other accessibility properties, such as the label.

The modifier takes a ViewBuilder, which allows us to set new views as children of the accessibility container.

Recall that our Budget History graph is drawing a horizontal bar graph, so we'll use an HStack and return a view for each budget.

I'll use a Rectangle for each accessibility element so that the frame will fill all available vertical space.

This will make each accessibility element's frame bigger than what's displayed visually, and that's OK.

Having a large but consistent frame will make it easier to navigate on iOS when VoiceOver users drag their finger across the screen to scan for accessibility elements.

If I select the HStack from within the accessibilityChildren(children:) modifier, the Accessibility Preview confirms that an element has been created for each bar in the graph.

These will all be accessible as children of the Canvas accessibility container.

With these changes, the Budget History graph is now completely accessible, and assistive technologies can navigate through each bar in the graph.

Notice that the frame for each element is the same, which is ideal.

For more complex charts, we have other ways of making them accessible.

For that, please check out Preston's presentation on bringing accessibility to charts.

But with accessibility children, the accessibility elements of a view can differ from what's presented visually, allowing you to tailor a great experience.

But accessibility children can also be used to compose the accessibility with the help of the combine behavior.

As a quick refresh, the combine child behavior will merge properties from multiple accessibility elements into a new or existing accessibility element.

But with the addition of the accessibility children API, it can now also be used to compose accessibility in a generic way.

With accessibility representation, the original accessibility is completely replaced.

This means no composition can take place; whereas accessibility children is additive.

This means you could later combine the children to merge their properties into the original element.

This is a more advanced use case of the accessibilityChildren(children:) modifier, but it's a functionality I wanted to highlight.

Examples are featured in this presentation's Accessibility Catalog Sample Project.

I hope to see many of you explore what's possible with this kind of composition.

accessibilityChildren(children:) gives you control over the children of a container.

And with that, complex graphs drawn with Canvas can be made accessible with modifiers and views you're already familiar with.

And with the combine child behavior, the accessibility of a single view can be composed of many.

Now that we've learned how to make individual components of our app accessible, we can start putting things together to refine the navigation experience.

I've heard that navigating Wallet Pal with VoiceOver is confusing and difficult.

So we have some more work to do if we want to deliver a great accessible app.

Let's take a closer look at the Friends carousel at the top.

While I don't have this feature built yet, I plan to add some kind of gamification to Wallet Pal.

So I've added a challenge button at the top left of each friend view.

We already fixed the SymbolButtonStyle, so the challenge button will be properly labeled now.

But since users are reporting that navigation is confusing, are there other issues? To answer that, we must first understand how assistive technologies will navigate Wallet Pal.

By default, accessibility elements are sorted based off their geometric position in relation to other elements, from top left to bottom right.

This means that without accessibility containers to differentiate the content, VoiceOver would navigate through each of the challenge buttons, then the Image and Add Friend button, and finally, the text with the user's name.

A great feature of the Accessibility Preview is that it shows accessibility elements in their sorted order.

This makes it easy to visualize how assistive technologies will navigate right from within Xcode.

As expected, the sorted order matches what we previously saw.

And this order would certainly be confusing to navigate.

Now there are multiple ways we could fix the sort order of the accessibility elements.

One thing we could do is to introduce accessibility containers.

I'll add the accessibilityElement(children:) modifier with the contain behavior.

This will wrap the accessibility elements of each FriendCellView in an accessibility container.

This fixes the navigation order, because children of an accessibility container are navigated before moving to the next accessibility element.

With this change, VoiceOver will navigate through the children of the accessibility container before moving to the next accessibility element.

And so we achieve a much more desirable navigation order.

But could we do better to improve this experience? One problem is that the challenge button is navigated to before knowing who the user is.

A VoiceOver user would want to know the name of the user before sending a challenge, so this button should really be sorted last.

We can use the accessibilitySortPriority(_:) modifier to fix this.

accessibilitySortPriority(_:) can be used to change the order of elements within an accessibility container.

An element with a higher priority will be sorted first, whereas a lower priority will be sorted last.

Elements with equal priorities are then sorted based off their geometric positioning.

I'll add the accessibilitySortPriority(_:) modifier to the challenge button to improve the navigation order.

I'll use a priority of -1 since the default is 0, to force the sort order of the challenge button to be last.

Now the challenge button will be navigated to last.

This is a good improvement, since there is less chance a VoiceOver user would be confused as to who they are sending a challenge to, but it's still not great.

Rather than wrapping each FriendCellView in an accessibility container, we could combine the children into a single element.

```swift
struct User: Identifiable {
    var id: Int
    var name: String
    var photo: String
}

struct FriendCellView: View {
    var user: User

    var body: some View {
        ZStack(alignment: .topLeading) {
            VStack(alignment: .center) {
                Image(user.photo)
                Text(user.name)
            }

            Button("Send Challenge", action: { /* ... */ })
                .buttonStyle(
                    SymbolButtonStyle(
                        systemName: "gamecontroller.fill"))
        }
    }
}
      
struct FriendsView: View {
    var users: [User]

    var body: some View {
        ScrollView(.horizontal, showsIndicators: false) {
            HStack {
                ForEach(users) { user in
                    FriendCellView(user: user)
                        .accessibilityElement(children: .combine)
                        .onTapGesture { /* ... */ }
                }

                AddFriendButton()

                Spacer()
            }
        }
    }
}
  
struct AddFriendButton: View {
    var body: some View {
        Button(action: { /* ... */ }) {
            Circle()
                .foregroundColor(Color(white: 0.9))
                .frame(width: 50, height: 50)
                .overlay(
                    Image(systemName: "plus")
                        .resizable()
                        .foregroundColor(Color(white: 0.5))
                        .padding(15)
                )
        }
        .buttonStyle(PlainButtonStyle())
    }
}

struct SymbolButtonStyle: ButtonStyle {
    let systemName: String

    func makeBody(configuration: Configuration) -> some View {
                Image(systemName: systemName)
            .accessibilityRepresentation { configuration.label }
    }
}
```

This too fixes the navigation order and reduces the number of accessibility elements. 

---

### AlertView implicit Rotor

And so this seems like a great use case for accessibilityRotorEntry.

```swift
struct Alert: Identifiable {
    var id: Int
    var isUnread: Bool
    var isFlagged: Bool
    var subject: String
    var content: String
}

struct AlertsView: View {
    var alerts: [Alert]

    var body: some View {
        VStack {
            ForEach(alerts) { alert in
                AlertCellView(alert: alert)
                    .accessibilityElement(children: .combine)
            }
        }
        .accessibilityElement(children: .contain)
        .accessibilityRotor("Warnings") {
            ForEach(alerts) { alert in
                if alert.isWarning {
                    AccessibilityRotorEntry(alert.title, id: alert.id)
                }
            }
        }
    }
}

struct AlertCell: View {
    var alert: Alert

    var body: some View {
        VStack(alignment: .leading) {
            HStack {
                if alert.isUnread {
                    Circle()
                        .foregroundColor(.blue)
                        .frame(width: 10, height: 10)
                }
                if alert.isFlagged {
                    Image(systemName: "exclamationmark.triangle.fill")
                        .foregroundColor(.orange)
                        .frame(width: 10, height: 10)
                }
                Text(alert.subject)
                    .font(.headline)
                    .fontWeight(.semibold)
                Spacer()
                Text("04/30/21")
                    .font(.subheadline)
                    .foregroundColor(.secondary)
            }
            Text(alert.content)
                .lineLimit(3)
        }
        .padding(10)
        .background(
            RoundedRectangle(cornerRadius: 8)
                .foregroundColor(Color(white: 0.9))
        )
    }
}
```

These will all be accessible as children of the Canvas accessibility container. 

---

### AlertView Explicit Rotor

The identity of a view is important to understand for accessibility rotors.

```swift
struct Alert: Identifiable {
    var id: Int
    var isUnread: Bool
    var isFlagged: Bool
    var subject: String
    var content: String
}

struct AlertsView: View {
    var alerts: [Alert]
    @Namespace var namespace

    var body: some View {
        VStack {
            ForEach(alerts) { alert in
                VStack {
                    AlertCellView(alert: alert)
                        .accessibilityElement(children: .combine)
                        .accessibilityRotorEntry(id: alert.id, in: namespace)
                    AlertActionsView(alert: alert)
                }
            }
        }
        .accessibilityElement(children: .contain)
        .accessibilityRotor("Warnings") {
            ForEach(alerts) { alert in
                if alert.isWarning {
                    AccessibilityRotorEntry(alert.title, id: alert.id, in: namespace)
                }
            }
        }
    }
}

struct AlertCell: View {
    var alert: Alert

    var body: some View {
        VStack(alignment: .leading) {
            HStack {
                if alert.isUnread {
                    Circle()
                        .foregroundColor(.blue)
                        .frame(width: 10, height: 10)
                }
                if alert.isFlagged {
                    Image(systemName: "exclamationmark.triangle.fill")
                        .foregroundColor(.orange)
                        .frame(width: 10, height: 10)
                }
                Text(alert.subject)
                    .font(.headline)
                    .fontWeight(.semibold)
                Spacer()
                Text("04/30/21")
                    .font(.subheadline)
                    .foregroundColor(.secondary)
            }
            Text(alert.content)
                .lineLimit(3)
        }
        .padding(10)
        .background(
            RoundedRectangle(cornerRadius: 8)
                .foregroundColor(Color(white: 0.9))
        )
    }
}
```

This simple case works elegantly because there is a single accessibility element -- due to the combine -- for the AlertCellView. 

---

### AlertNotifcationView

AccessibilityFocusState is the last piece you need.

```swift
struct Notification: Equatable {
    enum Priority {
        case low, high
    }
    var content: String
    var priority: Priority
}

struct AlertNotificationView<Content: View>: View {
    @ViewBuilder var content: Content
    @Binding var notification: Notification?
    @AccessibilityFocusState var isNotificationFocused: Bool

    var body: some View {
        ZStack(alignment: .top) {
            content

            if let notification = $notification {
                NotificationBanner(notification: notification)
                    .accessibilityFocused($isNotificationFocused)
            }
        }
        .onChange(of: notification) { notification in
            if notification?.priority == .high {
                isNotificationFocused = true
            } else {
                postAccessibilityNotification()
            }
        }
    }

    func postAccessibilityNotification() {
        guard let announcement = notification?.content else {
            return
        }
        #if os(macOS)
        NSAccessibility.post(
            element: NSApp.accessibilityWindow(),
            notification: .announcementRequested,
            userInfo: [.announcement: announcement])
        #else
        UIAccessibility.post(notification: .announcement, argument: announcement)
        #endif
    }
}

struct NotificationBanner: View {
    @Binding var notification: Notification?
    @State var timer: Timer?
    @AccessibilityFocusState var isNotificationFocused: Bool

    var body: some View {
        if let notification = notification {
            Text(notification.content)
                .accessibilityFocused($isNotificationFocused)
                .onAppear { startTimer() }
                .onDisappear { stopTimer() }
        } else {
            EmptyView()
        }
    }

    func startTimer() {
        timer = Timer.scheduledTimer(
            withTimeInterval: 3,
            repeats: true) { _ in
            if !isNotificationFocused {
                notification = nil
            }
        }
    }

    func stopTimer() {
        timer?.invalidate()
    }
}
```

With it, you can read and direct the focus of assistive technologies to create smooth transitions between views.
--- END FILE ---
=== END SWIFT DOCUMENTATION ===
=== END CONTEXT ===

=== BUILD ATTEMPT 1 FAILED ===
The previous implementation failed with the following errors:

Build failed but no detailed error log available.

=== INSTRUCTIONS FOR ATTEMPT 2 ===
1. Analyze what went wrong in the previous approach
2. Try a DIFFERENT approach or fix the specific issues
3. Do NOT repeat the same mistakes
4. If the same approach keeps failing, consider an alternative implementation strategy
5. Write the corrected code directly - do not explain, just implement

Please fix the issues and provide the corrected implementation.
mcp: xcodebuildmcp starting
mcp: xcodebuildmcp ready
mcp startup: ready: xcodebuildmcp

thinking
**Locating AGENTS.md for instructions**

I'm planning to find and read AGENTS.md to review the specific instructions mentioned by the user before proceeding.
exec
/bin/zsh -lc ls in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 52ms:
Algo
Artifacts
Paper
README.md
__Avenue
app
critique
swiftDocs
website

thinking
**Searching for existing AGENTS.md**
exec
/bin/zsh -lc "rg --files -g 'AGENTS.md'" in /Users/emmanuel/Documents/Theory/Redefining_racism exited 1 in 53ms:


thinking
**Checking for missing AGENTS.md**

I'm confirming the AGENTS.md file doesn't exist or is hidden by searching for it explicitly to follow instructions about reporting unreadable or missing agent files.
exec
/bin/zsh -lc 'find . -name AGENTS.md -print' in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 235ms:


thinking
**Preparing large task plan**

I'm planning to use the update_plan tool for this large task, starting by inspecting key files to align on types like AppDependencies and ModelDownloadManager before creating new UI views and viewmodels.
exec
/bin/zsh -lc 'rg -n "AppDependencies|ModelDownloadManager|PolicyAnalysis|AnalyzedClause|TierClassification|ArchitectureScores|ScoreResult|HistoricalPolicies|TierResolver|AnalysisPipeline|AnalysisProgress" app/decodingOppression/decodingOppression' in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 51ms:
app/decodingOppression/decodingOppression/MLX/MLXClauseClassifier.swift:5://  Actor that loads Qwen3-4B-4bit + LoRA and classifies clauses to TierClassification.
app/decodingOppression/decodingOppression/MLX/MLXClauseClassifier.swift:17:    private let downloadManager: ModelDownloadManager
app/decodingOppression/decodingOppression/MLX/MLXClauseClassifier.swift:19:    init(downloadManager: ModelDownloadManager) {
app/decodingOppression/decodingOppression/MLX/MLXClauseClassifier.swift:46:    func classify(clause: Clause) async throws -> TierClassification {
app/decodingOppression/decodingOppression/MLX/MLXClauseClassifier.swift:62:    private func parseResponse(_ response: String) -> TierClassification {
app/decodingOppression/decodingOppression/MLX/MLXClauseClassifier.swift:125:        let architectureScores = ArchitectureScores(aar: aar, se: se, ij: ij, rsc: rsc)
app/decodingOppression/decodingOppression/MLX/MLXClauseClassifier.swift:132:        return TierClassification(
app/decodingOppression/decodingOppression/MLX/MLXClauseClassifier.swift:143:    private let downloadManager: ModelDownloadManager
app/decodingOppression/decodingOppression/MLX/MLXClauseClassifier.swift:145:    init(downloadManager: ModelDownloadManager) {
app/decodingOppression/decodingOppression/MLX/MLXClauseClassifier.swift:153:    func classify(clause: Clause) async throws -> TierClassification {
app/decodingOppression/decodingOppression/MLX/Tier2EngineHolder.swift:5://  Deprecated: use Tier2Engine directly via AppDependencies.
app/decodingOppression/decodingOppression/MLX/Tier2EngineHolder.swift:17:    init(downloadManager: ModelDownloadManager) {
app/decodingOppression/decodingOppression/MLX/Tier2EngineHolder.swift:21:    func classify(clause: Clause) async throws -> TierClassification? {
app/decodingOppression/decodingOppression/MLX/MLXError.swift:13:    /// Thrown when ModelDownloadManager.state is not .available.
app/decodingOppression/decodingOppression/MLX/ModelDownloadManager.swift:2://  ModelDownloadManager.swift
app/decodingOppression/decodingOppression/MLX/ModelDownloadManager.swift:13:final class ModelDownloadManager: NSObject, ObservableObject, @unchecked Sendable {
app/decodingOppression/decodingOppression/MLX/ModelDownloadManager.swift:35:    static let shared: ModelDownloadManager = ModelDownloadManager()
app/decodingOppression/decodingOppression/MLX/ModelDownloadManager.swift:78:                downloadError = NSError(domain: "ModelDownloadManager", code: -1, userInfo: [NSLocalizedDescriptionKey: "No files to download"])
app/decodingOppression/decodingOppression/MLX/ModelDownloadManager.swift:152:extension ModelDownloadManager: URLSessionDownloadDelegate {
app/decodingOppression/decodingOppression/MLX/Tier2Engine.swift:13:    private let downloadManager: ModelDownloadManager

thinking
**Adjusting to existing files**

Existing files like ContentView and AnalyzedClause.swift are already present, so I'll inspect and align them with the plan to fix compilation issues rather than recreating them from scratch.
exec
/bin/zsh -lc "sed -n '1,200p' app/decodingOppression/decodingOppression/Models/AnalyzedClause.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 52ms:
//
//  AnalyzedClause.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/19/26.
//

import Foundation
import SwiftData

@Model
final class AnalyzedClause {
    var id: UUID
    var text: String
    var sectionType: SectionType
    var targetGroup: TargetGroup
    var effectDirection: EffectDirection
    var confidence: Double
    var tierUsed: MLTier
    @Attribute(.externalStorage)

thinking
**Inspecting existing view files**

I'll check ContentView.swift to verify its implementation matches the plan without re-verifying the entire plan, focusing on spotting discrepancies causing build issues.
exec
/bin/zsh -lc "sed -n '1,220p' app/decodingOppression/decodingOppression/ContentView.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
//
//  ContentView.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/19/26.
//

import SwiftUI

struct ContentView: View {
    @AppStorage("hasCompletedOnboarding") private var hasCompletedOnboarding: Bool = false

    #if os(macOS)
    @State private var selectedSidebarItem: SidebarItem? = .analyze
    @State private var historyViewModel = PolicyHistoryViewModel()
    #endif

    var body: some View {
        #if os(iOS)
        NavigationStack {

thinking
**Reviewing macOS detail drilldown behavior**

I'm checking ScoreCardView to verify if it supports drilldown charts as required by step 11, since the current macOS split views partially match the spec but may lack full drilldown handling.
exec
/bin/zsh -lc "sed -n '1,220p' app/decodingOppression/decodingOppression/Views/ScoreCardView.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
//
//  ScoreCardView.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/23/26.
//

import SwiftUI

struct ScoreCardView: View {
    @Environment(\.accessibilityDifferentiateWithoutColor) private var differentiateWithoutColor
    @Environment(\.accessibilityReduceMotion) private var reduceMotion
    @Environment(\.accessibilityReduceTransparency) private var reduceTransparency
    @Environment(\.dynamicTypeSize) private var dynamicTypeSize
    @Environment(\.legibilityWeight) private var legibilityWeight
    @State private var viewModel: ScoreCardViewModel
    @State private var animatedCOI: Double = 0
    @State private var selectedDrillDown: DrillDown?
    @Namespace private var rotorNamespace
    @Namespace private var linkedNamespace
exec
/bin/zsh -lc "sed -n '220,520p' app/decodingOppression/decodingOppression/Views/ScoreCardView.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
                Image(systemName: badge.1)
                Text(scoreText)
                    .font(.subheadline.monospacedDigit())
                    .speechAdjustedPitch(-0.1)
                    .speechSpellsOutCharacters(false)
            }
            .foregroundStyle(badge.0)
        }
        .padding(.vertical, 6)
        .accessibilityRotorEntry(id: label.lowercased(), in: rotorNamespace)
        .accessibilityLinkedGroup(id: label.lowercased(), in: linkedNamespace)

        #if os(macOS)
        Button {
            selectedDrillDown = drillDown
        } label: {
            rowContent
        }
        .buttonStyle(.plain)
        #else


thinking
**Clarifying macOS detail panel setup**

ScoreCardView currently uses an internal HSplitView for its detail panel on macOS, but the plan suggests the outer NavigationSplitView's detail column should own the drill-down chart display, with ScoreCardView rendering inside that. This implies removing the inner HSplitView from ScoreCardView on macOS to avoid duplicate detail panels.
thinking
**Verifying view alignment and build errors**

The existing HSplitView in ScoreCardView might align with the plan since it manages the detail panel inside the detail column, but compile errors suggest potential missing types, concurrency issues, or imports; next I'll inspect related view files for discrepancies.
exec
/bin/zsh -lc "sed -n '1,200p' app/decodingOppression/decodingOppression/Views/WelcomeView.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 52ms:
//
//  WelcomeView.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/23/26.
//

import SwiftUI

struct WelcomeView: View {
    @EnvironmentObject private var deps: AppDependencies
    @EnvironmentObject private var modelDownloadManager: ModelDownloadManager
    @Environment(\.accessibilityReduceMotion) private var reduceMotion
    @Environment(\.dynamicTypeSize) private var dynamicTypeSize
    @Binding var hasCompletedOnboarding: Bool
    @State private var viewModel = WelcomeViewModel()
    @AccessibilityFocusState private var progressFocused: Bool

    var body: some View {
        let style = WelcomeViewStyle(reduceMotion: reduceMotion, dynamicTypeSize: dynamicTypeSize)

thinking
**Checking WelcomeViewStyle**
exec
/bin/zsh -lc "sed -n '1,200p' app/decodingOppression/decodingOppression/Views/Style/WelcomeViewStyle.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
//
//  WelcomeViewStyle.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/23/26.
//

import SwiftUI

struct WelcomeViewStyle {
    let reduceMotion: Bool
    let dynamicTypeSize: DynamicTypeSize

    static func progressAnimation(reduceMotion: Bool) -> Animation? {
        reduceMotion ? nil : .easeInOut(duration: 0.4)
    }
}

thinking
**Checking dependency method async nature**

I'm verifying if startTier2Download in AppDependencies returns a Promise, since it's awaited in WelcomeView but may not be async.
exec
/bin/zsh -lc "sed -n '1,220p' app/decodingOppression/decodingOppression/decodingOppressionApp.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
//
//  decodingOppressionApp.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/19/26.
//

import Combine
import SwiftData
import SwiftUI
#if canImport(UIKit)
import UIKit
#endif

@main
@MainActor
struct decodingOppressionApp: App {
    #if canImport(UIKit)
    @UIApplicationDelegateAdaptor(AppDelegate.self) private var appDelegate
    #endif

thinking
**Inspecting async usage in WelcomeViewModel**

I'm checking if the call to startTier2Download in getStarted correctly handles the async operation with await.
exec
/bin/zsh -lc "sed -n '1,120p' app/decodingOppression/decodingOppression/ViewModels/WelcomeViewModel.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 52ms:
//
//  WelcomeViewModel.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/23/26.
//

import Foundation
import Observation

@Observable
@MainActor
final class WelcomeViewModel {
    var isDownloadStarted: Bool = false

    func getStarted(deps: AppDependencies, hasCompletedOnboarding: inout Bool) {
        if !isDownloadStarted {
            isDownloadStarted = true
            Task { await deps.startTier2Download() }
        }

thinking
**Checking async usage in other views**
exec
/bin/zsh -lc "sed -n '1,240p' app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 52ms:
//
//  PolicyHistoryView.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/23/26.
//

import SwiftData
import SwiftUI
import UniformTypeIdentifiers

struct PolicyHistoryView: View {
    @Environment(\.modelContext) private var modelContext
    @EnvironmentObject private var modelDownloadManager: ModelDownloadManager
    @Environment(\.accessibilityDifferentiateWithoutColor) private var differentiateWithoutColor
    @AppStorage("hasCompletedOnboarding") private var hasCompletedOnboarding: Bool = false
    @Query(sort: \PolicyAnalysis.dateAnalyzed, order: .reverse) private var analyses: [PolicyAnalysis]
    @State private var viewModel: PolicyHistoryViewModel
    @State private var analysisSelection: PDFSelection?


thinking
**Reviewing navigation and file importer usage**

Observed that PolicyHistoryView uses navigationDestination and fileImporter allows PDFs; on macOS, PolicyHistoryView's use of navigationDestination within NavigationSplitView may not rely on NavigationStack, so file importer might not trigger navigation. Next, I'll check PolicyHistoryViewModel.
exec
/bin/zsh -lc "sed -n '1,120p' app/decodingOppression/decodingOppression/ViewModels/PolicyHistoryViewModel.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
//
//  PolicyHistoryViewModel.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/23/26.
//

import Foundation
import Observation
import SwiftData

@Observable
@MainActor
final class PolicyHistoryViewModel {
    var isShowingFilePicker: Bool = false
    var selectedAnalysis: PolicyAnalysis?

    func delete(_ analysis: PolicyAnalysis, context: ModelContext) {
        context.delete(analysis)
    }

thinking
**Inspecting AnalysisView and related components**
exec
/bin/zsh -lc "sed -n '1,280p' app/decodingOppression/decodingOppression/Views/AnalysisView.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
//
//  AnalysisView.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/23/26.
//

import SwiftData
import SwiftUI

struct AnalysisView: View {
    let pdfURL: URL

    @EnvironmentObject private var deps: AppDependencies
    @EnvironmentObject private var modelDownloadManager: ModelDownloadManager
    @Environment(\.modelContext) private var modelContext
    @Environment(\.dismiss) private var dismiss
    @Environment(\.accessibilityDifferentiateWithoutColor) private var differentiateWithoutColor
    @Environment(\.accessibilityReduceMotion) private var reduceMotion
    @AppStorage("hasCompletedOnboarding") private var hasCompletedOnboarding: Bool = false

thinking
**Checking AnalysisViewModel**
exec
/bin/zsh -lc "sed -n '1,220p' app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
//
//  AnalysisViewModel.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/23/26.
//

import Foundation
import Observation
import SwiftData

@Observable
@MainActor
final class AnalysisViewModel {
    var stage: String = "Preparing analysis..."
    var coiValue: Double = 0
    var partialScores: ScoreResult = .zero
    var clauseIndex: Int = 0
    var totalClauses: Int = 0
    var isComplete: Bool = false

thinking
**Investigating build failure causes**

The build failure may stem from naming mismatches or SwiftData attribute issues around stored versus computed properties. Next, I'll inspect platform-specific code and ReportExporter.swift for missing imports or Mac/iOS-only types.
exec
/bin/zsh -lc "sed -n '1,240p' app/decodingOppression/decodingOppression/Export/ReportExporter.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 51ms:
//
//  ReportExporter.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/23/26.
//

import Foundation
#if canImport(UIKit)
import UIKit
#endif
#if os(macOS)
import AppKit
#endif

nonisolated struct ReportExporter {
    struct TierUsageStats: Codable {
        let tier1Count: Int
        let tier2Count: Int
        let tier3Count: Int
exec
/bin/zsh -lc "sed -n '240,520p' app/decodingOppression/decodingOppression/Export/ReportExporter.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
            let rect = CGRect(x: margin, y: y, width: width, height: bounding.height)
            NSAttributedString(string: text, attributes: attributes).draw(in: rect)
            y += bounding.height + 8
        }

        drawLine("Policy Analysis Report", font: .boldSystemFont(ofSize: 22))
        drawLine("Policy: \(analysis.policyName)", font: .systemFont(ofSize: 14))
        drawLine("Source: \(analysis.sourceFilename)", font: .systemFont(ofSize: 12), color: .secondaryLabelColor)
        drawLine("Date: \(analysis.dateAnalyzed.formatted(date: .long, time: .shortened))", font: .systemFont(ofSize: 12), color: .secondaryLabelColor)

        drawLine("COI: \(analysis.scoreResult.coi.formatted(.number.precision(.fractionLength(2))))", font: .boldSystemFont(ofSize: 16))

        drawLine("Sub-scores", font: .boldSystemFont(ofSize: 14))
        drawLine("DIS: \(analysis.scoreResult.dis.formatted(.number.precision(.fractionLength(2))))", font: .systemFont(ofSize: 12))
        drawLine("ADS: \(analysis.scoreResult.ads.formatted(.number.precision(.fractionLength(2))))", font: .systemFont(ofSize: 12))
        drawLine("EIS: \(analysis.scoreResult.eis.formatted(.number.precision(.fractionLength(2))))", font: .systemFont(ofSize: 12))
        drawLine("CIS: \(analysis.scoreResult.cis.formatted(.number.precision(.fractionLength(2))))", font: .systemFont(ofSize: 12))
        drawLine("OES: \(analysis.scoreResult.oes.formatted(.number.precision(.fractionLength(2))))", font: .systemFont(ofSize: 12))

        let stats = tierUsageStats(for: analysis)

thinking
**Verifying chart descriptor references**

The export structs align with the plan despite safetyFallbackCount being separate, so build failure might stem from incorrect or missing Chart descriptor references in views like BenefitHierarchyView; next, I'll inspect Chart Views for correctness.
exec
/bin/zsh -lc "sed -n '1,220p' app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
//
//  BenefitHierarchyView.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/23/26.
//

import Charts
import SwiftUI

struct BenefitHierarchyView: View {
    @Environment(\.accessibilityDifferentiateWithoutColor) private var differentiateWithoutColor
    @State private var viewModel: BenefitHierarchyViewModel

    init(analysis: PolicyAnalysis) {
        _viewModel = State(initialValue: BenefitHierarchyViewModel(analysis: analysis))
    }

    var body: some View {
        VStack(alignment: .leading, spacing: 16) {

thinking
**Reviewing style and symbol usage**

Noting potential compatibility concerns with ChartForegroundStyleScale using AnyShapeStyle and ImagePaint with system images, and observing the differentiateWithoutColor branch uses symbol-based methods tied to BenefitHierarchyViewStyle, which likely returns ChartSymbolShape; next is to verify BenefitHierarchyViewStyle details.
exec
/bin/zsh -lc "sed -n '1,200p' app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
//
//  BenefitHierarchyViewStyle.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/23/26.
//

import Charts
import SwiftUI

struct BenefitHierarchyViewStyle {
    static func effectColor(_ effect: EffectDirection) -> Color {
        switch effect {
        case .benefit:
            return .green
        case .burden:
            return .red
        case .neutral:
            return .gray
        case .mixed:

thinking
**Inspecting canvas usage**
exec
/bin/zsh -lc "sed -n '1,220p' app/decodingOppression/decodingOppression/Views/Charts/ArchitectureRadarView.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
//
//  ArchitectureRadarView.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/23/26.
//

import SwiftUI

struct ArchitectureRadarView: View {
    @Environment(\.accessibilityDifferentiateWithoutColor) private var differentiateWithoutColor
    @State private var viewModel: ArchitectureRadarViewModel
    @State private var selectedIndex: Int = 0

    init(analysis: PolicyAnalysis) {
        _viewModel = State(initialValue: ArchitectureRadarViewModel(analysis: analysis))
    }

    var body: some View {
        let components = viewModel.components

thinking
**Identifying next focus area**
exec
/bin/zsh -lc "sed -n '1,200p' app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 52ms:
//
//  CompoundingTrajectoryView.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/23/26.
//

import Charts
import SwiftUI

struct CompoundingTrajectoryView: View {
    @State private var viewModel: CompoundingTrajectoryViewModel

    init(analysis: PolicyAnalysis) {
        _viewModel = State(initialValue: CompoundingTrajectoryViewModel(analysis: analysis))
    }

    var body: some View {
        VStack(alignment: .leading, spacing: 16) {
            Text("Compounding Impact Trajectory")

thinking
**Identifying target component**
exec
/bin/zsh -lc "sed -n '1,200p' app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 51ms:
//
//  HistoricalComparisonView.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/23/26.
//

import Charts
import SwiftUI

struct HistoricalComparisonView: View {
    @State private var viewModel: HistoricalComparisonViewModel
    @Namespace private var rotorNamespace

    init(analysis: PolicyAnalysis) {
        _viewModel = State(initialValue: HistoricalComparisonViewModel(analysis: analysis))
    }

    var body: some View {
        VStack(alignment: .leading, spacing: 16) {

thinking
**Identifying component name**

Noted the component or module named OutgroupExpansionView for further exploration or modification.
exec
/bin/zsh -lc "sed -n '1,200p' app/decodingOppression/decodingOppression/Views/Charts/OutgroupExpansionView.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
//
//  OutgroupExpansionView.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/23/26.
//

import SwiftUI

struct OutgroupExpansionView: View {
    @State private var viewModel: OutgroupExpansionViewModel

    init(analysis: PolicyAnalysis) {
        _viewModel = State(initialValue: OutgroupExpansionViewModel(analysis: analysis))
    }

    var body: some View {
        VStack(alignment: .leading, spacing: 16) {
            Text("Outgroup Expansion")
                .font(.title2.weight(.semibold))

thinking
**Noticing potential duplicate heading style**

I spotted a repeated style definition for an accessibility heading (.h2) that may be duplicated but doesn't cause compile errors; I'll check ExportView next to see if this impacts usage or can be cleaned up.
exec
/bin/zsh -lc "sed -n '1,220p' app/decodingOppression/decodingOppression/Views/ExportView.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
//
//  ExportView.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/23/26.
//

import SwiftUI

struct ExportView: View {
    let analysis: PolicyAnalysis

    @State private var viewModel = ExportViewModel()
    @State private var lastFormat: ExportFormat?

    var body: some View {
        VStack(alignment: .leading, spacing: ExportViewStyle.buttonSpacing) {
            Text("Export")
                .font(.title2.weight(.semibold))


thinking
**Confirming ShareLink usage and fallback plan**

ExportView relies solely on ShareLink, which works for macOS and should be fine on iOS 16, but it currently lacks a UIActivityViewController fallback as planned; I'll verify usage in ExportViewModel next.
exec
/bin/zsh -lc "sed -n '1,200p' app/decodingOppression/decodingOppression/ViewModels/ExportViewModel.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
//
//  ExportViewModel.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/23/26.
//

import Foundation
import Observation
import UniformTypeIdentifiers

@Observable
@MainActor
final class ExportViewModel {
    var isGenerating: Bool = false
    var error: Error?
    var exportedItem: ExportedItem?

    func export(analysis: PolicyAnalysis, format: ExportFormat) {
        guard !isGenerating else { return }

thinking
**Inspecting ClauseListView for issues**
exec
/bin/zsh -lc "sed -n '1,220p' app/decodingOppression/decodingOppression/Views/ClauseListView.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
//
//  ClauseListView.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/23/26.
//

import SwiftUI

struct ClauseListView: View {
    @State private var viewModel: ClauseListViewModel
    @Namespace private var rotorNamespace

    init(analysis: PolicyAnalysis) {
        _viewModel = State(initialValue: ClauseListViewModel(analysis: analysis))
    }

    var body: some View {
        List {
            Section("Oppressive Clauses") {

thinking
**Checking ClauseListViewStyle presence**

I'm verifying if the ClauseListViewStyle is defined or used in the codebase to understand its role and impact.
exec
/bin/zsh -lc "sed -n '1,160p' app/decodingOppression/decodingOppression/Views/Style/ClauseListViewStyle.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 50ms:
//
//  ClauseListViewStyle.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/23/26.
//

import SwiftUI

struct ClauseListViewStyle {
    static func scoreColor(_ score: Double) -> Color {
        if score >= 0.3 { return .red }
        if score <= -0.3 { return .green }
        return .secondary
    }
}

thinking
**Checking for compile issues in view models**

I'm scanning Chart-related and other view models for compile errors, focusing on suspicious data models and usage that might cause build failures due to missing imports or outdated code.
exec
/bin/zsh -lc "sed -n '1,200p' app/decodingOppression/decodingOppression/Models/PolicyAnalysis.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
//
//  PolicyAnalysis.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/19/26.
//

import Foundation
import SwiftData

@Model
final class PolicyAnalysis {
    var id: UUID
    var policyName: String
    var sourceFilename: String
    var dateAnalyzed: Date
    @Attribute(.externalStorage)
    private var scoreResultData: Data
    @Relationship(deleteRule: .cascade)
    var clauses: [AnalyzedClause]

thinking
**Checking pipeline contracts**
exec
/bin/zsh -lc "sed -n '1,200p' app/decodingOppression/decodingOppression/Models/PipelineContracts.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 52ms:
//
//  PipelineContracts.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/19/26.
//

import Foundation

// MARK: - Architecture scores (Codable for pipeline and training)

struct ArchitectureScores: Codable, Sendable {
    var aar: Double  // asymmetric autonomy restriction
    var se: Double   // selective empathy
    var ij: Double   // ideological justification
    var rsc: Double  // resistance to structural critique
}

// MARK: - Analysis progress



thinking
**Checking compile errors approach**

I'm clarifying that build failures are from compile errors, considering using `xcodebuild` or MCP tools to diagnose, but plan to inspect code references like `ChartSymbolScale` usage for type mismatches that could cause compilation issues.
thinking
**Investigating potential SwiftUI and SwiftData conflicts**

I'm checking if compile errors stem from platform-specific APIs, SwiftData array attributes, concurrency annotations, or missing imports, while preparing to inspect related view models like BenefitHierarchyViewModel for unresolved references or duplicates.
exec
/bin/zsh -lc "sed -n '1,200p' app/decodingOppression/decodingOppression/ViewModels/Charts/BenefitHierarchyViewModel.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
//
//  BenefitHierarchyViewModel.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/23/26.
//

import Foundation
import Observation

@Observable
@MainActor
final class BenefitHierarchyViewModel {
    var analysis: PolicyAnalysis

    init(analysis: PolicyAnalysis) {
        self.analysis = analysis
    }

    var dataPoints: [BenefitHierarchyDatum] {

thinking
**Identifying target ViewModel**
exec
/bin/zsh -lc "sed -n '1,200p' app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
//
//  CompoundingTrajectoryViewModel.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/23/26.
//

import Foundation
import Observation

@Observable
@MainActor
final class CompoundingTrajectoryViewModel {
    var analysis: PolicyAnalysis

    init(analysis: PolicyAnalysis) {
        self.analysis = analysis
    }

    var points: [CompoundingPoint] {

thinking
**Identifying key view model**
exec
/bin/zsh -lc "sed -n '1,200p' app/decodingOppression/decodingOppression/ViewModels/Charts/HistoricalComparisonViewModel.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 51ms:
//
//  HistoricalComparisonViewModel.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/23/26.
//

import Foundation
import Observation

@Observable
@MainActor
final class HistoricalComparisonViewModel {
    var analysis: PolicyAnalysis

    init(analysis: PolicyAnalysis) {
        self.analysis = analysis
    }

    var entries: [HistoricalComparisonEntry] {

thinking
**Identifying key view model**
exec
/bin/zsh -lc "sed -n '1,200p' app/decodingOppression/decodingOppression/ViewModels/Charts/ArchitectureRadarViewModel.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
//
//  ArchitectureRadarViewModel.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/23/26.
//

import Foundation
import Observation

@Observable
@MainActor
final class ArchitectureRadarViewModel {
    var analysis: PolicyAnalysis

    init(analysis: PolicyAnalysis) {
        self.analysis = analysis
    }

    var components: [ArchitectureComponent] {

thinking
**Identifying key view model**
exec
/bin/zsh -lc "sed -n '1,200p' app/decodingOppression/decodingOppression/ViewModels/Charts/OutgroupExpansionViewModel.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 52ms:
//
//  OutgroupExpansionViewModel.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/23/26.
//

import Foundation
import Observation

@Observable
@MainActor
final class OutgroupExpansionViewModel {
    var analysis: PolicyAnalysis

    init(analysis: PolicyAnalysis) {
        self.analysis = analysis
    }

    var expansionRate: Double {

thinking
**Inspecting detail view file**
exec
/bin/zsh -lc "sed -n '1,200p' app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
//
//  EliteInterestDetailView.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/23/26.
//

import SwiftUI

struct EliteInterestDetailView: View {
    @State private var viewModel: EliteInterestDetailViewModel

    init(analysis: PolicyAnalysis) {
        _viewModel = State(initialValue: EliteInterestDetailViewModel(analysis: analysis))
    }

    var body: some View {
        VStack(alignment: .leading, spacing: 16) {
            Text("Elite Interest Detail")
                .font(.title2.weight(.semibold))

thinking
**Checking minor style inconsistencies**

Noticed repeated accessibilityHeading .h2 and possible missing ScoreCardViewStyle to verify if it impacts the UI or accessibility.
exec
/bin/zsh -lc "sed -n '1,200p' app/decodingOppression/decodingOppression/Views/Style/ScoreCardViewStyle.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 52ms:
//
//  ScoreCardViewStyle.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/23/26.
//

import SwiftUI

struct ScoreCardViewStyle {
    static func scoreRevealAnimation(reduceMotion: Bool) -> Animation? {
        reduceMotion ? nil : .easeOut(duration: 0.5)
    }

    static func scoreColor(_ score: Double, differentiateWithoutColor: Bool) -> (Color, String) {
        if score < 0 {
            return (.blue, "arrow.down")
        }
        switch score {
        case 0.6...:

thinking
**Reviewing AnalysisViewStyle**
exec
/bin/zsh -lc "sed -n '1,200p' app/decodingOppression/decodingOppression/Views/Style/AnalysisViewStyle.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 52ms:
//
//  AnalysisViewStyle.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/23/26.
//

import SwiftUI

struct AnalysisViewStyle {
    static func gaugeAnimation(reduceMotion: Bool) -> Animation? {
        reduceMotion ? nil : .spring(duration: 0.6)
    }

    static func scoreColor(_ score: Double, differentiateWithoutColor: Bool) -> (Color, String) {
        if score < 0 {
            return (.blue, "arrow.down")
        }
        switch score {
        case 0.6...:

thinking
**Identifying PolicyHistoryViewStyle**
exec
/bin/zsh -lc "sed -n '1,200p' app/decodingOppression/decodingOppression/Views/Style/PolicyHistoryViewStyle.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
//
//  PolicyHistoryViewStyle.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/23/26.
//

import SwiftUI

struct PolicyHistoryViewStyle {
    static func coiBadgeColor(_ coi: Double, differentiateWithoutColor: Bool) -> (Color, String) {
        switch coi {
        case 0.6...:
            return (.red, "exclamationmark.triangle")
        case 0.3..<0.6:
            return (.orange, "minus.circle")
        default:
            return (.green, "checkmark.shield")
        }
    }

thinking
**Verifying Codable conformance for key types**

I'm checking if SectionType, TargetGroup, and related types conform to Codable since they’re used in a Codable struct and might cause build errors if missing. Next, I'll search their definitions to confirm.
exec
/bin/zsh -lc 'rg -n "enum SectionType|enum TargetGroup|enum EffectDirection|enum MLTier" app/decodingOppression/decodingOppression/Models' in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 52ms:
app/decodingOppression/decodingOppression/Models/GenerableTypes.swift:20:    enum TargetGroup: String {
app/decodingOppression/decodingOppression/Models/GenerableTypes.swift:28:    enum EffectDirection: String {
app/decodingOppression/decodingOppression/Models/GenerableTypes.swift:80:    enum TargetGroup: String, Codable {
app/decodingOppression/decodingOppression/Models/GenerableTypes.swift:87:    enum EffectDirection: String, Codable {
app/decodingOppression/decodingOppression/Models/Policy.swift:12:enum SectionType: String, Codable, CaseIterable, Sendable {
app/decodingOppression/decodingOppression/Models/Policy.swift:20:enum TargetGroup: String, Codable, CaseIterable, Sendable {
app/decodingOppression/decodingOppression/Models/Policy.swift:27:enum EffectDirection: String, Codable, CaseIterable, Sendable {
app/decodingOppression/decodingOppression/Models/Policy.swift:34:enum MLTier: String, Codable, Sendable {

thinking
**Checking for duplicate definitions**

I'm opening GenerableTypes.swift to verify whether there are duplicate type definitions that could impact the implementation.
exec
/bin/zsh -lc "sed -n '1,160p' app/decodingOppression/decodingOppression/Models/GenerableTypes.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 51ms:
//
//  GenerableTypes.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/19/26.
//

import Foundation

#if canImport(FoundationModels)
import FoundationModels
#endif

// MARK: - Clause classification (classification-first order for constrained decoding)

#if canImport(FoundationModels)
@Generable(description: "Classification of a policy clause by target group and effect direction")
struct ClauseClassification {
    @Generable
    enum TargetGroup: String {

thinking
**Clarifying nested type definitions**

TargetGroup and EffectDirection are only defined nested inside ClauseClassification, while ProxyDetection defined there is used more widely, including in PipelineContracts and TierClassification; now checking Policy.swift for related definitions.
exec
/bin/zsh -lc "sed -n '1,120p' app/decodingOppression/decodingOppression/Models/Policy.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 51ms:
//
//  Policy.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/19/26.
//

import Foundation

// MARK: - Section type and targeting

enum SectionType: String, Codable, CaseIterable, Sendable {
    case title
    case definitions
    case operativeClauses
    case penalties
    case exceptions
}

enum TargetGroup: String, Codable, CaseIterable, Sendable {

thinking
**Checking model references**

I'm verifying whether ClauseListViewModel references ClauseListViewStyle to investigate a potential compile issue but found no direct link so far.
exec
/bin/zsh -lc "sed -n '1,200p' app/decodingOppression/decodingOppression/ViewModels/ClauseListViewModel.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
//
//  ClauseListViewModel.swift
//  decodingOppression
//
//  Created by Emmanuel Theodore on 2/23/26.
//

import Foundation
import Observation

@Observable
@MainActor
final class ClauseListViewModel {
    var analysis: PolicyAnalysis

    init(analysis: PolicyAnalysis) {
        self.analysis = analysis
    }

    var oppressiveClauses: [ClauseScore] {

thinking
**Analyzing potential compile errors**

I'm assessing multiple possible causes for compile errors including SwiftUI version requirements for NavigationSplitView, usage of `@Observable` needing the Observation module, and type mismatches in navigationDestination and accessibility identifiers. I'm also verifying initializers in WelcomeViewStyle and ModelDownloadManager's state type for inconsistencies.
exec
/bin/zsh -lc "sed -n '1,220p' app/decodingOppression/decodingOppression/MLX/ModelDownloadManager.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 52ms:
//
//  ModelDownloadManager.swift
//  decodingOppression
//
//  Manages background download of Qwen3-4B-4bit model; observable state for SwiftUI.
//

import Combine
import Foundation
import Hub

@MainActor
final class ModelDownloadManager: NSObject, ObservableObject, @unchecked Sendable {
    // MainActor-isolated; marked Sendable to allow injection into actors.
    nonisolated static let sessionIdentifier = "com.decodingOppression.modelDownload"

    enum DownloadState: Sendable {
        case unavailable
        case downloading(progress: Double) // 0.0 – 1.0
        case available(modelURL: URL)


thinking
**Planning to list Xcode schemes**

I'm considering using the mcp tool to list available Xcode schemes to identify the correct scheme for building and diagnosing the compile errors more effectively.
thinking
**Planning to discover Xcode projects**

I'll use the MCP tool's project discovery to locate Xcode projects before running builds to identify compile errors and fix the build issues.
tool xcodebuildmcp.discover_projs({"workspaceRoot":"/Users/emmanuel/Documents/Theory/Redefining_racism","maxDepth":6})
xcodebuildmcp.discover_projs({"workspaceRoot":"/Users/emmanuel/Documents/Theory/Redefining_racism","maxDepth":6}) success in 53ms:
{
  "content": [
    {
      "type": "text",
      "text": "Discovery finished. Found 1 projects and 0 workspaces."
    },
    {
      "type": "text",
      "text": "Projects found:\n - /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression.xcodeproj"
    },
    {
      "type": "text",
      "text": "Hint: Save a default with session-set-defaults { projectPath: '...' } or { workspacePath: '...' }."
    }
  ],
  "isError": false
}

thinking
**Listing URI schemes**
tool xcodebuildmcp.list_schemes({})
xcodebuildmcp.list_schemes({}) failed in 1ms:
{
  "content": [
    {
      "type": "text",
      "text": "Error: Missing required session defaults\nDetails: Provide a project or workspace\nSet with: session-set-defaults { \"projectPath\": \"...\" } OR session-set-defaults { \"workspacePath\": \"...\" }"
    }
  ],
  "isError": true
}

thinking
**Setting defaults with session-set-defaults**
tool xcodebuildmcp.session-set-defaults({"projectPath":"/Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression.xcodeproj"})
xcodebuildmcp.session-set-defaults({"projectPath":"/Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression.xcodeproj"}) success in 7ms:
{
  "content": [
    {
      "type": "text",
      "text": "Defaults updated:\n{\n  \"projectPath\": \"/Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression.xcodeproj\"\n}"
    }
  ],
  "isError": false
}
Reconnecting... 1/5 (stream disconnected before completion: error sending request for url (https://chatgpt.com/backend-api/codex/responses))

thinking
**Listing schemes**
tool xcodebuildmcp.list_schemes({})
xcodebuildmcp.list_schemes({}) success in 3.89s:
{
  "content": [
    {
      "type": "text",
      "text": "✅ Available schemes:"
    },
    {
      "type": "text",
      "text": "decodingOppression"
    },
    {
      "type": "text",
      "text": "Next Steps:\n1. Build the app: build_macos({ projectPath: \"/Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression.xcodeproj\", scheme: \"decodingOppression\" })\n   or for iOS: build_sim({ projectPath: \"/Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression.xcodeproj\", scheme: \"decodingOppression\", simulatorName: \"iPhone 16\" })\n2. Show build settings: show_build_settings({ projectPath: \"/Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression.xcodeproj\", scheme: \"decodingOppression\" })"
    },
    {
      "type": "text",
      "text": "Hint: Consider saving a default scheme with session-set-defaults { scheme: \"decodingOppression\" } to avoid repeating it."
    }
  ],
  "isError": false

thinking
**Setting default scheme for macOS build**
tool xcodebuildmcp.session-set-defaults({"scheme":"decodingOppression"})
xcodebuildmcp.session-set-defaults({"scheme":"decodingOppression"}) success in 5ms:
{
  "content": [
    {
      "type": "text",
      "text": "Defaults updated:\n{\n  \"projectPath\": \"/Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression.xcodeproj\",\n  \"scheme\": \"decodingOppression\"\n}"
    }
  ],
  "isError": false
}

thinking
**Running macOS build to check errors**
tool xcodebuildmcp.build_macos({})
xcodebuildmcp.build_macos({}) failed in 7.06s:
{
  "content": [
    {
      "type": "text",
      "text": "⚠️ Warning: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift:38:17: warning: stored property 'pathBuilder' of 'Sendable'-conforming struct 'AnySymbolShape' has non-Sendable type '(CGRect) -> Path'; this is an error in the Swift 6 language mode"
    },
    {
      "type": "text",
      "text": "❌ Error: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift:37:8: error: type 'AnySymbolShape' does not conform to protocol 'ChartSymbolShape'"
    },
    {
      "type": "text",
      "text": "❌ Error: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift:51:8: error: type 'DiamondSymbol' does not conform to protocol 'ChartSymbolShape'"
    },
    {
      "type": "text",
      "text": "❌ Error: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift:64:8: error: type 'TriangleSymbol' does not conform to protocol 'ChartSymbolShape'"
    },
    {
      "type": "text",

thinking
**Investigating ChartSymbolShape conformance issues**

I'm examining the ChartSymbolShape protocol from the Charts SDK, suspecting it requires specific properties like static defaultSize or size. To fix errors, I'll check if removing custom conformance and using built-in ChartSymbolShape types like Circle or Square is simpler, then verify current uses in the project.
exec
/bin/zsh -lc 'rg -n "ChartSymbolShape" app/decodingOppression/decodingOppression' in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 50ms:
app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift:37:struct AnySymbolShape: ChartSymbolShape {
app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift:40:    init<S: ChartSymbolShape>(_ shape: S) {
app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift:51:struct DiamondSymbol: ChartSymbolShape {
app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift:64:struct TriangleSymbol: ChartSymbolShape {


thinking
**Assessing ChartSymbolShape conformance**

I’m analyzing that `ChartSymbolShape` likely requires a static size property and specific methods like `path(in:)`, which our current custom shapes lack, causing conformance errors. Considering replacing custom shapes with built-in Chart symbol types or using existing symbol and foreground style APIs to differentiate visuals without custom shapes.
thinking
**Planning protocol requirement exploration**

I’m preparing to write a minimal test struct conforming to `ChartSymbolShape` and compile it to expose exact protocol requirements via error messages, aiming to identify missing properties or methods causing conformance issues. This will clarify what our custom shapes must implement or confirm if switching to built-in shapes is simpler.
exec
/bin/zsh -lc "cat <<'EOF' >/tmp/ChartSymbolShapeCheck.swift
import Charts
import SwiftUI

struct Foo: ChartSymbolShape {
    func path(in rect: CGRect) -> Path { Path() }
}

EOF
xcrun swiftc -sdk macosx /tmp/ChartSymbolShapeCheck.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism exited 1 in 797ms:
warning: no such SDK: macosx
<unknown>:0: warning: no such sysroot directory: 'macosx'
<unknown>:0: error: unable to load standard library for target 'arm64-apple-macosx26.0'


thinking
**Analyzing protocol requirements from errors**

The errors imply ChartSymbolShape requires Sendable conformance and methods like a static defaultSize and a path(in:) instance method; implementing these explicitly with @Sendable closures could resolve the issues.
thinking
**Confirming protocol requirements via code and docs**

The protocol likely requires a static defaultSize property alongside path(in:), so I'll verify by searching for ChartSymbolShape definitions and references, aiming to confirm exact property names and signatures.
exec
/bin/zsh -lc 'rg -n "ChartSymbolShape" -S swiftDocs' in /Users/emmanuel/Documents/Theory/Redefining_racism exited 1 in 53ms:



thinking
**Refining custom chart symbol shapes**

Decided to keep custom ChartSymbolShape implementation to fulfill pattern fill requirements and plan to add required members like `defaultSize` and `path(in:)` to conform fully, aiming to fix compile errors through iterative builds.
thinking
**Redesigning custom symbol with enum-based shape**

Planning to replace multiple symbol structs and the wrapper with a single ChartSymbolShape struct parameterized by effect, simplifying conformance and Sendable compliance while matching chartSymbolScale’s expected type; next step is implementing this unified symbol type and updating usage accordingly.
file update
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -24,25 +24,4 @@
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
-    }
-}
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
-
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
@@ -50,22 +29,24 @@
 
-struct DiamondSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
 
-struct TriangleSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
apply_patch(auto_approved=true) exited 0 in 34ms:
Success. Updated the following files:
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
file update:
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..bc78c391717f2b7650a17eb944577cab9056c940
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,33 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
-    }
-}
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
-
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
 
-struct DiamondSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
 
-struct TriangleSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }

file update:
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..bc78c391717f2b7650a17eb944577cab9056c940
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,33 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
-    }
-}
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
-
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
 
-struct DiamondSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
 
-struct TriangleSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }

Reconnecting... 1/5 (stream disconnected before completion: error sending request for url (https://chatgpt.com/backend-api/codex/responses))

thinking
**Rebuilding macOS target**

I'm rebuilding the macOS project now to identify any build errors and address them.
tool xcodebuildmcp.build_macos({})
xcodebuildmcp.build_macos({}) failed in 4.60s:
{
  "content": [
    {
      "type": "text",
      "text": "❌ Error: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift:30:8: error: type 'BenefitSymbol' does not conform to protocol 'ChartSymbolShape'"
    },
    {
      "type": "text",
      "text": "❌ [stderr] --- xcodebuild: WARNING: Using the first of multiple matching destinations:"
    },
    {
      "type": "text",
      "text": "❌ [stderr] { platform:macOS, arch:arm64, id:00006001-000448A43402801E, name:My Mac }"
    },
    {
      "type": "text",
      "text": "❌ [stderr] { platform:macOS, arch:x86_64, id:00006001-000448A43402801E, name:My Mac }"
    },
    {
      "type": "text",
file update:
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..bc78c391717f2b7650a17eb944577cab9056c940
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,33 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
-    }
-}
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
-
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
 
-struct DiamondSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
 
-struct TriangleSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }



thinking
**Exploring ways to reveal protocol requirements**

I'm investigating how to get detailed requirement info for the protocol by trying multiple `xcodebuild` and `swiftc` flags but haven't found a direct way to show which requirements are missing or why conformance fails yet.
thinking
**Trying to list SDKs with xcodebuild**

I'm attempting to use `xcodebuild -showsdks` via exec_command to identify available SDKs that might help reveal protocol requirement details.
exec
/bin/zsh -lc 'xcodebuild -showsdks | head -n 20' in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 346ms:
DriverKit SDKs:
	DriverKit 25.2                	-sdk driverkit25.2

iOS SDKs:
	iOS 26.2                      	-sdk iphoneos26.2

iOS Simulator SDKs:
	Simulator - iOS 26.2          	-sdk iphonesimulator26.2

macOS SDKs:
	macOS 26.2                    	-sdk macosx26.2
	macOS 26.2                    	-sdk macosx26.2

tvOS SDKs:
	tvOS 26.2                     	-sdk appletvos26.2

tvOS Simulator SDKs:
	Simulator - tvOS 26.2         	-sdk appletvsimulator26.2

visionOS SDKs:
file update:
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..bc78c391717f2b7650a17eb944577cab9056c940
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,33 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
-    }
-}
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
-
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
 
-struct DiamondSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
 
-struct TriangleSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Testing SDK-specific swiftc call**
exec
/bin/zsh -lc "cat <<'EOF' >/tmp/ChartSymbolShapeCheck.swift
import Charts
import SwiftUI

struct Foo: ChartSymbolShape {
    static var defaultSize: CGSize { CGSize(width: 12, height: 12) }
    func path(in rect: CGRect) -> Path { Path() }
}

EOF
xcrun --sdk macosx26.2 swiftc /tmp/ChartSymbolShapeCheck.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism exited 1 in 727ms:
2026-02-22 23:55:19.278 xcodebuild[54555:350106]  DVTFilePathFSEvents: Failed to start fs event stream.
2026-02-22 23:55:19.468 xcodebuild[54555:350105] [MT] DVTDeveloperPaths: Failed to get length of DARWIN_USER_CACHE_DIR from confstr(3), error = Error Domain=NSPOSIXErrorDomain Code=5 "Input/output error". Using NSCachesDirectory instead.
<unknown>:0: error: error opening '/Users/emmanuel/.cache/clang/ModuleCache/Swift-3AJJN1UPT8RFK.swiftmodule' for output: /Users/emmanuel/.cache/clang/ModuleCache: Operation not permitted
<unknown>:0: error: unable to load standard library for target 'arm64-apple-macosx26.0'
file update:
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..bc78c391717f2b7650a17eb944577cab9056c940
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,33 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
-    }
-}
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
-
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
 
-struct DiamondSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
 
-struct TriangleSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }



thinking
**Analyzing shape conformance issues**

Exec fails due to sandbox restrictions, so I'll rely on xcodebuild output instead. ChartSymbolShape requires conforming to Shape and Sendable, including a `static defaultSize`; `animatableData` can be synthesized if no animatable properties exist. The remaining issue might stem from ChartSymbolShape needing more requirements or not being a protocol as expected.
thinking
**Planning to inspect SDK interface**

Planning to locate ChartSymbolShape in the Swift Charts module's SDK by using `xcrun` to get the SDK path and searching the module's swiftinterface files for its exact definition and requirements.
exec
/bin/zsh -lc 'SDK_PATH=$(xcrun --sdk macosx26.2 --show-sdk-path)
rg -n "ChartSymbolShape" "$SDK_PATH/System/Library/Frameworks/Charts.framework" -g "*.swiftinterface" | head -n 20' in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 52ms:
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/arm64e-apple-macos.swiftinterface:1551:  nonisolated public func symbol<S>(_ symbol: S) -> some Charts.ChartContent where S : Charts.ChartSymbolShape
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/arm64e-apple-macos.swiftinterface:1875:  public func symbol<P>(for value: P) -> Charts.AnyChartSymbolShape? where P : Charts.Plottable
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/arm64e-apple-macos.swiftinterface:1938:public protocol ChartSymbolShape : SwiftUICore.Shape {
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/arm64e-apple-macos.swiftinterface:1942:extension Charts.ChartSymbolShape where Self : SwiftUICore.InsettableShape {
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/arm64e-apple-macos.swiftinterface:1943:  public func strokeBorder(lineWidth: CoreFoundation.CGFloat = 1) -> some Charts.ChartSymbolShape
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/arm64e-apple-macos.swiftinterface:1945:  public func strokeBorder(style: SwiftUICore.StrokeStyle) -> some Charts.ChartSymbolShape
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/arm64e-apple-macos.swiftinterface:1949:@frozen public struct AnyChartSymbolShape : Charts.ChartSymbolShape {
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/arm64e-apple-macos.swiftinterface:1950:  internal let storage: any Charts.ChartSymbolShape
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/arm64e-apple-macos.swiftinterface:1951:  nonisolated public init(_ content: any Charts.ChartSymbolShape)
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/arm64e-apple-macos.swiftinterface:1959:  public typealias Body = SwiftUICore._ShapeView<Charts.AnyChartSymbolShape, SwiftUICore.ForegroundStyle>
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/arm64e-apple-macos.swiftinterface:1962:extension SwiftUICore.Circle : Charts.ChartSymbolShape {
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/arm64e-apple-macos.swiftinterface:1968:public struct BasicChartSymbolShape : Charts.ChartSymbolShape {
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/arm64e-apple-macos.swiftinterface:1973:  public func strokeBorder(lineWidth: CoreFoundation.CGFloat = 1) -> some Charts.ChartSymbolShape
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/arm64e-apple-macos.swiftinterface:1978:  public typealias Body = SwiftUICore._ShapeView<Charts.BasicChartSymbolShape, SwiftUICore.ForegroundStyle>
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/arm64e-apple-macos.swiftinterface:1981:extension Charts.ChartSymbolShape where Self == Charts.BasicChartSymbolShape {
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/arm64e-apple-macos.swiftinterface:1982:  public static var circle: Charts.BasicChartSymbolShape {
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/arm64e-apple-macos.swiftinterface:1985:  public static var square: Charts.BasicChartSymbolShape {
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/arm64e-apple-macos.swiftinterface:1988:  public static var triangle: Charts.BasicChartSymbolShape {
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/arm64e-apple-macos.swiftinterface:1991:  public static var diamond: Charts.BasicChartSymbolShape {
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/arm64e-apple-macos.swiftinterface:1994:  public static var pentagon: Charts.BasicChartSymbolShape {
file update:
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..bc78c391717f2b7650a17eb944577cab9056c940
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,33 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
-    }
-}
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
-
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
 
-struct DiamondSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
 
-struct TriangleSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Locating protocol requirements section**
exec
/bin/zsh -lc 'SDK_PATH=$(xcrun --sdk macosx26.2 --show-sdk-path)
sed -n '"'1936,1966p' \""'$SDK_PATH/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/arm64e-apple-macos.swiftinterface"' in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
}
@available(iOS 16.0, macOS 13.0, tvOS 16.0, watchOS 9.0, *)
public protocol ChartSymbolShape : SwiftUICore.Shape {
  var perceptualUnitRect: CoreFoundation.CGRect { get }
}
@available(iOS 16.0, macOS 13.0, tvOS 16.0, watchOS 9.0, *)
extension Charts.ChartSymbolShape where Self : SwiftUICore.InsettableShape {
  public func strokeBorder(lineWidth: CoreFoundation.CGFloat = 1) -> some Charts.ChartSymbolShape
  
  public func strokeBorder(style: SwiftUICore.StrokeStyle) -> some Charts.ChartSymbolShape
  
}
@available(iOS 16.0, macOS 13.0, tvOS 16.0, watchOS 9.0, *)
@frozen public struct AnyChartSymbolShape : Charts.ChartSymbolShape {
  internal let storage: any Charts.ChartSymbolShape
  nonisolated public init(_ content: any Charts.ChartSymbolShape)
  nonisolated public func path(in rect: CoreFoundation.CGRect) -> SwiftUICore.Path
  public var perceptualUnitRect: CoreFoundation.CGRect {
    get
  }
file update:
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..bc78c391717f2b7650a17eb944577cab9056c940
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,33 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
-    }
-}
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
-
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
 
-struct DiamondSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
 
-struct TriangleSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Planning perceptual unit rect implementation**

I see the protocol requires implementing a non-default `perceptualUnitRect` property, so I'll need to define it for custom shapes. Considering using `AnyChartSymbolShape` for type erasure and built-in shapes like `BasicChartSymbolShape.diamond` as a basis to simplify implementation.
exec
/bin/zsh -lc 'SDK_PATH=$(xcrun --sdk macosx26.2 --show-sdk-path)
sed -n '"'1966,2006p' \""'$SDK_PATH/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/arm64e-apple-macos.swiftinterface"' in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
}
@available(iOS 16.0, macOS 13.0, tvOS 16.0, watchOS 9.0, *)
public struct BasicChartSymbolShape : Charts.ChartSymbolShape {
  nonisolated public func path(in rect: CoreFoundation.CGRect) -> SwiftUICore.Path
  public var perceptualUnitRect: CoreFoundation.CGRect {
    get
  }
  public func strokeBorder(lineWidth: CoreFoundation.CGFloat = 1) -> some Charts.ChartSymbolShape
  
  @available(iOS 16.0, tvOS 16.0, watchOS 9.0, macOS 13.0, *)
  public typealias AnimatableData = SwiftUICore.EmptyAnimatableData
  @available(iOS 16.0, tvOS 16.0, watchOS 9.0, macOS 13.0, *)
  public typealias Body = SwiftUICore._ShapeView<Charts.BasicChartSymbolShape, SwiftUICore.ForegroundStyle>
}
@available(iOS 16.0, macOS 13.0, tvOS 16.0, watchOS 9.0, *)
extension Charts.ChartSymbolShape where Self == Charts.BasicChartSymbolShape {
  public static var circle: Charts.BasicChartSymbolShape {
    get
  }
  public static var square: Charts.BasicChartSymbolShape {
file update:
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..bc78c391717f2b7650a17eb944577cab9056c940
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,33 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
-    }
-}
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
-
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
 
-struct DiamondSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
 
-struct TriangleSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Adding perceptualUnitRect to BenefitSymbol**

I'm updating BenefitSymbol to implement the required perceptualUnitRect property with a unit CGRect, defining its bounding box for the custom shape as needed by ChartSymbolShape.
file update
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -32,2 +32,3 @@
     static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
apply_patch(auto_approved=true) exited 0 in 59ms:
Success. Updated the following files:
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
file update:
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }

file update:
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Rebuilding project**
tool xcodebuildmcp.build_macos({})
xcodebuildmcp.build_macos({}) failed in 4.28s:
{
  "content": [
    {
      "type": "text",
      "text": "❌ Error: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift:38:23: error: value of tuple type '()' has no member 'shape'"
    },
    {
      "type": "text",
      "text": "❌ [stderr] --- xcodebuild: WARNING: Using the first of multiple matching destinations:"
    },
    {
      "type": "text",
      "text": "❌ [stderr] { platform:macOS, arch:arm64, id:00006001-000448A43402801E, name:My Mac }"
    },
    {
      "type": "text",
      "text": "❌ [stderr] { platform:macOS, arch:x86_64, id:00006001-000448A43402801E, name:My Mac }"
    },
    {
      "type": "text",
file update:
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Identifying new error in embedding engine**

The error at line 38 in MLXEmbeddingEngine.swift is unrelated to the prior plan and suggests a systemic issue; next, I'll inspect that file to diagnose and fix the cause.
exec
/bin/zsh -lc "sed -n '1,160p' app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 51ms:
//
//  MLXEmbeddingEngine.swift
//  decodingOppression
//
//  Actor that loads BGE small embedder and provides similarity for taxonomy matching.
//

import Foundation
#if !targetEnvironment(simulator)
import MLX
import MLXEmbedders
#endif

actor MLXEmbeddingEngine {
#if !targetEnvironment(simulator)
    private var modelContainer: ModelContainer?

    func loadModel() async throws {
        if modelContainer != nil { return }
        modelContainer = try await loadModelContainer(
file update:
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Investigating unexpected void return**

I'm focusing on why the `pooler` call returns `()` instead of a tensor with `.shape`, suspecting the method might be a void closure rather than returning a value. Next, I'll check the `MLXEmbedders` module interface for the true `pooler` signature to confirm its return type.
exec
/bin/zsh -lc 'SDK_PATH=$(xcrun --sdk macosx26.2 --show-sdk-path)
rg -n "pooler" "$SDK_PATH/System/Library/Frameworks/MLXEmbedders.framework" -g "*.swiftinterface" | head -n 20' in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 52ms:
rg: /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/MLXEmbedders.framework: IO error for operation on /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/MLXEmbedders.framework: No such file or directory (os error 2)
file update:
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Investigating MLXEmbedders location**

Considering that MLXEmbedders might be an external Swift package, I'll check project package-related files and search usage references in the codebase to locate it.
exec
/bin/zsh -lc 'rg -n "pooler" app/decodingOppression' in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift:27:        return try await modelContainer.perform { model, tokenizer, pooler in
app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift:37:            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
file update:
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Checking Swift package interface**

I'm looking into whether MLXEmbedders is a Swift package with a different API by inspecting its interface and locating its files, possibly via Package.resolved or SPM checkouts.
exec
/bin/zsh -lc 'rg -n "MLXEmbedders" -S .' in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 52ms:
Total output lines: 680

./__Avenue/harper/logs/session-2025-02-19-140000.md:7:2. **Comment 2**: MLX Swift package was referenced in the project but not linked to the app target. Request: add package `https://github.com/ml-explore/mlx-swift-lm` with rule "Up to Next Minor from 2.29.1" (already present), and in the `decodingOppression` target add the MLX products (e.g. `MLXLLM`, `MLXEmbedders`, `MLXLMCommon`) to Frameworks & Libraries so they link; commit the generated `Package.resolved` (user action).
./__Avenue/harper/logs/session-2025-02-19-140000.md:21:     - Added a `PBXBuildFile` section with three entries: `MLXLLM`, `MLXEmbedders`, `MLXLMCommon` in Frameworks.
./__Avenue/harper/logs/session-2025-02-19-140000.md:22:     - Added an `XCSwiftPackageProductDependency` section with three product dependencies referencing the existing package, with `productName` set to `MLXLLM`, `MLXEmbedders`, and `MLXLMCommon`.
./Artifacts/build_20260222_135147/logs/prompt_attempt_5.txt:83:- \`private var embedder: (any EmbedderModel)?\` — from \`MLXEmbedders\`
./Artifacts/build_20260222_135147/logs/prompt_attempt_5.txt:86:- Call \`MLXEmbedders.loadEmbedder(configuration: .init(id: \"mlx-community/bge-small-en-v1.5\"))\` (the \`MLXEmbedders\` API in \`mlx-swift-lm\` ≥ 2.29.x). Store the result in \`embedder\`.
./__Avenue/harper/logs/session-2025-02-19-000000.md:7:1. Add mlx-swift-lm SPM dependency and link MLXLLM, MLXEmbedders, MLXLMCommon to the app target.
./__Avenue/harper/logs/session-2025-02-19-000000.md:16:1. **SPM**: The project already had the mlx-swift-lm package reference (URL, version 2.29.1 up to next minor). The app target’s `packageProductDependencies` was empty. I added the three product dependencies (MLXLLM, MLXEmbedders, MLXLMCommon) to the decodingOppression target in `project.pbxproj`.
./Artifacts/build_20260222_135147/logs/platform_results/build.log:51:        ➜ Explicit dependency on target 'MLXEmbedders' in project 'mlx-swift-lm'
./Artifacts/build_20260222_135147/logs/platform_results/build.log:61:    Target 'MLXEmbedders' in project 'mlx-swift-lm'
./Artifacts/build_20260222_135147/logs/platform_results/build.log:62:        ➜ Explicit dependency on target 'MLXEmbedders' in project 'mlx-swift-lm'
./Artifacts/build_20260222_135147/logs/platform_results/build.log:71:    Target 'MLXEmbedders' in project 'mlx-swift-lm'
./Artifacts/build_20260222_135147/logs/platform_results/build.log:330:    /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang -Xlinker -reproducible -target arm64-apple-ios26.2-simulator -dynamiclib -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator26.2.sdk -O0 -L/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/EagerLinkingTBDs/Debug-iphonesimulator -L/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Products/Debug-iphonesimulator -F/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/EagerLinkingTBDs/Debug-iphonesimulator -F/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Products/Debug-iphonesimulator/PackageFrameworks -F/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Products/Debug-iphonesimulator/PackageFrameworks -F/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Products/Debug-iphonesimulator/PackageFrameworks -F/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Products/Debug-iphonesimulator/PackageFrameworks -F/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Products/Debug-iphonesimulator/PackageFrameworks -F/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Products/Debug-iphonesimulator/PackageFrameworks -F/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Products/Debug-iphonesimulator/PackageFrameworks -F/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Products/Debug-iphonesimulator/PackageFrameworks -F/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Products/Debug-iphonesimulator/PackageFrameworks -F/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Products/Debug-iphonesimulator/PackageFrameworks -F/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Products/Debug-iphonesimulator/PackageFrameworks -F/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Products/Debug-iphonesimulator/PackageFrameworks -F/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Products/Debug-iphonesimulator/PackageFrameworks -F/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Products/Debug-iphonesimulator/PackageFrameworks -F/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Products/Debug-iphonesimulator/PackageFrameworks -F/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Products/Debug-iphonesimulator/PackageFrameworks -F/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Products/Debug-iphonesimulator/PackageFrameworks -F/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Products/Debug-iphonesimulator/PackageFrameworks -F/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Products/Debug-iphonesimulator/PackageFrameworks -F/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Products/Debug-iphonesimulator/PackageFrameworks -F/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Products/Debug-iphonesimulator/PackageFrameworks -F/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Products/Debug-iphonesimulator -filelist /Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/decodingOppression.build/Debug-iphonesimulator/decodingOppression.build/Objects-normal/arm64/decodingOppression.LinkFileList -install_name @rpath/decodingOppression.debug.dylib -Xlinker -rpath -Xlinker /Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Products/Debug-iphonesimulator/PackageFrameworks -Xlinker -rpath -Xlinker @executable_path/Frameworks -dead_strip -Xlinker -object_path_lto -Xlinker /Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/decodingOppression.build/Debug-iphonesimulator/decodingOppression.build/Objects-normal/arm64/decodingOppression_lto.o -rdynamic -Xlinker -no_deduplicate -Xlinker -objc_abi_version -Xlinker 2 -Xlinker -debug_variant -Xlinker -dependency_info -Xlinker /Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/decodingOppression.build/Debug-iphonesimulator/decodingOppression.build/Objects-normal/arm64/decodingOppression_dependency_info.dat -fobjc-link-runtime -fprofile-instr-generate -L/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib/swift/iphonesimulator -L/usr/lib/swift -Xlinker -add_ast_path -Xlinker /Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/decodingOppression.build/Debug-iphonesimulator/decodingOppression.build/Objects-normal/arm64/decodingOppression.swiftmodule @/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/decodingOppression.build/Debug-iphonesimulator/decodingOppression.build/Objects-normal/arm64/decodingOppression-linker-args.resp -Wl,-no_warn_duplicate_libraries -Wl,-no_warn_duplicate_libraries -Wl,-no_warn_duplicate_libraries -Wl,-no_warn_duplicate_libraries -Wl,-no_warn_duplicate_libraries -Wl,-no_warn_duplicate_libraries -Wl,-no_warn_duplicate_libraries -Wl,-no_warn_duplicate_libraries -Wl,-no_warn_duplicate_libraries -Wl,-no_warn_duplicate_libraries -Wl,-no_warn_duplicate_libraries -lc++ -Wl,-no_warn_duplicate_libraries -Wl,-no_warn_duplicate_libraries -Wl,-no_warn_duplicate_libraries -Wl,-no_warn_duplicate_libraries -Wl,-no_warn_duplicate_libraries -Wl,-no_warn_duplicate_libraries -Wl,-no_warn_duplicate_libraries -Wl,-no_warn_duplicate_libraries -Wl,-no_warn_duplicate_libraries -Wl,-no_warn_duplicate_libraries -framework Foundation -framework Metal -framework Accelerate -Xlinker -alias -Xlinker _main -Xlinker ___debug_main_executable_dylib_entry_point -Xlinker -no_adhoc_codesign -o /Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Products/Debug-iphonesimulator/decodingOppression.app/decodingOppression.debug.dylib -Xlinker -add_ast_path -Xlinker /Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/mlx-swift-lm.build/Debug-iphonesimulator/MLXLLM.build/Objects-normal/arm64/MLXLLM.swiftmodule @/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/mlx-swift-lm.build/Debug-iphonesimulator/MLXLLM.build/Objects-normal/arm64/MLXLLM-linker-args.resp -Xlinker -add_ast_path -Xlinker /Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/mlx-swift.build/Debug-iphonesimulator/MLX.build/Objects-normal/arm64/MLX.swiftmodule @/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/mlx-swift.build/Debug-iphonesimulator/MLX.build/Objects-normal/arm64/MLX-linker-args.resp -Xlinker -add_ast_path -Xlinker /Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/swift-numerics.build/Debug-iphonesimulator/Numerics.build/Objects-normal/arm64/Numerics.swiftmodule @/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/swift-numerics.build/Debug-iphonesimulator/Numerics.build/Objects-normal/arm64/Numerics-linker-args.resp -Xlinker -add_ast_path -Xlinker /Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/swift-numerics.build/Debug-iphonesimulator/RealModule.build/Objects-normal/arm64/RealModule.swiftmodule @/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/swift-numerics.build/Debug-iphonesimulator/RealModule.build/Objects-normal/arm64/RealModule-linker-args.resp -Xlinker -add_ast_path -Xlinker /Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/swift-numerics.build/Debug-iphonesimulator/ComplexModule.build/Objects-normal/arm64/ComplexModule.swiftmodule @/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/swift-numerics.build/Debug-iphonesimulator/ComplexModule.build/Objects-normal/arm64/ComplexModule-linker-args.resp -Xlinker -add_ast_path -Xlinker /Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/mlx-swift.build/Debug-iphonesimulator/MLXNN.build/Objects-normal/arm64/MLXNN.swiftmodule @/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/mlx-swift.build/Debug-iphonesimulator/MLXNN.build/Objects-normal/arm64/MLXNN-linker-args.resp -Xlinker -add_ast_path -Xlinker /Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/mlx-swift.build/Debug-iphonesimulator/MLXRandom.build/Objects-normal/arm64/MLXRandom.swiftmodule @/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/mlx-swift.build/Debug-iphonesimulator/MLXRandom.build/Objects-normal/arm64/MLXRandom-linker-args.resp -Xlinker -add_ast_path -Xlinker /Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/mlx-swift.build/Debug-iphonesimulator/MLXFast.build/Objects-normal/arm64/MLXFast.swiftmodule @/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/mlx-swift.build/Debug-iphonesimulator/MLXFast.build/Objects-normal/arm64/MLXFast-linker-args.resp -Xlinker -add_ast_path -Xlinker /Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/mlx-swift.build/Debug-iphonesimulator/MLXOptimizers.build/Objects-normal/arm64/MLXOptimizers.swiftmodule @/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/mlx-swift.build/Debug-iphonesimulator/MLXOptimizers.build/Objects-normal/arm64/MLXOptimizers-linker-args.resp -Xlinker -add_ast_path -Xlinker /Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/mlx-swift.build/Debug-iphonesimulator/MLXLinalg.build/Objects-normal/arm64/MLXLinalg.swiftmodule @/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/mlx-swift.build/Debug-iphonesimulator/MLXLinalg.build/Objects-normal/arm64/MLXLinalg-linker-args.resp -Xlinker -add_ast_path -Xlinker /Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/swift-transformers.build/Debug-iphonesimulator/Tokenizers.build/Objects-normal/arm64/Tokenizers.swiftmodule @/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/swift-transformers.build/Debug-iphonesimulator/Tokenizers.build/Objects-normal/arm64/Tokenizers-linker-args.resp -Xlinker -add_ast_path -Xlinker /Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/swift-transformers.build/Debug-iphonesimulator/Generation.build/Objects-normal/arm64/Generation.swiftmodule @/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/swift-transformers.build/Debug-iphonesimulator/Generation.build/Objects-normal/arm64/Generation-linker-args.resp -Xlinker -add_ast_path -Xlinker /Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/swift-transformers.build/Debug-iphonesimulator/Models.build/Objects-normal/arm64/Models.swiftmodule @/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/swift-transformers.build/Debug-iphonesimulator/Models.build/Objects-normal/arm64/Models-linker-args.resp -Xlinker -add_ast_path -Xlinker /Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/Jinja.build/Debug-iphonesimulator/Jinja.build/Objects-normal/arm64/Jinja.swiftmodule @/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/Jinja.build/Debug-iphonesimulator/Jinja.build/Objects-normal/arm64/Jinja-linker-args.resp -Xlinker -add_ast_path -Xlinker /Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/swift-collections.build/Debug-iphonesimulator/OrderedCollections.build/Objects-normal/arm64/OrderedCollections.swiftmodule @/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/swift-collections.build/Debug-iphonesimulator/OrderedCollections.build/Objects-normal/arm64/OrderedCollections-linker-args.resp -Xlinker -add_ast_path -Xlinker /Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/swift-collections.build/Debug-iphonesimulator/InternalCollectionsUtilities.build/Objects-normal/arm64/InternalCollectionsUtilities.swiftmodule @/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/swift-collections.build/Debug-iphonesimulator/InternalCollectionsUtilities.build/Objects-normal/arm64/InternalCollectionsUtilities-linker-args.resp -Xlinker -add_ast_path -Xlinker /Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/swift-transformers.build/Debug-iphonesimulator/Hub.build/Objects-normal/arm64/Hub.swiftmodule @/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/swift-transformers.build/Debug-iphonesimulator/Hub.build/Objects-normal/arm64/Hub-linker-args.resp -Xlinker -add_ast_path -Xlinker /Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/mlx-swift-lm.build/Debug-iphonesimulator/MLXLMCommon.build/Objects-normal/arm64/MLXLMCommon.swiftmodule @/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/mlx-swift-lm.build/Debug-iphonesimulator/MLXLMCommon.build/Objects-normal/arm64/MLXLMCommon-linker-args.resp -Xlinker -add_ast_path -Xlinker /Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/mlx-swift-lm.build/Debug-iphonesimulator/MLXEmbedders.build/Objects-normal/arm64/MLXEmbedders.swiftmodule @/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Build/Intermediates.noindex/mlx-swift-lm.build/Debug-iphonesimulator/MLXEmbedders.build/Objects-normal/arm64/MLXEmbedders-linker-args.resp
./Artifacts/build_20260222_135147/logs/prompt_attempt_1.txt:92:- \`private var embedder: (any EmbedderModel)?\` — from \`MLXEmbedders\`
./Artifacts/build_20260222_135147/logs/prompt_attempt_1.txt:95:- Call \`MLXEmbedders.loadEmbedder(configuration: .init(id: \"mlx-community/bge-small-en-v1.5\"))\` (the \`MLXEmbedders\` API in \`mlx-swift-lm\` ≥ 2.29.x). Store the result in \`embedder\`.
./__Avenue/harper/logs/session-2025-02-19-120000.md:9:1. **SPM**: Added `mlx-swift-lm` (https://github.com/ml-explore/mlx-swift-lm, up to next minor from 2.29.1) to `project.pbxproj`: XCRemoteSwiftPackageReference, packageReferences on the project, XCSwiftPackageProductDependency for MLXLLM, MLXEmbedders, MLXLMCommon, and packageProductDependencies on the decodingOppression target.
./Artifacts/build_20260222_135147/logs/prompt_attempt_2.txt:83:- \`private var embedder: (any Embedder…68073 tokens truncated…       ➜ Explicit dependency on target 'MLXEmbedders' in project 'mlx-swift-lm'
./Artifacts/build_20260222_224434/logs/buildlint_attempt_1.log:59:    Target 'MLXEmbedders' in project 'mlx-swift-lm'
./Artifacts/build_20260222_224434/logs/buildlint_attempt_1.log:60:        ➜ Explicit dependency on target 'MLXEmbedders' in project 'mlx-swift-lm'
file update:
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Locating MLXEmbedders API source**

I'm targeting the mlx-swift-lm package source in DerivedData to inspect the MLXEmbedders API, focusing on implementations around `loadEmbedder` for better insight.
exec
/bin/zsh -lc "find ~/Library/Developer/Xcode/DerivedData -path '*mlx-swift-lm*' -maxdepth 6 -type d | head -n 5" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 367ms:
/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Index.noindex/Build/Intermediates.noindex/mlx-swift-lm.build
/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/Index.noindex/Build/Intermediates.noindex/mlx-swift-lm.build/Debug-iphoneos
/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/SourcePackages/checkouts/mlx-swift-lm
/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/SourcePackages/checkouts/mlx-swift-lm/Tests
/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/SourcePackages/checkouts/mlx-swift-lm/Tests/MLXLMTests
file update:
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Identifying embedder API**
exec
/bin/zsh -lc 'rg -n "Embedder|loadEmbedder|pooler" ~/Library/Developer/Xcode/DerivedData/decodingOppression-*/SourcePackages/checkouts/mlx-swift-lm -g "*.swift" | head -n 40' in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 52ms:
/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/SourcePackages/checkouts/mlx-swift-lm/Package.swift:20:            name: "MLXEmbedders",
/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/SourcePackages/checkouts/mlx-swift-lm/Package.swift:21:            targets: ["MLXEmbedders"]),
/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/SourcePackages/checkouts/mlx-swift-lm/Package.swift:108:            name: "MLXEmbedders",
/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/SourcePackages/checkouts/mlx-swift-lm/Package.swift:117:            path: "Libraries/Embedders",
/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/SourcePackages/checkouts/mlx-swift-lm/Libraries/Embedders/Configuration.swift:69:            let model = NomicBertModel(configuration, pooler: false)
/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/SourcePackages/checkouts/mlx-swift-lm/Libraries/Embedders/Configuration.swift:94:            throw EmbedderError(message: "Unsupported model type.")
/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/SourcePackages/checkouts/mlx-swift-lm/Libraries/Embedders/Tokenizer.swift:48:        throw EmbedderError(message: "missing config")
/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/SourcePackages/checkouts/mlx-swift-lm/Libraries/Embedders/Load.swift:9:struct EmbedderError: Error {
/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/SourcePackages/checkouts/mlx-swift-lm/Libraries/Embedders/Bert.swift:114:    let pooler: Linear?
/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/SourcePackages/checkouts/mlx-swift-lm/Libraries/Embedders/Bert.swift:128:            self.pooler = nil
/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/SourcePackages/checkouts/mlx-swift-lm/Libraries/Embedders/Bert.swift:130:            pooler = Linear(config.embedDim, config.embedDim)
/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/SourcePackages/checkouts/mlx-swift-lm/Libraries/Embedders/Bert.swift:158:                hiddenStates: outputs, pooledOutput: tanh(pooler!(outputs[0..., 0])))
/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/SourcePackages/checkouts/mlx-swift-lm/Libraries/Embedders/Bert.swift:175:            key = key.replacingOccurrences(of: "pooler.dense.", with: "pooler.")
/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/SourcePackages/checkouts/mlx-swift-lm/Libraries/Embedders/EmbeddingModel.swift:35:    let pooler: Pooling
/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/SourcePackages/checkouts/mlx-swift-lm/Libraries/Embedders/EmbeddingModel.swift:38:        model: EmbeddingModel, tokenizer: Tokenizer, pooler: Pooling = Pooling(strategy: .none)
/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/SourcePackages/checkouts/mlx-swift-lm/Libraries/Embedders/EmbeddingModel.swift:42:        self.pooler = pooler
/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/SourcePackages/checkouts/mlx-swift-lm/Libraries/Embedders/EmbeddingModel.swift:55:        self.pooler = loadPooling(modelDirectory: modelDirectory)  //?? Pooling(strategy: .none)
/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/SourcePackages/checkouts/mlx-swift-lm/Libraries/Embedders/EmbeddingModel.swift:64:        try action(model, tokenizer, pooler)
/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/SourcePackages/checkouts/mlx-swift-lm/Libraries/Embedders/NomicBert.swift:325:    let pooler: Linear?
/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/SourcePackages/checkouts/mlx-swift-lm/Libraries/Embedders/NomicBert.swift:330:        _ config: NomicBertConfiguration, pooler: Bool = true,
file update:
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Inspecting embedding model pooler API**
exec
/bin/zsh -lc "sed -n '1,120p' ~/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/SourcePackages/checkouts/mlx-swift-lm/Libraries/Embedders/EmbeddingModel.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 51ms:
// Copyright © 2024 Apple Inc.

import Foundation
@preconcurrency import Hub
import MLX
import MLXNN
import Tokenizers

/// Container for models that guarantees single threaded access.
///
/// Wrap models used by e.g. the UI in a ModelContainer. Callers can access
/// the model and/or tokenizer:
///
/// ```swift
/// let promptTokens = await modelContainer.perform { _, tokenizer in
///     tokenizer.encode(text: prompt)
/// }
/// ```
///
/// or:
file update:
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Reviewing pooling struct API**

I'm examining the Pooling struct within MLXEmbedders to understand its interface and usage.
exec
/bin/zsh -lc "sed -n '1,200p' ~/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/SourcePackages/checkouts/mlx-swift-lm/Libraries/Embedders/Pooling.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 52ms:
// Copyright © 2024 Apple Inc.

import Foundation
import MLX
import MLXLinalg
import MLXNN

public struct PoolingConfiguration: Codable {
    public let dimension: Int
    public let poolingModeClsToken: Bool
    public let poolingModeMeanTokens: Bool
    public let poolingModeMaxTokens: Bool
    public let poolingModeLastToken: Bool

    enum CodingKeys: String, CodingKey {
        case dimension = "word_embedding_dimension"
        case poolingModeClsToken = "pooling_mode_cls_token"
        case poolingModeMeanTokens = "pooling_mode_mean_tokens"
        case poolingModeMaxTokens = "pooling_mode_max_tokens"
        case poolingModeLastToken = "pooling_mode_lasttoken"
file update:
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Identifying eval() return type causes error**

The error occurs because `eval()` returns void, so assigning `let pooled = pooler(...).eval()` makes `pooled` equal to `()`. The fix is to separate calling `eval()` from assignment: assign first, then call `eval()` on the result.
exec
/bin/zsh -lc 'SDK_PATH=$(xcrun --sdk macosx26.2 --show-sdk-path)
rg -n "func eval" "$SDK_PATH/System/Library/Frameworks/MLX.framework" -g "*.swiftinterface" | head -n 20' in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
rg: /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/MLX.framework: IO error for operation on /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/MLX.framework: No such file or directory (os error 2)
file update:
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Locating MLX Swift interface**

MLX comes from an external package, likely found under SourcePackages/checkouts/mlx-swift in DerivedData, so I'll inspect that path to understand its Swift interface.
exec
/bin/zsh -lc 'rg -n "func eval" ~/Library/Developer/Xcode/DerivedData/decodingOppression-*/SourcePackages/checkouts/mlx-swift -g "*.swift" | head -n 20' in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/SourcePackages/checkouts/mlx-swift/Source/MLX/MLXArray.swift:556:    public func eval() {
/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/SourcePackages/checkouts/mlx-swift/Source/MLX/Transforms+Eval.swift:15:public func eval(_ arrays: MLXArray...) {
/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/SourcePackages/checkouts/mlx-swift/Source/MLX/Transforms+Eval.swift:27:public func eval(_ arrays: [MLXArray]) {
/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/SourcePackages/checkouts/mlx-swift/Source/MLX/Transforms+Eval.swift:69:public func eval(_ values: Any...) {
/Users/emmanuel/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/SourcePackages/checkouts/mlx-swift/Source/MLX/Transforms+Eval.swift:82:public func eval(_ values: [Any]) {
file update:
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Inspecting MLXArray eval method**
exec
/bin/zsh -lc "sed -n '540,580p' ~/Library/Developer/Xcode/DerivedData/decodingOppression-cxwoggwjsgwizbfojlfnncihejwm/SourcePackages/checkouts/mlx-swift/Source/MLX/MLXArray.swift" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 52ms:
    }

    /// Extract the imaginary part of a ``DType/complex64`` array.
    ///
    /// ### See Also
    /// - <doc:conversion>
    public func imaginaryPart(stream: StreamOrDevice = .default) -> MLXArray {
        precondition(dtype.isComplex)
        let i = MLXArray(real: 0, imaginary: 1)
        return (self / i).asType(.float32)
    }

    /// Evaluate the array.
    ///
    /// MLX is lazy and arrays are not fully realized until they are evaluated.  This method is typically
    /// not needed as all reads ensure the contents are evaluated.
    public func eval() {
        _ = evalLock.withLock {
            mlx_array_eval(ctx)
        }
file update:
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Adjusting eval usage and output handling**

Recognized that eval returns Void, so the code must not expect a return value. Planning to modify the embedding engine to call eval correctly on the pooler output and verify output shapes and mask handling for consistency before patching.
file update
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -36,3 +36,4 @@
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
apply_patch(auto_approved=true) exited 0 in 38ms:
Success. Updated the following files:
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
file update:
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..a515562b3141a526164dac352e66a7efbf9ac01a
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -34,7 +34,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }

file update:
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..a515562b3141a526164dac352e66a7efbf9ac01a
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -34,7 +34,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Rebuilding macOS project**
tool xcodebuildmcp.build_macos({})
xcodebuildmcp.build_macos({}) failed in 4.40s:
{
  "content": [
    {
      "type": "text",
      "text": "⚠️ Warning: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift:27:16: warning: no calls to throwing functions occur within 'try' expression"
    },
    {
      "type": "text",
      "text": "❌ Error: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift:29:35: error: property 'eosTokenId' is not available due to missing import of defining module 'Tokenizers'"
    },
    {
      "type": "text",
      "text": "❌ Error: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift:29:35: error: property 'eosTokenId' is not available due to missing import of defining module 'Tokenizers'"
    },
    {
      "type": "text",
      "text": "❌ Error: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift:28:36: error: instance method 'encode(text:addSpecialTokens:)' is not available due to missing import of defining module 'Tokenizers'"
    },
    {
      "type": "text",
file update:
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..a515562b3141a526164dac352e66a7efbf9ac01a
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -34,7 +34,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Adding missing Tokenizers import**

The Tokenizers module is missing and needs importing in MLXEmbeddingEngine; it's available via swift-transformers. Also confirming that `try` before modelContainer.perform isn't necessary since it doesn't throw. I'll add the import and clean up the unnecessary `try`.
file update
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -11,2 +11,3 @@
 import MLXEmbedders
+import Tokenizers
 #endif
apply_patch(auto_approved=true) exited 0 in 48ms:
Success. Updated the following files:
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
file update:
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..605b100014190562e7e6fad3ed8d6b683e2fb33a
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }

file update:
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..605b100014190562e7e6fad3ed8d6b683e2fb33a
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Rebuilding project**
tool xcodebuildmcp.build_macos({})
xcodebuildmcp.build_macos({}) failed in 4.23s:
{
  "content": [
    {
      "type": "text",
      "text": "❌ Error: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift:38:72: error: extra argument 'format' in call"
    },
    {
      "type": "text",
      "text": "❌ Error: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift:38:72: error: cannot infer contextual base in reference to member 'percent'"
    },
    {
      "type": "text",
      "text": "❌ [stderr] --- xcodebuild: WARNING: Using the first of multiple matching destinations:"
    },
    {
      "type": "text",
      "text": "❌ [stderr] { platform:macOS, arch:arm64, id:00006001-000448A43402801E, name:My Mac }"
    },
    {
      "type": "text",
file update:
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..605b100014190562e7e6fad3ed8d6b683e2fb33a
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Fixing percent format usage in summary**

The current use of `format: .percent` in string interpolation causes errors in Swift 6, so I'll replace it with `.formatted(.percent)` on the value to fix compatibility.
file update
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -37,3 +37,3 @@
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
apply_patch(auto_approved=true) exited 0 in 45ms:
Success. Updated the following files:
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
file update:
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..605b100014190562e7e6fad3ed8d6b683e2fb33a
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }

file update:
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..605b100014190562e7e6fad3ed8d6b683e2fb33a
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Rebuilding project**
tool xcodebuildmcp.build_macos({})
xcodebuildmcp.build_macos({}) failed in 4.39s:
{
  "content": [
    {
      "type": "text",
      "text": "❌ Error: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift:58:10: error: instance member 'accessibilityRotor' cannot be used on type 'View'"
    },
    {
      "type": "text",
      "text": "❌ Error: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift:58:10: error: type '()' cannot conform to 'AccessibilityRotorContent'"
    },
    {
      "type": "text",
      "text": "❌ [stderr] --- xcodebuild: WARNING: Using the first of multiple matching destinations:"
    },
    {
      "type": "text",
      "text": "❌ [stderr] { platform:macOS, arch:arm64, id:00006001-000448A43402801E, name:My Mac }"
    },
    {
      "type": "text",
file update:
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..605b100014190562e7e6fad3ed8d6b683e2fb33a
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }



thinking
**Identifying platform limitation for accessibilityRotor**

The accessibilityRotor modifier is unavailable on macOS, causing the error; it likely requires guarding with an OS check to apply it only on supported platforms like iOS.
thinking
**Verifying accessibilityRotor availability via SDK interface**

I'm checking SwiftUI's macOS SDK interface files to confirm if accessibilityRotor is declared, to determine proper conditional compilation based on platform support.
exec
/bin/zsh -lc 'SDK_PATH=$(xcrun --sdk macosx26.2 --show-sdk-path)
rg -n "accessibilityRotor" "$SDK_PATH/System/Library/Frameworks/SwiftUI.framework" -g "*.swiftinterface" | head -n 20' in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 52ms:
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/SwiftUI.framework/Versions/A/Modules/SwiftUI.swiftmodule/arm64e-apple-macos.swiftinterface:15474:  nonisolated public func accessibilityRotorEntry<ID>(id: ID, in namespace: SwiftUICore.Namespace.ID) -> some SwiftUICore.View where ID : Swift.Hashable
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/SwiftUI.framework/Versions/A/Modules/SwiftUI.swiftmodule/arm64e-apple-macos.swiftinterface:16408:  nonisolated public func accessibilityRotor<Content>(_ label: SwiftUICore.Text, @SwiftUI.AccessibilityRotorContentBuilder entries: @escaping () -> Content) -> some SwiftUICore.View where Content : SwiftUI.AccessibilityRotorContent
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/SwiftUI.framework/Versions/A/Modules/SwiftUI.swiftmodule/arm64e-apple-macos.swiftinterface:16410:  nonisolated public func accessibilityRotor<Content>(_ systemRotor: SwiftUI.AccessibilitySystemRotor, @SwiftUI.AccessibilityRotorContentBuilder entries: @escaping () -> Content) -> some SwiftUICore.View where Content : SwiftUI.AccessibilityRotorContent
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/SwiftUI.framework/Versions/A/Modules/SwiftUI.swiftmodule/arm64e-apple-macos.swiftinterface:16412:  nonisolated public func accessibilityRotor<EntryModel>(_ rotorLabel: SwiftUICore.Text, entries: [EntryModel], entryLabel: Swift.KeyPath<EntryModel, Swift.String>) -> some SwiftUICore.View where EntryModel : Swift.Identifiable
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/SwiftUI.framework/Versions/A/Modules/SwiftUI.swiftmodule/arm64e-apple-macos.swiftinterface:16414:  nonisolated public func accessibilityRotor<EntryModel, ID>(_ rotorLabel: SwiftUICore.Text, entries: [EntryModel], entryID: Swift.KeyPath<EntryModel, ID>, entryLabel: Swift.KeyPath<EntryModel, Swift.String>) -> some SwiftUICore.View where ID : Swift.Hashable
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/SwiftUI.framework/Versions/A/Modules/SwiftUI.swiftmodule/arm64e-apple-macos.swiftinterface:16416:  nonisolated public func accessibilityRotor<EntryModel>(_ systemRotor: SwiftUI.AccessibilitySystemRotor, entries: [EntryModel], entryLabel: Swift.KeyPath<EntryModel, Swift.String>) -> some SwiftUICore.View where EntryModel : Swift.Identifiable
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/SwiftUI.framework/Versions/A/Modules/SwiftUI.swiftmodule/arm64e-apple-macos.swiftinterface:16418:  nonisolated public func accessibilityRotor<EntryModel, ID>(_ systemRotor: SwiftUI.AccessibilitySystemRotor, entries: [EntryModel], entryID: Swift.KeyPath<EntryModel, ID>, entryLabel: Swift.KeyPath<EntryModel, Swift.String>) -> some SwiftUICore.View where ID : Swift.Hashable
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/SwiftUI.framework/Versions/A/Modules/SwiftUI.swiftmodule/arm64e-apple-macos.swiftinterface:16420:  nonisolated public func accessibilityRotor(_ label: SwiftUICore.Text, textRanges: [Swift.Range<Swift.String.Index>]) -> some SwiftUICore.View
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/SwiftUI.framework/Versions/A/Modules/SwiftUI.swiftmodule/arm64e-apple-macos.swiftinterface:16422:  nonisolated public func accessibilityRotor(_ systemRotor: SwiftUI.AccessibilitySystemRotor, textRanges: [Swift.Range<Swift.String.Index>]) -> some SwiftUICore.View
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/SwiftUI.framework/Versions/A/Modules/SwiftUI.swiftmodule/arm64e-apple-macos.swiftinterface:16427:  nonisolated public func accessibilityRotor<Content>(_ labelKey: SwiftUICore.LocalizedStringKey, @SwiftUI.AccessibilityRotorContentBuilder entries: @escaping () -> Content) -> some SwiftUICore.View where Content : SwiftUI.AccessibilityRotorContent
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/SwiftUI.framework/Versions/A/Modules/SwiftUI.swiftmodule/arm64e-apple-macos.swiftinterface:16430:  @_disfavoredOverload @_alwaysEmitIntoClient nonisolated public func accessibilityRotor<Content>(_ label: Foundation.LocalizedStringResource, @SwiftUI.AccessibilityRotorContentBuilder entries: @escaping () -> Content) -> some SwiftUICore.View where Content : SwiftUI.AccessibilityRotorContent {
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/SwiftUI.framework/Versions/A/Modules/SwiftUI.swiftmodule/arm64e-apple-macos.swiftinterface:16431:        accessibilityRotor(
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/SwiftUI.framework/Versions/A/Modules/SwiftUI.swiftmodule/arm64e-apple-macos.swiftinterface:16436:  @_disfavoredOverload nonisolated public func accessibilityRotor<L, Content>(_ label: L, @SwiftUI.AccessibilityRotorContentBuilder entries: @escaping () -> Content) -> some SwiftUICore.View where L : Swift.StringProtocol, Content : SwiftUI.AccessibilityRotorContent
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/SwiftUI.framework/Versions/A/Modules/SwiftUI.swiftmodule/arm64e-apple-macos.swiftinterface:16438:  nonisolated public func accessibilityRotor<EntryModel>(_ rotorLabelKey: SwiftUICore.LocalizedStringKey, entries: [EntryModel], entryLabel: Swift.KeyPath<EntryModel, Swift.String>) -> some SwiftUICore.View where EntryModel : Swift.Identifiable
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/SwiftUI.framework/Versions/A/Modules/SwiftUI.swiftmodule/arm64e-apple-macos.swiftinterface:16441:  @_disfavoredOverload @_alwaysEmitIntoClient nonisolated public func accessibilityRotor<EntryModel>(_ rotorLabelResource: Foundation.LocalizedStringResource, entries: [EntryModel], entryLabel: Swift.KeyPath<EntryModel, Swift.String>) -> some SwiftUICore.View where EntryModel : Swift.Identifiable {
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/SwiftUI.framework/Versions/A/Modules/SwiftUI.swiftmodule/arm64e-apple-macos.swiftinterface:16442:        accessibilityRotor(
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/SwiftUI.framework/Versions/A/Modules/SwiftUI.swiftmodule/arm64e-apple-macos.swiftinterface:16446:  @_disfavoredOverload nonisolated public func accessibilityRotor<L, EntryModel>(_ rotorLabel: L, entries: [EntryModel], entryLabel: Swift.KeyPath<EntryModel, Swift.String>) -> some SwiftUICore.View where L : Swift.StringProtocol, EntryModel : Swift.Identifiable
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/SwiftUI.framework/Versions/A/Modules/SwiftUI.swiftmodule/arm64e-apple-macos.swiftinterface:16448:  nonisolated public func accessibilityRotor<EntryModel, ID>(_ rotorLabelKey: SwiftUICore.LocalizedStringKey, entries: [EntryModel], entryID: Swift.KeyPath<EntryModel, ID>, entryLabel: Swift.KeyPath<EntryModel, Swift.String>) -> some SwiftUICore.View where ID : Swift.Hashable
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/SwiftUI.framework/Versions/A/Modules/SwiftUI.swiftmodule/arm64e-apple-macos.swiftinterface:16451:  @_disfavoredOverload @_alwaysEmitIntoClient nonisolated public func accessibilityRotor<EntryModel, ID>(_ rotorLabelResource: Foundation.LocalizedStringResource, entries: [EntryModel], entryID: Swift.KeyPath<EntryModel, ID>, entryLabel: Swift.KeyPath<EntryModel, Swift.String>) -> some SwiftUICore.View where ID : Swift.Hashable {
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/SwiftUI.framework/Versions/A/Modules/SwiftUI.swiftmodule/arm64e-apple-macos.swiftinterface:16452:        accessibilityRotor(
file update:
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..605b100014190562e7e6fad3ed8d6b683e2fb33a
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }



thinking
**Diagnosing static context error**

The error likely stems from calling `.accessibilityRotor` on the `View` type itself rather than an instance, possibly caused by scoping or conditional compilation around `#if os(macOS)` in the view's body leading to confusion between instance and type contexts. I'll inspect the view code near line 58 to pinpoint misuse or misplaced conditional compilation affecting the instance call.
thinking
**Confirming modifier scope issue**

The `.accessibilityRotor` modifier is likely misapplied outside the conditional view expression, causing the compiler to treat it as called on the `View` type rather than an instance; I'll inspect the ScoreCardView code around lines 40–80 to verify how the `#if os(macOS)` branches and modifiers are structured.
exec
/bin/zsh -lc "nl -ba app/decodingOppression/decodingOppression/Views/ScoreCardView.swift | sed -n '40,90p'" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
    40	            detailPanel
    41	                .frame(minWidth: 320)
    42	        }
    43	        .toolbar { exportToolbar }
    44	        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
    45	            ExportView(analysis: viewModel.analysis)
    46	                .frame(width: 360)
    47	        }
    48	        #else
    49	        ScrollView {
    50	            scoreCardContent
    51	                .padding(24)
    52	        }
    53	        .toolbar { exportToolbar }
    54	        .sheet(isPresented: $viewModel.isShowingExport) {
    55	            ExportView(analysis: viewModel.analysis)
    56	        }
    57	        #endif
    58	        .accessibilityRotor("Scores") {
    59	            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
file update:
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..605b100014190562e7e6fad3ed8d6b683e2fb33a
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }



thinking
**Analyzing accessibilityRotor error cause**

The error likely arises because `.accessibilityRotor` is being interpreted as a static method on `View` due to how the conditional compilation branches affect the expression, not because of availability or imports.
thinking
**Refactoring to wrap conditional View for accessibilityRotor**

Plan to wrap the `#if/#else` content inside a `Group` assigned to a local `content` variable in the body, then apply `.accessibilityRotor` on `content` to ensure the compiler treats it as an instance expression and resolves the method correctly.
file update
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -33,4 +33,18 @@
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
@@ -39,51 +53,41 @@
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
apply_patch(auto_approved=true) exited 0 in 53ms:
Success. Updated the following files:
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
file update:
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..605b100014190562e7e6fad3ed8d6b683e2fb33a
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }

file update:
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..605b100014190562e7e6fad3ed8d6b683e2fb33a
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Triggering rebuild**
tool xcodebuildmcp.build_macos({})
xcodebuildmcp.build_macos({}) failed in 4.17s:
{
  "content": [
    {
      "type": "text",
      "text": "❌ Error: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift:46:48: error: actor-isolated instance method 'analyze(pdfURL:)' cannot be called from outside of the actor"
    },
    {
      "type": "text",
      "text": "❌ [stderr] --- xcodebuild: WARNING: Using the first of multiple matching destinations:"
    },
    {
      "type": "text",
      "text": "❌ [stderr] { platform:macOS, arch:arm64, id:00006001-000448A43402801E, name:My Mac }"
    },
    {
      "type": "text",
      "text": "❌ [stderr] { platform:macOS, arch:x86_64, id:00006001-000448A43402801E, name:My Mac }"
    },
    {
      "type": "text",
file update:
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..605b100014190562e7e6fad3ed8d6b683e2fb33a
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Resolving actor-isolation call in AnalysisViewModel**

Noticed the actor method must be called with `await` before using `for await`; planning to first `await` the actor call to get the AsyncStream, then iterate over it separately to fix the isolation error.
file update
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -45,3 +45,4 @@
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
apply_patch(auto_approved=true) exited 0 in 55ms:
Success. Updated the following files:
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
file update:
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..605b100014190562e7e6fad3ed8d6b683e2fb33a
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }

file update:
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..605b100014190562e7e6fad3ed8d6b683e2fb33a
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Rebuilding project**
tool xcodebuildmcp.build_macos({})
xcodebuildmcp.build_macos({}) failed in 4.19s:
{
  "content": [
    {
      "type": "text",
      "text": "❌ Error: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift:39:84: error: no exact matches in reference to static property 'percent'"
    },
    {
      "type": "text",
      "text": "❌ Error: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift:21:46: error: call to main actor-isolated initializer 'init()' in a synchronous nonisolated context"
    },
    {
      "type": "text",
      "text": "⚠️ Warning: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift:28:16: warning: no calls to throwing functions occur within 'try' expression"
    },
    {
      "type": "text",
      "text": "❌ [stderr] --- xcodebuild: WARNING: Using the first of multiple matching destinations:"
    },
    {
      "type": "text",
file update:
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..605b100014190562e7e6fad3ed8d6b683e2fb33a
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }



thinking
**Diagnosing formatting error with .percent**

The formatting error stems from using `.percent` as a static property on `FloatingPointFormatStyle<Double>`, which doesn’t exist; replacing the parameter type with `Double.FormatStyle` or adjusting the default to use `Double.FormatStyle.percent` should fix the mismatch.
thinking
**Fixing main actor init errors by removing default args**

The PolicyHistoryView error stems from default-parameter initialization of a `@MainActor` view model in a nonisolated context; removing the default argument and requiring callers to provide the view model (constructed on main actor) should resolve this. Also switching the `format` parameter to use `Double.FormatStyle` with `.percent` fixes the formatting issue in EliteInterestDetailView.
file update
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -36,5 +36,5 @@
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let format: Double.FormatStyle
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, format: Double.FormatStyle = .percent.precision(.fractionLength(0))) {
         self.title = title
apply_patch(auto_approved=true) exited 0 in 86ms:
Success. Updated the following files:
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
file update:
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..605b100014190562e7e6fad3ed8d6b683e2fb33a
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..fb2f6841b81ce9c71a87b44d54cc7c73729c5878
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -34,9 +34,9 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let format: Double.FormatStyle
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, format: Double.FormatStyle = .percent.precision(.fractionLength(0))) {
         self.title = title
         self.value = value
         self.format = format
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }

file update:
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..605b100014190562e7e6fad3ed8d6b683e2fb33a
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..fb2f6841b81ce9c71a87b44d54cc7c73729c5878
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -34,9 +34,9 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let format: Double.FormatStyle
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, format: Double.FormatStyle = .percent.precision(.fractionLength(0))) {
         self.title = title
         self.value = value
         self.format = format
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Refactoring state initialization with injected viewModel**

I'm removing the default initializer for the state-held viewModel in PolicyHistoryView to require explicit injection, updating call sites like ContentView and previews to pass a new PolicyHistoryViewModel instance accordingly.
exec
/bin/zsh -lc "rg -n \"PolicyHistoryView\\(\" app/decodingOppression/decodingOppression" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
app/decodingOppression/decodingOppression/ContentView.swift:22:                PolicyHistoryView()
app/decodingOppression/decodingOppression/ContentView.swift:38:                    PolicyHistoryView(viewModel: historyViewModel)
app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift:186:        PolicyHistoryView()
file update:
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..605b100014190562e7e6fad3ed8d6b683e2fb33a
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..fb2f6841b81ce9c71a87b44d54cc7c73729c5878
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -34,9 +34,9 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let format: Double.FormatStyle
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, format: Double.FormatStyle = .percent.precision(.fractionLength(0))) {
         self.title = title
         self.value = value
         self.format = format
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Patching views for updates**
file update
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -20,3 +20,3 @@
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
@@ -185,3 +185,3 @@
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
apply_patch(auto_approved=true) exited 0 in 72ms:
Success. Updated the following files:
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
file update:
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..605b100014190562e7e6fad3ed8d6b683e2fb33a
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..fb2f6841b81ce9c71a87b44d54cc7c73729c5878
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -34,9 +34,9 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let format: Double.FormatStyle
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, format: Double.FormatStyle = .percent.precision(.fractionLength(0))) {
         self.title = title
         self.value = value
         self.format = format
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..f1b0d0130ed2457518c2235a109f86be292992f4
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -183,7 +183,7 @@
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }

file update:
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..605b100014190562e7e6fad3ed8d6b683e2fb33a
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..fb2f6841b81ce9c71a87b44d54cc7c73729c5878
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -34,9 +34,9 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let format: Double.FormatStyle
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, format: Double.FormatStyle = .percent.precision(.fractionLength(0))) {
         self.title = title
         self.value = value
         self.format = format
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..f1b0d0130ed2457518c2235a109f86be292992f4
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -183,7 +183,7 @@
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Updating iOS ContentView path**
file update
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/ContentView.swift
@@ -21,3 +21,3 @@
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
apply_patch(auto_approved=true) exited 0 in 74ms:
Success. Updated the following files:
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/ContentView.swift
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..605b100014190562e7e6fad3ed8d6b683e2fb33a
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..fb2f6841b81ce9c71a87b44d54cc7c73729c5878
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -34,9 +34,9 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let format: Double.FormatStyle
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, format: Double.FormatStyle = .percent.precision(.fractionLength(0))) {
         self.title = title
         self.value = value
         self.format = format
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..f1b0d0130ed2457518c2235a109f86be292992f4
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -183,7 +183,7 @@
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }

file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..605b100014190562e7e6fad3ed8d6b683e2fb33a
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..fb2f6841b81ce9c71a87b44d54cc7c73729c5878
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -34,9 +34,9 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let format: Double.FormatStyle
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, format: Double.FormatStyle = .percent.precision(.fractionLength(0))) {
         self.title = title
         self.value = value
         self.format = format
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..f1b0d0130ed2457518c2235a109f86be292992f4
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -183,7 +183,7 @@
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Removing unnecessary try to fix warning**

I'm removing `try` from the `modelContainer.perform` call since the closure doesn't throw, which resolves the MLXEmbeddingEngine warning.
file update
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -27,3 +27,3 @@
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
apply_patch(auto_approved=true) exited 0 in 81ms:
Success. Updated the following files:
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..fb2f6841b81ce9c71a87b44d54cc7c73729c5878
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -34,9 +34,9 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let format: Double.FormatStyle
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, format: Double.FormatStyle = .percent.precision(.fractionLength(0))) {
         self.title = title
         self.value = value
         self.format = format
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..f1b0d0130ed2457518c2235a109f86be292992f4
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -183,7 +183,7 @@
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }

file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..fb2f6841b81ce9c71a87b44d54cc7c73729c5878
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -34,9 +34,9 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let format: Double.FormatStyle
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, format: Double.FormatStyle = .percent.precision(.fractionLength(0))) {
         self.title = title
         self.value = value
         self.format = format
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..f1b0d0130ed2457518c2235a109f86be292992f4
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -183,7 +183,7 @@
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Triggering rebuild**
tool xcodebuildmcp.build_macos({})
xcodebuildmcp.build_macos({}) failed in 4.46s:
{
  "content": [
    {
      "type": "text",
      "text": "⚠️ Warning: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Models/AnalyzedClause.swift:30:33: warning: main actor-isolated conformance of 'ArchitectureScores' to 'Decodable' cannot be used in nonisolated context; this is an error in the Swift 6 language mode"
    },
    {
      "type": "text",
      "text": "⚠️ Warning: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Models/AnalyzedClause.swift:34:58: warning: main actor-isolated conformance of 'ArchitectureScores' to 'Encodable' cannot be used in nonisolated context; this is an error in the Swift 6 language mode"
    },
    {
      "type": "text",
      "text": "⚠️ Warning: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Models/AnalyzedClause.swift:59:59: warning: main actor-isolated conformance of 'ArchitectureScores' to 'Encodable' cannot be used in nonisolated context; this is an error in the Swift 6 language mode"
    },
    {
      "type": "text",
      "text": "❌ Error: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift:37:24: error: 'FormatStyle' is not a member type of struct 'Swift.Double'"
    },
    {
      "type": "text",
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..fb2f6841b81ce9c71a87b44d54cc7c73729c5878
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -34,9 +34,9 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let format: Double.FormatStyle
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, format: Double.FormatStyle = .percent.precision(.fractionLength(0))) {
         self.title = title
         self.value = value
         self.format = format
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..f1b0d0130ed2457518c2235a109f86be292992f4
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -183,7 +183,7 @@
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }



thinking
**Refactoring formatting to use closure**

Deciding to replace the format type property with a formatter closure in MetricRow to avoid Swift SDK compatibility issues with `Double.FormatStyle`, simplifying formatting by passing a `(Double) -> String` closure instead.
thinking
**Noting main actor isolation warnings**

Observed warnings about ArchitectureScores’ Decodable conformance being main actor-isolated in AnalyzedClause, likely due to `@Model` or module-level attributes; these cause errors in Swift 6 mode but can be ignored for now since the build fails on errors first.
file update
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -36,8 +36,10 @@
     let value: Double
-    let format: Double.FormatStyle
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: Double.FormatStyle = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
@@ -49,3 +51,3 @@
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
apply_patch(auto_approved=true) exited 0 in 88ms:
Success. Updated the following files:
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..705454a7cd99477f0a086ea976823c9a7bd960b9
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -34,12 +34,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +49,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..f1b0d0130ed2457518c2235a109f86be292992f4
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -183,7 +183,7 @@
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }

file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..705454a7cd99477f0a086ea976823c9a7bd960b9
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -34,12 +34,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +49,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..f1b0d0130ed2457518c2235a109f86be292992f4
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -183,7 +183,7 @@
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Renaming format to formatter call site**

The average confidence MetricRow call in EliteInterestDetailView requires updating from `format:` to `formatter:` with a closure to match the new API.
file update
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -26,3 +26,7 @@
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
apply_patch(auto_approved=true) exited 0 in 75ms:
Success. Updated the following files:
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..f1b0d0130ed2457518c2235a109f86be292992f4
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -183,7 +183,7 @@
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }

file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..f1b0d0130ed2457518c2235a109f86be292992f4
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -183,7 +183,7 @@
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Rebuilding project**
tool xcodebuildmcp.build_macos({})
xcodebuildmcp.build_macos({}) failed in 8.29s:
{
  "content": [
    {
      "type": "text",
      "text": "❌ Error: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/ClauseListView.swift:47:17: error: no exact matches in call to initializer "
    },
    {
      "type": "text",
      "text": "❌ Error: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/ClauseListView.swift:20:13: error: static method 'buildExpression' requires that 'Section' conform to 'View'"
    },
    {
      "type": "text",
      "text": "❌ Error: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/ClauseListView.swift:20:43: error: extra trailing closure passed in call"
    },
    {
      "type": "text",
      "text": "❌ Error: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/ClauseListView.swift:20:21: error: argument type 'String' does not conform to expected type 'Decoder'"
    },
    {
      "type": "text",
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..f1b0d0130ed2457518c2235a109f86be292992f4
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -183,7 +183,7 @@
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Resolving Section name conflict**

Discovered that the local `Section` model shadows SwiftUI's `Section`, causing compile errors in ClauseListView; deciding to prefix SwiftUI's `Section` explicitly there to fix the conflict. Also identified that `navigationDestination(item:)` now requires `Hashable`, so planning to make `PDFSelection` conform to `Hashable` next.
file update
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -19,3 +19,3 @@
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
@@ -31,3 +31,3 @@
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
apply_patch(auto_approved=true) exited 0 in 80ms:
Success. Updated the following files:
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..6931b31fdabebb998ac4bde96036e10aad403866
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..f1b0d0130ed2457518c2235a109f86be292992f4
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -183,7 +183,7 @@
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }

file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..6931b31fdabebb998ac4bde96036e10aad403866
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..f1b0d0130ed2457518c2235a109f86be292992f4
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -183,7 +183,7 @@
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Making PDF selection hashable**

Updated the PDFSelection struct in PolicyHistoryView to conform to Hashable.
file update
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -178,3 +178,3 @@
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
apply_patch(auto_approved=true) exited 0 in 89ms:
Success. Updated the following files:
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..6931b31fdabebb998ac4bde96036e10aad403866
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }

file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..6931b31fdabebb998ac4bde96036e10aad403866
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Triggering rebuild**
tool xcodebuildmcp.build_macos({})
xcodebuildmcp.build_macos({}) failed in 7.07s:
{
  "content": [
    {
      "type": "text",
      "text": "❌ Error: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/ClauseListView.swift:47:17: error: no exact matches in call to initializer "
    },
    {
      "type": "text",
      "text": "❌ [stderr] --- xcodebuild: WARNING: Using the first of multiple matching destinations:"
    },
    {
      "type": "text",
      "text": "❌ [stderr] { platform:macOS, arch:arm64, id:00006001-000448A43402801E, name:My Mac }"
    },
    {
      "type": "text",
      "text": "❌ [stderr] { platform:macOS, arch:x86_64, id:00006001-000448A43402801E, name:My Mac }"
    },
    {
      "type": "text",
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..6931b31fdabebb998ac4bde96036e10aad403866
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Inspecting error around ClauseListView line 47**

I'm reviewing lines 40-55 to clarify the error near the suspected `AccessibilityRotorEntry` usage and confirm the issue location before fixing it.
exec
/bin/zsh -lc "nl -ba app/decodingOppression/decodingOppression/Views/ClauseListView.swift | sed -n '40,60p'" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
    40	                    }
    41	                }
    42	            }
    43	        }
    44	        .navigationTitle("Clauses")
    45	        .accessibilityRotor("Oppressive Clauses") {
    46	            ForEach(viewModel.oppressiveClauses) { item in
    47	                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
    48	            }
    49	        }
    50	        .accessibilityRotor("Liberatory Clauses") {
    51	            ForEach(viewModel.liberatoryClauses) { item in
    52	                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
    53	            }
    54	        }
    55	    }
    56	}
    57	
    58	private struct ClauseRow: View {
    59	    let item: ClauseScore
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..6931b31fdabebb998ac4bde96036e10aad403866
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Investigating initializer mismatch**

I'm checking whether the AccessibilityRotorEntry initializer accepts String or requires Text/LocalizedStringKey, as the error suggests a mismatch potentially due to differing parameter types on macOS.
exec
/bin/zsh -lc 'SDK_PATH=$(xcrun --sdk macosx26.2 --show-sdk-path)
rg -n "struct AccessibilityRotorEntry" "$SDK_PATH/System/Library/Frameworks/SwiftUI.framework" -g "*.swiftinterface" | head -n 5' in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/SwiftUI.framework/Versions/A/Modules/SwiftUI.swiftmodule/x86_64-apple-macos.swiftinterface:15422:public struct AccessibilityRotorEntry<ID> where ID : Swift.Hashable {
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/SwiftUI.framework/Versions/A/Modules/SwiftUI.swiftmodule/arm64e-apple-macos.swiftinterface:15422:public struct AccessibilityRotorEntry<ID> where ID : Swift.Hashable {
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..6931b31fdabebb998ac4bde96036e10aad403866
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Inspecting initializer**
exec
/bin/zsh -lc 'SDK_PATH=$(xcrun --sdk macosx26.2 --show-sdk-path)
sed -n '"'15422,15460p' \""'$SDK_PATH/System/Library/Frameworks/SwiftUI.framework/Versions/A/Modules/SwiftUI.swiftmodule/arm64e-apple-macos.swiftinterface"' in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
public struct AccessibilityRotorEntry<ID> where ID : Swift.Hashable {
  #if compiler(>=5.3) && $NonescapableTypes
  public init(_ label: SwiftUICore.Text, id: ID, textRange: Swift.Range<Swift.String.Index>? = nil, prepare: @escaping () -> Swift.Void = {})
  #endif
  #if compiler(>=5.3) && $NonescapableTypes
  public init(_ label: SwiftUICore.Text, id: ID, in namespace: SwiftUICore.Namespace.ID, textRange: Swift.Range<Swift.String.Index>? = nil, prepare: @escaping () -> Swift.Void = {})
  #endif
  #if compiler(>=5.3) && $NonescapableTypes
  public init(_ label: SwiftUICore.Text? = nil, textRange: Swift.Range<Swift.String.Index>, prepare: @escaping () -> Swift.Void = {}) where ID == Swift.Never
  #endif
  #if compiler(>=5.3) && $NonescapableTypes
  public init(_ labelKey: SwiftUICore.LocalizedStringKey, id: ID, textRange: Swift.Range<Swift.String.Index>? = nil, prepare: @escaping () -> Swift.Void = {})
  #endif
  #if compiler(>=5.3) && $NonescapableTypes
  @available(iOS 16.0, macOS 13.0, tvOS 16.0, watchOS 9.0, *)
  @_disfavoredOverload @_alwaysEmitIntoClient public init(_ label: Foundation.LocalizedStringResource, id: ID, textRange: Swift.Range<Swift.String.Index>? = nil, prepare: @escaping () -> Swift.Void = {}) {
        self.init(
            Text(label), id: id, textRange: textRange,
            prepare: prepare
        )
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..6931b31fdabebb998ac4bde96036e10aad403866
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }



thinking
**Clarifying initializer usage for accessibility entries**

The call using a string label with a labeled `id:` doesn't match any initializer; to fix this, wrap string labels as `Text` before passing with `id:` in the namespace. I'll update ClauseListView and ScoreCardView accordingly.
thinking
**Disambiguating string literal initializer with Text wrapper**

Since the string literal likely uses the LocalizedStringKey initializer with `id:` but string variables do not, wrapping the variable with `Text()` will clarify which initializer to use. I'll patch ClauseListView accordingly.
file update
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -46,3 +46,3 @@
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
@@ -51,3 +51,3 @@
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
apply_patch(auto_approved=true) exited 0 in 86ms:
Success. Updated the following files:
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }

file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Triggering rebuild**
tool xcodebuildmcp.build_macos({})
xcodebuildmcp.build_macos({}) failed in 10.18s:
{
  "content": [
    {
      "type": "text",
      "text": "❌ Error: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift:44:45: error: ambiguous use of 'percent'"
    },
    {
      "type": "text",
      "text": "❌ Error: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift:63:34: error: missing argument for parameter 'valueDescriptionProvider' in call"
    },
    {
      "type": "text",
      "text": "❌ Error: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift:65:103: error: missing argument for parameter 'valueDescriptionProvider' in call"
    },
    {
      "type": "text",
      "text": "❌ [stderr] --- xcodebuild: WARNING: Using the first of multiple matching destinations:"
    },
    {
      "type": "text",
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Identifying API changes in data axis setup**

Found that the `.percent` format in axis labels may be ambiguous and the `AXNumericDataAxisDescriptor` now requires a `valueDescriptionProvider` parameter, so the data axis setup in `CompoundingTrajectoryView` needs updating accordingly.
exec
/bin/zsh -lc "nl -ba app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift | sed -n '30,90p'" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 52ms:
    30	                    .foregroundStyle(CompoundingTrajectoryViewStyle.lineColor)
    31	
    32	                    if point.isCurrent {
    33	                        PointMark(
    34	                            x: .value("Year", point.year),
    35	                            y: .value("Capacity", point.capacity)
    36	                        )
    37	                        .foregroundStyle(CompoundingTrajectoryViewStyle.currentPointColor)
    38	                    }
    39	                }
    40	            }
    41	            .chartYAxis {
    42	                AxisMarks(position: .leading) {
    43	                    AxisGridLine()
    44	                    AxisValueLabel(format: .percent)
    45	                }
    46	            }
    47	            .accessibilityChartDescriptor(CompoundingChartDescriptor(points: viewModel.points))
    48	            .accessibilityLabel("Compounding Impact Trajectory")
    49	            .accessibilityHint("Tracks outgroup capacity over time")
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Investigating API changes in accessibility**

I'm verifying that `AXNumericDataAxisDescriptor` belongs to SwiftUI accessibility and looking into its interface to understand the ambiguous `.percent` and missing `valueDescriptionProvider` argument issues, suspecting API changes in iOS 26.
exec
/bin/zsh -lc 'SDK_PATH=$(xcrun --sdk macosx26.2 --show-sdk-path)
rg -n "AXNumericDataAxisDescriptor" "$SDK_PATH/System/Library/Frameworks/SwiftUI.framework" -g "*.swiftinterface" | head -n 10' in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:

file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Considering accessibility framework location**
exec
/bin/zsh -lc 'SDK_PATH=$(xcrun --sdk macosx26.2 --show-sdk-path)
rg -n "AXNumericDataAxisDescriptor" "$SDK_PATH/System/Library/Frameworks" -g "*.swiftinterface" | head -n 20' in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Accessibility.framework/Versions/A/Modules/Accessibility.swiftmodule/x86_64-apple-macos.swiftinterface:19:extension Accessibility.AXNumericDataAxisDescriptor {
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Accessibility.framework/Versions/A/Modules/Accessibility.swiftmodule/x86_64-apple-macos.swiftinterface:55:  convenience public init(title: Swift.String? = nil, summary: Swift.String? = nil, xAxis: any Accessibility.AXDataAxisDescriptor, yAxis: Accessibility.AXNumericDataAxisDescriptor? = nil, additionalAxes: [any Accessibility.AXDataAxisDescriptor] = [], series: [Accessibility.AXDataSeriesDescriptor])
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Accessibility.framework/Versions/A/Modules/Accessibility.swiftmodule/x86_64-apple-macos.swiftinterface:58:  convenience public init(attributedTitle: Foundation.NSAttributedString? = nil, summary: Swift.String? = nil, xAxis: any Accessibility.AXDataAxisDescriptor, yAxis: Accessibility.AXNumericDataAxisDescriptor? = nil, additionalAxes: [any Accessibility.AXDataAxisDescriptor] = [], series: [Accessibility.AXDataSeriesDescriptor])
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Accessibility.framework/Versions/A/Modules/Accessibility.swiftmodule/arm64e-apple-macos.swiftinterface:19:extension Accessibility.AXNumericDataAxisDescriptor {
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Accessibility.framework/Versions/A/Modules/Accessibility.swiftmodule/arm64e-apple-macos.swiftinterface:55:  convenience public init(title: Swift.String? = nil, summary: Swift.String? = nil, xAxis: any Accessibility.AXDataAxisDescriptor, yAxis: Accessibility.AXNumericDataAxisDescriptor? = nil, additionalAxes: [any Accessibility.AXDataAxisDescriptor] = [], series: [Accessibility.AXDataSeriesDescriptor])
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Accessibility.framework/Versions/A/Modules/Accessibility.swiftmodule/arm64e-apple-macos.swiftinterface:58:  convenience public init(attributedTitle: Foundation.NSAttributedString? = nil, summary: Swift.String? = nil, xAxis: any Accessibility.AXDataAxisDescriptor, yAxis: Accessibility.AXNumericDataAxisDescriptor? = nil, additionalAxes: [any Accessibility.AXDataAxisDescriptor] = [], series: [Accessibility.AXDataSeriesDescriptor])
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Accessibility.framework/Versions/A/Modules/Accessibility.swiftmodule/arm64e-apple-ios-macabi.swiftinterface:19:extension Accessibility.AXNumericDataAxisDescriptor {
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Accessibility.framework/Versions/A/Modules/Accessibility.swiftmodule/arm64e-apple-ios-macabi.swiftinterface:55:  convenience public init(title: Swift.String? = nil, summary: Swift.String? = nil, xAxis: any Accessibility.AXDataAxisDescriptor, yAxis: Accessibility.AXNumericDataAxisDescriptor? = nil, additionalAxes: [any Accessibility.AXDataAxisDescriptor] = [], series: [Accessibility.AXDataSeriesDescriptor])
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Accessibility.framework/Versions/A/Modules/Accessibility.swiftmodule/arm64e-apple-ios-macabi.swiftinterface:58:  convenience public init(attributedTitle: Foundation.NSAttributedString? = nil, summary: Swift.String? = nil, xAxis: any Accessibility.AXDataAxisDescriptor, yAxis: Accessibility.AXNumericDataAxisDescriptor? = nil, additionalAxes: [any Accessibility.AXDataAxisDescriptor] = [], series: [Accessibility.AXDataSeriesDescriptor])
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Accessibility.framework/Versions/A/Modules/Accessibility.swiftmodule/x86_64-apple-ios-macabi.swiftinterface:19:extension Accessibility.AXNumericDataAxisDescriptor {
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Accessibility.framework/Versions/A/Modules/Accessibility.swiftmodule/x86_64-apple-ios-macabi.swiftinterface:55:  convenience public init(title: Swift.String? = nil, summary: Swift.String? = nil, xAxis: any Accessibility.AXDataAxisDescriptor, yAxis: Accessibility.AXNumericDataAxisDescriptor? = nil, additionalAxes: [any Accessibility.AXDataAxisDescriptor] = [], series: [Accessibility.AXDataSeriesDescriptor])
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Accessibility.framework/Versions/A/Modules/Accessibility.swiftmodule/x86_64-apple-ios-macabi.swiftinterface:58:  convenience public init(attributedTitle: Foundation.NSAttributedString? = nil, summary: Swift.String? = nil, xAxis: any Accessibility.AXDataAxisDescriptor, yAxis: Accessibility.AXNumericDataAxisDescriptor? = nil, additionalAxes: [any Accessibility.AXDataAxisDescriptor] = [], series: [Accessibility.AXDataSeriesDescriptor])
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Inspecting numeric axis descriptor**
exec
/bin/zsh -lc 'SDK_PATH=$(xcrun --sdk macosx26.2 --show-sdk-path)
sed -n '"'1,120p' \""'$SDK_PATH/System/Library/Frameworks/Accessibility.framework/Versions/A/Modules/Accessibility.swiftmodule/arm64e-apple-macos.swiftinterface"' in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
// swift-interface-format-version: 1.0
// swift-compiler-version: Apple Swift version 6.2 effective-5.10 (swiftlang-6.2.3.3.2 clang-1700.6.3.2)
// swift-module-flags: -target arm64e-apple-macos26.2 -target-variant arm64e-apple-ios26.2-macabi -enable-objc-interop -enable-library-evolution -swift-version 5 -enforce-exclusivity=checked -O -library-level api -enable-upcoming-feature MemberImportVisibility -enable-experimental-feature DebugDescriptionMacro -enable-bare-slash-regex -user-module-version 545.3.7 -module-name Accessibility
// swift-module-flags-ignorable:  -formal-cxx-interoperability-mode=off -interface-compiler-version 6.2
@_exported import Accessibility
import Foundation
import Swift
import _Concurrency
import _StringProcessing
import _SwiftConcurrencyShims
@available(macOS 12.2, iOS 15.2, tvOS 15.2, watchOS 8.2, *)
extension Accessibility.AXBrailleMap {
  public subscript(point: CoreFoundation.CGPoint) -> Swift.Float {
    get
    set
  }
}
@available(macOS 12.0, iOS 15.0, tvOS 15.0, watchOS 8.0, *)
extension Accessibility.AXNumericDataAxisDescriptor {
  public var range: Swift.ClosedRange<Swift.Double> {
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Identifying missing initializer parameters**

The `AXNumericDataAxisDescriptor` now requires a `valueDescriptionProvider` closure, which our code lacks; I'll search all initializations of both numeric and categorical axis descriptors to update them consistently.
exec
/bin/zsh -lc 'rg -n "AXNumericDataAxisDescriptor" app/decodingOppression/decodingOppression/Views' in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:
app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift:80:        let yAxis = AXNumericDataAxisDescriptor(
app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift:60:        let xAxis = AXNumericDataAxisDescriptor(
app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift:65:        let yAxis = AXNumericDataAxisDescriptor(title: "Capacity", range: 0...1, gridlinePositions: [])
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Planning accessibility update**

I'm preparing to add the `valueDescriptionProvider` closure and checking if the `AXCategoricalDataAxisDescriptor` interface needs changes by searching its swiftinterface.
exec
/bin/zsh -lc 'SDK_PATH=$(xcrun --sdk macosx26.2 --show-sdk-path)
rg -n "AXCategoricalDataAxisDescriptor" "$SDK_PATH/System/Library/Frameworks/Accessibility.framework" -g "*.swiftinterface" | head -n 20' in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 51ms:

file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Searching for class in frameworks**
exec
/bin/zsh -lc 'SDK_PATH=$(xcrun --sdk macosx26.2 --show-sdk-path)
rg -n "AXCategoricalDataAxisDescriptor" "$SDK_PATH/System/Library/Frameworks" -g "*.swiftinterface" | head -n 20' in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 52ms:

file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Searching SDK for descriptor**
exec
/bin/zsh -lc 'SDK_PATH=$(xcrun --sdk macosx26.2 --show-sdk-path)
rg -n "CategoricalDataAxis" "$SDK_PATH" | head -n 20' in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 871ms:
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Accessibility.framework/Versions/A/Headers/AXAudiograph.h:81:@interface AXCategoricalDataAxisDescriptor : NSObject <AXDataAxisDescriptor>
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Accessibility.framework/Versions/A/Accessibility.tbd:336:                       AXBrailleTranslator, AXCategoricalDataAxisDescriptor, AXCategoricalScale, 
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/PrivateFrameworks/AXMediaUtilities.framework/Versions/A/AXMediaUtilities.tbd:419:                       AXMCaptionDetectorNode, AXMCaptureVideoDataOutput, AXMCategoricalDataAxisDescriptor, 
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Inspecting Swift interface bridging**

I'm checking the Objective-C header for the accessibility class to understand its initializer since Swift interfaces might bridge from ObjC.
exec
/bin/zsh -lc 'SDK_PATH=$(xcrun --sdk macosx26.2 --show-sdk-path)
sed -n '"'60,110p' \""'$SDK_PATH/System/Library/Frameworks/Accessibility.framework/Versions/A/Headers/AXAudiograph.h"' in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 53ms:

/// The maximum displayable value for the axis.
@property (nonatomic, assign) double upperBound NS_REFINED_FOR_SWIFT;

/// Provides a value description to be spoken for a particular data value on this axis.
/// Use this to format data values to string representations that include units, dates, times, etc.
@property (nonatomic, copy) NSString *(^valueDescriptionProvider)(double);

/// The positions of any gridlines along this axis.
@property (nonatomic, copy) NSArray<NSNumber *> *gridlinePositions NS_REFINED_FOR_SWIFT;

- (instancetype)initWithTitle:(NSString *)title lowerBound:(double)lowerbound upperBound:(double)upperBound gridlinePositions:(nullable NSArray<NSNumber *> *)gridlinePositions valueDescriptionProvider:(NSString * _Nonnull (^)(double))valueDescriptionProvider NS_DESIGNATED_INITIALIZER NS_REFINED_FOR_SWIFT;

- (instancetype)initWithAttributedTitle:(NSAttributedString *)attributedTitle lowerBound:(double)lowerbound upperBound:(double)upperBound gridlinePositions:(nullable NSArray<NSNumber *> *)gridlinePositions valueDescriptionProvider:(NSString * _Nonnull (^)(double))valueDescriptionProvider NS_DESIGNATED_INITIALIZER NS_REFINED_FOR_SWIFT;

- (instancetype)init NS_UNAVAILABLE;
+ (instancetype)new NS_UNAVAILABLE;

@end

file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }



thinking
**Updating chart axis labels and descriptors**

I'm planning to replace ambiguous `AxisValueLabel(format: .percent)` with a closure-based label to avoid conflicts, and to add required `valueDescriptionProvider` closures to all `AXNumericDataAxisDescriptor` instances in BenefitHierarchyView and CompoundingTrajectoryView to properly format axis values.
thinking
**Replacing percent axis labels with closure**

I'll change `AxisValueLabel(format: .percent)` to use a closure that extracts the double value and formats it with `.percent`, applying this update in both BenefitHierarchyView and CompoundingTrajectoryView.
file update
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -45,3 +45,7 @@
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
@@ -59,3 +63,7 @@
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
apply_patch(auto_approved=true) exited 0 in 92ms:
Success. Updated the following files:
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..de186bcd9b70e2713f8b03a6e98d18800d33b8d3
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 } else {
@@ -57,7 +61,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }

file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..de186bcd9b70e2713f8b03a6e98d18800d33b8d3
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 } else {
@@ -57,7 +61,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Updating numeric axis descriptor**

I'm adjusting the numeric data axis descriptor to use a formatted percent string for value descriptions while keeping the categorical x-axis unchanged.
file update
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -90,3 +90,6 @@
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
apply_patch(auto_approved=true) exited 0 in 90ms:
Success. Updated the following files:
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..36bca8abae5b7493c594fd2a506e8aa5ee5b5f10
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 } else {
@@ -57,7 +61,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 }
@@ -80,7 +88,10 @@
         let yAxis = AXNumericDataAxisDescriptor(
             title: "Percentage",
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
 
         let benefitSeries = AXDataSeriesDescriptor(
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }

file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..36bca8abae5b7493c594fd2a506e8aa5ee5b5f10
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 } else {
@@ -57,7 +61,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 }
@@ -80,7 +88,10 @@
         let yAxis = AXNumericDataAxisDescriptor(
             title: "Percentage",
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
 
         let benefitSeries = AXDataSeriesDescriptor(
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Updating axis label and descriptor**

I'm patching the axis value label and descriptor in the compounding trajectory view to improve clarity or accuracy.
file update
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -43,3 +43,7 @@
                     AxisGridLine()
-                    AxisValueLabel(format: .percent)
+                    AxisValueLabel {
+                        if let value = $0.as(Double.self) {
+                            Text(value, format: .percent)
+                        }
+                    }
                 }
apply_patch(auto_approved=true) exited 0 in 87ms:
Success. Updated the following files:
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..36bca8abae5b7493c594fd2a506e8aa5ee5b5f10
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 } else {
@@ -57,7 +61,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 }
@@ -80,7 +88,10 @@
         let yAxis = AXNumericDataAxisDescriptor(
             title: "Percentage",
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
 
         let benefitSeries = AXDataSeriesDescriptor(
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
index b25aa9287d9f429c382a3cfb4003f8ea2c80c11e..fdcb8d2e54a8e6973ade610871228b106d7d75ae
--- a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -41,7 +41,11 @@
             .chartYAxis {
                 AxisMarks(position: .leading) {
                     AxisGridLine()
-                    AxisValueLabel(format: .percent)
+                    AxisValueLabel {
+                        if let value = $0.as(Double.self) {
+                            Text(value, format: .percent)
+                        }
+                    }
                 }
             }
             .accessibilityChartDescriptor(CompoundingChartDescriptor(points: viewModel.points))
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }

file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..36bca8abae5b7493c594fd2a506e8aa5ee5b5f10
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 } else {
@@ -57,7 +61,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 }
@@ -80,7 +88,10 @@
         let yAxis = AXNumericDataAxisDescriptor(
             title: "Percentage",
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
 
         let benefitSeries = AXDataSeriesDescriptor(
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
index b25aa9287d9f429c382a3cfb4003f8ea2c80c11e..fdcb8d2e54a8e6973ade610871228b106d7d75ae
--- a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -41,7 +41,11 @@
             .chartYAxis {
                 AxisMarks(position: .leading) {
                     AxisGridLine()
-                    AxisValueLabel(format: .percent)
+                    AxisValueLabel {
+                        if let value = $0.as(Double.self) {
+                            Text(value, format: .percent)
+                        }
+                    }
                 }
             }
             .accessibilityChartDescriptor(CompoundingChartDescriptor(points: viewModel.points))
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Updating initializers with value description provider**
file update
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -66,5 +66,15 @@
             range: Double((points.first?.year ?? 0))...Double((points.last?.year ?? 0)),
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                String(Int(value))
+            }
+        )
+        let yAxis = AXNumericDataAxisDescriptor(
+            title: "Capacity",
+            range: 0...1,
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
-        let yAxis = AXNumericDataAxisDescriptor(title: "Capacity", range: 0...1, gridlinePositions: [])
 
apply_patch(auto_approved=true) exited 0 in 96ms:
Success. Updated the following files:
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..36bca8abae5b7493c594fd2a506e8aa5ee5b5f10
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 } else {
@@ -57,7 +61,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 }
@@ -80,7 +88,10 @@
         let yAxis = AXNumericDataAxisDescriptor(
             title: "Percentage",
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
 
         let benefitSeries = AXDataSeriesDescriptor(
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
index b25aa9287d9f429c382a3cfb4003f8ea2c80c11e..c00d15514ae62ec16a9898c72cdd4607d0eb8071
--- a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -41,7 +41,11 @@
             .chartYAxis {
                 AxisMarks(position: .leading) {
                     AxisGridLine()
-                    AxisValueLabel(format: .percent)
+                    AxisValueLabel {
+                        if let value = $0.as(Double.self) {
+                            Text(value, format: .percent)
+                        }
+                    }
                 }
             }
             .accessibilityChartDescriptor(CompoundingChartDescriptor(points: viewModel.points))
@@ -60,9 +64,19 @@
         let xAxis = AXNumericDataAxisDescriptor(
             title: "Year",
             range: Double((points.first?.year ?? 0))...Double((points.last?.year ?? 0)),
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                String(Int(value))
+            }
+        )
+        let yAxis = AXNumericDataAxisDescriptor(
+            title: "Capacity",
+            range: 0...1,
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
-        let yAxis = AXNumericDataAxisDescriptor(title: "Capacity", range: 0...1, gridlinePositions: [])
 
         let series = AXDataSeriesDescriptor(
             name: "Capacity",
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }

file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..36bca8abae5b7493c594fd2a506e8aa5ee5b5f10
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 } else {
@@ -57,7 +61,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 }
@@ -80,7 +88,10 @@
         let yAxis = AXNumericDataAxisDescriptor(
             title: "Percentage",
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
 
         let benefitSeries = AXDataSeriesDescriptor(
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
index b25aa9287d9f429c382a3cfb4003f8ea2c80c11e..c00d15514ae62ec16a9898c72cdd4607d0eb8071
--- a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -41,7 +41,11 @@
             .chartYAxis {
                 AxisMarks(position: .leading) {
                     AxisGridLine()
-                    AxisValueLabel(format: .percent)
+                    AxisValueLabel {
+                        if let value = $0.as(Double.self) {
+                            Text(value, format: .percent)
+                        }
+                    }
                 }
             }
             .accessibilityChartDescriptor(CompoundingChartDescriptor(points: viewModel.points))
@@ -60,9 +64,19 @@
         let xAxis = AXNumericDataAxisDescriptor(
             title: "Year",
             range: Double((points.first?.year ?? 0))...Double((points.last?.year ?? 0)),
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                String(Int(value))
+            }
+        )
+        let yAxis = AXNumericDataAxisDescriptor(
+            title: "Capacity",
+            range: 0...1,
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
-        let yAxis = AXNumericDataAxisDescriptor(title: "Capacity", range: 0...1, gridlinePositions: [])
 
         let series = AXDataSeriesDescriptor(
             name: "Capacity",
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Rebuilding project**
tool xcodebuildmcp.build_macos({})
xcodebuildmcp.build_macos({}) failed in 10.85s:
{
  "content": [
    {
      "type": "text",
      "text": "❌ Error: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift:47:17: error: no exact matches in call to initializer "
    },
    {
      "type": "text",
      "text": "❌ Error: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift:33:18: error: value of type 'some ChartContent' has no member 'accessibilityAddTraits'"
    },
    {
      "type": "text",
      "text": "❌ Error: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift:33:60: error: type '[Any]' has no member 'isSelected'"
    },
    {
      "type": "text",
      "text": "❌ [stderr] --- xcodebuild: WARNING: Using the first of multiple matching destinations:"
    },
    {
      "type": "text",
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..36bca8abae5b7493c594fd2a506e8aa5ee5b5f10
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 } else {
@@ -57,7 +61,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 }
@@ -80,7 +88,10 @@
         let yAxis = AXNumericDataAxisDescriptor(
             title: "Percentage",
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
 
         let benefitSeries = AXDataSeriesDescriptor(
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
index b25aa9287d9f429c382a3cfb4003f8ea2c80c11e..c00d15514ae62ec16a9898c72cdd4607d0eb8071
--- a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -41,7 +41,11 @@
             .chartYAxis {
                 AxisMarks(position: .leading) {
                     AxisGridLine()
-                    AxisValueLabel(format: .percent)
+                    AxisValueLabel {
+                        if let value = $0.as(Double.self) {
+                            Text(value, format: .percent)
+                        }
+                    }
                 }
             }
             .accessibilityChartDescriptor(CompoundingChartDescriptor(points: viewModel.points))
@@ -60,9 +64,19 @@
         let xAxis = AXNumericDataAxisDescriptor(
             title: "Year",
             range: Double((points.first?.year ?? 0))...Double((points.last?.year ?? 0)),
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                String(Int(value))
+            }
+        )
+        let yAxis = AXNumericDataAxisDescriptor(
+            title: "Capacity",
+            range: 0...1,
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
-        let yAxis = AXNumericDataAxisDescriptor(title: "Capacity", range: 0...1, gridlinePositions: [])
 
         let series = AXDataSeriesDescriptor(
             name: "Capacity",
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }



thinking
**Adjusting accessibility modifiers for chart elements**

Accessibility modifiers like `accessibilityAddTraits` aren’t supported directly on `BarMark` or `ChartContent`, so I'll remove those from bars and instead enhance accessibility by adding labels or values (e.g., appending "current policy") on BarMarks or on the Chart with appropriate element containment. Also, I'll fix misuse of empty arrays in `accessibilityAddTraits` by ensuring proper `AccessibilityTraits` values are passed.
thinking
**Refining accessibility updates in chart view**

I'll replace `accessibilityAddTraits` with conditional `accessibilityValue` strings including "current policy" and convert rotor entries to use `Text` for labels. Accessibility labels and values will stay on BarMarks, while removing unsupported traits modifiers to fix errors.
file update
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
@@ -31,4 +31,3 @@
                 .accessibilityLabel(entry.name)
-                .accessibilityValue(entry.coi.formatted(.number.precision(.fractionLength(2))))
-                .accessibilityAddTraits(entry.isCurrent ? .isSelected : [])
+                .accessibilityValue(accessibilityValue(for: entry))
                 .accessibilityRotorEntry(id: entry.id, in: rotorNamespace)
@@ -46,3 +45,3 @@
             ForEach(viewModel.entries) { entry in
-                AccessibilityRotorEntry(entry.name, id: entry.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(entry.name), id: entry.id, in: rotorNamespace)
             }
@@ -51,2 +50,10 @@
     }
+
+    private func accessibilityValue(for entry: HistoricalComparisonEntry) -> String {
+        let score = entry.coi.formatted(.number.precision(.fractionLength(2)))
+        if entry.isCurrent {
+            return "\(score), current policy"
+        }
+        return score
+    }
 }
apply_patch(auto_approved=true) exited 0 in 97ms:
Success. Updated the following files:
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..36bca8abae5b7493c594fd2a506e8aa5ee5b5f10
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 } else {
@@ -57,7 +61,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 }
@@ -80,7 +88,10 @@
         let yAxis = AXNumericDataAxisDescriptor(
             title: "Percentage",
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
 
         let benefitSeries = AXDataSeriesDescriptor(
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
index b25aa9287d9f429c382a3cfb4003f8ea2c80c11e..c00d15514ae62ec16a9898c72cdd4607d0eb8071
--- a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -41,7 +41,11 @@
             .chartYAxis {
                 AxisMarks(position: .leading) {
                     AxisGridLine()
-                    AxisValueLabel(format: .percent)
+                    AxisValueLabel {
+                        if let value = $0.as(Double.self) {
+                            Text(value, format: .percent)
+                        }
+                    }
                 }
             }
             .accessibilityChartDescriptor(CompoundingChartDescriptor(points: viewModel.points))
@@ -60,9 +64,19 @@
         let xAxis = AXNumericDataAxisDescriptor(
             title: "Year",
             range: Double((points.first?.year ?? 0))...Double((points.last?.year ?? 0)),
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                String(Int(value))
+            }
+        )
+        let yAxis = AXNumericDataAxisDescriptor(
+            title: "Capacity",
+            range: 0...1,
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
-        let yAxis = AXNumericDataAxisDescriptor(title: "Capacity", range: 0...1, gridlinePositions: [])
 
         let series = AXDataSeriesDescriptor(
             name: "Capacity",
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
index 2ce700cd11c0855d714405bfa9e68d3521028a31..a72903a4d5a3ff2846844285062d568e90540ff4
--- a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
@@ -29,8 +29,7 @@
                 )
                 .foregroundStyle(HistoricalComparisonViewStyle.barColor(isCurrent: entry.isCurrent))
                 .accessibilityLabel(entry.name)
-                .accessibilityValue(entry.coi.formatted(.number.precision(.fractionLength(2))))
-                .accessibilityAddTraits(entry.isCurrent ? .isSelected : [])
+                .accessibilityValue(accessibilityValue(for: entry))
                 .accessibilityRotorEntry(id: entry.id, in: rotorNamespace)
             }
             .chartYAxis {
@@ -44,11 +43,19 @@
         .padding(24)
         .accessibilityRotor("Historical Policies") {
             ForEach(viewModel.entries) { entry in
-                AccessibilityRotorEntry(entry.name, id: entry.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(entry.name), id: entry.id, in: rotorNamespace)
             }
         }
         .accessibilitySortPriority(1)
     }
+
+    private func accessibilityValue(for entry: HistoricalComparisonEntry) -> String {
+        let score = entry.coi.formatted(.number.precision(.fractionLength(2)))
+        if entry.isCurrent {
+            return "\(score), current policy"
+        }
+        return score
+    }
 }
 
 #Preview {
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }

file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..36bca8abae5b7493c594fd2a506e8aa5ee5b5f10
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 } else {
@@ -57,7 +61,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 }
@@ -80,7 +88,10 @@
         let yAxis = AXNumericDataAxisDescriptor(
             title: "Percentage",
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
 
         let benefitSeries = AXDataSeriesDescriptor(
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
index b25aa9287d9f429c382a3cfb4003f8ea2c80c11e..c00d15514ae62ec16a9898c72cdd4607d0eb8071
--- a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -41,7 +41,11 @@
             .chartYAxis {
                 AxisMarks(position: .leading) {
                     AxisGridLine()
-                    AxisValueLabel(format: .percent)
+                    AxisValueLabel {
+                        if let value = $0.as(Double.self) {
+                            Text(value, format: .percent)
+                        }
+                    }
                 }
             }
             .accessibilityChartDescriptor(CompoundingChartDescriptor(points: viewModel.points))
@@ -60,9 +64,19 @@
         let xAxis = AXNumericDataAxisDescriptor(
             title: "Year",
             range: Double((points.first?.year ?? 0))...Double((points.last?.year ?? 0)),
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                String(Int(value))
+            }
+        )
+        let yAxis = AXNumericDataAxisDescriptor(
+            title: "Capacity",
+            range: 0...1,
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
-        let yAxis = AXNumericDataAxisDescriptor(title: "Capacity", range: 0...1, gridlinePositions: [])
 
         let series = AXDataSeriesDescriptor(
             name: "Capacity",
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
index 2ce700cd11c0855d714405bfa9e68d3521028a31..a72903a4d5a3ff2846844285062d568e90540ff4
--- a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
@@ -29,8 +29,7 @@
                 )
                 .foregroundStyle(HistoricalComparisonViewStyle.barColor(isCurrent: entry.isCurrent))
                 .accessibilityLabel(entry.name)
-                .accessibilityValue(entry.coi.formatted(.number.precision(.fractionLength(2))))
-                .accessibilityAddTraits(entry.isCurrent ? .isSelected : [])
+                .accessibilityValue(accessibilityValue(for: entry))
                 .accessibilityRotorEntry(id: entry.id, in: rotorNamespace)
             }
             .chartYAxis {
@@ -44,11 +43,19 @@
         .padding(24)
         .accessibilityRotor("Historical Policies") {
             ForEach(viewModel.entries) { entry in
-                AccessibilityRotorEntry(entry.name, id: entry.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(entry.name), id: entry.id, in: rotorNamespace)
             }
         }
         .accessibilitySortPriority(1)
     }
+
+    private func accessibilityValue(for entry: HistoricalComparisonEntry) -> String {
+        let score = entry.coi.formatted(.number.precision(.fractionLength(2)))
+        if entry.isCurrent {
+            return "\(score), current policy"
+        }
+        return score
+    }
 }
 
 #Preview {
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Rebuilding the project**
tool xcodebuildmcp.build_macos({})
xcodebuildmcp.build_macos({}) failed in 4.30s:
{
  "content": [
    {
      "type": "text",
      "text": "❌ Error: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift:33:18: error: value of type 'some ChartContent' has no member 'accessibilityRotorEntry'"
    },
    {
      "type": "text",
      "text": "❌ [stderr] --- xcodebuild: WARNING: Using the first of multiple matching destinations:"
    },
    {
      "type": "text",
      "text": "❌ [stderr] { platform:macOS, arch:arm64, id:00006001-000448A43402801E, name:My Mac }"
    },
    {
      "type": "text",
      "text": "❌ [stderr] { platform:macOS, arch:x86_64, id:00006001-000448A43402801E, name:My Mac }"
    },
    {
      "type": "text",
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..36bca8abae5b7493c594fd2a506e8aa5ee5b5f10
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 } else {
@@ -57,7 +61,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 }
@@ -80,7 +88,10 @@
         let yAxis = AXNumericDataAxisDescriptor(
             title: "Percentage",
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
 
         let benefitSeries = AXDataSeriesDescriptor(
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
index b25aa9287d9f429c382a3cfb4003f8ea2c80c11e..c00d15514ae62ec16a9898c72cdd4607d0eb8071
--- a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -41,7 +41,11 @@
             .chartYAxis {
                 AxisMarks(position: .leading) {
                     AxisGridLine()
-                    AxisValueLabel(format: .percent)
+                    AxisValueLabel {
+                        if let value = $0.as(Double.self) {
+                            Text(value, format: .percent)
+                        }
+                    }
                 }
             }
             .accessibilityChartDescriptor(CompoundingChartDescriptor(points: viewModel.points))
@@ -60,9 +64,19 @@
         let xAxis = AXNumericDataAxisDescriptor(
             title: "Year",
             range: Double((points.first?.year ?? 0))...Double((points.last?.year ?? 0)),
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                String(Int(value))
+            }
+        )
+        let yAxis = AXNumericDataAxisDescriptor(
+            title: "Capacity",
+            range: 0...1,
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
-        let yAxis = AXNumericDataAxisDescriptor(title: "Capacity", range: 0...1, gridlinePositions: [])
 
         let series = AXDataSeriesDescriptor(
             name: "Capacity",
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
index 2ce700cd11c0855d714405bfa9e68d3521028a31..a72903a4d5a3ff2846844285062d568e90540ff4
--- a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
@@ -29,8 +29,7 @@
                 )
                 .foregroundStyle(HistoricalComparisonViewStyle.barColor(isCurrent: entry.isCurrent))
                 .accessibilityLabel(entry.name)
-                .accessibilityValue(entry.coi.formatted(.number.precision(.fractionLength(2))))
-                .accessibilityAddTraits(entry.isCurrent ? .isSelected : [])
+                .accessibilityValue(accessibilityValue(for: entry))
                 .accessibilityRotorEntry(id: entry.id, in: rotorNamespace)
             }
             .chartYAxis {
@@ -44,11 +43,19 @@
         .padding(24)
         .accessibilityRotor("Historical Policies") {
             ForEach(viewModel.entries) { entry in
-                AccessibilityRotorEntry(entry.name, id: entry.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(entry.name), id: entry.id, in: rotorNamespace)
             }
         }
         .accessibilitySortPriority(1)
     }
+
+    private func accessibilityValue(for entry: HistoricalComparisonEntry) -> String {
+        let score = entry.coi.formatted(.number.precision(.fractionLength(2)))
+        if entry.isCurrent {
+            return "\(score), current policy"
+        }
+        return score
+    }
 }
 
 #Preview {
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }



thinking
**Revising accessibility rotor approach**

Removing `accessibilityRotorEntry` from BarMark due to its absence on ChartContent and shifting to use `accessibilityRotor` on the container with an entries array, simplifying the custom "Historical Policies" rotor implementation.
thinking
**Resolving rotor linking by simplifying accessibility setup**

Decided to remove `.accessibilityRotorEntry` from individual bars due to lacking `ChartContent` support and instead use `accessibilityRotor` with entries array and `entryID` on the container, accepting that explicit rotor-entry linking may be omitted for compilation and simplicity. I'll replace rotor entries tied to marks with a single rotor using the entries array and clean up unused namespaces.
file update
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
@@ -12,4 +12,2 @@
     @State private var viewModel: HistoricalComparisonViewModel
-    @Namespace private var rotorNamespace
-
     init(analysis: PolicyAnalysis) {
@@ -32,3 +30,2 @@
                 .accessibilityValue(accessibilityValue(for: entry))
-                .accessibilityRotorEntry(id: entry.id, in: rotorNamespace)
             }
@@ -43,7 +40,3 @@
         .padding(24)
-        .accessibilityRotor("Historical Policies") {
-            ForEach(viewModel.entries) { entry in
-                AccessibilityRotorEntry(Text(entry.name), id: entry.id, in: rotorNamespace)
-            }
-        }
+        .accessibilityRotor("Historical Policies", entries: viewModel.entries, entryID: \.id, entryLabel: \.name)
         .accessibilitySortPriority(1)
apply_patch(auto_approved=true) exited 0 in 105ms:
Success. Updated the following files:
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..36bca8abae5b7493c594fd2a506e8aa5ee5b5f10
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 } else {
@@ -57,7 +61,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 }
@@ -80,7 +88,10 @@
         let yAxis = AXNumericDataAxisDescriptor(
             title: "Percentage",
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
 
         let benefitSeries = AXDataSeriesDescriptor(
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
index b25aa9287d9f429c382a3cfb4003f8ea2c80c11e..c00d15514ae62ec16a9898c72cdd4607d0eb8071
--- a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -41,7 +41,11 @@
             .chartYAxis {
                 AxisMarks(position: .leading) {
                     AxisGridLine()
-                    AxisValueLabel(format: .percent)
+                    AxisValueLabel {
+                        if let value = $0.as(Double.self) {
+                            Text(value, format: .percent)
+                        }
+                    }
                 }
             }
             .accessibilityChartDescriptor(CompoundingChartDescriptor(points: viewModel.points))
@@ -60,9 +64,19 @@
         let xAxis = AXNumericDataAxisDescriptor(
             title: "Year",
             range: Double((points.first?.year ?? 0))...Double((points.last?.year ?? 0)),
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                String(Int(value))
+            }
+        )
+        let yAxis = AXNumericDataAxisDescriptor(
+            title: "Capacity",
+            range: 0...1,
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
-        let yAxis = AXNumericDataAxisDescriptor(title: "Capacity", range: 0...1, gridlinePositions: [])
 
         let series = AXDataSeriesDescriptor(
             name: "Capacity",
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
index 2ce700cd11c0855d714405bfa9e68d3521028a31..c59531c13f4db12c808b65ff2574996f65908384
--- a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
@@ -10,8 +10,6 @@
 
 struct HistoricalComparisonView: View {
     @State private var viewModel: HistoricalComparisonViewModel
-    @Namespace private var rotorNamespace
-
     init(analysis: PolicyAnalysis) {
         _viewModel = State(initialValue: HistoricalComparisonViewModel(analysis: analysis))
     }
@@ -29,9 +27,7 @@
                 )
                 .foregroundStyle(HistoricalComparisonViewStyle.barColor(isCurrent: entry.isCurrent))
                 .accessibilityLabel(entry.name)
-                .accessibilityValue(entry.coi.formatted(.number.precision(.fractionLength(2))))
-                .accessibilityAddTraits(entry.isCurrent ? .isSelected : [])
-                .accessibilityRotorEntry(id: entry.id, in: rotorNamespace)
+                .accessibilityValue(accessibilityValue(for: entry))
             }
             .chartYAxis {
                 AxisMarks(position: .leading) {
@@ -42,12 +38,16 @@
             .accessibilityElement(children: .contain)
         }
         .padding(24)
-        .accessibilityRotor("Historical Policies") {
-            ForEach(viewModel.entries) { entry in
-                AccessibilityRotorEntry(entry.name, id: entry.id, in: rotorNamespace)
-            }
+        .accessibilityRotor("Historical Policies", entries: viewModel.entries, entryID: \.id, entryLabel: \.name)
+        .accessibilitySortPriority(1)
+    }
+
+    private func accessibilityValue(for entry: HistoricalComparisonEntry) -> String {
+        let score = entry.coi.formatted(.number.precision(.fractionLength(2)))
+        if entry.isCurrent {
+            return "\(score), current policy"
         }
-        .accessibilitySortPriority(1)
+        return score
     }
 }
 
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }

file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..36bca8abae5b7493c594fd2a506e8aa5ee5b5f10
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 } else {
@@ -57,7 +61,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 }
@@ -80,7 +88,10 @@
         let yAxis = AXNumericDataAxisDescriptor(
             title: "Percentage",
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
 
         let benefitSeries = AXDataSeriesDescriptor(
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
index b25aa9287d9f429c382a3cfb4003f8ea2c80c11e..c00d15514ae62ec16a9898c72cdd4607d0eb8071
--- a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -41,7 +41,11 @@
             .chartYAxis {
                 AxisMarks(position: .leading) {
                     AxisGridLine()
-                    AxisValueLabel(format: .percent)
+                    AxisValueLabel {
+                        if let value = $0.as(Double.self) {
+                            Text(value, format: .percent)
+                        }
+                    }
                 }
             }
             .accessibilityChartDescriptor(CompoundingChartDescriptor(points: viewModel.points))
@@ -60,9 +64,19 @@
         let xAxis = AXNumericDataAxisDescriptor(
             title: "Year",
             range: Double((points.first?.year ?? 0))...Double((points.last?.year ?? 0)),
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                String(Int(value))
+            }
+        )
+        let yAxis = AXNumericDataAxisDescriptor(
+            title: "Capacity",
+            range: 0...1,
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
-        let yAxis = AXNumericDataAxisDescriptor(title: "Capacity", range: 0...1, gridlinePositions: [])
 
         let series = AXDataSeriesDescriptor(
             name: "Capacity",
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
index 2ce700cd11c0855d714405bfa9e68d3521028a31..c59531c13f4db12c808b65ff2574996f65908384
--- a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
@@ -10,8 +10,6 @@
 
 struct HistoricalComparisonView: View {
     @State private var viewModel: HistoricalComparisonViewModel
-    @Namespace private var rotorNamespace
-
     init(analysis: PolicyAnalysis) {
         _viewModel = State(initialValue: HistoricalComparisonViewModel(analysis: analysis))
     }
@@ -29,9 +27,7 @@
                 )
                 .foregroundStyle(HistoricalComparisonViewStyle.barColor(isCurrent: entry.isCurrent))
                 .accessibilityLabel(entry.name)
-                .accessibilityValue(entry.coi.formatted(.number.precision(.fractionLength(2))))
-                .accessibilityAddTraits(entry.isCurrent ? .isSelected : [])
-                .accessibilityRotorEntry(id: entry.id, in: rotorNamespace)
+                .accessibilityValue(accessibilityValue(for: entry))
             }
             .chartYAxis {
                 AxisMarks(position: .leading) {
@@ -42,12 +38,16 @@
             .accessibilityElement(children: .contain)
         }
         .padding(24)
-        .accessibilityRotor("Historical Policies") {
-            ForEach(viewModel.entries) { entry in
-                AccessibilityRotorEntry(entry.name, id: entry.id, in: rotorNamespace)
-            }
+        .accessibilityRotor("Historical Policies", entries: viewModel.entries, entryID: \.id, entryLabel: \.name)
+        .accessibilitySortPriority(1)
+    }
+
+    private func accessibilityValue(for entry: HistoricalComparisonEntry) -> String {
+        let score = entry.coi.formatted(.number.precision(.fractionLength(2)))
+        if entry.isCurrent {
+            return "\(score), current policy"
         }
-        .accessibilitySortPriority(1)
+        return score
     }
 }
 
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Triggering rebuild**
tool xcodebuildmcp.build_macos({})
xcodebuildmcp.build_macos({}) failed in 11.76s:
{
  "content": [
    {
      "type": "text",
      "text": "❌ Error: /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift:44:21: error: type '(_) -> ()' cannot conform to 'StringProtocol'"
    },
    {
      "type": "text",
      "text": "❌ [stderr] --- xcodebuild: WARNING: Using the first of multiple matching destinations:"
    },
    {
      "type": "text",
      "text": "❌ [stderr] { platform:macOS, arch:arm64, id:00006001-000448A43402801E, name:My Mac }"
    },
    {
      "type": "text",
      "text": "❌ [stderr] { platform:macOS, arch:x86_64, id:00006001-000448A43402801E, name:My Mac }"
    },
    {
      "type": "text",
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..36bca8abae5b7493c594fd2a506e8aa5ee5b5f10
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 } else {
@@ -57,7 +61,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 }
@@ -80,7 +88,10 @@
         let yAxis = AXNumericDataAxisDescriptor(
             title: "Percentage",
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
 
         let benefitSeries = AXDataSeriesDescriptor(
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
index b25aa9287d9f429c382a3cfb4003f8ea2c80c11e..c00d15514ae62ec16a9898c72cdd4607d0eb8071
--- a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -41,7 +41,11 @@
             .chartYAxis {
                 AxisMarks(position: .leading) {
                     AxisGridLine()
-                    AxisValueLabel(format: .percent)
+                    AxisValueLabel {
+                        if let value = $0.as(Double.self) {
+                            Text(value, format: .percent)
+                        }
+                    }
                 }
             }
             .accessibilityChartDescriptor(CompoundingChartDescriptor(points: viewModel.points))
@@ -60,9 +64,19 @@
         let xAxis = AXNumericDataAxisDescriptor(
             title: "Year",
             range: Double((points.first?.year ?? 0))...Double((points.last?.year ?? 0)),
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                String(Int(value))
+            }
+        )
+        let yAxis = AXNumericDataAxisDescriptor(
+            title: "Capacity",
+            range: 0...1,
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
-        let yAxis = AXNumericDataAxisDescriptor(title: "Capacity", range: 0...1, gridlinePositions: [])
 
         let series = AXDataSeriesDescriptor(
             name: "Capacity",
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
index 2ce700cd11c0855d714405bfa9e68d3521028a31..c59531c13f4db12c808b65ff2574996f65908384
--- a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
@@ -10,8 +10,6 @@
 
 struct HistoricalComparisonView: View {
     @State private var viewModel: HistoricalComparisonViewModel
-    @Namespace private var rotorNamespace
-
     init(analysis: PolicyAnalysis) {
         _viewModel = State(initialValue: HistoricalComparisonViewModel(analysis: analysis))
     }
@@ -29,9 +27,7 @@
                 )
                 .foregroundStyle(HistoricalComparisonViewStyle.barColor(isCurrent: entry.isCurrent))
                 .accessibilityLabel(entry.name)
-                .accessibilityValue(entry.coi.formatted(.number.precision(.fractionLength(2))))
-                .accessibilityAddTraits(entry.isCurrent ? .isSelected : [])
-                .accessibilityRotorEntry(id: entry.id, in: rotorNamespace)
+                .accessibilityValue(accessibilityValue(for: entry))
             }
             .chartYAxis {
                 AxisMarks(position: .leading) {
@@ -42,12 +38,16 @@
             .accessibilityElement(children: .contain)
         }
         .padding(24)
-        .accessibilityRotor("Historical Policies") {
-            ForEach(viewModel.entries) { entry in
-                AccessibilityRotorEntry(entry.name, id: entry.id, in: rotorNamespace)
-            }
+        .accessibilityRotor("Historical Policies", entries: viewModel.entries, entryID: \.id, entryLabel: \.name)
+        .accessibilitySortPriority(1)
+    }
+
+    private func accessibilityValue(for entry: HistoricalComparisonEntry) -> String {
+        let score = entry.coi.formatted(.number.precision(.fractionLength(2)))
+        if entry.isCurrent {
+            return "\(score), current policy"
         }
-        .accessibilitySortPriority(1)
+        return score
     }
 }
 
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Diagnosing AxisValueLabel usage issue**

Noticing the error suggests the `AxisValueLabel` initializer expects a string label, not a closure, indicating the current usage may not be supported in this SwiftUI version; next, I'll check the SwiftUI interface to confirm available initializers.
exec
/bin/zsh -lc 'SDK_PATH=$(xcrun --sdk macosx26.2 --show-sdk-path)
rg -n "struct AxisValueLabel" "$SDK_PATH/System/Library/Frameworks/SwiftUI.framework" -g "*.swiftinterface" | head -n 20' in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 51ms:

file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..36bca8abae5b7493c594fd2a506e8aa5ee5b5f10
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 } else {
@@ -57,7 +61,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 }
@@ -80,7 +88,10 @@
         let yAxis = AXNumericDataAxisDescriptor(
             title: "Percentage",
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
 
         let benefitSeries = AXDataSeriesDescriptor(
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
index b25aa9287d9f429c382a3cfb4003f8ea2c80c11e..c00d15514ae62ec16a9898c72cdd4607d0eb8071
--- a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -41,7 +41,11 @@
             .chartYAxis {
                 AxisMarks(position: .leading) {
                     AxisGridLine()
-                    AxisValueLabel(format: .percent)
+                    AxisValueLabel {
+                        if let value = $0.as(Double.self) {
+                            Text(value, format: .percent)
+                        }
+                    }
                 }
             }
             .accessibilityChartDescriptor(CompoundingChartDescriptor(points: viewModel.points))
@@ -60,9 +64,19 @@
         let xAxis = AXNumericDataAxisDescriptor(
             title: "Year",
             range: Double((points.first?.year ?? 0))...Double((points.last?.year ?? 0)),
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                String(Int(value))
+            }
+        )
+        let yAxis = AXNumericDataAxisDescriptor(
+            title: "Capacity",
+            range: 0...1,
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
-        let yAxis = AXNumericDataAxisDescriptor(title: "Capacity", range: 0...1, gridlinePositions: [])
 
         let series = AXDataSeriesDescriptor(
             name: "Capacity",
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
index 2ce700cd11c0855d714405bfa9e68d3521028a31..c59531c13f4db12c808b65ff2574996f65908384
--- a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
@@ -10,8 +10,6 @@
 
 struct HistoricalComparisonView: View {
     @State private var viewModel: HistoricalComparisonViewModel
-    @Namespace private var rotorNamespace
-
     init(analysis: PolicyAnalysis) {
         _viewModel = State(initialValue: HistoricalComparisonViewModel(analysis: analysis))
     }
@@ -29,9 +27,7 @@
                 )
                 .foregroundStyle(HistoricalComparisonViewStyle.barColor(isCurrent: entry.isCurrent))
                 .accessibilityLabel(entry.name)
-                .accessibilityValue(entry.coi.formatted(.number.precision(.fractionLength(2))))
-                .accessibilityAddTraits(entry.isCurrent ? .isSelected : [])
-                .accessibilityRotorEntry(id: entry.id, in: rotorNamespace)
+                .accessibilityValue(accessibilityValue(for: entry))
             }
             .chartYAxis {
                 AxisMarks(position: .leading) {
@@ -42,12 +38,16 @@
             .accessibilityElement(children: .contain)
         }
         .padding(24)
-        .accessibilityRotor("Historical Policies") {
-            ForEach(viewModel.entries) { entry in
-                AccessibilityRotorEntry(entry.name, id: entry.id, in: rotorNamespace)
-            }
+        .accessibilityRotor("Historical Policies", entries: viewModel.entries, entryID: \.id, entryLabel: \.name)
+        .accessibilitySortPriority(1)
+    }
+
+    private func accessibilityValue(for entry: HistoricalComparisonEntry) -> String {
+        let score = entry.coi.formatted(.number.precision(.fractionLength(2)))
+        if entry.isCurrent {
+            return "\(score), current policy"
         }
-        .accessibilitySortPriority(1)
+        return score
     }
 }
 
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Searching Charts module for label**
exec
/bin/zsh -lc 'SDK_PATH=$(xcrun --sdk macosx26.2 --show-sdk-path)
rg -n "AxisValueLabel" "$SDK_PATH/System/Library/Frameworks/Charts.framework" -g "*.swiftinterface" | head -n 20' in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 51ms:
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/x86_64-apple-macos.swiftinterface:1024:public struct AxisValueLabel<Content> : Charts.AxisMark where Content : SwiftUICore.View {
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/x86_64-apple-macos.swiftinterface:1026:  nonisolated public init(centered: Swift.Bool? = nil, anchor: SwiftUICore.UnitPoint? = nil, multiLabelAlignment: SwiftUICore.Alignment? = nil, collisionResolution: Charts.AxisValueLabelCollisionResolution = .automatic, offsetsMarks: Swift.Bool? = nil, orientation: Charts.AxisValueLabelOrientation = .automatic, horizontalSpacing: CoreFoundation.CGFloat? = nil, verticalSpacing: CoreFoundation.CGFloat? = nil) where Content == Swift.Never
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/x86_64-apple-macos.swiftinterface:1029:  nonisolated public init(centered: Swift.Bool? = nil, anchor: SwiftUICore.UnitPoint? = nil, multiLabelAlignment: SwiftUICore.Alignment? = nil, collisionResolution: Charts.AxisValueLabelCollisionResolution = .automatic, offsetsMarks: Swift.Bool? = nil, orientation: Charts.AxisValueLabelOrientation = .automatic, horizontalSpacing: CoreFoundation.CGFloat? = nil, verticalSpacing: CoreFoundation.CGFloat? = nil, @SwiftUICore.ViewBuilder content: () -> Content)
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/x86_64-apple-macos.swiftinterface:1032:  nonisolated public init(_ titleKey: SwiftUICore.LocalizedStringKey, centered: Swift.Bool? = nil, anchor: SwiftUICore.UnitPoint? = nil, multiLabelAlignment: SwiftUICore.Alignment? = nil, collisionResolution: Charts.AxisValueLabelCollisionResolution = .automatic, offsetsMarks: Swift.Bool? = nil, orientation: Charts.AxisValueLabelOrientation = .automatic, horizontalSpacing: CoreFoundation.CGFloat? = nil, verticalSpacing: CoreFoundation.CGFloat? = nil) where Content == SwiftUICore.Text
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/x86_64-apple-macos.swiftinterface:1035:  @_disfavoredOverload @_alwaysEmitIntoClient nonisolated public init(_ titleResource: Foundation.LocalizedStringResource, centered: Swift.Bool? = nil, anchor: SwiftUICore.UnitPoint? = nil, multiLabelAlignment: SwiftUICore.Alignment? = nil, collisionResolution: Charts.AxisValueLabelCollisionResolution = .automatic, offsetsMarks: Swift.Bool? = nil, orientation: Charts.AxisValueLabelOrientation = .automatic, horizontalSpacing: CoreFoundation.CGFloat? = nil, verticalSpacing: CoreFoundation.CGFloat? = nil) where Content == SwiftUICore.Text {
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/x86_64-apple-macos.swiftinterface:1050:  @_disfavoredOverload nonisolated public init<S>(_ title: S, centered: Swift.Bool? = nil, anchor: SwiftUICore.UnitPoint? = nil, multiLabelAlignment: SwiftUICore.Alignment? = nil, collisionResolution: Charts.AxisValueLabelCollisionResolution = .automatic, offsetsMarks: Swift.Bool? = nil, orientation: Charts.AxisValueLabelOrientation = .automatic, horizontalSpacing: CoreFoundation.CGFloat? = nil, verticalSpacing: CoreFoundation.CGFloat? = nil) where Content == SwiftUICore.Text, S : Swift.StringProtocol
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/x86_64-apple-macos.swiftinterface:1053:  nonisolated public init<Format>(format: Format, centered: Swift.Bool? = nil, anchor: SwiftUICore.UnitPoint? = nil, multiLabelAlignment: SwiftUICore.Alignment? = nil, collisionResolution: Charts.AxisValueLabelCollisionResolution = .automatic, offsetsMarks: Swift.Bool? = nil, orientation: Charts.AxisValueLabelOrientation = .automatic, horizontalSpacing: CoreFoundation.CGFloat? = nil, verticalSpacing: CoreFoundation.CGFloat? = nil) where Content == Swift.Never, Format : Foundation.FormatStyle, Format.FormatInput : Charts.Plottable, Format.FormatOutput == Swift.String
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/x86_64-apple-macos.swiftinterface:1055:  public static func _layoutAxisMark(_ content: Charts.AxisValueLabel<Content>, _ inputs: Charts._AxisMarkLayoutInputs)
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/x86_64-apple-macos.swiftinterface:1056:  public static func _renderAxisMark(_ content: Charts.AxisValueLabel<Content>, _ inputs: Charts._AxisMarkRenderInputs) -> Charts._AxisMarkRenderOutputs
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/x86_64-apple-macos.swiftinterface:1058:  public static func _collectAxisMark(_ content: Charts.AxisValueLabel<Content>, _ inputs: Charts._AxisMarkCollectInputs) -> Charts._AxisMarkCollectOutputs
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/x86_64-apple-macos.swiftinterface:1061:public struct AxisValueLabelOrientation : Swift.CustomStringConvertible {
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/x86_64-apple-macos.swiftinterface:1062:  public static var automatic: Charts.AxisValueLabelOrientation {
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/x86_64-apple-macos.swiftinterface:1065:  public static var horizontal: Charts.AxisValueLabelOrientation {
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/x86_64-apple-macos.swiftinterface:1068:  public static var vertical: Charts.AxisValueLabelOrientation {
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/x86_64-apple-macos.swiftinterface:1071:  public static var verticalReversed: Charts.AxisValueLabelOrientation {
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/x86_64-apple-macos.swiftinterface:1079:public struct AxisValueLabelCollisionResolution : Swift.CustomStringConvertible {
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/x86_64-apple-macos.swiftinterface:1080:  public static var automatic: Charts.AxisValueLabelCollisionResolution {
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/x86_64-apple-macos.swiftinterface:1083:  public static var greedy: Charts.AxisValueLabelCollisionResolution {
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/x86_64-apple-macos.swiftinterface:1087:  public static func greedy(priority: Swift.Double = 0, minimumSpacing: CoreFoundation.CGFloat? = nil) -> Charts.AxisValueLabelCollisionResolution
/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX26.2.sdk/System/Library/Frameworks/Charts.framework/Versions/A/Modules/Charts.swiftmodule/x86_64-apple-macos.swiftinterface:1089:  public static var truncate: Charts.AxisValueLabelCollisionResolution {
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..36bca8abae5b7493c594fd2a506e8aa5ee5b5f10
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 } else {
@@ -57,7 +61,11 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel {
+                                if let value = $0.as(Double.self) {
+                                    Text(value, format: .percent)
+                                }
+                            }
                         }
                     }
                 }
@@ -80,7 +88,10 @@
         let yAxis = AXNumericDataAxisDescriptor(
             title: "Percentage",
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
 
         let benefitSeries = AXDataSeriesDescriptor(
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
index b25aa9287d9f429c382a3cfb4003f8ea2c80c11e..c00d15514ae62ec16a9898c72cdd4607d0eb8071
--- a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -41,7 +41,11 @@
             .chartYAxis {
                 AxisMarks(position: .leading) {
                     AxisGridLine()
-                    AxisValueLabel(format: .percent)
+                    AxisValueLabel {
+                        if let value = $0.as(Double.self) {
+                            Text(value, format: .percent)
+                        }
+                    }
                 }
             }
             .accessibilityChartDescriptor(CompoundingChartDescriptor(points: viewModel.points))
@@ -60,9 +64,19 @@
         let xAxis = AXNumericDataAxisDescriptor(
             title: "Year",
             range: Double((points.first?.year ?? 0))...Double((points.last?.year ?? 0)),
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                String(Int(value))
+            }
+        )
+        let yAxis = AXNumericDataAxisDescriptor(
+            title: "Capacity",
+            range: 0...1,
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
-        let yAxis = AXNumericDataAxisDescriptor(title: "Capacity", range: 0...1, gridlinePositions: [])
 
         let series = AXDataSeriesDescriptor(
             name: "Capacity",
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
index 2ce700cd11c0855d714405bfa9e68d3521028a31..c59531c13f4db12c808b65ff2574996f65908384
--- a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
@@ -10,8 +10,6 @@
 
 struct HistoricalComparisonView: View {
     @State private var viewModel: HistoricalComparisonViewModel
-    @Namespace private var rotorNamespace
-
     init(analysis: PolicyAnalysis) {
         _viewModel = State(initialValue: HistoricalComparisonViewModel(analysis: analysis))
     }
@@ -29,9 +27,7 @@
                 )
                 .foregroundStyle(HistoricalComparisonViewStyle.barColor(isCurrent: entry.isCurrent))
                 .accessibilityLabel(entry.name)
-                .accessibilityValue(entry.coi.formatted(.number.precision(.fractionLength(2))))
-                .accessibilityAddTraits(entry.isCurrent ? .isSelected : [])
-                .accessibilityRotorEntry(id: entry.id, in: rotorNamespace)
+                .accessibilityValue(accessibilityValue(for: entry))
             }
             .chartYAxis {
                 AxisMarks(position: .leading) {
@@ -42,12 +38,16 @@
             .accessibilityElement(children: .contain)
         }
         .padding(24)
-        .accessibilityRotor("Historical Policies") {
-            ForEach(viewModel.entries) { entry in
-                AccessibilityRotorEntry(entry.name, id: entry.id, in: rotorNamespace)
-            }
+        .accessibilityRotor("Historical Policies", entries: viewModel.entries, entryID: \.id, entryLabel: \.name)
+        .accessibilitySortPriority(1)
+    }
+
+    private func accessibilityValue(for entry: HistoricalComparisonEntry) -> String {
+        let score = entry.coi.formatted(.number.precision(.fractionLength(2)))
+        if entry.isCurrent {
+            return "\(score), current policy"
         }
-        .accessibilitySortPriority(1)
+        return score
     }
 }
 
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }



thinking
**Clarifying closure parameter mismatch**

The error arises because the AxisValueLabel viewBuilder initializer accepts a closure without parameters, but the code tries to use a closure with a parameter, causing the compiler to interpret it as the string-based initializer instead. This means you can't access the axis value inside that closure as currently written.
thinking
**Switching to format-style axis labels**

Decided to replace the invalid closure approach with explicit use of `AxisValueLabel(format:)` passing `FloatingPointFormatStyle<Double>.Percent()` to correctly format axis values as percentages. I'll update affected views accordingly.
file update
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -45,7 +45,3 @@
                             AxisGridLine()
-                            AxisValueLabel {
-                                if let value = $0.as(Double.self) {
-                                    Text(value, format: .percent)
-                                }
-                            }
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
@@ -63,7 +59,3 @@
                             AxisGridLine()
-                            AxisValueLabel {
-                                if let value = $0.as(Double.self) {
-                                    Text(value, format: .percent)
-                                }
-                            }
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
apply_patch(auto_approved=true) exited 0 in 81ms:
Success. Updated the following files:
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..56c9a0232c570d832bae9f796ec09b49d36f2910
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 } else {
@@ -57,7 +57,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 }
@@ -80,7 +80,10 @@
         let yAxis = AXNumericDataAxisDescriptor(
             title: "Percentage",
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
 
         let benefitSeries = AXDataSeriesDescriptor(
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
index b25aa9287d9f429c382a3cfb4003f8ea2c80c11e..c00d15514ae62ec16a9898c72cdd4607d0eb8071
--- a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -41,7 +41,11 @@
             .chartYAxis {
                 AxisMarks(position: .leading) {
                     AxisGridLine()
-                    AxisValueLabel(format: .percent)
+                    AxisValueLabel {
+                        if let value = $0.as(Double.self) {
+                            Text(value, format: .percent)
+                        }
+                    }
                 }
             }
             .accessibilityChartDescriptor(CompoundingChartDescriptor(points: viewModel.points))
@@ -60,9 +64,19 @@
         let xAxis = AXNumericDataAxisDescriptor(
             title: "Year",
             range: Double((points.first?.year ?? 0))...Double((points.last?.year ?? 0)),
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                String(Int(value))
+            }
+        )
+        let yAxis = AXNumericDataAxisDescriptor(
+            title: "Capacity",
+            range: 0...1,
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
-        let yAxis = AXNumericDataAxisDescriptor(title: "Capacity", range: 0...1, gridlinePositions: [])
 
         let series = AXDataSeriesDescriptor(
             name: "Capacity",
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
index 2ce700cd11c0855d714405bfa9e68d3521028a31..c59531c13f4db12c808b65ff2574996f65908384
--- a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
@@ -10,8 +10,6 @@
 
 struct HistoricalComparisonView: View {
     @State private var viewModel: HistoricalComparisonViewModel
-    @Namespace private var rotorNamespace
-
     init(analysis: PolicyAnalysis) {
         _viewModel = State(initialValue: HistoricalComparisonViewModel(analysis: analysis))
     }
@@ -29,9 +27,7 @@
                 )
                 .foregroundStyle(HistoricalComparisonViewStyle.barColor(isCurrent: entry.isCurrent))
                 .accessibilityLabel(entry.name)
-                .accessibilityValue(entry.coi.formatted(.number.precision(.fractionLength(2))))
-                .accessibilityAddTraits(entry.isCurrent ? .isSelected : [])
-                .accessibilityRotorEntry(id: entry.id, in: rotorNamespace)
+                .accessibilityValue(accessibilityValue(for: entry))
             }
             .chartYAxis {
                 AxisMarks(position: .leading) {
@@ -42,12 +38,16 @@
             .accessibilityElement(children: .contain)
         }
         .padding(24)
-        .accessibilityRotor("Historical Policies") {
-            ForEach(viewModel.entries) { entry in
-                AccessibilityRotorEntry(entry.name, id: entry.id, in: rotorNamespace)
-            }
+        .accessibilityRotor("Historical Policies", entries: viewModel.entries, entryID: \.id, entryLabel: \.name)
+        .accessibilitySortPriority(1)
+    }
+
+    private func accessibilityValue(for entry: HistoricalComparisonEntry) -> String {
+        let score = entry.coi.formatted(.number.precision(.fractionLength(2)))
+        if entry.isCurrent {
+            return "\(score), current policy"
         }
-        .accessibilitySortPriority(1)
+        return score
     }
 }
 
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }

file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..56c9a0232c570d832bae9f796ec09b49d36f2910
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 } else {
@@ -57,7 +57,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 }
@@ -80,7 +80,10 @@
         let yAxis = AXNumericDataAxisDescriptor(
             title: "Percentage",
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
 
         let benefitSeries = AXDataSeriesDescriptor(
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
index b25aa9287d9f429c382a3cfb4003f8ea2c80c11e..c00d15514ae62ec16a9898c72cdd4607d0eb8071
--- a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -41,7 +41,11 @@
             .chartYAxis {
                 AxisMarks(position: .leading) {
                     AxisGridLine()
-                    AxisValueLabel(format: .percent)
+                    AxisValueLabel {
+                        if let value = $0.as(Double.self) {
+                            Text(value, format: .percent)
+                        }
+                    }
                 }
             }
             .accessibilityChartDescriptor(CompoundingChartDescriptor(points: viewModel.points))
@@ -60,9 +64,19 @@
         let xAxis = AXNumericDataAxisDescriptor(
             title: "Year",
             range: Double((points.first?.year ?? 0))...Double((points.last?.year ?? 0)),
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                String(Int(value))
+            }
+        )
+        let yAxis = AXNumericDataAxisDescriptor(
+            title: "Capacity",
+            range: 0...1,
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
-        let yAxis = AXNumericDataAxisDescriptor(title: "Capacity", range: 0...1, gridlinePositions: [])
 
         let series = AXDataSeriesDescriptor(
             name: "Capacity",
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
index 2ce700cd11c0855d714405bfa9e68d3521028a31..c59531c13f4db12c808b65ff2574996f65908384
--- a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
@@ -10,8 +10,6 @@
 
 struct HistoricalComparisonView: View {
     @State private var viewModel: HistoricalComparisonViewModel
-    @Namespace private var rotorNamespace
-
     init(analysis: PolicyAnalysis) {
         _viewModel = State(initialValue: HistoricalComparisonViewModel(analysis: analysis))
     }
@@ -29,9 +27,7 @@
                 )
                 .foregroundStyle(HistoricalComparisonViewStyle.barColor(isCurrent: entry.isCurrent))
                 .accessibilityLabel(entry.name)
-                .accessibilityValue(entry.coi.formatted(.number.precision(.fractionLength(2))))
-                .accessibilityAddTraits(entry.isCurrent ? .isSelected : [])
-                .accessibilityRotorEntry(id: entry.id, in: rotorNamespace)
+                .accessibilityValue(accessibilityValue(for: entry))
             }
             .chartYAxis {
                 AxisMarks(position: .leading) {
@@ -42,12 +38,16 @@
             .accessibilityElement(children: .contain)
         }
         .padding(24)
-        .accessibilityRotor("Historical Policies") {
-            ForEach(viewModel.entries) { entry in
-                AccessibilityRotorEntry(entry.name, id: entry.id, in: rotorNamespace)
-            }
+        .accessibilityRotor("Historical Policies", entries: viewModel.entries, entryID: \.id, entryLabel: \.name)
+        .accessibilitySortPriority(1)
+    }
+
+    private func accessibilityValue(for entry: HistoricalComparisonEntry) -> String {
+        let score = entry.coi.formatted(.number.precision(.fractionLength(2)))
+        if entry.isCurrent {
+            return "\(score), current policy"
         }
-        .accessibilitySortPriority(1)
+        return score
     }
 }
 
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Updating trajectory view**
file update
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -43,7 +43,3 @@
                     AxisGridLine()
-                    AxisValueLabel {
-                        if let value = $0.as(Double.self) {
-                            Text(value, format: .percent)
-                        }
-                    }
+                    AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                 }
apply_patch(auto_approved=true) exited 0 in 102ms:
Success. Updated the following files:
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..56c9a0232c570d832bae9f796ec09b49d36f2910
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 } else {
@@ -57,7 +57,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 }
@@ -80,7 +80,10 @@
         let yAxis = AXNumericDataAxisDescriptor(
             title: "Percentage",
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
 
         let benefitSeries = AXDataSeriesDescriptor(
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
index b25aa9287d9f429c382a3cfb4003f8ea2c80c11e..c7968797d0fb2f7dfabcbbebb788cd9264d0aa4a
--- a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -41,7 +41,7 @@
             .chartYAxis {
                 AxisMarks(position: .leading) {
                     AxisGridLine()
-                    AxisValueLabel(format: .percent)
+                    AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                 }
             }
             .accessibilityChartDescriptor(CompoundingChartDescriptor(points: viewModel.points))
@@ -60,9 +60,19 @@
         let xAxis = AXNumericDataAxisDescriptor(
             title: "Year",
             range: Double((points.first?.year ?? 0))...Double((points.last?.year ?? 0)),
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                String(Int(value))
+            }
+        )
+        let yAxis = AXNumericDataAxisDescriptor(
+            title: "Capacity",
+            range: 0...1,
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
-        let yAxis = AXNumericDataAxisDescriptor(title: "Capacity", range: 0...1, gridlinePositions: [])
 
         let series = AXDataSeriesDescriptor(
             name: "Capacity",
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
index 2ce700cd11c0855d714405bfa9e68d3521028a31..c59531c13f4db12c808b65ff2574996f65908384
--- a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
@@ -10,8 +10,6 @@
 
 struct HistoricalComparisonView: View {
     @State private var viewModel: HistoricalComparisonViewModel
-    @Namespace private var rotorNamespace
-
     init(analysis: PolicyAnalysis) {
         _viewModel = State(initialValue: HistoricalComparisonViewModel(analysis: analysis))
     }
@@ -29,9 +27,7 @@
                 )
                 .foregroundStyle(HistoricalComparisonViewStyle.barColor(isCurrent: entry.isCurrent))
                 .accessibilityLabel(entry.name)
-                .accessibilityValue(entry.coi.formatted(.number.precision(.fractionLength(2))))
-                .accessibilityAddTraits(entry.isCurrent ? .isSelected : [])
-                .accessibilityRotorEntry(id: entry.id, in: rotorNamespace)
+                .accessibilityValue(accessibilityValue(for: entry))
             }
             .chartYAxis {
                 AxisMarks(position: .leading) {
@@ -42,12 +38,16 @@
             .accessibilityElement(children: .contain)
         }
         .padding(24)
-        .accessibilityRotor("Historical Policies") {
-            ForEach(viewModel.entries) { entry in
-                AccessibilityRotorEntry(entry.name, id: entry.id, in: rotorNamespace)
-            }
+        .accessibilityRotor("Historical Policies", entries: viewModel.entries, entryID: \.id, entryLabel: \.name)
+        .accessibilitySortPriority(1)
+    }
+
+    private func accessibilityValue(for entry: HistoricalComparisonEntry) -> String {
+        let score = entry.coi.formatted(.number.precision(.fractionLength(2)))
+        if entry.isCurrent {
+            return "\(score), current policy"
         }
-        .accessibilitySortPriority(1)
+        return score
     }
 }
 
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }

file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..56c9a0232c570d832bae9f796ec09b49d36f2910
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 } else {
@@ -57,7 +57,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 }
@@ -80,7 +80,10 @@
         let yAxis = AXNumericDataAxisDescriptor(
             title: "Percentage",
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
 
         let benefitSeries = AXDataSeriesDescriptor(
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
index b25aa9287d9f429c382a3cfb4003f8ea2c80c11e..c7968797d0fb2f7dfabcbbebb788cd9264d0aa4a
--- a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -41,7 +41,7 @@
             .chartYAxis {
                 AxisMarks(position: .leading) {
                     AxisGridLine()
-                    AxisValueLabel(format: .percent)
+                    AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                 }
             }
             .accessibilityChartDescriptor(CompoundingChartDescriptor(points: viewModel.points))
@@ -60,9 +60,19 @@
         let xAxis = AXNumericDataAxisDescriptor(
             title: "Year",
             range: Double((points.first?.year ?? 0))...Double((points.last?.year ?? 0)),
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                String(Int(value))
+            }
+        )
+        let yAxis = AXNumericDataAxisDescriptor(
+            title: "Capacity",
+            range: 0...1,
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
-        let yAxis = AXNumericDataAxisDescriptor(title: "Capacity", range: 0...1, gridlinePositions: [])
 
         let series = AXDataSeriesDescriptor(
             name: "Capacity",
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
index 2ce700cd11c0855d714405bfa9e68d3521028a31..c59531c13f4db12c808b65ff2574996f65908384
--- a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
@@ -10,8 +10,6 @@
 
 struct HistoricalComparisonView: View {
     @State private var viewModel: HistoricalComparisonViewModel
-    @Namespace private var rotorNamespace
-
     init(analysis: PolicyAnalysis) {
         _viewModel = State(initialValue: HistoricalComparisonViewModel(analysis: analysis))
     }
@@ -29,9 +27,7 @@
                 )
                 .foregroundStyle(HistoricalComparisonViewStyle.barColor(isCurrent: entry.isCurrent))
                 .accessibilityLabel(entry.name)
-                .accessibilityValue(entry.coi.formatted(.number.precision(.fractionLength(2))))
-                .accessibilityAddTraits(entry.isCurrent ? .isSelected : [])
-                .accessibilityRotorEntry(id: entry.id, in: rotorNamespace)
+                .accessibilityValue(accessibilityValue(for: entry))
             }
             .chartYAxis {
                 AxisMarks(position: .leading) {
@@ -42,12 +38,16 @@
             .accessibilityElement(children: .contain)
         }
         .padding(24)
-        .accessibilityRotor("Historical Policies") {
-            ForEach(viewModel.entries) { entry in
-                AccessibilityRotorEntry(entry.name, id: entry.id, in: rotorNamespace)
-            }
+        .accessibilityRotor("Historical Policies", entries: viewModel.entries, entryID: \.id, entryLabel: \.name)
+        .accessibilitySortPriority(1)
+    }
+
+    private func accessibilityValue(for entry: HistoricalComparisonEntry) -> String {
+        let score = entry.coi.formatted(.number.precision(.fractionLength(2)))
+        if entry.isCurrent {
+            return "\(score), current policy"
         }
-        .accessibilitySortPriority(1)
+        return score
     }
 }
 
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Triggering rebuild**
tool xcodebuildmcp.build_macos({})
xcodebuildmcp.build_macos({}) success in 16.88s:
{
  "content": [
    {
      "type": "text",
      "text": "⚠️ Warning: 2026-02-23 00:05:27.142 appintentsmetadataprocessor[61455:371659] warning: Metadata extraction skipped. No AppIntents.framework dependency found."
    },
    {
      "type": "text",
      "text": "✅ macOS Build build succeeded for scheme decodingOppression."
    },
    {
      "type": "text",
      "text": "Next Steps:\n1. Get app path: get_mac_app_path({ scheme: 'decodingOppression' })\n2. Get bundle ID: get_mac_bundle_id({ appPath: 'PATH_FROM_STEP_1' })\n3. Launch: launch_mac_app({ appPath: 'PATH_FROM_STEP_1' })"
    }
  ]
}
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..56c9a0232c570d832bae9f796ec09b49d36f2910
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 } else {
@@ -57,7 +57,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 }
@@ -80,7 +80,10 @@
         let yAxis = AXNumericDataAxisDescriptor(
             title: "Percentage",
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
 
         let benefitSeries = AXDataSeriesDescriptor(
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
index b25aa9287d9f429c382a3cfb4003f8ea2c80c11e..c7968797d0fb2f7dfabcbbebb788cd9264d0aa4a
--- a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -41,7 +41,7 @@
             .chartYAxis {
                 AxisMarks(position: .leading) {
                     AxisGridLine()
-                    AxisValueLabel(format: .percent)
+                    AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                 }
             }
             .accessibilityChartDescriptor(CompoundingChartDescriptor(points: viewModel.points))
@@ -60,9 +60,19 @@
         let xAxis = AXNumericDataAxisDescriptor(
             title: "Year",
             range: Double((points.first?.year ?? 0))...Double((points.last?.year ?? 0)),
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                String(Int(value))
+            }
+        )
+        let yAxis = AXNumericDataAxisDescriptor(
+            title: "Capacity",
+            range: 0...1,
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
-        let yAxis = AXNumericDataAxisDescriptor(title: "Capacity", range: 0...1, gridlinePositions: [])
 
         let series = AXDataSeriesDescriptor(
             name: "Capacity",
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
index 2ce700cd11c0855d714405bfa9e68d3521028a31..c59531c13f4db12c808b65ff2574996f65908384
--- a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
@@ -10,8 +10,6 @@
 
 struct HistoricalComparisonView: View {
     @State private var viewModel: HistoricalComparisonViewModel
-    @Namespace private var rotorNamespace
-
     init(analysis: PolicyAnalysis) {
         _viewModel = State(initialValue: HistoricalComparisonViewModel(analysis: analysis))
     }
@@ -29,9 +27,7 @@
                 )
                 .foregroundStyle(HistoricalComparisonViewStyle.barColor(isCurrent: entry.isCurrent))
                 .accessibilityLabel(entry.name)
-                .accessibilityValue(entry.coi.formatted(.number.precision(.fractionLength(2))))
-                .accessibilityAddTraits(entry.isCurrent ? .isSelected : [])
-                .accessibilityRotorEntry(id: entry.id, in: rotorNamespace)
+                .accessibilityValue(accessibilityValue(for: entry))
             }
             .chartYAxis {
                 AxisMarks(position: .leading) {
@@ -42,12 +38,16 @@
             .accessibilityElement(children: .contain)
         }
         .padding(24)
-        .accessibilityRotor("Historical Policies") {
-            ForEach(viewModel.entries) { entry in
-                AccessibilityRotorEntry(entry.name, id: entry.id, in: rotorNamespace)
-            }
+        .accessibilityRotor("Historical Policies", entries: viewModel.entries, entryID: \.id, entryLabel: \.name)
+        .accessibilitySortPriority(1)
+    }
+
+    private func accessibilityValue(for entry: HistoricalComparisonEntry) -> String {
+        let score = entry.coi.formatted(.number.precision(.fractionLength(2)))
+        if entry.isCurrent {
+            return "\(score), current policy"
         }
-        .accessibilitySortPriority(1)
+        return score
     }
 }
 
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Confirming macOS build success, planning iOS build check**

macOS build passed without errors, possibly with suppressed warnings; next, I’ll run the iOS simulator build on iPhone 16 to verify iOS compatibility and detect any new issues.
tool xcodebuildmcp.build_sim({"simulatorName":"iPhone 16","useLatestOS":true})
xcodebuildmcp.build_sim({"simulatorName":"iPhone 16","useLatestOS":true}) failed in 2ms:
{
  "content": [
    {
      "type": "text",
      "text": "Error: Missing required session defaults\nDetails: Provide simulatorId or simulatorName\nSet with: session-set-defaults { \"simulatorId\": \"...\" } OR session-set-defaults { \"simulatorName\": \"...\" }"
    }
  ],
  "isError": true
}
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..56c9a0232c570d832bae9f796ec09b49d36f2910
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 } else {
@@ -57,7 +57,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 }
@@ -80,7 +80,10 @@
         let yAxis = AXNumericDataAxisDescriptor(
             title: "Percentage",
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
 
         let benefitSeries = AXDataSeriesDescriptor(
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
index b25aa9287d9f429c382a3cfb4003f8ea2c80c11e..c7968797d0fb2f7dfabcbbebb788cd9264d0aa4a
--- a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -41,7 +41,7 @@
             .chartYAxis {
                 AxisMarks(position: .leading) {
                     AxisGridLine()
-                    AxisValueLabel(format: .percent)
+                    AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                 }
             }
             .accessibilityChartDescriptor(CompoundingChartDescriptor(points: viewModel.points))
@@ -60,9 +60,19 @@
         let xAxis = AXNumericDataAxisDescriptor(
             title: "Year",
             range: Double((points.first?.year ?? 0))...Double((points.last?.year ?? 0)),
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                String(Int(value))
+            }
+        )
+        let yAxis = AXNumericDataAxisDescriptor(
+            title: "Capacity",
+            range: 0...1,
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
-        let yAxis = AXNumericDataAxisDescriptor(title: "Capacity", range: 0...1, gridlinePositions: [])
 
         let series = AXDataSeriesDescriptor(
             name: "Capacity",
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
index 2ce700cd11c0855d714405bfa9e68d3521028a31..c59531c13f4db12c808b65ff2574996f65908384
--- a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
@@ -10,8 +10,6 @@
 
 struct HistoricalComparisonView: View {
     @State private var viewModel: HistoricalComparisonViewModel
-    @Namespace private var rotorNamespace
-
     init(analysis: PolicyAnalysis) {
         _viewModel = State(initialValue: HistoricalComparisonViewModel(analysis: analysis))
     }
@@ -29,9 +27,7 @@
                 )
                 .foregroundStyle(HistoricalComparisonViewStyle.barColor(isCurrent: entry.isCurrent))
                 .accessibilityLabel(entry.name)
-                .accessibilityValue(entry.coi.formatted(.number.precision(.fractionLength(2))))
-                .accessibilityAddTraits(entry.isCurrent ? .isSelected : [])
-                .accessibilityRotorEntry(id: entry.id, in: rotorNamespace)
+                .accessibilityValue(accessibilityValue(for: entry))
             }
             .chartYAxis {
                 AxisMarks(position: .leading) {
@@ -42,12 +38,16 @@
             .accessibilityElement(children: .contain)
         }
         .padding(24)
-        .accessibilityRotor("Historical Policies") {
-            ForEach(viewModel.entries) { entry in
-                AccessibilityRotorEntry(entry.name, id: entry.id, in: rotorNamespace)
-            }
+        .accessibilityRotor("Historical Policies", entries: viewModel.entries, entryID: \.id, entryLabel: \.name)
+        .accessibilitySortPriority(1)
+    }
+
+    private func accessibilityValue(for entry: HistoricalComparisonEntry) -> String {
+        let score = entry.coi.formatted(.number.precision(.fractionLength(2)))
+        if entry.isCurrent {
+            return "\(score), current policy"
         }
-        .accessibilitySortPriority(1)
+        return score
     }
 }
 
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Planning session default setting**

I'm preparing to call session-set-defaults with simulatorName "iPhone 16" and useLatestOS to configure the session defaults accordingly.
tool xcodebuildmcp.session-set-defaults({"simulatorName":"iPhone 16","useLatestOS":true})
xcodebuildmcp.session-set-defaults({"simulatorName":"iPhone 16","useLatestOS":true}) success in 4ms:
{
  "content": [
    {
      "type": "text",
      "text": "Defaults updated:\n{\n  \"projectPath\": \"/Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression.xcodeproj\",\n  \"scheme\": \"decodingOppression\",\n  \"simulatorName\": \"iPhone 16\",\n  \"useLatestOS\": true\n}"
    }
  ],
  "isError": false
}
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..56c9a0232c570d832bae9f796ec09b49d36f2910
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 } else {
@@ -57,7 +57,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 }
@@ -80,7 +80,10 @@
         let yAxis = AXNumericDataAxisDescriptor(
             title: "Percentage",
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
 
         let benefitSeries = AXDataSeriesDescriptor(
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
index b25aa9287d9f429c382a3cfb4003f8ea2c80c11e..c7968797d0fb2f7dfabcbbebb788cd9264d0aa4a
--- a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -41,7 +41,7 @@
             .chartYAxis {
                 AxisMarks(position: .leading) {
                     AxisGridLine()
-                    AxisValueLabel(format: .percent)
+                    AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                 }
             }
             .accessibilityChartDescriptor(CompoundingChartDescriptor(points: viewModel.points))
@@ -60,9 +60,19 @@
         let xAxis = AXNumericDataAxisDescriptor(
             title: "Year",
             range: Double((points.first?.year ?? 0))...Double((points.last?.year ?? 0)),
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                String(Int(value))
+            }
+        )
+        let yAxis = AXNumericDataAxisDescriptor(
+            title: "Capacity",
+            range: 0...1,
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
-        let yAxis = AXNumericDataAxisDescriptor(title: "Capacity", range: 0...1, gridlinePositions: [])
 
         let series = AXDataSeriesDescriptor(
             name: "Capacity",
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
index 2ce700cd11c0855d714405bfa9e68d3521028a31..c59531c13f4db12c808b65ff2574996f65908384
--- a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
@@ -10,8 +10,6 @@
 
 struct HistoricalComparisonView: View {
     @State private var viewModel: HistoricalComparisonViewModel
-    @Namespace private var rotorNamespace
-
     init(analysis: PolicyAnalysis) {
         _viewModel = State(initialValue: HistoricalComparisonViewModel(analysis: analysis))
     }
@@ -29,9 +27,7 @@
                 )
                 .foregroundStyle(HistoricalComparisonViewStyle.barColor(isCurrent: entry.isCurrent))
                 .accessibilityLabel(entry.name)
-                .accessibilityValue(entry.coi.formatted(.number.precision(.fractionLength(2))))
-                .accessibilityAddTraits(entry.isCurrent ? .isSelected : [])
-                .accessibilityRotorEntry(id: entry.id, in: rotorNamespace)
+                .accessibilityValue(accessibilityValue(for: entry))
             }
             .chartYAxis {
                 AxisMarks(position: .leading) {
@@ -42,12 +38,16 @@
             .accessibilityElement(children: .contain)
         }
         .padding(24)
-        .accessibilityRotor("Historical Policies") {
-            ForEach(viewModel.entries) { entry in
-                AccessibilityRotorEntry(entry.name, id: entry.id, in: rotorNamespace)
-            }
+        .accessibilityRotor("Historical Policies", entries: viewModel.entries, entryID: \.id, entryLabel: \.name)
+        .accessibilitySortPriority(1)
+    }
+
+    private func accessibilityValue(for entry: HistoricalComparisonEntry) -> String {
+        let score = entry.coi.formatted(.number.precision(.fractionLength(2)))
+        if entry.isCurrent {
+            return "\(score), current policy"
         }
-        .accessibilitySortPriority(1)
+        return score
     }
 }
 
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Starting simulation build**
tool xcodebuildmcp.build_sim({})
xcodebuildmcp.build_sim({}) failed in 1m 00s:
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..56c9a0232c570d832bae9f796ec09b49d36f2910
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 } else {
@@ -57,7 +57,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 }
@@ -80,7 +80,10 @@
         let yAxis = AXNumericDataAxisDescriptor(
             title: "Percentage",
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
 
         let benefitSeries = AXDataSeriesDescriptor(
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
index b25aa9287d9f429c382a3cfb4003f8ea2c80c11e..c7968797d0fb2f7dfabcbbebb788cd9264d0aa4a
--- a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -41,7 +41,7 @@
             .chartYAxis {
                 AxisMarks(position: .leading) {
                     AxisGridLine()
-                    AxisValueLabel(format: .percent)
+                    AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                 }
             }
             .accessibilityChartDescriptor(CompoundingChartDescriptor(points: viewModel.points))
@@ -60,9 +60,19 @@
         let xAxis = AXNumericDataAxisDescriptor(
             title: "Year",
             range: Double((points.first?.year ?? 0))...Double((points.last?.year ?? 0)),
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                String(Int(value))
+            }
+        )
+        let yAxis = AXNumericDataAxisDescriptor(
+            title: "Capacity",
+            range: 0...1,
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
-        let yAxis = AXNumericDataAxisDescriptor(title: "Capacity", range: 0...1, gridlinePositions: [])
 
         let series = AXDataSeriesDescriptor(
             name: "Capacity",
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
index 2ce700cd11c0855d714405bfa9e68d3521028a31..c59531c13f4db12c808b65ff2574996f65908384
--- a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
@@ -10,8 +10,6 @@
 
 struct HistoricalComparisonView: View {
     @State private var viewModel: HistoricalComparisonViewModel
-    @Namespace private var rotorNamespace
-
     init(analysis: PolicyAnalysis) {
         _viewModel = State(initialValue: HistoricalComparisonViewModel(analysis: analysis))
     }
@@ -29,9 +27,7 @@
                 )
                 .foregroundStyle(HistoricalComparisonViewStyle.barColor(isCurrent: entry.isCurrent))
                 .accessibilityLabel(entry.name)
-                .accessibilityValue(entry.coi.formatted(.number.precision(.fractionLength(2))))
-                .accessibilityAddTraits(entry.isCurrent ? .isSelected : [])
-                .accessibilityRotorEntry(id: entry.id, in: rotorNamespace)
+                .accessibilityValue(accessibilityValue(for: entry))
             }
             .chartYAxis {
                 AxisMarks(position: .leading) {
@@ -42,12 +38,16 @@
             .accessibilityElement(children: .contain)
         }
         .padding(24)
-        .accessibilityRotor("Historical Policies") {
-            ForEach(viewModel.entries) { entry in
-                AccessibilityRotorEntry(entry.name, id: entry.id, in: rotorNamespace)
-            }
+        .accessibilityRotor("Historical Policies", entries: viewModel.entries, entryID: \.id, entryLabel: \.name)
+        .accessibilitySortPriority(1)
+    }
+
+    private func accessibilityValue(for entry: HistoricalComparisonEntry) -> String {
+        let score = entry.coi.formatted(.number.precision(.fractionLength(2)))
+        if entry.isCurrent {
+            return "\(score), current policy"
         }
-        .accessibilitySortPriority(1)
+        return score
     }
 }
 
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }



thinking
**Noting build simulation timeout**

Build simulation timed out after 60 seconds but may still be running; we'll note this and avoid leaving orphaned builds. I'll continue verifying accessibility descriptor updates and ensure all relevant axis and label adjustments are correctly applied.
thinking
**Verifying viewModel updates in PolicyHistoryView**

Confirmed updating PolicyHistoryView with required viewModel in root and previews; I'll double-check for any other calls missing this update to prevent build issues.
exec
/bin/zsh -lc "rg -n \"PolicyHistoryView\\(\" app/decodingOppression/decodingOppression" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 51ms:
app/decodingOppression/decodingOppression/ContentView.swift:22:                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
app/decodingOppression/decodingOppression/ContentView.swift:38:                    PolicyHistoryView(viewModel: historyViewModel)
app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift:186:        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..56c9a0232c570d832bae9f796ec09b49d36f2910
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 } else {
@@ -57,7 +57,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 }
@@ -80,7 +80,10 @@
         let yAxis = AXNumericDataAxisDescriptor(
             title: "Percentage",
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
 
         let benefitSeries = AXDataSeriesDescriptor(
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
index b25aa9287d9f429c382a3cfb4003f8ea2c80c11e..c7968797d0fb2f7dfabcbbebb788cd9264d0aa4a
--- a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -41,7 +41,7 @@
             .chartYAxis {
                 AxisMarks(position: .leading) {
                     AxisGridLine()
-                    AxisValueLabel(format: .percent)
+                    AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                 }
             }
             .accessibilityChartDescriptor(CompoundingChartDescriptor(points: viewModel.points))
@@ -60,9 +60,19 @@
         let xAxis = AXNumericDataAxisDescriptor(
             title: "Year",
             range: Double((points.first?.year ?? 0))...Double((points.last?.year ?? 0)),
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                String(Int(value))
+            }
+        )
+        let yAxis = AXNumericDataAxisDescriptor(
+            title: "Capacity",
+            range: 0...1,
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
-        let yAxis = AXNumericDataAxisDescriptor(title: "Capacity", range: 0...1, gridlinePositions: [])
 
         let series = AXDataSeriesDescriptor(
             name: "Capacity",
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
index 2ce700cd11c0855d714405bfa9e68d3521028a31..c59531c13f4db12c808b65ff2574996f65908384
--- a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
@@ -10,8 +10,6 @@
 
 struct HistoricalComparisonView: View {
     @State private var viewModel: HistoricalComparisonViewModel
-    @Namespace private var rotorNamespace
-
     init(analysis: PolicyAnalysis) {
         _viewModel = State(initialValue: HistoricalComparisonViewModel(analysis: analysis))
     }
@@ -29,9 +27,7 @@
                 )
                 .foregroundStyle(HistoricalComparisonViewStyle.barColor(isCurrent: entry.isCurrent))
                 .accessibilityLabel(entry.name)
-                .accessibilityValue(entry.coi.formatted(.number.precision(.fractionLength(2))))
-                .accessibilityAddTraits(entry.isCurrent ? .isSelected : [])
-                .accessibilityRotorEntry(id: entry.id, in: rotorNamespace)
+                .accessibilityValue(accessibilityValue(for: entry))
             }
             .chartYAxis {
                 AxisMarks(position: .leading) {
@@ -42,12 +38,16 @@
             .accessibilityElement(children: .contain)
         }
         .padding(24)
-        .accessibilityRotor("Historical Policies") {
-            ForEach(viewModel.entries) { entry in
-                AccessibilityRotorEntry(entry.name, id: entry.id, in: rotorNamespace)
-            }
+        .accessibilityRotor("Historical Policies", entries: viewModel.entries, entryID: \.id, entryLabel: \.name)
+        .accessibilitySortPriority(1)
+    }
+
+    private func accessibilityValue(for entry: HistoricalComparisonEntry) -> String {
+        let score = entry.coi.formatted(.number.precision(.fractionLength(2)))
+        if entry.isCurrent {
+            return "\(score), current policy"
         }
-        .accessibilitySortPriority(1)
+        return score
     }
 }
 
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Checking variable usage of accessibility entries**

I'm verifying if any `AccessibilityRotorEntry` instances use a string variable with the `id:` parameter instead of a string literal to ensure consistent initialization with `LocalizedStringKey`.
exec
/bin/zsh -lc "rg -n \"AccessibilityRotorEntry\\(\" app/decodingOppression/decodingOppression" in /Users/emmanuel/Documents/Theory/Redefining_racism succeeded in 52ms:
app/decodingOppression/decodingOppression/Views/ClauseListView.swift:47:                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
app/decodingOppression/decodingOppression/Views/ClauseListView.swift:52:                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
app/decodingOppression/decodingOppression/Views/ScoreCardView.swift:63:                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
app/decodingOppression/decodingOppression/Views/ScoreCardView.swift:64:                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
app/decodingOppression/decodingOppression/Views/ScoreCardView.swift:65:                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
app/decodingOppression/decodingOppression/Views/ScoreCardView.swift:66:                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
app/decodingOppression/decodingOppression/Views/ScoreCardView.swift:67:                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
app/decodingOppression/decodingOppression/Views/ScoreCardView.swift:68:                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..56c9a0232c570d832bae9f796ec09b49d36f2910
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 } else {
@@ -57,7 +57,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 }
@@ -80,7 +80,10 @@
         let yAxis = AXNumericDataAxisDescriptor(
             title: "Percentage",
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
 
         let benefitSeries = AXDataSeriesDescriptor(
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
index b25aa9287d9f429c382a3cfb4003f8ea2c80c11e..c7968797d0fb2f7dfabcbbebb788cd9264d0aa4a
--- a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -41,7 +41,7 @@
             .chartYAxis {
                 AxisMarks(position: .leading) {
                     AxisGridLine()
-                    AxisValueLabel(format: .percent)
+                    AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                 }
             }
             .accessibilityChartDescriptor(CompoundingChartDescriptor(points: viewModel.points))
@@ -60,9 +60,19 @@
         let xAxis = AXNumericDataAxisDescriptor(
             title: "Year",
             range: Double((points.first?.year ?? 0))...Double((points.last?.year ?? 0)),
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                String(Int(value))
+            }
+        )
+        let yAxis = AXNumericDataAxisDescriptor(
+            title: "Capacity",
+            range: 0...1,
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
-        let yAxis = AXNumericDataAxisDescriptor(title: "Capacity", range: 0...1, gridlinePositions: [])
 
         let series = AXDataSeriesDescriptor(
             name: "Capacity",
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
index 2ce700cd11c0855d714405bfa9e68d3521028a31..c59531c13f4db12c808b65ff2574996f65908384
--- a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
@@ -10,8 +10,6 @@
 
 struct HistoricalComparisonView: View {
     @State private var viewModel: HistoricalComparisonViewModel
-    @Namespace private var rotorNamespace
-
     init(analysis: PolicyAnalysis) {
         _viewModel = State(initialValue: HistoricalComparisonViewModel(analysis: analysis))
     }
@@ -29,9 +27,7 @@
                 )
                 .foregroundStyle(HistoricalComparisonViewStyle.barColor(isCurrent: entry.isCurrent))
                 .accessibilityLabel(entry.name)
-                .accessibilityValue(entry.coi.formatted(.number.precision(.fractionLength(2))))
-                .accessibilityAddTraits(entry.isCurrent ? .isSelected : [])
-                .accessibilityRotorEntry(id: entry.id, in: rotorNamespace)
+                .accessibilityValue(accessibilityValue(for: entry))
             }
             .chartYAxis {
                 AxisMarks(position: .leading) {
@@ -42,12 +38,16 @@
             .accessibilityElement(children: .contain)
         }
         .padding(24)
-        .accessibilityRotor("Historical Policies") {
-            ForEach(viewModel.entries) { entry in
-                AccessibilityRotorEntry(entry.name, id: entry.id, in: rotorNamespace)
-            }
+        .accessibilityRotor("Historical Policies", entries: viewModel.entries, entryID: \.id, entryLabel: \.name)
+        .accessibilitySortPriority(1)
+    }
+
+    private func accessibilityValue(for entry: HistoricalComparisonEntry) -> String {
+        let score = entry.coi.formatted(.number.precision(.fractionLength(2)))
+        if entry.isCurrent {
+            return "\(score), current policy"
         }
-        .accessibilitySortPriority(1)
+        return score
     }
 }
 
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }



thinking
**Confirming recent successful build**

The last build after fixing axis labels and historical comparison errors succeeded on macOS, so current warnings about main actor isolation seem resolved or suppressed.
thinking
**Planning to rerun macOS build for verification**

There were multiple iterative fixes and errors around axis label types and HistoricalComparison, with some builds succeeding and others failing; I'll rerun the macOS build now to confirm stability after the latest changes.
tool xcodebuildmcp.build_macos({})
xcodebuildmcp.build_macos({}) success in 3.20s:
{
  "content": [
    {
      "type": "text",
      "text": "✅ macOS Build build succeeded for scheme decodingOppression."
    },
    {
      "type": "text",
      "text": "Next Steps:\n1. Get app path: get_mac_app_path({ scheme: 'decodingOppression' })\n2. Get bundle ID: get_mac_bundle_id({ appPath: 'PATH_FROM_STEP_1' })\n3. Launch: launch_mac_app({ appPath: 'PATH_FROM_STEP_1' })"
    }
  ]
}
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..f85b7db7565c24ebe217c6304a762c5c6b5bffc3
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -19,7 +19,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..56c9a0232c570d832bae9f796ec09b49d36f2910
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 } else {
@@ -57,7 +57,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 }
@@ -80,7 +80,10 @@
         let yAxis = AXNumericDataAxisDescriptor(
             title: "Percentage",
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
 
         let benefitSeries = AXDataSeriesDescriptor(
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
index b25aa9287d9f429c382a3cfb4003f8ea2c80c11e..c7968797d0fb2f7dfabcbbebb788cd9264d0aa4a
--- a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -41,7 +41,7 @@
             .chartYAxis {
                 AxisMarks(position: .leading) {
                     AxisGridLine()
-                    AxisValueLabel(format: .percent)
+                    AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                 }
             }
             .accessibilityChartDescriptor(CompoundingChartDescriptor(points: viewModel.points))
@@ -60,9 +60,19 @@
         let xAxis = AXNumericDataAxisDescriptor(
             title: "Year",
             range: Double((points.first?.year ?? 0))...Double((points.last?.year ?? 0)),
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                String(Int(value))
+            }
+        )
+        let yAxis = AXNumericDataAxisDescriptor(
+            title: "Capacity",
+            range: 0...1,
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
-        let yAxis = AXNumericDataAxisDescriptor(title: "Capacity", range: 0...1, gridlinePositions: [])
 
         let series = AXDataSeriesDescriptor(
             name: "Capacity",
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
index 2ce700cd11c0855d714405bfa9e68d3521028a31..c59531c13f4db12c808b65ff2574996f65908384
--- a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
@@ -10,8 +10,6 @@
 
 struct HistoricalComparisonView: View {
     @State private var viewModel: HistoricalComparisonViewModel
-    @Namespace private var rotorNamespace
-
     init(analysis: PolicyAnalysis) {
         _viewModel = State(initialValue: HistoricalComparisonViewModel(analysis: analysis))
     }
@@ -29,9 +27,7 @@
                 )
                 .foregroundStyle(HistoricalComparisonViewStyle.barColor(isCurrent: entry.isCurrent))
                 .accessibilityLabel(entry.name)
-                .accessibilityValue(entry.coi.formatted(.number.precision(.fractionLength(2))))
-                .accessibilityAddTraits(entry.isCurrent ? .isSelected : [])
-                .accessibilityRotorEntry(id: entry.id, in: rotorNamespace)
+                .accessibilityValue(accessibilityValue(for: entry))
             }
             .chartYAxis {
                 AxisMarks(position: .leading) {
@@ -42,12 +38,16 @@
             .accessibilityElement(children: .contain)
         }
         .padding(24)
-        .accessibilityRotor("Historical Policies") {
-            ForEach(viewModel.entries) { entry in
-                AccessibilityRotorEntry(entry.name, id: entry.id, in: rotorNamespace)
-            }
+        .accessibilityRotor("Historical Policies", entries: viewModel.entries, entryID: \.id, entryLabel: \.name)
+        .accessibilitySortPriority(1)
+    }
+
+    private func accessibilityValue(for entry: HistoricalComparisonEntry) -> String {
+        let score = entry.coi.formatted(.number.precision(.fractionLength(2)))
+        if entry.isCurrent {
+            return "\(score), current policy"
         }
-        .accessibilitySortPriority(1)
+        return score
     }
 }
 
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }



thinking
**Noting build timeout and file updates**

The iOS build timed out again despite retrying; I'll note this alongside the success of the macOS build. I've updated additional files (including MLX-related ones) to fix build issues not previously planned, and I'll mention these changes with relevant tests in the final summary.
thinking
**Improving iOS viewModel state management**

I decided to add a stored `@State` viewModel property for iOS in ContentView to avoid recreating the viewModel on every render, aligning with the macOS pattern and maintaining state properly after the initializer change. This small improvement helps stabilize iOS UI behavior without breaking cross-platform compilation.
file update
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/ContentView.swift
@@ -12,2 +12,6 @@
 
+    #if os(iOS)
+    @State private var historyViewModel = PolicyHistoryViewModel()
+    #endif
+
     #if os(macOS)
@@ -21,3 +25,3 @@
             if hasCompletedOnboarding {
-                PolicyHistoryView(viewModel: PolicyHistoryViewModel())
+                PolicyHistoryView(viewModel: historyViewModel)
             } else {
apply_patch(auto_approved=true) exited 0 in 106ms:
Success. Updated the following files:
M /Users/emmanuel/Documents/Theory/Redefining_racism/app/decodingOppression/decodingOppression/ContentView.swift
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..4a1b3f80f9d045c59360287161aa42f4ca26dd92
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -10,6 +10,10 @@
 struct ContentView: View {
     @AppStorage("hasCompletedOnboarding") private var hasCompletedOnboarding: Bool = false
 
+    #if os(iOS)
+    @State private var historyViewModel = PolicyHistoryViewModel()
+    #endif
+
     #if os(macOS)
     @State private var selectedSidebarItem: SidebarItem? = .analyze
     @State private var historyViewModel = PolicyHistoryViewModel()
@@ -19,7 +23,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: historyViewModel)
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..56c9a0232c570d832bae9f796ec09b49d36f2910
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 } else {
@@ -57,7 +57,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 }
@@ -80,7 +80,10 @@
         let yAxis = AXNumericDataAxisDescriptor(
             title: "Percentage",
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
 
         let benefitSeries = AXDataSeriesDescriptor(
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
index b25aa9287d9f429c382a3cfb4003f8ea2c80c11e..c7968797d0fb2f7dfabcbbebb788cd9264d0aa4a
--- a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -41,7 +41,7 @@
             .chartYAxis {
                 AxisMarks(position: .leading) {
                     AxisGridLine()
-                    AxisValueLabel(format: .percent)
+                    AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                 }
             }
             .accessibilityChartDescriptor(CompoundingChartDescriptor(points: viewModel.points))
@@ -60,9 +60,19 @@
         let xAxis = AXNumericDataAxisDescriptor(
             title: "Year",
             range: Double((points.first?.year ?? 0))...Double((points.last?.year ?? 0)),
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                String(Int(value))
+            }
+        )
+        let yAxis = AXNumericDataAxisDescriptor(
+            title: "Capacity",
+            range: 0...1,
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
-        let yAxis = AXNumericDataAxisDescriptor(title: "Capacity", range: 0...1, gridlinePositions: [])
 
         let series = AXDataSeriesDescriptor(
             name: "Capacity",
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
index 2ce700cd11c0855d714405bfa9e68d3521028a31..c59531c13f4db12c808b65ff2574996f65908384
--- a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
@@ -10,8 +10,6 @@
 
 struct HistoricalComparisonView: View {
     @State private var viewModel: HistoricalComparisonViewModel
-    @Namespace private var rotorNamespace
-
     init(analysis: PolicyAnalysis) {
         _viewModel = State(initialValue: HistoricalComparisonViewModel(analysis: analysis))
     }
@@ -29,9 +27,7 @@
                 )
                 .foregroundStyle(HistoricalComparisonViewStyle.barColor(isCurrent: entry.isCurrent))
                 .accessibilityLabel(entry.name)
-                .accessibilityValue(entry.coi.formatted(.number.precision(.fractionLength(2))))
-                .accessibilityAddTraits(entry.isCurrent ? .isSelected : [])
-                .accessibilityRotorEntry(id: entry.id, in: rotorNamespace)
+                .accessibilityValue(accessibilityValue(for: entry))
             }
             .chartYAxis {
                 AxisMarks(position: .leading) {
@@ -42,12 +38,16 @@
             .accessibilityElement(children: .contain)
         }
         .padding(24)
-        .accessibilityRotor("Historical Policies") {
-            ForEach(viewModel.entries) { entry in
-                AccessibilityRotorEntry(entry.name, id: entry.id, in: rotorNamespace)
-            }
+        .accessibilityRotor("Historical Policies", entries: viewModel.entries, entryID: \.id, entryLabel: \.name)
+        .accessibilitySortPriority(1)
+    }
+
+    private func accessibilityValue(for entry: HistoricalComparisonEntry) -> String {
+        let score = entry.coi.formatted(.number.precision(.fractionLength(2)))
+        if entry.isCurrent {
+            return "\(score), current policy"
         }
-        .accessibilitySortPriority(1)
+        return score
     }
 }
 
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }

file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..4a1b3f80f9d045c59360287161aa42f4ca26dd92
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -10,6 +10,10 @@
 struct ContentView: View {
     @AppStorage("hasCompletedOnboarding") private var hasCompletedOnboarding: Bool = false
 
+    #if os(iOS)
+    @State private var historyViewModel = PolicyHistoryViewModel()
+    #endif
+
     #if os(macOS)
     @State private var selectedSidebarItem: SidebarItem? = .analyze
     @State private var historyViewModel = PolicyHistoryViewModel()
@@ -19,7 +23,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: historyViewModel)
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..56c9a0232c570d832bae9f796ec09b49d36f2910
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 } else {
@@ -57,7 +57,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 }
@@ -80,7 +80,10 @@
         let yAxis = AXNumericDataAxisDescriptor(
             title: "Percentage",
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
 
         let benefitSeries = AXDataSeriesDescriptor(
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
index b25aa9287d9f429c382a3cfb4003f8ea2c80c11e..c7968797d0fb2f7dfabcbbebb788cd9264d0aa4a
--- a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -41,7 +41,7 @@
             .chartYAxis {
                 AxisMarks(position: .leading) {
                     AxisGridLine()
-                    AxisValueLabel(format: .percent)
+                    AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                 }
             }
             .accessibilityChartDescriptor(CompoundingChartDescriptor(points: viewModel.points))
@@ -60,9 +60,19 @@
         let xAxis = AXNumericDataAxisDescriptor(
             title: "Year",
             range: Double((points.first?.year ?? 0))...Double((points.last?.year ?? 0)),
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                String(Int(value))
+            }
+        )
+        let yAxis = AXNumericDataAxisDescriptor(
+            title: "Capacity",
+            range: 0...1,
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
-        let yAxis = AXNumericDataAxisDescriptor(title: "Capacity", range: 0...1, gridlinePositions: [])
 
         let series = AXDataSeriesDescriptor(
             name: "Capacity",
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
index 2ce700cd11c0855d714405bfa9e68d3521028a31..c59531c13f4db12c808b65ff2574996f65908384
--- a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
@@ -10,8 +10,6 @@
 
 struct HistoricalComparisonView: View {
     @State private var viewModel: HistoricalComparisonViewModel
-    @Namespace private var rotorNamespace
-
     init(analysis: PolicyAnalysis) {
         _viewModel = State(initialValue: HistoricalComparisonViewModel(analysis: analysis))
     }
@@ -29,9 +27,7 @@
                 )
                 .foregroundStyle(HistoricalComparisonViewStyle.barColor(isCurrent: entry.isCurrent))
                 .accessibilityLabel(entry.name)
-                .accessibilityValue(entry.coi.formatted(.number.precision(.fractionLength(2))))
-                .accessibilityAddTraits(entry.isCurrent ? .isSelected : [])
-                .accessibilityRotorEntry(id: entry.id, in: rotorNamespace)
+                .accessibilityValue(accessibilityValue(for: entry))
             }
             .chartYAxis {
                 AxisMarks(position: .leading) {
@@ -42,12 +38,16 @@
             .accessibilityElement(children: .contain)
         }
         .padding(24)
-        .accessibilityRotor("Historical Policies") {
-            ForEach(viewModel.entries) { entry in
-                AccessibilityRotorEntry(entry.name, id: entry.id, in: rotorNamespace)
-            }
+        .accessibilityRotor("Historical Policies", entries: viewModel.entries, entryID: \.id, entryLabel: \.name)
+        .accessibilitySortPriority(1)
+    }
+
+    private func accessibilityValue(for entry: HistoricalComparisonEntry) -> String {
+        let score = entry.coi.formatted(.number.precision(.fractionLength(2)))
+        if entry.isCurrent {
+            return "\(score), current policy"
         }
-        .accessibilitySortPriority(1)
+        return score
     }
 }
 
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Building macOS target**

I'm compiling the macOS build quickly to verify it has no immediate issues before proceeding.
tool xcodebuildmcp.build_macos({})
xcodebuildmcp.build_macos({}) success in 6.47s:
{
  "content": [
    {
      "type": "text",
      "text": "⚠️ Warning: 2026-02-23 00:07:45.265 appintentsmetadataprocessor[62541:376025] warning: Metadata extraction skipped. No AppIntents.framework dependency found."
    },
    {
      "type": "text",
      "text": "✅ macOS Build build succeeded for scheme decodingOppression."
    },
    {
      "type": "text",
      "text": "Next Steps:\n1. Get app path: get_mac_app_path({ scheme: 'decodingOppression' })\n2. Get bundle ID: get_mac_bundle_id({ appPath: 'PATH_FROM_STEP_1' })\n3. Launch: launch_mac_app({ appPath: 'PATH_FROM_STEP_1' })"
    }
  ]
}
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..4a1b3f80f9d045c59360287161aa42f4ca26dd92
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -10,6 +10,10 @@
 struct ContentView: View {
     @AppStorage("hasCompletedOnboarding") private var hasCompletedOnboarding: Bool = false
 
+    #if os(iOS)
+    @State private var historyViewModel = PolicyHistoryViewModel()
+    #endif
+
     #if os(macOS)
     @State private var selectedSidebarItem: SidebarItem? = .analyze
     @State private var historyViewModel = PolicyHistoryViewModel()
@@ -19,7 +23,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: historyViewModel)
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..56c9a0232c570d832bae9f796ec09b49d36f2910
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 } else {
@@ -57,7 +57,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 }
@@ -80,7 +80,10 @@
         let yAxis = AXNumericDataAxisDescriptor(
             title: "Percentage",
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
 
         let benefitSeries = AXDataSeriesDescriptor(
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
index b25aa9287d9f429c382a3cfb4003f8ea2c80c11e..c7968797d0fb2f7dfabcbbebb788cd9264d0aa4a
--- a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -41,7 +41,7 @@
             .chartYAxis {
                 AxisMarks(position: .leading) {
                     AxisGridLine()
-                    AxisValueLabel(format: .percent)
+                    AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                 }
             }
             .accessibilityChartDescriptor(CompoundingChartDescriptor(points: viewModel.points))
@@ -60,9 +60,19 @@
         let xAxis = AXNumericDataAxisDescriptor(
             title: "Year",
             range: Double((points.first?.year ?? 0))...Double((points.last?.year ?? 0)),
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                String(Int(value))
+            }
+        )
+        let yAxis = AXNumericDataAxisDescriptor(
+            title: "Capacity",
+            range: 0...1,
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
-        let yAxis = AXNumericDataAxisDescriptor(title: "Capacity", range: 0...1, gridlinePositions: [])
 
         let series = AXDataSeriesDescriptor(
             name: "Capacity",
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
index 2ce700cd11c0855d714405bfa9e68d3521028a31..c59531c13f4db12c808b65ff2574996f65908384
--- a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
@@ -10,8 +10,6 @@
 
 struct HistoricalComparisonView: View {
     @State private var viewModel: HistoricalComparisonViewModel
-    @Namespace private var rotorNamespace
-
     init(analysis: PolicyAnalysis) {
         _viewModel = State(initialValue: HistoricalComparisonViewModel(analysis: analysis))
     }
@@ -29,9 +27,7 @@
                 )
                 .foregroundStyle(HistoricalComparisonViewStyle.barColor(isCurrent: entry.isCurrent))
                 .accessibilityLabel(entry.name)
-                .accessibilityValue(entry.coi.formatted(.number.precision(.fractionLength(2))))
-                .accessibilityAddTraits(entry.isCurrent ? .isSelected : [])
-                .accessibilityRotorEntry(id: entry.id, in: rotorNamespace)
+                .accessibilityValue(accessibilityValue(for: entry))
             }
             .chartYAxis {
                 AxisMarks(position: .leading) {
@@ -42,12 +38,16 @@
             .accessibilityElement(children: .contain)
         }
         .padding(24)
-        .accessibilityRotor("Historical Policies") {
-            ForEach(viewModel.entries) { entry in
-                AccessibilityRotorEntry(entry.name, id: entry.id, in: rotorNamespace)
-            }
+        .accessibilityRotor("Historical Policies", entries: viewModel.entries, entryID: \.id, entryLabel: \.name)
+        .accessibilitySortPriority(1)
+    }
+
+    private func accessibilityValue(for entry: HistoricalComparisonEntry) -> String {
+        let score = entry.coi.formatted(.number.precision(.fractionLength(2)))
+        if entry.isCurrent {
+            return "\(score), current policy"
         }
-        .accessibilitySortPriority(1)
+        return score
     }
 }
 
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }


thinking
**Verifying symbols and concurrency readiness**

I'm confirming that symbol types align with expected chart scales and noting concurrency warnings might arise on iOS builds, prompting a retry of the iOS simulator build to catch potential issues.
tool xcodebuildmcp.build_sim({})
xcodebuildmcp.build_sim({}) failed in 1m 00s:
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..4a1b3f80f9d045c59360287161aa42f4ca26dd92
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -10,6 +10,10 @@
 struct ContentView: View {
     @AppStorage("hasCompletedOnboarding") private var hasCompletedOnboarding: Bool = false
 
+    #if os(iOS)
+    @State private var historyViewModel = PolicyHistoryViewModel()
+    #endif
+
     #if os(macOS)
     @State private var selectedSidebarItem: SidebarItem? = .analyze
     @State private var historyViewModel = PolicyHistoryViewModel()
@@ -19,7 +23,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: historyViewModel)
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..56c9a0232c570d832bae9f796ec09b49d36f2910
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 } else {
@@ -57,7 +57,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 }
@@ -80,7 +80,10 @@
         let yAxis = AXNumericDataAxisDescriptor(
             title: "Percentage",
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
 
         let benefitSeries = AXDataSeriesDescriptor(
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
index b25aa9287d9f429c382a3cfb4003f8ea2c80c11e..c7968797d0fb2f7dfabcbbebb788cd9264d0aa4a
--- a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -41,7 +41,7 @@
             .chartYAxis {
                 AxisMarks(position: .leading) {
                     AxisGridLine()
-                    AxisValueLabel(format: .percent)
+                    AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                 }
             }
             .accessibilityChartDescriptor(CompoundingChartDescriptor(points: viewModel.points))
@@ -60,9 +60,19 @@
         let xAxis = AXNumericDataAxisDescriptor(
             title: "Year",
             range: Double((points.first?.year ?? 0))...Double((points.last?.year ?? 0)),
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                String(Int(value))
+            }
+        )
+        let yAxis = AXNumericDataAxisDescriptor(
+            title: "Capacity",
+            range: 0...1,
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
-        let yAxis = AXNumericDataAxisDescriptor(title: "Capacity", range: 0...1, gridlinePositions: [])
 
         let series = AXDataSeriesDescriptor(
             name: "Capacity",
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
index 2ce700cd11c0855d714405bfa9e68d3521028a31..c59531c13f4db12c808b65ff2574996f65908384
--- a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
@@ -10,8 +10,6 @@
 
 struct HistoricalComparisonView: View {
     @State private var viewModel: HistoricalComparisonViewModel
-    @Namespace private var rotorNamespace
-
     init(analysis: PolicyAnalysis) {
         _viewModel = State(initialValue: HistoricalComparisonViewModel(analysis: analysis))
     }
@@ -29,9 +27,7 @@
                 )
                 .foregroundStyle(HistoricalComparisonViewStyle.barColor(isCurrent: entry.isCurrent))
                 .accessibilityLabel(entry.name)
-                .accessibilityValue(entry.coi.formatted(.number.precision(.fractionLength(2))))
-                .accessibilityAddTraits(entry.isCurrent ? .isSelected : [])
-                .accessibilityRotorEntry(id: entry.id, in: rotorNamespace)
+                .accessibilityValue(accessibilityValue(for: entry))
             }
             .chartYAxis {
                 AxisMarks(position: .leading) {
@@ -42,12 +38,16 @@
             .accessibilityElement(children: .contain)
         }
         .padding(24)
-        .accessibilityRotor("Historical Policies") {
-            ForEach(viewModel.entries) { entry in
-                AccessibilityRotorEntry(entry.name, id: entry.id, in: rotorNamespace)
-            }
+        .accessibilityRotor("Historical Policies", entries: viewModel.entries, entryID: \.id, entryLabel: \.name)
+        .accessibilitySortPriority(1)
+    }
+
+    private func accessibilityValue(for entry: HistoricalComparisonEntry) -> String {
+        let score = entry.coi.formatted(.number.precision(.fractionLength(2)))
+        if entry.isCurrent {
+            return "\(score), current policy"
         }
-        .accessibilitySortPriority(1)
+        return score
     }
 }
 
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }



thinking
**Summarizing final changes and tests**

The build timed out on macOS using xcodebuild; no critical compile errors remain. Modifications include updating several Views, ViewModels, and style files, with optional consideration of replacing custom chart symbol shapes. Tests were run via macOS build, and no nested bullet lists were used in the summary.
thinking
**Finalizing summary and test report**

Planning a concise final response with separate **Summary** and **Tests** sections, avoiding nested bullets. The summary will note key fixes minimally and mention that AGENTS.md was not found in the repo. Tests will list macOS build success and simulator build timeout as a numbered list.
codex
AGENTS.md not found in the repo.

**Summary**
- Fixed build errors in chart symbol shapes, axis labels, and accessibility rotor wiring.
- Updated MLX embedding evaluation and Tokenizers import, plus analysis pipeline call and view model injection.
- Adjusted formatting helpers and rotor/section naming to avoid type conflicts.

**Tests**
1. `xcodebuildmcp build_macos` (passed)
2. `xcodebuildmcp build_sim` (timed out)
file update:
diff --git a/app/decodingOppression/decodingOppression/ContentView.swift b/app/decodingOppression/decodingOppression/ContentView.swift
index 45a74dacf5c68dd525a9374982e691ee87962cd4..4a1b3f80f9d045c59360287161aa42f4ca26dd92
--- a/app/decodingOppression/decodingOppression/ContentView.swift
+++ b/app/decodingOppression/decodingOppression/ContentView.swift
@@ -10,6 +10,10 @@
 struct ContentView: View {
     @AppStorage("hasCompletedOnboarding") private var hasCompletedOnboarding: Bool = false
 
+    #if os(iOS)
+    @State private var historyViewModel = PolicyHistoryViewModel()
+    #endif
+
     #if os(macOS)
     @State private var selectedSidebarItem: SidebarItem? = .analyze
     @State private var historyViewModel = PolicyHistoryViewModel()
@@ -19,7 +23,7 @@
         #if os(iOS)
         NavigationStack {
             if hasCompletedOnboarding {
-                PolicyHistoryView()
+                PolicyHistoryView(viewModel: historyViewModel)
             } else {
                 WelcomeView(hasCompletedOnboarding: $hasCompletedOnboarding)
             }
diff --git a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
index 2183575ba0f48ed3070b9cf6b1cb3a1f11e8b7d5..817a851a2f7089b25d3ef82587dd95c57de59bdc
--- a/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
+++ b/app/decodingOppression/decodingOppression/MLX/MLXEmbeddingEngine.swift
@@ -9,6 +9,7 @@
 #if !targetEnvironment(simulator)
 import MLX
 import MLXEmbedders
+import Tokenizers
 #endif
 
 actor MLXEmbeddingEngine {
@@ -24,7 +25,7 @@
 
     func embed(_ text: String) async throws -> [Float] {
         guard let modelContainer else { throw MLXError.modelNotLoaded }
-        return try await modelContainer.perform { model, tokenizer, pooler in
+        return await modelContainer.perform { model, tokenizer, pooler in
             let tokens = tokenizer.encode(text: text, addSpecialTokens: true)
             let padId = tokenizer.eosTokenId ?? 0
             let maxLength = max(tokens.count, 1)
@@ -34,7 +35,8 @@
             let mask = (inputs .!= padId)
             let tokenTypes = MLXArray.zeros(like: inputs)
             let output = model(inputs, positionIds: nil, tokenTypeIds: tokenTypes, attentionMask: mask)
-            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true).eval()
+            let pooled = pooler(output, mask: mask, normalize: true, applyLayerNorm: true)
+            pooled.eval()
             if pooled.shape.count == 2 {
                 return pooled[0].asArray(Float.self)
             }
diff --git a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
index 3d650e23a33e87d4e46ad7689278eb71e95398fb..efa9ba1e1962653fbb3e991e9974ab5ddaabf0e4
--- a/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/AnalysisViewModel.swift
@@ -43,7 +43,8 @@
             guard let self else { return }
             do {
                 let pipeline = try deps.makeAnalysisPipeline()
-                for await progress in pipeline.analyze(pdfURL: pdfURL) {
+                let stream = await pipeline.analyze(pdfURL: pdfURL)
+                for await progress in stream {
                     switch progress {
                     case .extracting:
                         stage = "Extracting text..."
diff --git a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
index df8ca4522854555efbe01dd4ee4504d9f8fe91bb..e2d110c0815d030056b28d4249a2ce24d7d4f450
--- a/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
+++ b/app/decodingOppression/decodingOppression/ViewModels/Charts/CompoundingTrajectoryViewModel.swift
@@ -35,7 +35,7 @@
     }
 
     var summary: String {
-        let values = points.map { "\($0.year): \($0.capacity, format: .percent)" }
+        let values = points.map { "\($0.year): \($0.capacity.formatted(.percent))" }
         return values.joined(separator: ", ")
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
index 45b3fb1c6523f087bbc67713338726099a469a95..56c9a0232c570d832bae9f796ec09b49d36f2910
--- a/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/BenefitHierarchyView.swift
@@ -43,7 +43,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 } else {
@@ -57,7 +57,7 @@
                     .chartYAxis {
                         AxisMarks(position: .leading) {
                             AxisGridLine()
-                            AxisValueLabel(format: .percent)
+                            AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                         }
                     }
                 }
@@ -80,7 +80,10 @@
         let yAxis = AXNumericDataAxisDescriptor(
             title: "Percentage",
             range: 0...1,
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
 
         let benefitSeries = AXDataSeriesDescriptor(
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
index b25aa9287d9f429c382a3cfb4003f8ea2c80c11e..c7968797d0fb2f7dfabcbbebb788cd9264d0aa4a
--- a/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/CompoundingTrajectoryView.swift
@@ -41,7 +41,7 @@
             .chartYAxis {
                 AxisMarks(position: .leading) {
                     AxisGridLine()
-                    AxisValueLabel(format: .percent)
+                    AxisValueLabel(format: FloatingPointFormatStyle<Double>.Percent())
                 }
             }
             .accessibilityChartDescriptor(CompoundingChartDescriptor(points: viewModel.points))
@@ -60,9 +60,19 @@
         let xAxis = AXNumericDataAxisDescriptor(
             title: "Year",
             range: Double((points.first?.year ?? 0))...Double((points.last?.year ?? 0)),
-            gridlinePositions: []
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                String(Int(value))
+            }
+        )
+        let yAxis = AXNumericDataAxisDescriptor(
+            title: "Capacity",
+            range: 0...1,
+            gridlinePositions: [],
+            valueDescriptionProvider: { value in
+                value.formatted(.percent)
+            }
         )
-        let yAxis = AXNumericDataAxisDescriptor(title: "Capacity", range: 0...1, gridlinePositions: [])
 
         let series = AXDataSeriesDescriptor(
             name: "Capacity",
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
index a7110432d96878c34ef5ae3940a00118625607ea..971b90278fa2a0b0f9ab8676c14d3c78ef12c1d5
--- a/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/EliteInterestDetailView.swift
@@ -24,7 +24,11 @@
             MetricRow(title: "Elite clause share", value: viewModel.eliteClauseRate)
             MetricRow(title: "Elite benefit rate", value: viewModel.eliteBenefitRate)
             MetricRow(title: "Elite burden rate", value: viewModel.eliteBurdenRate)
-            MetricRow(title: "Average confidence", value: viewModel.eliteAverageConfidence, format: .number.precision(.fractionLength(2)))
+            MetricRow(
+                title: "Average confidence",
+                value: viewModel.eliteAverageConfidence,
+                formatter: { $0.formatted(.number.precision(.fractionLength(2))) }
+            )
         }
         .padding(24)
         .accessibilityLabel("Elite Interest Detail")
@@ -34,12 +38,14 @@
 private struct MetricRow: View {
     let title: String
     let value: Double
-    let format: FloatingPointFormatStyle<Double>
+    let formatter: (Double) -> String
 
-    init(title: String, value: Double, format: FloatingPointFormatStyle<Double> = .percent.precision(.fractionLength(0))) {
+    init(title: String, value: Double, formatter: @escaping (Double) -> String = { value in
+        value.formatted(.percent.precision(.fractionLength(0)))
+    }) {
         self.title = title
         self.value = value
-        self.format = format
+        self.formatter = formatter
     }
 
     var body: some View {
@@ -47,7 +53,7 @@
             Text(title)
                 .font(EliteInterestDetailViewStyle.metricFont)
             Spacer()
-            Text(value.formatted(format))
+            Text(formatter(value))
                 .font(.headline.monospacedDigit())
                 .foregroundStyle(.primary)
         }
diff --git a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
index 2ce700cd11c0855d714405bfa9e68d3521028a31..c59531c13f4db12c808b65ff2574996f65908384
--- a/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
+++ b/app/decodingOppression/decodingOppression/Views/Charts/HistoricalComparisonView.swift
@@ -10,8 +10,6 @@
 
 struct HistoricalComparisonView: View {
     @State private var viewModel: HistoricalComparisonViewModel
-    @Namespace private var rotorNamespace
-
     init(analysis: PolicyAnalysis) {
         _viewModel = State(initialValue: HistoricalComparisonViewModel(analysis: analysis))
     }
@@ -29,9 +27,7 @@
                 )
                 .foregroundStyle(HistoricalComparisonViewStyle.barColor(isCurrent: entry.isCurrent))
                 .accessibilityLabel(entry.name)
-                .accessibilityValue(entry.coi.formatted(.number.precision(.fractionLength(2))))
-                .accessibilityAddTraits(entry.isCurrent ? .isSelected : [])
-                .accessibilityRotorEntry(id: entry.id, in: rotorNamespace)
+                .accessibilityValue(accessibilityValue(for: entry))
             }
             .chartYAxis {
                 AxisMarks(position: .leading) {
@@ -42,12 +38,16 @@
             .accessibilityElement(children: .contain)
         }
         .padding(24)
-        .accessibilityRotor("Historical Policies") {
-            ForEach(viewModel.entries) { entry in
-                AccessibilityRotorEntry(entry.name, id: entry.id, in: rotorNamespace)
-            }
+        .accessibilityRotor("Historical Policies", entries: viewModel.entries, entryID: \.id, entryLabel: \.name)
+        .accessibilitySortPriority(1)
+    }
+
+    private func accessibilityValue(for entry: HistoricalComparisonEntry) -> String {
+        let score = entry.coi.formatted(.number.precision(.fractionLength(2)))
+        if entry.isCurrent {
+            return "\(score), current policy"
         }
-        .accessibilitySortPriority(1)
+        return score
     }
 }
 
diff --git a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
index c420a0d9e4ded24f8e499f9c62eaa679d79696fd..4306cf6fa2890b52b0fae50e6602bd6a09d272dc
--- a/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ClauseListView.swift
@@ -17,7 +17,7 @@
 
     var body: some View {
         List {
-            Section("Oppressive Clauses") {
+            SwiftUI.Section("Oppressive Clauses") {
                 if viewModel.oppressiveClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -29,7 +29,7 @@
                 }
             }
 
-            Section("Liberatory Clauses") {
+            SwiftUI.Section("Liberatory Clauses") {
                 if viewModel.liberatoryClauses.isEmpty {
                     Text("None identified")
                         .foregroundStyle(.secondary)
@@ -44,12 +44,12 @@
         .navigationTitle("Clauses")
         .accessibilityRotor("Oppressive Clauses") {
             ForEach(viewModel.oppressiveClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
         .accessibilityRotor("Liberatory Clauses") {
             ForEach(viewModel.liberatoryClauses) { item in
-                AccessibilityRotorEntry(item.clause.text, id: item.id, in: rotorNamespace)
+                AccessibilityRotorEntry(Text(item.clause.text), id: item.id, in: rotorNamespace)
             }
         }
     }
diff --git a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
index 246f82577c0b69624a8b3e1435db7b0adb9689af..75ff5b010cee7f1bc48017df5e7ca365c30749ed
--- a/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
+++ b/app/decodingOppression/decodingOppression/Views/PolicyHistoryView.swift
@@ -18,7 +18,7 @@
     @State private var viewModel: PolicyHistoryViewModel
     @State private var analysisSelection: PDFSelection?
 
-    init(viewModel: PolicyHistoryViewModel = PolicyHistoryViewModel()) {
+    init(viewModel: PolicyHistoryViewModel) {
         _viewModel = State(initialValue: viewModel)
     }
 
@@ -176,14 +176,14 @@
     }
 }
 
-private struct PDFSelection: Identifiable {
+private struct PDFSelection: Identifiable, Hashable {
     let id = UUID()
     let url: URL
 }
 
 #Preview {
     NavigationStack {
-        PolicyHistoryView()
+        PolicyHistoryView(viewModel: PolicyHistoryViewModel())
             .environmentObject(ModelDownloadManager.shared)
     }
 }
diff --git a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
index a7a24d02aaf6a4b172186c7e434c414c450348b9..68d62dcbaa1d88f3efae6ca3f25bb6feeb471221
--- a/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
+++ b/app/decodingOppression/decodingOppression/Views/ScoreCardView.swift
@@ -31,61 +31,65 @@
 
     var body: some View {
         @Bindable var viewModel = viewModel
-        #if os(macOS)
-        HSplitView {
+        let content = Group {
+            #if os(macOS)
+            HSplitView {
+                ScrollView {
+                    scoreCardContent
+                        .padding(24)
+                }
+                detailPanel
+                    .frame(minWidth: 320)
+            }
+            .toolbar { exportToolbar }
+            .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
+                ExportView(analysis: viewModel.analysis)
+                    .frame(width: 360)
+            }
+            #else
             ScrollView {
                 scoreCardContent
                     .padding(24)
             }
-            detailPanel
-                .frame(minWidth: 320)
+            .toolbar { exportToolbar }
+            .sheet(isPresented: $viewModel.isShowingExport) {
+                ExportView(analysis: viewModel.analysis)
+            }
+            #endif
         }
-        .toolbar { exportToolbar }
-        .popover(isPresented: $viewModel.isShowingExport, attachmentAnchor: .rect(.bounds), arrowEdge: .top) {
-            ExportView(analysis: viewModel.analysis)
-                .frame(width: 360)
-        }
-        #else
-        ScrollView {
-            scoreCardContent
-                .padding(24)
-        }
-        .toolbar { exportToolbar }
-        .sheet(isPresented: $viewModel.isShowingExport) {
-            ExportView(analysis: viewModel.analysis)
-        }
-        #endif
-        .accessibilityRotor("Scores") {
-            AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
-            AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
-            AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
-            AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
-            AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
-            AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
-        }
-        .accessibilitySortPriority(5)
-        .onAppear {
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
-            if let animation {
-                withAnimation(animation) {
+
+        return content
+            .accessibilityRotor("Scores") {
+                AccessibilityRotorEntry("Composite Oppression Index", id: "coi", in: rotorNamespace)
+                AccessibilityRotorEntry("Differential Impact Score", id: "dis", in: rotorNamespace)
+                AccessibilityRotorEntry("Architecture Detection Score", id: "ads", in: rotorNamespace)
+                AccessibilityRotorEntry("Elite Interest Score", id: "eis", in: rotorNamespace)
+                AccessibilityRotorEntry("Compounding Impact Score", id: "cis", in: rotorNamespace)
+                AccessibilityRotorEntry("Outgroup Expansion Score", id: "oes", in: rotorNamespace)
+            }
+            .accessibilitySortPriority(5)
+            .onAppear {
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, viewModel.analysis.scoreResult.coi))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
-        .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
-            let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
-            let target = max(0, min(1, newValue))
-            if let animation {
-                withAnimation(animation) {
+            .onChange(of: viewModel.analysis.scoreResult.coi) { _, newValue in
+                let animation = ScoreCardViewStyle.scoreRevealAnimation(reduceMotion: reduceMotion)
+                let target = max(0, min(1, newValue))
+                if let animation {
+                    withAnimation(animation) {
+                        animatedCOI = target
+                    }
+                } else {
                     animatedCOI = target
                 }
-            } else {
-                animatedCOI = target
             }
-        }
     }
 
     private var exportToolbar: some ToolbarContent {
diff --git a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
index 2479d7af5c43e8c51aa03a51f07cc9819ea2e95a..f67acd6b3c09f819248b245edddd70e81c6c130c
--- a/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
+++ b/app/decodingOppression/decodingOppression/Views/Style/Charts/BenefitHierarchyViewStyle.swift
@@ -22,52 +22,34 @@
         }
     }
 
-    static func symbolShape(for effect: EffectDirection) -> AnySymbolShape {
-        switch effect {
-        case .benefit:
-            return AnySymbolShape(DiamondSymbol())
-        case .burden:
-            return AnySymbolShape(TriangleSymbol())
-        default:
-            return AnySymbolShape(Circle())
-        }
+    static func symbolShape(for effect: EffectDirection) -> BenefitSymbol {
+        BenefitSymbol(effect: effect)
     }
 }
-
-struct AnySymbolShape: ChartSymbolShape {
-    private let pathBuilder: (CGRect) -> Path
 
-    init<S: ChartSymbolShape>(_ shape: S) {
-        self.pathBuilder = { rect in
-            shape.path(in: rect)
-        }
-    }
-
-    func path(in rect: CGRect) -> Path {
-        pathBuilder(rect)
-    }
-}
+struct BenefitSymbol: ChartSymbolShape {
+    let effect: EffectDirection
+    static var defaultSize: CGSize { CGSize(width: 14, height: 14) }
+    var perceptualUnitRect: CGRect { CGRect(x: 0, y: 0, width: 1, height: 1) }
 
-struct DiamondSymbol: ChartSymbolShape {
     func path(in rect: CGRect) -> Path {
         var path = Path()
-        let center = CGPoint(x: rect.midX, y: rect.midY)
-        path.move(to: CGPoint(x: center.x, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
-        path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: center.y))
-        path.closeSubpath()
-        return path
-    }
-}
-
-struct TriangleSymbol: ChartSymbolShape {
-    func path(in rect: CGRect) -> Path {
-        var path = Path()
-        path.move(to: CGPoint(x: rect.midX, y: rect.minY))
-        path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
-        path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
-        path.closeSubpath()
+        switch effect {
+        case .benefit:
+            let center = CGPoint(x: rect.midX, y: rect.midY)
+            path.move(to: CGPoint(x: center.x, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: center.y))
+            path.addLine(to: CGPoint(x: center.x, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: center.y))
+            path.closeSubpath()
+        case .burden:
+            path.move(to: CGPoint(x: rect.midX, y: rect.minY))
+            path.addLine(to: CGPoint(x: rect.maxX, y: rect.maxY))
+            path.addLine(to: CGPoint(x: rect.minX, y: rect.maxY))
+            path.closeSubpath()
+        default:
+            path.addEllipse(in: rect)
+        }
         return path
     }
 }

tokens used
226,806
AGENTS.md not found in the repo.

**Summary**
- Fixed build errors in chart symbol shapes, axis labels, and accessibility rotor wiring.
- Updated MLX embedding evaluation and Tokenizers import, plus analysis pipeline call and view model injection.
- Adjusted formatting helpers and rotor/section naming to avoid type conflicts.

**Tests**
1. `xcodebuildmcp build_macos` (passed)
2. `xcodebuildmcp build_sim` (timed out)
